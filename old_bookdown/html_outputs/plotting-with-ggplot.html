<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>28 Plotting with ggplot | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.15/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet">
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script><link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.3/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script><script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Editorial and technical notes</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Download handbook and data</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transition to R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Suggested packages</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">6</span> Import and export</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">7</span> R projects</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Cleaning data and core functions</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">10</span> Factors</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivoting data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">13</span> Joining data</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">14</span> Characters and strings</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteration, loops, and lists</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Descriptive tables</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Simple statistical tests</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Univariate and multivariable regression</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Missing data</a></li>
<li><a class="" href="standardization-1.html"><span class="header-section-number">21</span> Standardization</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection-1.html"><span class="header-section-number">23</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Epidemic modeling</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="active" href="plotting-with-ggplot.html"><span class="header-section-number">28</span> Plotting with ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">29</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">30</span> Epidemic curves</a></li>
<li><a class="" href="plot-continuous-data.html"><span class="header-section-number">31</span> Plot continuous data</a></li>
<li><a class="" href="plot-categorical-data.html"><span class="header-section-number">32</span> Plot categorical data</a></li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">33</span> Tables for presentation</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">34</span> Demographic pyramids and Likert-scales</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagrams and charts</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Combinations analysis</a></li>
<li><a class="" href="heat-tiles.html"><span class="header-section-number">37</span> Heat tiles</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">38</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">39</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">40</span> Interactive plots</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="r-markdown-reports.html"><span class="header-section-number">41</span> R Markdown reports</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">42</span> Organizing routine reports</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">43</span> Dashboards with R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">44</span> Dashboards with Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">45</span> Writing functions</a></li>
<li><a class="" href="version-control-and-collaboration-with-github.html"><span class="header-section-number">46</span> Version control and collaboration with Github</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">47</span> Directory interactions</a></li>
<li><a class="" href="errors-help.html"><span class="header-section-number">48</span> Errors &amp; help</a></li>
<li><a class="" href="relational-databases.html"><span class="header-section-number">49</span> Relational databases</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">50</span> R on network drives</a></li>
<li><a class="" href="advanced-rstudio.html"><span class="header-section-number">51</span> Advanced RStudio</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="plotting-with-ggplot" class="section level1" number="28">
<h1>
<span class="header-section-number">28</span> Plotting with ggplot<a class="anchor" aria-label="anchor" href="#plotting-with-ggplot"><i class="fas fa-link"></i></a>
</h1>
<p><strong>ggplot2</strong> is the most popular data visualisation package in R and is generally used instead of <strong>base</strong> <code>R</code> for creating figures. The “gg” in the name represents a “<strong>g</strong>rammar of <strong>g</strong>raphics”. <strong>ggplot2</strong> benefits from a wide variety of supplementary R packages that further enhance its functionality.</p>
<p>The syntax is significantly different from <strong>base</strong> <code>R</code> plotting, and has a learning curve associated with it. Using <strong>ggplot2</strong> generally requires the user to format their data in a way that is highly <strong>tidyverse</strong> compatible, which ultimately makes using these packages together very effective.</p>
<p>In this page we will cover:</p>
<ul>
<li>The fundamentals of plotting with <strong>ggplot2</strong><br>
</li>
<li>Tips and tricks to make your plots sharp</li>
</ul>
<p>There a several extensive <strong>ggplot2</strong> tutorials linked in the resources section. You can also download this <a href="https://rstudio.com/resources/cheatsheets/">data visualization with ggplot cheatsheet</a> from the RStudio website. If you want inspiration for ways to creatively visualise your data, we suggest reviewing websites like the <a href="https://www.r-graph-gallery.com/">R graph gallery</a> and <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
<div id="preparation-19" class="section level2" number="28.1">
<h2>
<span class="header-section-number">28.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-19"><i class="fas fa-link"></i></a>
</h2>
<div id="load-packages-17" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages-17"><i class="fas fa-link"></i></a>
</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load packages with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<div class="sourceCode" id="cb1235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">tidyverse</span>,      <span class="co"># includes ggplot2 and other</span>
  <span class="va">rio</span>,            <span class="co"># import/export</span>
  <span class="va">here</span>,           <span class="co"># file locator</span>
  <span class="va">stringr</span>,        <span class="co"># working with characters   </span>
  <span class="va">scales</span>,         <span class="co"># transform numbers</span>
  <span class="va">ggrepel</span>,        <span class="co"># smartly-placed labels</span>
  <span class="va">gghighlight</span>,    <span class="co"># highlight one part of plot</span>
  <span class="va">RColorBrewer</span>    <span class="co"># color scales</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="import-data-13" class="section level3 unnumbered">
<h3>Import data<a class="anchor" aria-label="anchor" href="#import-data-13"><i class="fas fa-link"></i></a>
</h3>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page. The dataset is imported using the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data.</p>
<div class="sourceCode" id="cb1236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p>The first 50 rows of the linelist are displayed below. We will focus on the continuous variables <code>age</code>, <code>wt_kg</code> (weight in kilos), <code>ct_blood</code> (CT values), and <code>days_onset_hosp</code> (difference between onset date and hospitalisation).</p>
<div id="htmlwidget-f809783fcfbba19ba8a7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f809783fcfbba19ba8a7">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="general-cleaning" class="section level3 unnumbered">
<h3>General cleaning<a class="anchor" aria-label="anchor" href="#general-cleaning"><i class="fas fa-link"></i></a>
</h3>
<p>When preparing data to plot, it is best to make the data adhere to <a href="https://r4ds.had.co.nz/tidy-data.html">“tidy” data standards</a> as much as possible. How to achieve this is expanded on in the data management pages of this handbook, such as <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Cleaning data and core functions</a>.</p>
<p>Some simple ways we can prepare our data to make it better for plotting can include making the contents of the data better for display - this does not necessarily mean its better for data manipulation! For example:</p>
<ul>
<li>Replace <code>NA</code> values in a character column with the string “Unknown”<br>
</li>
<li>Clean some columns so that their “data friendly” values with underscores etc are changed to normal text or title case (see <a href="characters-and-strings.html#characters-and-strings">Characters and strings</a>)</li>
</ul>
<p>Here are some examples of this in action:</p>
<div class="sourceCode" id="cb1237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="co"># make display version of columns with more friendly names</span>
  <span class="fu">mutate</span><span class="op">(</span>
    <span class="co"># f to Male, f to Female, NA to Unknown</span>
    gender_disp <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">~</span> <span class="st">"Male"</span>,
                            <span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span> <span class="op">~</span> <span class="st">"Female"</span>,
                            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Unknown"</span><span class="op">)</span>,
    <span class="co"># replace NA with unknown for outcome</span>
    outcome_disp <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="pivoting-longer" class="section level3 unnumbered">
<h3>Pivoting longer<a class="anchor" aria-label="anchor" href="#pivoting-longer"><i class="fas fa-link"></i></a>
</h3>
<p>As a matter of data structure, for <strong>ggplot2</strong> we often also want to pivot our data into <em>longer</em> formats, which will allow us to use a set of variables as a single variable. Read more about this is the page on <a href="pivoting-data.html#pivoting-data">Pivoting data</a>.</p>
<p>For example, say that we have “wide” data with each case and their symptoms (as shown shown below, in the style of the linelist).</p>
<div class="sourceCode" id="cb1238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symptoms_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here is how the first 50 rows look:</p>
<div id="htmlwidget-e5bcd6d66609089d9b8d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5bcd6d66609089d9b8d">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>If we wanted to show the number of cases with specific symptoms, we are limited by the fact that each symptom is a specific column. However, we can <em>pivot</em> the symptoms columns to a longer format like this:</p>
<div class="sourceCode" id="cb1239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symptoms_data_long</span> <span class="op">&lt;-</span> <span class="va">symptoms_data</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,
               names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,
               values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here are the first 50 rows. Note that case has 5 rows - one for each possibly symptom. Scroll to the right to see the new columns <code>symptom_name</code> and <code>symptom_is_present</code>. Note that this format is not very useful for other operations, and should just be used for the plot it was made for.</p>
<div id="htmlwidget-76fe2ed7a3855b3757bb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-76fe2ed7a3855b3757bb">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","5fe599","5fe599","5fe599","5fe599","8689b7","8689b7","8689b7","8689b7","8689b7","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","b8812a","b8812a","b8812a","b8812a","b8812a","893f25","893f25","893f25","893f25","893f25","be99c8","be99c8","be99c8","be99c8","be99c8","07e3e8","07e3e8","07e3e8","07e3e8","07e3e8","369449","369449","369449","369449","369449","f393b4","f393b4","f393b4","f393b4","f393b4","1389ca","1389ca","1389ca","1389ca","1389ca"],["fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit"],["no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","no","no","no","no","no","no","no","yes","no","yes","no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","no","no","yes","no","yes","no","no","yes","no","yes","no","no","yes","no","no"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>symptom_name<\/th>\n      <th>symptom_is_present<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="basics-of-ggplot" class="section level2" number="28.2">
<h2>
<span class="header-section-number">28.2</span> Basics of ggplot<a class="anchor" aria-label="anchor" href="#basics-of-ggplot"><i class="fas fa-link"></i></a>
</h2>
<p><strong>“Grammar of graphics” - ggplot2</strong></p>
<p>Plotting with <strong>ggplot2</strong> is based on “adding” plot layers and attribute specifications on top of one another, with each sub-command added with a plus symbol (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>). The result is a multi-layer plot object that can be saved, modified, printed, exported, etc.</p>
<p>ggplot objects can be highly complex, but the basic order of layers will usually look like this:</p>
<ol style="list-style-type: decimal">
<li>Begin with the baseline <code>ggplot()</code> command - establish the coordinate base and specify the dataset<br>
</li>
<li>Add “geom” layers - these geometric functions visualize the data as a bar graph, line plot, scatter plot, histogram, etc (or a combination!). These functions all start with <code>geom_</code> as a prefix.<br>
</li>
<li>Add adjustments to the plot such as to specify the axis labels, title, fonts, sizes, color schemes, legends, rotate the axes, etc.</li>
</ol>
<p>A simple example of skeleton code is as follows. We will explain each component in the sections below.</p>
<div class="sourceCode" id="cb1240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">my_data</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_XXXX</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">col1</span>, y <span class="op">=</span> <span class="va">col2</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"color"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="ggplot" class="section level2" number="28.3">
<h2>
<span class="header-section-number">28.3</span> <code>ggplot()</code><a class="anchor" aria-label="anchor" href="#ggplot"><i class="fas fa-link"></i></a>
</h2>
<p>The opening command of any ggplot2 plot is <code>ggplot()</code>. This command simply creates a blank canvas upon which to add layers. It “opens” the way for further layers to be added with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> symbol.</p>
<p>Typically, the command <code>ggplot()</code> includes the <code>data =</code> argument for the plot. This sets the default dataset to be used for subsequent layers of the plot.</p>
<p>Finally, this command will end with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> after the closing parentheses. This leaves the command “open”. The plot will only execute/appear when the command includes a final layer without a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> at the end.</p>
<div class="sourceCode" id="cb1241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This will create plot that is a blank canvas</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></code></pre></div>
</div>
<div id="geoms" class="section level2" number="28.4">
<h2>
<span class="header-section-number">28.4</span> Geoms<a class="anchor" aria-label="anchor" href="#geoms"><i class="fas fa-link"></i></a>
</h2>
<p>A blank canvas is not sufficient! We need to create geometries from our data! Bar plots, histograms, scatter plots, box plots!</p>
<p>This is done by adding layers of geometry to the initial <code>ggplot()</code> command. There are many <strong>ggplot2</strong> functions that create “geoms”. Each of these functions begins with “geom_”, so we will refer to them generically as <code>geom_XXXX()</code>. There are over 40 geoms in <strong>ggplot2</strong> and many others created by fans. View them at the <a href="https://exts.ggplot2.tidyverse.org/gallery/">ggplot2 gallery</a>. Some common geoms are listed below:</p>
<ul>
<li>Histograms - <code>geom_histogram()</code><br>
</li>
<li>Bar charts - <code>geom_bar()</code><br>
</li>
<li>Box plots - <code>geom_boxplot()</code><br>
</li>
<li>Points (e.g. scatter plots) - <code>geom_point()</code><br>
</li>
<li>Line graphs - <code>geom_line()</code> or <code>geom_path()</code><br>
</li>
<li>Trend lines - <code>geom_smooth()</code>
</li>
</ul>
<p>In one plot you can display one or multiple geoms. Each is added with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, and they are plotted sequentially such that later geoms are plotted on top of previous ones.</p>
<p>But simply knowing these geom functions is not sufficient to produce a plot! We must also <em>map</em> the data to the plot…</p>
</div>
<div id="mapping-plot-aesthetics-to-data" class="section level2" number="28.5">
<h2>
<span class="header-section-number">28.5</span> Mapping plot aesthetics to data<a class="anchor" aria-label="anchor" href="#mapping-plot-aesthetics-to-data"><i class="fas fa-link"></i></a>
</h2>
<p>The next core component of a <code>ggplot()</code> object is how plot “aesthetics” are mapped to columns in the data. By a plot “aesthetic”, we mean a visual property of an object in the plot. The two essential “aesthetics” are the x-axis, and (if necessary) the y-axis.</p>
<p>For aesthetics that are “mapped” to columns of the data are given to the <code>mapping =</code> argument, but the actual assignments are listed within <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, as shown below.</p>
<p>Below, in the <code>ggplot()</code> command the data are set as the case <code>linelist</code>, and then the column <code>age</code> is mapped to the x-axis, and the column <code>wt_kg</code> is mapped to the y-axis. A <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> continues the plotting command and leads to <code>geom_point()</code>. This geom <em>inherits</em> the mapped aesthetics from the <code>ggplot()</code> command - it know the axis-column assignments and proceeds to visualize those relationships as <em>points</em> on the canvas.</p>
<div class="sourceCode" id="cb1242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-881-1.png" width="672"></div>
<p>The following command utilizes the same data, but slightly different aesthetic mapping and a different geom. It produces a histogram with <code>geom_histogram()</code>, which by its very nature only requires a column mapped to the x-axis. The count y-axis is generated automatically.</p>
<div class="sourceCode" id="cb1243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-882-1.png" width="672"></div>
<p><strong>Aesthetic mapping can be defined in several places, even multiple times!</strong></p>
<p><code>mapping = aes()</code> can be written in several places, or more than once. It can be written in the top <code>ggplot()</code> command, and/or for each individual <code>geom_XXXX()</code> beneath. The nuances include:</p>
<ul>
<li>Mapping assignments specified in the top <code>ggplot()</code> command will apply as defaults across any geom below.<br>
</li>
<li>Mapping assignments specified within one <code>geom_XXXX()</code> apply only to that geom.</li>
</ul>
<p>Likewise, <code>data =</code> specified in the top <code>ggplot()</code> will apply by default to any geom below, but you can also specify data for each geom, if desired (this is one way to create a plot that combines multiple datasets).</p>
<p>Thus, both of the following commands will create the same plot:</p>
<div class="sourceCode" id="cb1244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># These commands will produce the exact same plot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="other-aesthetics" class="section level2" number="28.6">
<h2>
<span class="header-section-number">28.6</span> Other aesthetics<a class="anchor" aria-label="anchor" href="#other-aesthetics"><i class="fas fa-link"></i></a>
</h2>
<p>There are other aesthetics, which can be specific to the type of geom. Some examples:</p>
<ul>
<li>
<code>shape =</code> Display of a point (<code>geom_point()</code>) as a dot, star, triangle, square, etc.<br>
</li>
<li>
<code>fill =</code> The interior color (e.g. of a bar or boxplot)<br>
</li>
<li>
<code>color =</code> The exterior line(s) of a bar, boxplot, etc. (or the point color if using <code>geom_point()</code>)<br>
</li>
<li>
<code>size =</code> Size (e.g. line thickness, point size)<br>
</li>
<li>
<code>alpha =</code> Transparency (1 = opaque, 0 = invisible)<br>
</li>
<li>
<code>binwidth =</code> Width of histogram bins<br>
</li>
<li>
<code>linetype =</code> Line type (e.g. solid, dashed, dotted)</li>
</ul>
<p><em>Assignments for these kinds of aesthetics (non-axes) can be placed inside or outside the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>.</em> This depends on whether you want their value to be static or to be scaled/depend on the values in each row of data.</p>
<p>If you want the value to be static, you would write its assignment within the <code>geom_XXXX()</code> but <em>outside</em> of a <code>mapping = aes()</code> statement (there may not even be one in the geom). The assignment values would be unchanging - for example, <code>size = 1</code> or <code>color = "blue"</code>.</p>
<p>Here are two examples. In the first, the mapping assignments of the axes is set in the <code>ggplot()</code> command, and the color, size, and alpha are alone in the <code>geom_point()</code>. Note that they could not be written in <code>ggplot()</code>. In the second example, the axis mapping is done within the geom (just for example - it does not make a difference), and the binwidth, color, fill, and alpha are <em>outside</em> the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> and set to static values.</p>
<div class="sourceCode" id="cb1245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># set data and axes mapping</span>
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>         <span class="co"># set static point aesthetics</span>

<span class="co"># histogram</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>       <span class="co"># set data</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>              <span class="co"># display histogram</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span>,      <span class="co"># axis mapping for histogram</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,                <span class="co"># width of bins</span>
    color <span class="op">=</span> <span class="st">"red"</span>,               <span class="co"># bin line color</span>
    fill <span class="op">=</span> <span class="st">"blue"</span>,               <span class="co"># bin interior color</span>
    alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>                 <span class="co"># bin transparency</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-884-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-884-2.png" width="50%"></p>
<p>But you can instead map these aesthetics to columns in the data. In this case, their display is scaled and depends on the value in each row of data. Essentially, the data are grouped by the values in that column. If the column is continuous, as in the examples below, the aesthetic scale is continuous. If the column you assign is discrete, then the groups/colors/sizes/etc. will display by group (read more in the <a href="plotting-with-ggplot.html#ggplotgroups">grouping</a> section).</p>
<p>In this case, you assign these aesthetics <em>within</em> the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, alongside the axes assignments. The assignments are now made to column names, not to static values. And finally, like the axes assignments, if you choose to put these in an <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> in the top <code>ggplot()</code> command these assignments will apply by default to any geoms below.</p>
<p>Two examples are below.</p>
<p>Note in the first example how the color of each point reflects the age value - and a scale has appeared in a legend! For now just note that the scale exists - we will show how to modify it in later sections. The second example highlights two new mapped aesthetics (color <em>and</em> size), while shape and alpha remain mapped to static values outside of any <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>.</p>
<div class="sourceCode" id="cb1246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># set data</span>
       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>     <span class="co"># map aesthetics to column values</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># map x-axis to age            </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># map y-axis to weight</span>
         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     <span class="co"># map color to age</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span>            <span class="co"># display data as points </span>

<span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># set data</span>
       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>     <span class="co"># map aesthetics to column values</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># map x-axis to age            </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># map y-axis to weight</span>
         color <span class="op">=</span> <span class="va">age</span>,       <span class="co"># map color to age</span>
         size <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># map size to age</span>
  <span class="fu">geom_point</span><span class="op">(</span>             <span class="co"># display data as points</span>
    shape <span class="op">=</span> <span class="st">"diamond"</span>,      <span class="co"># points display as diamonds</span>
    alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>            <span class="co"># point transparency at 30%</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-885-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-885-2.png" width="50%"></p>
<p>It becomes important to track your layers and aesthetics when making more complex plots - like those with multiple geoms.</p>
<p>In the example below, the <code>size =</code> aesthetic is assigned twice - once for <code>geom_point()</code> and once for <code>geom_smooth()</code> - both times as a static value.</p>
<div class="sourceCode" id="cb1247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># map aesthetics to columns</span>
  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># add points for each row of data</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># add a trend line with linear method, width of 2</span></code></pre></div>
<pre><code>## Warning: Removed 86 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 86 rows containing missing values (geom_point).</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-886-1.png" width="672"></div>
<p>Note that propoerly aligning axes to plot from multiple dataset on top of one another can be difficult. Consider instead using <strong>cowplot</strong> or a similar package to combine two plots - as described in that section of the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page.</p>
</div>
<div id="storing-plots" class="section level2" number="28.7">
<h2>
<span class="header-section-number">28.7</span> Storing plots<a class="anchor" aria-label="anchor" href="#storing-plots"><i class="fas fa-link"></i></a>
</h2>
<div id="saving-plots-1" class="section level3 unnumbered">
<h3>Saving plots<a class="anchor" aria-label="anchor" href="#saving-plots-1"><i class="fas fa-link"></i></a>
</h3>
<p>Plots can be printed to the Plots RStudio pane, as we have done until now, by simply beginning the command with <code>ggplot()</code>. However, you can also save the plot as an object by using the assignment operator <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> and giving it a name. It will not print unless the object name itself is run. You can also print it by wrapping the plot name with <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, but this is only necessary in certain circumstances like if the plot is created inside a <em>for loop</em>.</p>
<div class="sourceCode" id="cb1250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define plot</span>
<span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="va">age_by_wt</span>    <span class="co"># print</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-887-1.png" width="672"></div>
</div>
<div id="modifying-saved-plots" class="section level3 unnumbered">
<h3>Modifying saved plots<a class="anchor" aria-label="anchor" href="#modifying-saved-plots"><i class="fas fa-link"></i></a>
</h3>
<p>One nice thing about <strong>ggplot2</strong> is that you can define a plot (as above), and then add layers to it starting with its name. You do not have to repeat all the commands that created the original plot!</p>
<p>For example, to modify the plot <code>age_by_wt</code> that was defined above, to include a vertical line at age 50, we would just add a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> and continue….</p>
<div class="sourceCode" id="cb1251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-888-1.png" width="672"></div>
</div>
</div>
<div id="labels" class="section level2" number="28.8">
<h2>
<span class="header-section-number">28.8</span> Labels<a class="anchor" aria-label="anchor" href="#labels"><i class="fas fa-link"></i></a>
</h2>
<p>Surely you will want to add or adjust the plot’s labels. These are most easily done with the <code>labs()</code> function, added with <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> just as the geoms were.</p>
<p>Within <code>labs()</code> you can provide character strings to these arguements:</p>
<ul>
<li>
<code>x =</code> and <code>y =</code> The x-axis and y-axis title (labels)<br>
</li>
<li>
<code>title =</code> The main plot title<br>
</li>
<li>
<code>subtitle =</code> The subtitle of the plot, in smaller text below the title<br>
</li>
<li>
<code>caption =</code> The caption of the plot, or bottom-right by default</li>
</ul>
<p>Here is a plot we made earlier, but with nicer labels:</p>
<div class="sourceCode" id="cb1252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># set data</span>
  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>     <span class="co"># map aesthetics to column values</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># map x-axis to age            </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># map y-axis to weight</span>
         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     <span class="co"># map color to age</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>           <span class="co"># display data as points</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Age and weight distribution"</span>,
    subtitle <span class="op">=</span> <span class="st">"Fictional Ebola outbreak, 2014"</span>,
    x <span class="op">=</span> <span class="st">"Age in years"</span>,
    y <span class="op">=</span> <span class="st">"Weight in kilos"</span>,
    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Data as of {max(linelist$date_hospitalisation, na.rm=T)}"</span><span class="op">)</span><span class="op">)</span>

<span class="va">age_by_wt</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-889-1.png" width="672">
Note how in the caption assignment we used <code>str_glue()</code> from the <strong>stringr</strong> package to implant dynamic R code within the string text. The caption will display the maximum hospitalization date in the linelist. Read more about this in the page on <a href="characters-and-strings.html#characters-and-strings">Characters and strings</a>.</p>
<p>You can also use <code>labs()</code> to adjust the legend title(s), but this is a bit more complicated. See the section on legends in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page.</p>
</div>
<div id="themes" class="section level2" number="28.9">
<h2>
<span class="header-section-number">28.9</span> Themes<a class="anchor" aria-label="anchor" href="#themes"><i class="fas fa-link"></i></a>
</h2>
<p>One of the best parts of <strong>ggplot2</strong> is the amount of control you have over the plot - you can define anything! Generally this done by adjusting the “theme” arguments for the plot. This is done in one of two ways:</p>
<ul>
<li>Adding pre-defined <code>theme_XXXX()</code> functions to make sweeping adjustments
<ul>
<li>These include <code>theme_classic()</code>, <code>theme_minimal()</code>, <code>theme_dark()</code>, <code>theme_light()</code> <code>theme_grey()</code>, <code>theme_bw()</code> and others<br>
</li>
</ul>
</li>
<li>Adjusting each tiny aspect of the plot individually within <code>theme()</code>
</li>
</ul>
<p>We have mention the pre-defined <code>theme_XXXX()</code> functions above, will demonstrate them below, and will not describe them further here.</p>
<p>The <code>theme()</code> function can take a large number of arguments, each of which edits a very specific aspects of the plot. We won’t go through all examples, but will describe the general pattern and show you how to find the argument you need. The basic syntax is this:</p>
<ol style="list-style-type: decimal">
<li>Add <code>theme()</code> as you would a geom or <code>labs()</code><br>
</li>
<li>Within <code>theme()</code>, provide the specific argument name for the element you want to edit (e.g. <code>plot.title =</code> for the plot title)<br>
</li>
<li>Supply the <code>element_XXXX()</code> function as the value for the argument<br>
</li>
</ol>
<ul>
<li>Most of the time this is <code>element_text()</code>, but other versions include <code>element_rect()</code> for editing the plot canvas background colors, or even <code>element_blank()</code> to remove plot elements<br>
</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Within the <code>element_XXXX()</code> give arguments to make fine adjustments</li>
</ol>
<p>That was quite abstract and convoluted, so here are some examples.</p>
<p>The below plot looks quite silly, but it serves to show you a variety of the ways you can adjust your plot. We begin with the plot <code>age_by_wt</code> (that we defined above), and add <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> <code>theme_classic()</code> (with empty parentheses) to enact several adjustments in one command. Then, for finer adjustments, we add a <code>theme()</code> command. Within it, we list the arguments for each aspect we want to adjust - in this case there are many. It can be nice to organize them into sub-grounds with new lines.</p>
<p>To describe just some of them: The <code>legend.position =</code> is unique in that it accepts simple values like “bottom”, but generally text-related arguements require that you place the details within <code>element_text()</code>. See how we adjust the title size with <code>size =</code>, the caption horizontal alignment with <code>hjust = 0</code> (from right to left), and make the subtitle italicized with <code>face =</code>.</p>
<div class="sourceCode" id="cb1253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span> <span class="op">+</span> 
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                 <span class="co"># pre-defined theme adjustments</span>
  <span class="fu">theme</span><span class="op">(</span>
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span>
    
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,          <span class="co"># size of title to 30</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,        <span class="co"># left-align caption</span>
    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># italicize subtitle</span>
    
    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">15</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, <span class="co"># adjusts only x-axis text</span>
    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,         <span class="co"># adjusts only y-axis text</span>
    
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>           <span class="co"># adjusts both axes titles</span>
    <span class="op">)</span>     </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-890-1.png" width="672"></div>
<p>Here are some especially common <code>theme()</code> arguments. You will recognize some patterns, such as appending <code>.x</code> or <code>.y</code> to apply the change only to one axis.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="50%">
<col width="49%">
</colgroup>
<thead><tr class="header">
<th>
<code>theme()</code> argument</th>
<th>What it adjusts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>plot.title = element_text()</code></td>
<td>The title</td>
</tr>
<tr class="even">
<td><code>plot.subtitle = element_text()</code></td>
<td>The subtitle</td>
</tr>
<tr class="odd">
<td><code>plot.caption = element_text()</code></td>
<td>The caption (family, face, color, size, angle, vjust, hjust…)</td>
</tr>
<tr class="even">
<td><code>axis.title = element_text()</code></td>
<td>Axis titles (both x and y) (size, face, angle, color…)</td>
</tr>
<tr class="odd">
<td><code>axis.title.x = element_text()</code></td>
<td>Axis title x-axis only (use <code>.y</code> for y-axis only)</td>
</tr>
<tr class="even">
<td><code>axis.text = element_text()</code></td>
<td>Axis text (both x and y)</td>
</tr>
<tr class="odd">
<td><code>axis.ticks = element_blank()</code></td>
<td>Remove axis ticks</td>
</tr>
<tr class="even">
<td><code>axis.line = element_line()</code></td>
<td>Axis lines (colour, size, linetype: solid dashed dotted etc)</td>
</tr>
<tr class="odd">
<td><code>strip.text = element_text()</code></td>
<td>Facet strip text (colour, face, size, angle…)</td>
</tr>
<tr class="even">
<td><code>strip.background = element_rect()</code></td>
<td>facet strip (fill, colour, size…)</td>
</tr>
</tbody>
</table></div>
<p>But there are so many theme arguments! How could I remember them all??? Do not worry - it is impossible to remember them all. Luckily there are a few tools to help you:</p>
<p>See the <strong>tidyverse</strong> documentation on <a href="https://ggplot2.tidyverse.org/reference/theme.html">modifying theme</a> has a complete list.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Run <code>theme_get()</code> from <strong>ggplot2</strong> to print a list of all 90+ <code>theme()</code> arguments to the console.</span></p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> If you ever want to remove an element of a plot, you can also do it through <code>theme()</code>! Just pass <code>element_blank()</code> to an argument to have it disappear completely!</span></p>
</div>
<div id="ggplotgroups" class="section level2" number="28.10">
<h2>
<span class="header-section-number">28.10</span> Groups<a class="anchor" aria-label="anchor" href="#ggplotgroups"><i class="fas fa-link"></i></a>
</h2>
<p>You can easily group the data and “plot by group”. This is demonstrated more extensively in the pages on <a href="plot-continuous-data.html#plot-continuous-data">Plot continuous data</a> and [Plot discrete data], but we describe the mechanism briefly below.</p>
<p>A very simple way to group the data is to add the <code>color =</code> or <code>fill =</code> arguments <em>within</em> the <code>mapping = aes()</code>, and assign the discrete column name to group the data by. Each unique value in the grouping column will be plotted separately (<code>NA</code> missing values will appear as a group).</p>
<p>In fact, you have already done this! Above, we moved the <code>color =</code> argument within <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> and assigned it the column <code>age</code>. This effectively grouped the data by age, which was a continuous scale. In contrast, here we discuss grouping by discrete columns.</p>
<p>Below we show the scatter plot of age and weight, but we have set <code>color =</code> to the column <code>gender</code>. A legend automatically appears.</p>
<div class="sourceCode" id="cb1254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-891-1.png" width="672">
Note that depending on the geom, you may need to use different arguments to group the data. <code>fill =</code> or <code>color =</code> are appropriate for most cases, but you could also adjust by <code>shape =</code> etc.</p>
<p>The most basic way of grouping the data is by adding the <code>group =</code> argument within the <code>mapping = aes()</code> and assigning it to a discrete column. However, this by itself will not change the colors, fill, or shapes. Nor will it create a legend. Yet it is good to be aware of this argument in case you want to use it.</p>
<p>There are many examples of grouped plot in the pages on plotting continuous and discrete variables.</p>
<p>To adjust the order and presentaton of groups in a plot, see the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page or the page on [Working with factors].</p>
<div id="facets-multiple-plots" class="section level3 unnumbered">
<h3>Facets / Multiple plots<a class="anchor" aria-label="anchor" href="#facets-multiple-plots"><i class="fas fa-link"></i></a>
</h3>
<p>Often its useful to show multiple graphs on one page, or one super-figure. There are a few ways to achieve this and a lot of packages that can help to facilitate it. However, while external packages are nice, it is often easier to use faceting as an alternative that is prebuilt into <code>ggplot2</code>. Faceting plots is extremely easy to do in terms of code, and produces plots with more predictable aesthetics - you wont have to wrangle legends and ensure that axes are aligned etc.</p>
<p>Faceting is a very specific way to obtain multiple plots - by definition, to facet you have to show the same type of plot in each facet, where every plot is specific to a level of a variable. This is done with one of two functions:</p>
<ol style="list-style-type: decimal">
<li><p><code>facet_wrap()</code> This is used when you want to show a different graph for each level of a <em>single</em> variable. One example of this could be showing a different epidemic curve for each hospital in a region.</p></li>
<li><p><code>facet_grid()</code> This is used when you want to bring a second variable into the faceting arrangement. Here each element of a grid is shows the intersection between an x or y element of a grid. For example, this could involve showing a different epidemic curve for each hospital in a region, shown horizontally, for each age group, shown vertically.</p></li>
</ol>
<p>This can quickly become an overwhelming amount of information - its good to ensure you don’t have too many levels of each variable that you choose to facet by! Here are some quick examples with the malaria dataset:</p>
<div class="sourceCode" id="cb1255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> 

<span class="co"># show a wrapped plot with facets by district</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span>, fill <span class="op">=</span> <span class="va">District</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"date of data collection"</span>,
    y <span class="op">=</span> <span class="st">"malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">District</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-892-1.png" width="672"></div>
<p>We can also use a <code>facet_grid()</code> approach with the different age groups - we need to do some data transformations first however, as the age groups all are in their own columns - we want them in a single column. When you pass the two variables to <code>facet_grid()</code>, you can use formula notation (e.g. <code>x ~ y</code>) or wrap the variables in <code>vars()</code>. For reference, this: <code>facet_grid(x ~ y)</code> is equivalent to <code>facet_grid(rows = vars(x), cols = vars(y))</code> Here’s how we can do this:</p>
<div class="sourceCode" id="cb1256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">malaria_age</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>
    <span class="co"># choose all the columns that start with malaria rdt (age group specific)</span>
    cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"malaria_rdt_"</span><span class="op">)</span>,
    <span class="co"># column names become age group</span>
    names_to <span class="op">=</span> <span class="st">"age_group"</span>,
    <span class="co"># values to a single column (num_cases)</span>
    values_to <span class="op">=</span> <span class="st">"num_cases"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># clean up age group column - replace "malaria_rdt_" to leave only age group</span>
  <span class="co"># then replace 15 with 15+</span>
  <span class="co"># then refactor the age groups so they are in order</span>
  <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"malaria_rdt_"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">.</span> <span class="op">==</span> <span class="st">"15"</span>, <span class="st">"15+"</span>, <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
           <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"5-14"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>


<span class="co"># make the same plot as before, but show in a grid</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_age</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">num_cases</span>, fill <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"date of data collection"</span>,
    y <span class="op">=</span> <span class="st">"malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district and age group"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">District</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-893-1.png" width="672"></div>
</div>
<div id="piping-into-ggplot2" class="section level3 unnumbered">
<h3>Piping into <strong>ggplot2</strong><a class="anchor" aria-label="anchor" href="#piping-into-ggplot2"><i class="fas fa-link"></i></a>
</h3>
<p>When using pipes to clean and transform your data, it is easy to pass the transformed data into <code>ggplot()</code>. The pipes that pass the dataset from function-to-function will transition to <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> once the <code>ggplot()</code> function is called. Note that in this case, there is no need to specify the <code>data =</code> argument, as this is automatically defined as the piped-in dataset.</p>
<p>This is how that might look:</p>
<div class="sourceCode" id="cb1257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>                                                     <span class="co"># begin with linelist</span>
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># select columns</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>                                                  <span class="co"># pivot longer</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                                  
    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,
    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>                                                        <span class="co"># replace missing values</span>
    symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span>                                                        <span class="co"># begin ggplot!</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">symptom_name</span>, fill <span class="op">=</span> <span class="va">symptom_is_present</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>                    
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Symptom"</span>,
    y <span class="op">=</span> <span class="st">"Symptom status (proportion)"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-894-1.png" width="672"></div>
</div>
<div id="exporting-plots" class="section level3 unnumbered">
<h3>Exporting plots<a class="anchor" aria-label="anchor" href="#exporting-plots"><i class="fas fa-link"></i></a>
</h3>
<p>Exporting ggplots is made easy with the <code>ggsave()</code> function from <strong>ggplot2</strong>. It can work in two ways, either:</p>
<ul>
<li>Specify the name of the plot object, then the file path and name with extension
<ul>
<li>For example: <code>ggsave(my_plot, "My Documents/work/plots/my_plot.png")</code><br>
</li>
</ul>
</li>
<li>Save the last plot that was printed
<ul>
<li>For example: <code>ggsave("My Documents/work/plots/my_plot.png")</code>
</li>
</ul>
</li>
</ul>
<p>You can export as png, pdf, jpeg, tiff, bmp, svg, or several other file types, by specifying the file extension in the file path.</p>
<p>You can also specify the arguments <code>width =</code>, <code>height =</code>, and <code>units =</code> (either “in”, “cm”, or “mm”). You can also specify <code>dpi =</code> with a number for plot resolution (e.g. 300). See the function details by entering <code>?ggsave</code> or reading the <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">documentation online</a>.</p>
</div>
</div>
<div id="resources-21" class="section level2" number="28.11">
<h2>
<span class="header-section-number">28.11</span> Resources<a class="anchor" aria-label="anchor" href="#resources-21"><i class="fas fa-link"></i></a>
</h2>
<p>R for Data Science pages on <a href="https://r4ds.had.co.nz/data-visualisation.html">data visualization</a> and <a href="https://r4ds.had.co.nz/graphics-for-communication.html">graphics for communicaton</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="gis-basics.html"><span class="header-section-number">27</span> GIS basics</a></div>
<div class="next"><a href="ggplot-tips.html"><span class="header-section-number">29</span> ggplot tips</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#plotting-with-ggplot"><span class="header-section-number">28</span> Plotting with ggplot</a></li>
<li>
<a class="nav-link" href="#preparation-19"><span class="header-section-number">28.1</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-packages-17">Load packages</a></li>
<li><a class="nav-link" href="#import-data-13">Import data</a></li>
<li><a class="nav-link" href="#general-cleaning">General cleaning</a></li>
<li><a class="nav-link" href="#pivoting-longer">Pivoting longer</a></li>
</ul>
</li>
<li><a class="nav-link" href="#basics-of-ggplot"><span class="header-section-number">28.2</span> Basics of ggplot</a></li>
<li><a class="nav-link" href="#ggplot"><span class="header-section-number">28.3</span> ggplot()</a></li>
<li><a class="nav-link" href="#geoms"><span class="header-section-number">28.4</span> Geoms</a></li>
<li><a class="nav-link" href="#mapping-plot-aesthetics-to-data"><span class="header-section-number">28.5</span> Mapping plot aesthetics to data</a></li>
<li><a class="nav-link" href="#other-aesthetics"><span class="header-section-number">28.6</span> Other aesthetics</a></li>
<li>
<a class="nav-link" href="#storing-plots"><span class="header-section-number">28.7</span> Storing plots</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#saving-plots-1">Saving plots</a></li>
<li><a class="nav-link" href="#modifying-saved-plots">Modifying saved plots</a></li>
</ul>
</li>
<li><a class="nav-link" href="#labels"><span class="header-section-number">28.8</span> Labels</a></li>
<li><a class="nav-link" href="#themes"><span class="header-section-number">28.9</span> Themes</a></li>
<li>
<a class="nav-link" href="#ggplotgroups"><span class="header-section-number">28.10</span> Groups</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#facets-multiple-plots">Facets / Multiple plots</a></li>
<li><a class="nav-link" href="#piping-into-ggplot2">Piping into ggplot2</a></li>
<li><a class="nav-link" href="#exporting-plots">Exporting plots</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-21"><span class="header-section-number">28.11</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-04-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
