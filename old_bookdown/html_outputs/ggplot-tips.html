<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>31 ggplot tips | The Epidemiologist R Handbook</title>
<meta name="author" content="the handbook team">
<meta name="description" content="In this page we will cover tips and tricks to make your ggplots sharp and fancy. See the page on ggplot basics for the fundamentals. There a several extensive ggplot2 tutorials linked in the...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="31 ggplot tips | The Epidemiologist R Handbook">
<meta property="og:type" content="book">
<meta property="og:description" content="In this page we will cover tips and tricks to make your ggplots sharp and fancy. See the page on ggplot basics for the fundamentals. There a several extensive ggplot2 tutorials linked in the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="31 ggplot tips | The Epidemiologist R Handbook">
<meta name="twitter:description" content="In this page we will cover tips and tricks to make your ggplots sharp and fancy. See the page on ggplot basics for the fundamentals. There a several extensive ggplot2 tutorials linked in the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.0/transition.js"></script><script src="libs/bs3compat-0.5.0/tabs.js"></script><script src="libs/bs3compat-0.5.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.28/datatables.js"></script><link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>Need help learning R?</strong> Enroll in Applied Epi's <a href="https://www.appliedepi.org/live/" class="alert-link">intro R course</a>, try our <a href="https://www.appliedepi.org/tutorial/" class="alert-link">free R tutorials</a>, post in our <a href="https://community.appliedepi.org/" class="alert-link">Community Q&amp;A forum</a>, or ask about our <a href="mailto:contact@appliedepi.org" class="alert-link">R Help Desk service</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">About this book</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Editorial and technical notes</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Download handbook and data</a></li>
<li class="book-part">Basics</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> R Basics</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transition to R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Suggested packages</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R projects</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Import and export</a></li>
<li class="book-part">Data Management</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Cleaning data and core functions</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Working with dates</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Characters and strings</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factors</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Pivoting data</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">13</span> Grouping data</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">14</span> Joining data</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplication</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteration, loops, and lists</a></li>
<li class="book-part">Analysis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Descriptive tables</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Simple statistical tests</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Univariate and multivariable regression</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Missing data</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Standardised rates</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Moving averages</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Time series and outbreak detection</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Epidemic modeling</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">25</span> Contact tracing</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Survey analysis</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Survival analysis</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">28</span> GIS basics</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">29</span> Tables for presentation</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot basics</a></li>
<li><a class="active" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplot tips</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">32</span> Epidemic curves</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">33</span> Demographic pyramids and Likert-scales</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">34</span> Heat plots</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagrams and charts</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Combinations analysis</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Transmission chains</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">38</span> Phylogenetic trees</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Interactive plots</a></li>
<li class="book-part">Reports and dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">40</span> Reports with R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">41</span> Organizing routine reports</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">42</span> Dashboards with R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">43</span> Dashboards with Shiny</a></li>
<li class="book-part">Miscellaneous</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">44</span> Writing functions</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">45</span> Directory interactions</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">46</span> Version control and collaboration with Git and Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">47</span> Common errors</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">48</span> Getting help</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">49</span> R on network drives</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot-tips" class="section level1" number="31">
<h1>
<span class="header-section-number">31</span> ggplot tips<a class="anchor" aria-label="anchor" href="#ggplot-tips"><i class="fas fa-link"></i></a>
</h1>
<p>In this page we will cover tips and tricks to make your ggplots sharp and fancy. See the page on <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a> for the fundamentals.</p>
<p>There a several extensive <a href="https://ggplot2.tidyverse.org/"><strong>ggplot2</strong> tutorials</a> linked in the Resources section. You can also download this <a href="https://rstudio.com/resources/cheatsheets/">data visualization with ggplot cheatsheet</a> from the RStudio website. We strongly recommend that you peruse for inspiration at the <a href="https://www.r-graph-gallery.com/">R graph gallery</a> and <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
<div id="preparation-23" class="section level2" number="31.1">
<h2>
<span class="header-section-number">31.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-23"><i class="fas fa-link"></i></a>
</h2>
<div id="load-packages-21" class="section level3 unnumbered">
<h3>Load packages<a class="anchor" aria-label="anchor" href="#load-packages-21"><i class="fas fa-link"></i></a>
</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<div class="sourceCode" id="cb1462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">tidyverse</span>,      <span class="co"># includes ggplot2 and other</span></span>
<span>  <span class="va">rio</span>,            <span class="co"># import/export</span></span>
<span>  <span class="va">here</span>,           <span class="co"># file locator</span></span>
<span>  <span class="va">stringr</span>,        <span class="co"># working with characters   </span></span>
<span>  <span class="va">scales</span>,         <span class="co"># transform numbers</span></span>
<span>  <span class="va">ggrepel</span>,        <span class="co"># smartly-placed labels</span></span>
<span>  <span class="va">gghighlight</span>,    <span class="co"># highlight one part of plot</span></span>
<span>  <span class="va">RColorBrewer</span>    <span class="co"># color scales</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="import-data-18" class="section level3 unnumbered">
<h3>Import data<a class="anchor" aria-label="anchor" href="#import-data-18"><i class="fas fa-link"></i></a>
</h3>
<p>For this page, we import the dataset of cases from a simulated Ebola epidemic. If you want to follow along, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">click to download the “clean” linelist</a> (as .rds file). Import data with the <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> function from the <strong>rio</strong> package (it handles many file types like .xlsx, .csv, .rds - see the <a href="import-and-export.html#import-and-export">Import and export</a> page for details).</p>
<div class="sourceCode" id="cb1463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>The first 50 rows of the linelist are displayed below.</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-053b2acc988d1db47e1a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-053b2acc988d1db47e1a">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="ggplot_tips_colors" class="section level2" number="31.2">
<h2>
<span class="header-section-number">31.2</span> Scales for color, fill, axes, etc.<a class="anchor" aria-label="anchor" href="#ggplot_tips_colors"><i class="fas fa-link"></i></a>
</h2>
<p>In <strong>ggplot2</strong>, when aesthetics of plotted data (e.g. size, color, shape, fill, plot axis) are mapped to columns in the data, the exact display can be adjusted with the corresponding “scale” command. In this section we explain some common scale adjustments.</p>
<div id="color-schemes" class="section level3" number="31.2.1">
<h3>
<span class="header-section-number">31.2.1</span> Color schemes<a class="anchor" aria-label="anchor" href="#color-schemes"><i class="fas fa-link"></i></a>
</h3>
<p>One thing that can initially be difficult to understand with <strong>ggplot2</strong> is control of color schemes. Note that this section discusses the color of <em>plot objects</em> (geoms/shapes) such as points, bars, lines, tiles, etc. To adjust color of accessory text, titles, or background color see the <a href="ggplot-basics.html#ggplot_basics_themes">Themes</a> section of the <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a> page.</p>
<p>To control “color” of <em>plot objects</em> you will be adjusting either the <code>color =</code> aesthetic (the <em>exterior</em> color) or the <code>fill =</code> aesthetic (the <em>interior</em> color). One exception to this pattern is <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>, where you really only get to control <code>color =</code>, which controls the color of the point (interior and exterior).</p>
<p>When setting colour or fill you can use colour names recognized by R like <code>"red"</code> (see <a href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">complete list</a> or enter <code><a href="https://rdrr.io/r/grDevices/colors.html">?colors</a></code>), or a specific hex colour such as <code>"#ff0505"</code>.</p>
<div class="sourceCode" id="cb1464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># histogram - </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>       <span class="co"># set data and axes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>              <span class="co"># display histogram</span></span>
<span>    binwidth <span class="op">=</span> <span class="fl">7</span>,                <span class="co"># width of bins</span></span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,               <span class="co"># bin line color</span></span>
<span>    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span>          <span class="co"># bin interior color (fill) </span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1076-1.png" width="672"></div>
<p>As explained the <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a> section on <a href="ggplot-basics.html#ggplot_basics_mapping">mapping data to the plot</a>, aesthetics such as <code>fill =</code> and <code>color =</code> can be defined either <em>outside</em> of a <code>mapping = aes()</code> statement or <em>inside</em> of one. If <em>outside</em> the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, the assigned value should be static (e.g. <code>color = "blue"</code>) and will apply for <em>all</em> data plotted by the geom. If <em>inside</em>, the aesthetic should be mapped to a column, like <code>color = hospital</code>, and the expression will vary by the value for that row in the data. A few examples:</p>
<div class="sourceCode" id="cb1465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Static color for points and for line</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Static color for points and line"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Color mapped to continuous column</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>         </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Color mapped to continuous column"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Color mapped to discrete column</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>         </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Color mapped to discrete column"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bar plot, fill to discrete column, color to static value</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"yellow"</span><span class="op">)</span><span class="op">+</span>         </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fill mapped to discrete column, static color"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1077-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1077-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1077-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1077-4.png" width="50%"></p>
</div>
<div id="ggplot_tips_scales" class="section level3 unnumbered">
<h3>Scales<a class="anchor" aria-label="anchor" href="#ggplot_tips_scales"><i class="fas fa-link"></i></a>
</h3>
<p>Once you map a column to a plot aesthetic (e.g. <code>x =</code>, <code>y =</code>, <code>fill =</code>, <code>color =</code>…), your plot will gain a scale/legend. See above how the scale can be continuous, discrete, date, etc. values depending on the class of the assigned column. If you have multiple aesthetics mapped to columns, your plot will have multiple scales.</p>
<p>You can control the scales with the appropriate <code>scales_()</code> function. The scale functions of <strong>ggplot()</strong> have 3 parts that are written like this: <code>scale_AESTHETIC_METHOD()</code>.</p>
<ol style="list-style-type: decimal">
<li>The first part, <code>scale_()</code>, is fixed.<br>
</li>
<li>The second part, the AESTHETIC, should be the aesthetic that you want to adjust the scale for (<code>_fill_</code>, <code>_shape_</code>, <code>_color_</code>, <code>_size_</code>, <code>_alpha_</code>…) - the options here also include <code>_x_</code> and <code>_y_</code>.<br>
</li>
<li>The third part, the METHOD, will be either <code>_discrete()</code>, <code>continuous()</code>, <code>_date()</code>, <code>_gradient()</code>, or <code>_manual()</code> depending on the class of the column and <em>how</em> you want to control it. There are others, but these are the most-often used.</li>
</ol>
<p>Be sure that you use the correct function for the scale! Otherwise your scale command will not appear to change anything. If you have multiple scales, you may use multiple scale functions to adjust them! For example:</p>
</div>
<div id="scale-arguments" class="section level3 unnumbered">
<h3>Scale arguments<a class="anchor" aria-label="anchor" href="#scale-arguments"><i class="fas fa-link"></i></a>
</h3>
<p>Each kind of scale has its own arguments, though there is some overlap. Query the function like <code><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">?scale_color_discrete</a></code> in the R console to see the function argument documentation.</p>
<p>For continuous scales, use <code>breaks =</code> to provide a sequence of values with <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> (take <code>to =</code>, <code>from =</code>, and <code>by =</code> as shown in the example below. Set <code>expand = c(0,0)</code> to eliminate padding space around the axes (this can be used on any <code>_x_</code> or <code>_y_</code> scale.</p>
<p>For discrete scales, you can adjust the order of level appearance with <code>breaks =</code>, and how the values display with the <code>labels =</code> argument. Provide a character vector to each of those (see example below). You can also drop <code>NA</code> easily by setting <code>na.translate = FALSE</code>.</p>
<p>The nuances of date scales are covered more extensively in the <a href="epidemic-curves.html#epidemic-curves">Epidemic curves</a> page.</p>
</div>
<div id="manual-adjustments" class="section level3 unnumbered">
<h3>Manual adjustments<a class="anchor" aria-label="anchor" href="#manual-adjustments"><i class="fas fa-link"></i></a>
</h3>
<p>One of the most useful tricks is using “manual” scaling functions to explicitly assign colors as you desire. These are functions with the syntax <code>scale_xxx_manual()</code> (e.g. <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual()</a></code> or <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual()</a></code>). Each of the below arguments are demonstrated in the code example below.</p>
<ul>
<li>Assign colors to data values with the <code>values =</code> argument<br>
</li>
<li>Specify a color for <code>NA</code> with <code>na.value =</code><br>
</li>
<li>Change how the values are <em>written</em> in the legend with the <code>labels =</code> argument<br>
</li>
<li>Change the legend title with <code>name =</code>
</li>
</ul>
<p>Below, we create a bar plot and show how it appears by default, and then with three scales adjusted - the continuous y-axis scale, the discrete x-axis scale, and manual adjustment of the fill (interior bar color).</p>
<div class="sourceCode" id="cb1466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BASELINE - no scale adjustment</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Baseline - no scale adjustments"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1078-1.png" width="672"></div>
<div class="sourceCode" id="cb1467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SCALES ADJUSTED</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># simplify background</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>                <span class="co"># continuous scale for y-axis (counts)</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                 <span class="co"># no padding</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                 to <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>                 by <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>                   <span class="co"># discrete scale for x-axis (gender)</span></span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                  <span class="co"># no padding</span></span>
<span>    drop <span class="op">=</span> <span class="cn">FALSE</span>,                     <span class="co"># show all factor levels (even if not in data)</span></span>
<span>    na.translate <span class="op">=</span> <span class="cn">FALSE</span>,             <span class="co"># remove NA outcomes from plot</span></span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Died"</span>, <span class="st">"Recovered"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># Change display of values</span></span>
<span>    </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>                  <span class="co"># Manually specify fill (bar interior color)</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span> <span class="op">=</span> <span class="st">"violetred"</span>,     <span class="co"># reference values in data to assign colors</span></span>
<span>               <span class="st">"f"</span> <span class="op">=</span> <span class="st">"aquamarine"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span> <span class="op">=</span> <span class="st">"Male"</span>,          <span class="co"># re-label the legend (use "=" assignment to avoid mistakes)</span></span>
<span>              <span class="st">"f"</span> <span class="op">=</span> <span class="st">"Female"</span>,</span>
<span>              <span class="st">"Missing"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Gender"</span>,                  <span class="co"># title of legend</span></span>
<span>    na.value <span class="op">=</span> <span class="st">"grey"</span>                 <span class="co"># assign a color for missing values</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Adjustment of scales"</span><span class="op">)</span> <span class="co"># Adjust the title of the fill legend</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1078-2.png" width="672"></div>
</div>
<div id="continuous-axes-scales" class="section level3 unnumbered">
<h3>Continuous axes scales<a class="anchor" aria-label="anchor" href="#continuous-axes-scales"><i class="fas fa-link"></i></a>
</h3>
<p>When data are mapping to the plot axes, these too can be adjusted with scales commands. A common example is adjusting the display of an axis (e.g. y-axis) that is mapped to a column with continuous data.</p>
<p>We may want to adjust the breaks or display of the values in the ggplot using <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous()</a></code>. As noted above, use the argument <code>breaks =</code> to provide a sequence of values that will serve as “breaks” along the scale. These are the values at which numbers will display. To this argument, you can provide a <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> vector containing the desired break values, or you can provide a regular sequence of numbers using the <strong>base</strong> R function <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code>. This <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> function accepts <code>to =</code>, <code>from =</code>, and <code>by =</code>.</p>
<div class="sourceCode" id="cb1468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BASELINE - no scale adjustment</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Baseline - no scale adjustments"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">outcome</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      to <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>      by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Adjusted y-axis breaks"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1079-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1079-2.png" width="50%"></p>
<div id="display-percents" class="section level4 unnumbered">
<h4>Display percents<a class="anchor" aria-label="anchor" href="#display-percents"><i class="fas fa-link"></i></a>
</h4>
<p>If your original data values are proportions, you can easily display them as percents with “%” by providing <code>labels = scales::percent</code> in your scales command, as shown below.</p>
<p>While an alternative would be to convert the values to character and add a “%” character to the end, this approach will cause complications because your data will no longer be continuous numeric values.</p>
<div class="sourceCode" id="cb1469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original y-axis proportions</span></span>
<span><span class="co">#############################</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                                   <span class="co"># start with linelist</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                       <span class="co"># group data by hospital</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>                                   <span class="co"># create summary columns</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,                                     <span class="co"># total number of rows in group</span></span>
<span>    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="co"># number of deaths in group</span></span>
<span>    prop_death <span class="op">=</span> <span class="va">deaths</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                   <span class="co"># proportion deaths in group</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>                                      <span class="co"># begin plotting</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">hospital</span>,</span>
<span>      y <span class="op">=</span> <span class="va">prop_death</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Display y-axis original proportions"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Display y-axis proportions as percents</span></span>
<span><span class="co">########################################</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>         </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    prop_death <span class="op">=</span> <span class="va">deaths</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">hospital</span>,</span>
<span>      y <span class="op">=</span> <span class="va">prop_death</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Display y-axis as percents (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>                    <span class="co"># display proportions as percents</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1080-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1080-2.png" width="50%"></p>
</div>
<div id="log-scale" class="section level4 unnumbered">
<h4>Log scale<a class="anchor" aria-label="anchor" href="#log-scale"><i class="fas fa-link"></i></a>
</h4>
<p>To transform a continuous axis to log scale, add <code>trans = "log2"</code> to the scale command. For purposes of example, we create a data frame of regions with their respective <code>preparedness_index</code> and cumulative cases values.</p>
<div class="sourceCode" id="cb1470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span>, <span class="st">"I"</span><span class="op">)</span>,</span>
<span>  preparedness_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8.8</span>, <span class="fl">7.5</span>, <span class="fl">3.4</span>, <span class="fl">3.6</span>, <span class="fl">2.1</span>, <span class="fl">7.9</span>, <span class="fl">7.0</span>, <span class="fl">5.6</span>, <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>  cases_cumulative <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">45</span>, <span class="fl">80</span>, <span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">7</span>, <span class="fl">51</span>, <span class="fl">30</span>, <span class="fl">1442</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span></span></code></pre></div>
<pre><code>##   region preparedness_index cases_cumulative
## 1      A                8.8               15
## 2      B                7.5               45
## 3      C                3.4               80
## 4      D                3.6               20
## 5      E                2.1               21
## 6      F                7.9                7
## 7      G                7.0               51
## 8      H                5.6               30
## 9      I                1.0             1442</code></pre>
<p>The cumulative cases for region “I” are dramatically greater than all the other regions. In circumstances like this, you may elect to display the y-axis using a log scale so the reader can see differences between the regions with fewer cumulative cases.</p>
<div class="sourceCode" id="cb1472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original y-axis</span></span>
<span><span class="va">preparedness_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span>,  </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>         x <span class="op">=</span> <span class="va">preparedness_index</span>,</span>
<span>         y <span class="op">=</span> <span class="va">cases_cumulative</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>            <span class="co"># points for each region </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">region</span><span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">+</span>                  <span class="co"># add text labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preparedness_plot</span>                  <span class="co"># print original plot</span></span>
<span></span>
<span></span>
<span><span class="co"># print with y-axis transformed</span></span>
<span><span class="va">preparedness_plot</span><span class="op">+</span>                   <span class="co"># begin with plot saved above</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span> <span class="co"># add transformation for y-axis</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1082-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1082-2.png" width="50%"></p>
</div>
</div>
<div id="gradient-scales" class="section level3 unnumbered">
<h3>Gradient scales<a class="anchor" aria-label="anchor" href="#gradient-scales"><i class="fas fa-link"></i></a>
</h3>
<p>Fill gradient scales can involve additional nuance. The defaults are usually quite pleasing, but you may want to adjust the values, cutoffs, etc.</p>
<p>To demonstrate how to adjust a continuous color scale, we’ll use a data set from the <a href="download-handbook-and-data.html#contact-tracing">Contact tracing</a> page that contains the ages of cases and of their source cases.</p>
<div class="sourceCode" id="cb1473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_source_relationships</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"godata"</span>, <span class="st">"relationships_clean.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">source_age</span>, <span class="va">target_age</span><span class="op">)</span> </span></code></pre></div>
<p>Below, we produce a “raster” heat tile density plot. We won’t elaborate how (see the link in paragraph above) but we will focus on how we can adjust the color scale. Read more about the <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d()</a></code> <strong>ggplot2</strong> function <a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">here</a>. Note how the <code>fill</code> scale is <em>continuous</em>.</p>
<div class="sourceCode" id="cb1474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">case_source_relationships</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">source_age</span>, y <span class="op">=</span> <span class="va">target_age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"raster"</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    contour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now we show some variations on the fill scale:</p>
<div class="sourceCode" id="cb1475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_matrix</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1085-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1085-2.png" width="50%"></p>
<p>Now we show some examples of actually adjusting the break points of the scale:</p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient()</a></code> accepts two colors (high/low)<br>
</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn()</a></code> accepts a vector of any length of colors to <code>values =</code> (intermediate values will be interpolated)<br>
</li>
<li>Use <a href="https://www.rdocumentation.org/packages/scales/versions/0.4.1/topics/rescale"><code>scales::rescale()</code></a> to adjust how colors are positioned along the gradient; it rescales your vector of positions to be between 0 and 1.</li>
</ul>
<div class="sourceCode" id="cb1476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>     <span class="co"># 2-sided gradient scale</span></span>
<span>    low <span class="op">=</span> <span class="st">"aquamarine"</span>,    <span class="co"># low value</span></span>
<span>    high <span class="op">=</span> <span class="st">"purple"</span>,       <span class="co"># high value</span></span>
<span>    na.value <span class="op">=</span> <span class="st">"grey"</span>,     <span class="co"># value for NA</span></span>
<span>    name <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># Legend title</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Manually specify high/low colors"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3+ colors to scale</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>    <span class="co"># 3-color scale (low/mid/high)</span></span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span><span class="op">)</span> <span class="co"># provide colors in vector</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"3-color scale"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use of rescale() to adjust placement of colors along scale</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>    <span class="co"># provide any number of colors</span></span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html">rescale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.07</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co"># positions for colors are rescaled between 0 and 1</span></span>
<span>    <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Colors not evenly positioned"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use of limits to cut-off values that get fill color</span></span>
<span><span class="va">trans_matrix</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>    </span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.0002</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Restrict value limits, resulting in grey space"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1086-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1086-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1086-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1086-4.png" width="50%"></p>
</div>
<div id="palettes" class="section level3 unnumbered">
<h3>Palettes<a class="anchor" aria-label="anchor" href="#palettes"><i class="fas fa-link"></i></a>
</h3>
<div id="colorbrewer-and-viridis" class="section level4 unnumbered">
<h4>Colorbrewer and Viridis<a class="anchor" aria-label="anchor" href="#colorbrewer-and-viridis"><i class="fas fa-link"></i></a>
</h4>
<p>More generally, if you want predefined palettes, you can use the <code>scale_xxx_brewer</code> or <code>scale_xxx_viridis_y</code> functions.</p>
<p>The ‘brewer’ functions can draw from <a href="colorbrewer.org">colorbrewer.org</a> palettes.</p>
<p>The ‘viridis’ functions draw from viridis (colourblind friendly!) palettes, which “provide colour maps that are perceptually uniform in both colour and black-and-white. They are also designed to be perceived by viewers with common forms of colour blindness.” (read more <a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">here</a> and <a href="https://bids.github.io/colormap/">here</a>). Define if the palette is discrete, continuous, or binned by specifying this at the end of the function (e.g. discrete is <code>scale_xxx_viridis_d</code>).</p>
<p>It is advised that you test your plot in this <a href="https://www.color-blindness.com/coblis-color-blindness-simulator/">color blindness simulator</a>. If you have a red/green color scheme, try a “hot-cold” (red-blue) scheme instead as described <a href="https://www.visualisingdata.com/2019/08/five-ways-to-design-for-red-green-colour-blindness/#:~:text=The%20pink%2Dred%20through%20to,green%20hues%20used%20by%20default.">here</a></p>
<p>Here is an example from the <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a> page, using various color schemes.</p>
<div class="sourceCode" id="cb1477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">symp_plot</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                                         <span class="co"># begin with linelist</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co"># select columns</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>                                                  <span class="co"># pivot longer</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                                  </span>
<span>    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>                                                        <span class="co"># replace missing values</span></span>
<span>    symptom_is_present <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>                                                        <span class="co"># begin ggplot!</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">symptom_name</span>, fill <span class="op">=</span> <span class="va">symptom_is_present</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>                    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Symptom"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Symptom status (proportion)"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">symp_plot</span>  <span class="co"># print with default colors</span></span>
<span></span>
<span><span class="co">#################################</span></span>
<span><span class="co"># print with manually-specified colors</span></span>
<span><span class="va">symp_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span> <span class="op">=</span> <span class="st">"black"</span>,         <span class="co"># explicitly define colours</span></span>
<span>               <span class="st">"no"</span> <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>               <span class="st">"unknown"</span> <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span><span class="op">)</span>, <span class="co"># order the factors correctly</span></span>
<span>    name <span class="op">=</span> <span class="st">""</span>                           <span class="co"># set legend to no title</span></span>
<span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="co">#################################</span></span>
<span><span class="co"># print with viridis discrete colors</span></span>
<span><span class="va">symp_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1087-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1087-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1087-3.png" width="50%"></p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="change-order-of-discrete-variables" class="section level2" number="31.3">
<h2>
<span class="header-section-number">31.3</span> Change order of discrete variables<a class="anchor" aria-label="anchor" href="#change-order-of-discrete-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Changing the order that discrete variables appear in is often difficult to understand for people who are new to <code>ggplot2</code> graphs. It’s easy to understand how to do this however once you understand how <code>ggplot2</code> handles discrete variables under the hood. Generally speaking, if a discrete varaible is used, it is automatically converted to a <code>factor</code> type - which orders factors by alphabetical order by default. To handle this, you simply have to reorder the factor levels to reflect the order you would like them to appear in the chart. For more detailed information on how to reorder <code>factor</code> objects, see the factor section of the guide.</p>
<p>We can look at a common example using age groups - by default the 5-9 age group will be placed in the middle of the age groups (given alphanumeric order), but we can move it behind the 0-4 age group of the chart by releveling the factors.</p>
<div class="sourceCode" id="cb1478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">age_cat5</span><span class="op">)</span>,                         <span class="co"># remove rows where age_cat5 is missing</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"5-9"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># relevel factor</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age group"</span>, y <span class="op">=</span> <span class="st">"Number of hospitalisations"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Total hospitalisations by age group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1088-1.png" width="672"></div>
<div id="ggthemr" class="section level4 unnnumbered" number="31.3.0.1">
<h4>
<span class="header-section-number">31.3.0.1</span> <strong>ggthemr</strong><a class="anchor" aria-label="anchor" href="#ggthemr"><i class="fas fa-link"></i></a>
</h4>
<p>Also consider using the <strong>ggthemr</strong> package. You can download this package from Github using the instructions <a href="https://github.com/Mikata-Project/ggthemr">here</a>. It offers palettes that are very aesthetically pleasing, but be aware that these typically have a maximum number of values that can be limiting if you want more than 7 or 8 colors.</p>
</div>
</div>
<div id="contour-lines" class="section level2" number="31.4">
<h2>
<span class="header-section-number">31.4</span> Contour lines<a class="anchor" aria-label="anchor" href="#contour-lines"><i class="fas fa-link"></i></a>
</h2>
<p>Contour plots are helpful when you have many points that might cover each other (“overplotting”). The case-source data used above are again plotted, but more simply using <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d_filled()</a></code> to produce discrete contour levels - like a topographical map. Read more about the statistics <a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">here</a>.</p>
<div class="sourceCode" id="cb1479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_source_relationships</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">source_age</span>, y <span class="op">=</span> <span class="va">target_age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"stat_density2d() + geom_point()"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">case_source_relationships</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">source_age</span>, y <span class="op">=</span> <span class="va">target_age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d_filled</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"stat_density2d_filled()"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1089-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1089-2.png" width="50%"></p>
</div>
<div id="marginal-distributions" class="section level2" number="31.5">
<h2>
<span class="header-section-number">31.5</span> Marginal distributions<a class="anchor" aria-label="anchor" href="#marginal-distributions"><i class="fas fa-link"></i></a>
</h2>
<p>To show the distributions on the edges of a <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> scatterplot, you can use the <strong>ggExtra</strong> package and its function <code>ggMarginal()</code>. Save your original ggplot as an object, then pass it to <code>ggMarginal()</code> as shown below. Here are the key arguments:</p>
<ul>
<li>You must specify the <code>type =</code> as either “histogram”, “density” “boxplot”, “violin”, or “densigram”.<br>
</li>
<li>By default, marginal plots will appear for both axes. You can set <code>margins =</code> to “x” or “y” if you only want one.<br>
</li>
<li>Other optional arguments include <code>fill =</code> (bar color), <code>color =</code> (line color), <code>size =</code> (plot size relative to margin size, so larger number makes the marginal plot smaller).<br>
</li>
<li>You can provide other axis-specific arguments to <code>xparams =</code> and <code>yparams =</code>. For example, to have different histogram bin sizes, as shown below.</li>
</ul>
<p>You can have the marginal plots reflect groups (columns that have been assigned to <code>color =</code> in your <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> mapped aesthetics). If this is the case, set the <code>ggMarginal()</code> argument <code>groupColour =</code> or <code>groupFill =</code> to <code>TRUE</code>, as shown below.</p>
<p>Read more at <a href="https://cran.r-project.org/web/packages/ggExtra/vignettes/ggExtra.html">this vignette</a>, in the <a href="https://www.r-graph-gallery.com/277-marginal-histogram-for-ggplot2.html">R Graph Gallery</a> or the function R documentation <code>?ggMarginal</code>.</p>
<div class="sourceCode" id="cb1480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install/load ggExtra</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">ggExtra</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Basic scatter plot of weight and age</span></span>
<span><span class="va">scatter_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Scatter plot of weight and age"</span><span class="op">)</span></span></code></pre></div>
<p>To add marginal histograms use <code>type = "histogram"</code>. You can optionally set <code>groupFill = TRUE</code> to get stacked histograms.</p>
<div class="sourceCode" id="cb1481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with histograms</span></span>
<span><span class="fu">ggMarginal</span><span class="op">(</span></span>
<span>  <span class="va">scatter_plot</span>,                     <span class="co"># add marginal histograms</span></span>
<span>  type <span class="op">=</span> <span class="st">"histogram"</span>,               <span class="co"># specify histograms</span></span>
<span>  fill <span class="op">=</span> <span class="st">"lightblue"</span>,               <span class="co"># bar fill</span></span>
<span>  xparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,    <span class="co"># other parameters for x-axis marginal</span></span>
<span>  yparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>     <span class="co"># other parameters for y-axis marginal</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1091-1.png" width="672"></div>
<p>Marginal density plot with grouped/colored values:</p>
<div class="sourceCode" id="cb1482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scatter plot, colored by outcome</span></span>
<span><span class="co"># Outcome column is assigned as color in ggplot. groupFill in ggMarginal set to TRUE</span></span>
<span><span class="va">scatter_plot_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Scatter plot of weight and age"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggMarginal</span><span class="op">(</span><span class="va">scatter_plot_color</span>, type <span class="op">=</span> <span class="st">"density"</span>, groupFill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1092-1.png" width="672"></div>
<p>Set the <code>size =</code> arguemnt to adjust the relative size of the marginal plot. Smaller number makes a larger marginal plot. You also set <code>color =</code>. Below are is a marginal boxplot, with demonstration of the <code>margins =</code> argument so it appears on only one axis:</p>
<div class="sourceCode" id="cb1483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with boxplot </span></span>
<span><span class="fu">ggMarginal</span><span class="op">(</span></span>
<span>  <span class="va">scatter_plot</span>,</span>
<span>  margins <span class="op">=</span> <span class="st">"x"</span>,      <span class="co"># only show x-axis marginal plot</span></span>
<span>  type <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span>   </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1093-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="smart-labeling" class="section level2" number="31.6">
<h2>
<span class="header-section-number">31.6</span> Smart Labeling<a class="anchor" aria-label="anchor" href="#smart-labeling"><i class="fas fa-link"></i></a>
</h2>
<p>In <strong>ggplot2</strong>, it is also possible to add text to plots. However, this comes with the notable limitation where text labels often clash with data points in a plot, making them look messy or hard to read. There is no ideal way to deal with this in the base package, but there is a <strong>ggplot2</strong> add-on, known as <strong>ggrepel</strong> that makes dealing with this very simple!</p>
<p>The <strong>ggrepel</strong> package provides two new functions, <code>geom_label_repel()</code> and <code>geom_text_repel()</code>, which replace <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text()</a></code>. Simply use these functions instead of the base functions to produce neat labels. Within the function, map the aesthetics <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> as always, but include the argument <code>label =</code> to which you provide a column name containing the values you want to display (e.g. patient id, or name, etc.). You can make more complex labels by combining columns and newlines (<code>\n</code>) within <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> as shown below.</p>
<p>A few tips:</p>
<ul>
<li>Use <code>min.segment.length = 0</code> to always draw line segments, or <code>min.segment.length = Inf</code> to never draw them<br>
</li>
<li>Use <code>size =</code> outside of <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> to set text size<br>
</li>
<li>Use <code>force =</code> to change the degree of repulsion between labels and their respective points (default is 1)<br>
</li>
<li>Include <code>fill =</code> within <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> to have label colored by value
<ul>
<li>A letter “a” may appear in the legend - add <code>guides(fill = guide_legend(override.aes = aes(color = NA)))+</code> to remove it</li>
</ul>
</li>
</ul>
<p>See this is very in-depth <a href="https://ggrepel.slowkow.com/articles/examples.html">tutorial</a> for more.</p>
<div class="sourceCode" id="cb1484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">ggrepel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                                               <span class="co"># start with linelist</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                                   <span class="co"># group by hospital</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>                                               <span class="co"># create new dataset with summary values per hospital</span></span>
<span>    n_cases <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,                                           <span class="co"># number of cases per hospital</span></span>
<span>    delay_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">days_onset_hosp</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,    <span class="co"># mean delay per hospital</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_cases</span>, y <span class="op">=</span> <span class="va">delay_mean</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># send data frame to ggplot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>                                    <span class="co"># add points</span></span>
<span>  <span class="fu">geom_label_repel</span><span class="op">(</span>                                        <span class="co"># add point labels</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span></span>
<span>        <span class="st">"{hospital}\n{n_cases} cases, {delay_mean} days"</span><span class="op">)</span>  <span class="co"># how label displays</span></span>
<span>      <span class="op">)</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,                                              <span class="co"># text size in labels</span></span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span>                               <span class="co"># show all line segments                </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>                                                    <span class="co"># add axes labels</span></span>
<span>    title <span class="op">=</span> <span class="st">"Mean delay to admission, by hospital"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of cases"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Mean delay (days)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1094-1.png" width="672"></div>
<p>You can label only a subset of the data points - by using standard <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> syntax to provide different <code>data =</code> for each <code>geom</code> layer of the plot. Below, All cases are plotted, but only a few are labeled.</p>
<div class="sourceCode" id="cb1485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># All points in grey</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">linelist</span>,                                   <span class="co"># all data provided to this layer</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ht_cm</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>                                              <span class="co"># grey and semi-transparent</span></span>
<span>  </span>
<span>  <span class="co"># Few points in black</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">days_onset_hosp</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">)</span>,  <span class="co"># filtered data provided to this layer</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ht_cm</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                                                <span class="co"># default black and not transparent</span></span>
<span>  </span>
<span>  <span class="co"># point labels for few points</span></span>
<span>  <span class="fu">geom_label_repel</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">days_onset_hosp</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">)</span>,  <span class="co"># filter the data for the labels</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">ht_cm</span>,</span>
<span>      y <span class="op">=</span> <span class="va">wt_kg</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">outcome</span>,                                          <span class="co"># label color by outcome</span></span>
<span>      label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Delay: {days_onset_hosp}d"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># label created with str_glue()</span></span>
<span>    min.segment.length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>                                  <span class="co"># show line segments for all</span></span>
<span>  </span>
<span>  <span class="co"># remove letter "a" from inside legend boxes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># axis labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Cases with long delay to admission"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"weight (kg)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"height(cm)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1095-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="time-axes" class="section level2" number="31.7">
<h2>
<span class="header-section-number">31.7</span> Time axes<a class="anchor" aria-label="anchor" href="#time-axes"><i class="fas fa-link"></i></a>
</h2>
<p>Working with time axes in ggplot can seem daunting, but is made very easy with a few key functions. Remember that when working with time or date that you should ensure that the correct variables are formatted as date or datetime class - see the <a href="working-with-dates.html#working-with-dates">Working with dates</a> page for more information on this, or <a href="epidemic-curves.html#epidemic-curves">Epidemic curves</a> page (ggplot section) for examples.</p>
<p>The single most useful set of functions for working with dates in <code>ggplot2</code> are the scale functions (<code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_datetime()</a></code>, and their cognate y-axis functions). These functions let you define how often you have axis labels, and how to format axis labels. To find out how to format dates, see the <em>working with dates</em> section again! You can use the <code>date_breaks</code> and <code>date_labels</code> arguments to specify how dates should look:</p>
<ol style="list-style-type: decimal">
<li><p><code>date_breaks</code> allows you to specify how often axis breaks occur - you can pass a string here (e.g. <code>"3 months"</code>, or “<code>2 days"</code>)</p></li>
<li><p><code>date_labels</code> allows you to define the format dates are shown in. You can pass a date format string to these arguments (e.g. <code>"%b-%d-%Y"</code>):</p></li>
</ol>
<div class="sourceCode" id="cb1486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make epi curve by date of onset when available</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    <span class="co"># 1 break every 1 month</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 months"</span>,</span>
<span>    <span class="co"># labels should show month then date</span></span>
<span>    date_labels <span class="op">=</span> <span class="st">"%b %d"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1096-1.png" width="672"></div>
<p>One easy solution to efficient date labels on the x-axis is to to assign the <code>labels =</code> argument in <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code> to the function <code>label_date_short()</code> from the package <strong>scales</strong>. This function will automatically construct efficient date labels (read more <a href="https://scales.r-lib.org/reference/label_date.html">here</a>). An additional benefit of this function is that the labels will automatically adjust as your data expands over time, from days, to weeks, to months and years.</p>
<p>See a complete example in the Epicurves page section on <a href="https://epirhandbook.com/en/epidemic-curves.html#multi-level-date-labels">multi-level date labels</a>, but a quick example is shown below for reference:</p>
<div class="sourceCode" id="cb1487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html">label_date_short</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># automatically efficient date labels</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1097-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="highlighting" class="section level2" number="31.8">
<h2>
<span class="header-section-number">31.8</span> Highlighting<a class="anchor" aria-label="anchor" href="#highlighting"><i class="fas fa-link"></i></a>
</h2>
<p>Highlighting specific elements in a chart is a useful way to draw attention to a specific instance of a variable while also providing information on the dispersion of the full dataset. While this is not easily done in base <strong>ggplot2</strong>, there is an external package that can help to do this known as <strong>gghighlight</strong>. This is easy to use within the ggplot syntax.</p>
<p>The <strong>gghighlight</strong> package uses the <code><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight()</a></code> function to achieve this effect. To use this function, supply a logical statement to the function - this can have quite flexible outcomes, but here we’ll show an example of the age distribution of cases in our linelist, highlighting them by outcome.</p>
<div class="sourceCode" id="cb1488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load gghighlight</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yutannihilation.github.io/gghighlight/">gghighlight</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># replace NA values with unknown in the outcome variable</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># produce a histogram of all cases by age</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span><span class="op">)</span>     <span class="co"># highlight instances where the patient has died.</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1098-1.png" width="672"></div>
<p>This also works well with faceting functions - it allows the user to produce facet plots with the background data highlighted that doesn’t apply to the facet! Below we count cases by week and plot the epidemic curves by hospital (<code>color =</code> and <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> set to <code>hospital</code> column).</p>
<div class="sourceCode" id="cb1489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># produce a histogram of all cases by age</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_hospitalisation</span>, <span class="st">"week"</span><span class="op">)</span>,</span>
<span>        <span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/gghighlight/reference/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                      <span class="co"># highlight instances where the patient has died</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">hospital</span><span class="op">)</span>                              <span class="co"># make facets by outcome</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1099-1.png" width="672"></div>
</div>
<div id="plotting-multiple-datasets" class="section level2" number="31.9">
<h2>
<span class="header-section-number">31.9</span> Plotting multiple datasets<a class="anchor" aria-label="anchor" href="#plotting-multiple-datasets"><i class="fas fa-link"></i></a>
</h2>
<p>Note that properly aligning axes to plot from multiple datasets in the same plot can be difficult. Consider one of the following strategies:</p>
<ul>
<li>Merge the data prior to plotting, and convert to “long” format with a column reflecting the dataset<br>
</li>
<li>Use <strong>cowplot</strong> or a similar package to combine two plots (see below)</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="combine-plots" class="section level2" number="31.10">
<h2>
<span class="header-section-number">31.10</span> Combine plots<a class="anchor" aria-label="anchor" href="#combine-plots"><i class="fas fa-link"></i></a>
</h2>
<p>Two packages that are very useful for combining plots are <strong>cowplot</strong> and <strong>patchwork</strong>. In this page we will mostly focus on <strong>cowplot</strong>, with occassional use of <strong>patchwork</strong>.</p>
<p>Here is the online <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html">introduction to cowplot</a>. You can read the more extensive documentation for each function online <a href="https://www.rdocumentation.org/packages/cowplot/versions/1.1.1">here</a>. We will cover a few of the most common use cases and functions below.</p>
<p>The <strong>cowplot</strong> package works in tandem with <strong>ggplot2</strong> - essentially, you use it to arrange and combine ggplots and their legends into compound figures. It can also accept <strong>base</strong> R graphics.</p>
<div class="sourceCode" id="cb1490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">tidyverse</span>,      <span class="co"># data manipulation and visualisation</span></span>
<span>  <span class="va">cowplot</span>,        <span class="co"># combine plots</span></span>
<span>  <span class="va">patchwork</span>       <span class="co"># combine plots</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>While faceting (described in the <a href="ggplot-basics.html#ggplot-basics">ggplot basics</a> page) is a convenient approach to plotting, sometimes its not possible to get the results you want from its relatively restrictive approach. Here, you may choose to combine plots by sticking them together into a larger plot. There are three well known packages that are great for this - <strong>cowplot</strong>, <strong>gridExtra</strong>, and <strong>patchwork</strong>. However, these packages largely do the same things, so we’ll focus on <strong>cowplot</strong> for this section.</p>
<div id="plot_grid" class="section level3 unnumbered">
<h3>
<code>plot_grid()</code><a class="anchor" aria-label="anchor" href="#plot_grid"><i class="fas fa-link"></i></a>
</h3>
<p>The <strong>cowplot</strong> package has a fairly wide range of functions, but the easiest use of it can be achieved through the use of <code>plot_grid()</code>. This is effectively a way to arrange predefined plots in a grid formation. We can work through another example with the malaria dataset - here we can plot the total cases by district, and also show the epidemic curve over time.</p>
<div class="sourceCode" id="cb1491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># bar chart of total cases by district</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">District</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"District"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total number of cases"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Total malaria cases by district"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># epidemic curve over time</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of data submission"</span>,</span>
<span>    y <span class="op">=</span>  <span class="st">"number of cases"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>,</span>
<span>                  <span class="co"># 1 column and two rows - stacked on top of each other</span></span>
<span>                   ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   <span class="co"># top plot is 2/3 as tall as second</span></span>
<span>                   rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1101-1.png" width="672"></div>
</div>
<div id="combine-legends" class="section level3 unnumbered">
<h3>Combine legends<a class="anchor" aria-label="anchor" href="#combine-legends"><i class="fas fa-link"></i></a>
</h3>
<p>If your plots have the same legend, combining them is relatively straight-forward. Simple use the <strong>cowplot</strong> approach above to combine the plots, but remove the legend from one of them (de-duplicate).</p>
<p>If your plots have different legends, you must use an alternative approach:</p>
<ol style="list-style-type: decimal">
<li>Create and save your plots <em>without legends</em> using <code>theme(legend.position = "none")</code><br>
</li>
<li>Extract the legends from each plot using <code>get_legend()</code> as shown below - <em>but extract legends from the plots modified to actually show the legend</em><br>
</li>
<li>Combine the legends into a legends panel<br>
</li>
<li>Combine the plots and legends panel</li>
</ol>
<p>For demonstration we show the two plots separately, and then arranged in a grid with their own legends showing (ugly and inefficient use of space):</p>
<div class="sourceCode" id="cb1492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">4</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by outcome"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">1</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by age"</span><span class="op">)</span></span></code></pre></div>
<p>Here is how the two plots look when combined using <code>plot_grid()</code> without combining their legends:</p>
<div class="sourceCode" id="cb1493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1103-1.png" width="672"></div>
<p>And now we show how to combine the legends. Essentially what we do is to define each plot <em>without</em> its legend (<code>theme(legend.position = "none"</code>), and then we define each plot’s legend <em>separately</em>, using the <code>get_legend()</code> function from <strong>cowplot</strong>. When we extract the legend from the saved plot, we need to add <code>+</code> the legend back in, including specifying the placement (“right”) and smaller adjustments for alignment of the legends and their titles. Then, we combine the legends together vertically, and then combine the two plots with the newly-combined legends. Voila!</p>
<div class="sourceCode" id="cb1494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define plot 1 without legend</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">4</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by outcome"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define plot 2 without legend</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">1</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by age"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># extract legend from p1 (from p1 + legend)</span></span>
<span><span class="va">leg_p1</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html">get_legend</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span></span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,        <span class="co"># extract vertical legend</span></span>
<span>                                      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># so legends  align</span></span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Outcome"</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># title of legend</span></span>
<span><span class="co"># extract legend from p2 (from p2 + legend)</span></span>
<span><span class="va">leg_p2</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html">get_legend</a></span><span class="op">(</span><span class="va">p2</span> <span class="op">+</span> </span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,         <span class="co"># extract vertical legend   </span></span>
<span>                                      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># so legends align</span></span>
<span>                                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Age Category"</span><span class="op">)</span><span class="op">)</span>             <span class="co"># title of legend</span></span>
<span></span>
<span><span class="co"># create a blank plot for legend alignment</span></span>
<span><span class="co">#blank_p &lt;- patchwork::plot_spacer() + theme_void()</span></span>
<span></span>
<span><span class="co"># create legends panel, can be one on top of the other (or use spacer commented above)</span></span>
<span><span class="va">legends</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">leg_p1</span>, <span class="va">leg_p2</span>, nrow <span class="op">=</span> <span class="fl">2</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine two plots and the combined legends panel</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">legends</span>, ncol <span class="op">=</span> <span class="fl">3</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">.4</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined</span>  <span class="co"># print</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1104-1.png" width="672"></div>
<p>This solution was learned from <a href="https://stackoverflow.com/questions/52060601/ggplot-multiple-legends-arrangement">this post</a> with a minor fix to align legends from <a href="https://github.com/wilkelab/cowplot/issues/33">this post</a>.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Fun note - the “cow” in <strong>cowplot</strong> comes from the creator’s name - Claus O. Wilke.</span></p>
</div>
<div id="inset-plots" class="section level3 unnumbered">
<h3>Inset plots<a class="anchor" aria-label="anchor" href="#inset-plots"><i class="fas fa-link"></i></a>
</h3>
<p>You can inset one plot in another using <strong>cowplot</strong>. Here are things to be aware of:</p>
<ul>
<li>Define the main plot with <code>theme_half_open()</code> from <strong>cowplot</strong>; it may be best to have the legend either on top or bottom<br>
</li>
<li>Define the inset plot. Best is to have a plot where you do not need a legend. You can remove plot theme elements with <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> as shown below.<br>
</li>
<li>Combine them by applying <code>ggdraw()</code> to the main plot, then adding <code>draw_plot()</code> on the inset plot and specifying the coordinates (x and y of lower left corner), height and width as proportion of the whole main plot.</li>
</ul>
<div class="sourceCode" id="cb1495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define main plot</span></span>
<span><span class="va">main_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">1</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">theme_half_open</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Epidemic curve and outcomes by hospital"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define inset plot</span></span>
<span><span class="va">inset_plot</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html">recode</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Marks"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span>, palette <span class="op">=</span> <span class="fl">4</span>, na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>          axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cases by outcome"</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># Combine main with inset</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html">ggdraw</a></span><span class="op">(</span><span class="va">main_plot</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu">draw_plot</span><span class="op">(</span><span class="va">inset_plot</span>,</span>
<span>               x <span class="op">=</span> <span class="fl">.6</span>, y <span class="op">=</span> <span class="fl">.55</span>,    <span class="co">#x = .07, y = .65,</span></span>
<span>               width <span class="op">=</span> <span class="fl">.4</span>, height <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1105-1.png" width="100%"></div>
<p>This technique is explained more in these two vignettes:</p>
<p><a href="https://wilkelab.org/cowplot/articles/drawing_with_on_plots.html">Wilke lab</a><br><a href="https://www.rdocumentation.org/packages/cowplot/versions/1.1.1/topics/draw_plot">draw_plot() documentation</a></p>
<!-- ======================================================= -->
</div>
</div>
<div id="dual-axes" class="section level2" number="31.11">
<h2>
<span class="header-section-number">31.11</span> Dual axes<a class="anchor" aria-label="anchor" href="#dual-axes"><i class="fas fa-link"></i></a>
</h2>
<p>A secondary y-axis is often a requested addition to a <code>ggplot2</code> graph. While there is a robust debate about the validity of such graphs in the data visualization community, and they are often not recommended, your manager may still want them. Below, we present one method to achieve them: using the <strong>cowplot</strong> package to combine two separate plots.</p>
<p>This approach involves creating two separate plots - one with a y-axis on the left, and the other with y-axis on the right. Both will use a specific <code>theme_cowplot()</code> and must have the same x-axis. Then in a third command the two plots are aligned and overlaid on top of each other. The functionalities of <strong>cowplot</strong>, of which this is only one, are described in depth at this <a href="https://wilkelab.org/cowplot/articles/aligning_plots.html">site</a>.</p>
<p>To demonstrate this technique we will overlay the epidemic curve with a line of the weekly percent of patients who died. We use this example because the alignment of dates on the x-axis is more complex than say, aligning a bar chart with another plot. Some things to note:</p>
<ul>
<li>The epicurve and the line are aggregated into weeks prior to plotting <em>and</em> the <code>date_breaks</code> and <code>date_labels</code> are identical - we do this so that the x-axes of the two plots are the same when they are overlaid.<br>
</li>
<li>The y-axis is moved to the right-side for plot 2 with the <code>position =</code> argument of <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous()</a></code>.<br>
</li>
<li>Both plots make use of <code>theme_cowplot()</code>
</li>
</ul>
<p>Note there is another example of this technique in the <a href="epidemic-curves.html#epidemic-curves">Epidemic curves</a> page - overlaying cumulative incidence on top of the epicurve.</p>
<p><strong>Make plot 1</strong><br>
This is essentially the epicurve. We use <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area()</a></code> just to demonstrate its use (area under a line, by default)</p>
<div class="sourceCode" id="cb1496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>            <span class="co"># load/install cowplot</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                 <span class="co"># save plot as object</span></span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span></span>
<span>       epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_area</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>               date_breaks <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>               date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>       y <span class="op">=</span> <span class="st">"Weekly cases"</span></span>
<span>     <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span>                                      <span class="co"># view plot </span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1106-1.png" width="672"></div>
<p><strong>Make plot 2</strong><br>
Create the second plot showing a line of the weekly percent of cases who died.</p>
<div class="sourceCode" id="cb1497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>         <span class="co"># save plot as object</span></span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span></span>
<span>       epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>       n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>       pct_death <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek</span>, y <span class="op">=</span> <span class="va">pct_death</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span></span>
<span>               date_breaks <span class="op">=</span> <span class="st">"month"</span>,</span>
<span>               date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>               position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="st">"Epiweek of symptom onset"</span>,</span>
<span>            y <span class="op">=</span> <span class="st">"Weekly percent of deaths"</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Weekly case incidence and percent deaths"</span></span>
<span>          <span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span>     <span class="co"># view plot</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1107-1.png" width="672"></div>
<p>Now we align the plot using the function <code>align_plots()</code>, specifying horizontal and vertical alignment (“hv”, could also be “h”, “v”, “none”). We specify alignment of all axes as well (top, bottom, left, and right) with “tblr”. The output is of class list (2 elements).</p>
<p>Then we draw the two plots together using <code>ggdraw()</code> (from <strong>cowplot</strong>) and referencing the two parts of the <code>aligned_plots</code> object.</p>
<div class="sourceCode" id="cb1498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>         <span class="co"># align the two plots and save them as list</span></span>
<span><span class="va">aligned_plotted</span> <span class="op">&lt;-</span> <span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>  <span class="co"># overlay them and save the visual plot</span></span>
<span><span class="va">aligned_plotted</span>                                                                <span class="co"># print the overlayed plots</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1108-1.png" width="672"></div>
<!-- ### Statistical transformation {.unnumbered}   -->
<!-- Another way to do this to have the second axis be a direct transformation of the secondary axis.  -->
<!-- Differences in axis values will be purely cosmetic - if you want to show two different variables on one graph, with different y-axis scales for each variable, this will not work without some work behind the scenes. To obtain this effect, you will have to transform one of your variables in the data, and apply the same transformation *in reverse* when specifying the axis labels. Based on this, you can either specify the transformation explicitly (e.g. variable a is around 10x as large as variable b) or calculate it in the code (e.g. what is the ratio between the maximum values of each dataset). -->
<!-- The syntax for adding a secondary axis is very straightforward! When calling a `scale_xxx_xxx()` function (e.g. `scale_y_continuous()`), use the `sec.axis` argument to call the `sec_axis()` function. The `trans` argument in this function allows you to specify the label transformation for the axis - provide this in standard tidyverse syntax.  -->
<!-- For example, if we want to show the number of positive RDTs in the malaria dataset for facility 1, showing 0-4 year olds and all cases on chart: -->
<!-- ```{r, , warning=F, message=F} -->
<!-- # take malaria data from facility 1 -->
<!-- malaria_facility_1 <- malaria_data %>% -->
<!--   filter(location_name == "Facility 1") -->
<!-- # calculate the ratio between malaria_rdt_0-4 and malaria_tot  -->
<!-- tf_ratio <- max(malaria_facility_1$malaria_tot, na.rm = T) / max(malaria_facility_1$`malaria_rdt_0-4`, na.rm = T) -->
<!-- # transform the values in the dataset -->
<!-- malaria_facility_1 <- malaria_facility_1 %>% -->
<!--   mutate(malaria_rdt_0_4_tf = `malaria_rdt_0-4` * tf_ratio) -->
<!-- # plot the graph with dual axes -->
<!-- ggplot(malaria_facility_1, aes(x = data_date)) + -->
<!--   geom_line(aes(y = malaria_tot, col = "Total cases")) + -->
<!--   geom_line(aes(y = malaria_rdt_0_4_tf, col = "Cases: 0-4 years old")) + -->
<!--   scale_y_continuous( -->
<!--     name = "Total cases", -->
<!--     sec.axis = sec_axis(trans = ~ . / tf_ratio, name = "Cases: 0-4 years old") -->
<!--   ) + -->
<!--   labs(x = "date of data collection") + -->
<!--   theme_minimal() + -->
<!--   theme(legend.title = element_blank()) -->
<!-- ``` -->
<!-- ## Sparklines   -->
<!-- UNDER CONSTRUCTION   -->
<!-- (perhaps move to Tables for presentation page) -->
</div>
<div id="packages-to-help-you" class="section level2" number="31.12">
<h2>
<span class="header-section-number">31.12</span> Packages to help you<a class="anchor" aria-label="anchor" href="#packages-to-help-you"><i class="fas fa-link"></i></a>
</h2>
<p>There are some really neat R packages specifically designed to help you navigate <strong>ggplot2</strong>:</p>
<div id="point-and-click-ggplot2-with-equisse" class="section level3 unnumbered">
<h3>Point-and-click <strong>ggplot2</strong> with <strong>equisse</strong><a class="anchor" aria-label="anchor" href="#point-and-click-ggplot2-with-equisse"><i class="fas fa-link"></i></a>
</h3>
<p>“This addin allows you to interactively explore your data by visualizing it with the ggplot2 package. It allows you to draw bar plots, curves, scatter plots, histograms, boxplot and sf objects, then export the graph or retrieve the code to reproduce the graph.”</p>
<p>Install and then launch the addin via the RStudio menu or with <code>esquisse::esquisser()</code>.</p>
<p>See the <a href="https://github.com/dreamRs/esquisse">Github page</a></p>
<p><a href="https://dreamrs.github.io/esquisse/index.html">Documentation</a></p>
</div>
</div>
<div id="miscellaneous" class="section level2" number="31.13">
<h2>
<span class="header-section-number">31.13</span> Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"><i class="fas fa-link"></i></a>
</h2>
<div id="numeric-display" class="section level3 unnumbered">
<h3>Numeric display<a class="anchor" aria-label="anchor" href="#numeric-display"><i class="fas fa-link"></i></a>
</h3>
<p>You can disable scientific notation by running this command prior to plotting.</p>
<div class="sourceCode" id="cb1499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code></pre></div>
<p>Or apply <code>number_format()</code> from the <strong>scales</strong> package to a specific value or column, as shown below.</p>
<p>Use functions from the package <strong>scales</strong> to easily adjust how numbers are displayed. These can be applied to columns in your data frame, but are shown on individual numbers for purpose of example.</p>
<div class="sourceCode" id="cb1500"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html">number</a></span><span class="op">(</span><span class="fl">6.2e5</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "620 000"</code></pre>
<div class="sourceCode" id="cb1502"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/number.html">number</a></span><span class="op">(</span><span class="fl">1506800.62</span>,  accuracy <span class="op">=</span> <span class="fl">0.1</span>,<span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1 506 800.6"</code></pre>
<div class="sourceCode" id="cb1504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">(</span><span class="fl">1506800.62</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1,506,800.62"</code></pre>
<div class="sourceCode" id="cb1506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma</a></span><span class="op">(</span><span class="fl">1506800.62</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span>,  big.mark <span class="op">=</span> <span class="st">"."</span> , decimal.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1.506.800,62"</code></pre>
<div class="sourceCode" id="cb1508"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "10%"</code></pre>
<div class="sourceCode" id="cb1510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/dollar_format.html">dollar</a></span><span class="op">(</span><span class="fl">56</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "$56"</code></pre>
<div class="sourceCode" id="cb1512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/scientific_format.html">scientific</a></span><span class="op">(</span><span class="fl">100000</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "1e+05"</code></pre>
</div>
</div>
<div id="resources-24" class="section level2" number="31.14">
<h2>
<span class="header-section-number">31.14</span> Resources<a class="anchor" aria-label="anchor" href="#resources-24"><i class="fas fa-link"></i></a>
</h2>
<p>Inspiration
<a href="https://www.tidyverse.org/blog/2018/07/ggplot2-3-0-0/">ggplot graph gallery</a></p>
<p>Presentation of data
European Centre for Disease Prevention and Control <a href="https://ecdc.europa.eu/sites/portal/files/documents/Guidelines%20for%20presentation%20of%20surveillance%20data-final-with-cover-for-we....pdf">Guidelines of presentation of surveillance data</a></p>
<p>Facets and labellers
<a href="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/#modifying-facet-label-text">Using labellers for facet strips</a>
<a href="https://ggplot2.tidyverse.org/reference/labellers.html">Labellers</a></p>
<p>Adjusting order with factors
<a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a><br><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a><br><a href="https://cmdlinetips.com/2019/02/how-to-reorder-a-boxplot-in-r/">How to reorder a boxplot</a><br><a href="https://www.r-graph-gallery.com/267-reorder-a-variable-in-ggplot2.html">Reorder a variable in ggplot2</a><br><a href="https://r4ds.had.co.nz/factors.html">R for Data Science - Factors</a></p>
<p>Legends<br><a href="https://stackoverflow.com/questions/38425908/reverse-stacking-order-without-affecting-legend-order-in-ggplot2-bar-charts">Adjust legend order</a></p>
<p>Captions
<a href="https://stackoverflow.com/questions/64701500/left-align-ggplot-caption">Caption alignment</a></p>
<p>Labels<br><a href="https://ggrepel.slowkow.com/articles/examples.html">ggrepel</a></p>
<p>Cheatsheets<br><a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/">Beautiful plotting with ggplot2</a></p>
<!-- TO DO - Under construction -->
<!-- * Straight horizontal, vertical, or other line -->
<!-- You can also add straight lines to your plot with `geom_hline()` (horizontal), `geom_vline()` (vertical) or `geom_abline()` (with a specified y intercept and slope) -->
<!-- Using option `label_wrap_gen` in facet_wrap to have multiple strip lines -->
<!-- labels and colors of strips -->
<!-- Axis text vertical adjustment -->
<!-- rotation -->
<!-- Labellers -->
<!-- limit range with limit() and coord_cartesian(), ylim(), or scale_x_continuous() -->
<!-- theme_classic() -->
<!-- expand = c(0,0) -->
<!-- coord_flip() -->
<!-- tick marks -->
<!-- ggrepel -->
<!-- animations -->
<!-- remove -->
<!-- remove title -->
<!-- using fill = or color = in labs() -->
<!-- flip order / don't flip order -->
<!-- move location -->
<!-- color?    theme(legend.title = element_text(colour="chocolate", size=16, face="bold"))+ scale_color_discrete(name="This color is\ncalled chocolate!?") -->
<!-- Color of boxes behind points in legend  -->
<!--      theme(legend.key=element_rect(fill='pink'))   or use fill = NA to remove them. http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/  -->
<!-- Change size of symbols in legend only guides(colour = guide_legend(override.aes = list(size=4))) -->
<!-- Turn off a layer in the legend -->
<!-- geom_text(data=nmmaps, aes(date, temp, label=round(temp)), size=4) -->
<!-- geom_text(data=nmmaps, aes(date, temp, label=round(temp), size=4), show_guide=FALSE) -->
<!-- Force a legend even if there is no aes().  -->
<!-- ggplot(nmmaps, aes(x=date, y=o3))+ -->
<!--      geom_line(aes(color="Important line"))+ -->
<!--      geom_point(aes(color="My points")) -->
<!-- Control the shape in the legend with guides - a list with linetype and shape -->
<!-- ggplot(nmmaps, aes(x=date, y=o3))+geom_line(aes(color="Important line"))+ -->
<!--    geom_point(aes(color="Point values"))+ -->
<!--   scale_colour_manual(name='', values=c('Important line'='grey', 'Point values'='red'), guide='legend') + -->
<!--   guides(colour = guide_legend(override.aes = list(linetype=c(1,0) -->
<!--                                                       , shape=c(NA, 16)))) -->

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot basics</a></div>
<div class="next"><a href="epidemic-curves.html"><span class="header-section-number">32</span> Epidemic curves</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot-tips"><span class="header-section-number">31</span> ggplot tips</a></li>
<li>
<a class="nav-link" href="#preparation-23"><span class="header-section-number">31.1</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#load-packages-21">Load packages</a></li>
<li><a class="nav-link" href="#import-data-18">Import data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ggplot_tips_colors"><span class="header-section-number">31.2</span> Scales for color, fill, axes, etc.</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#color-schemes"><span class="header-section-number">31.2.1</span> Color schemes</a></li>
<li><a class="nav-link" href="#ggplot_tips_scales">Scales</a></li>
<li><a class="nav-link" href="#scale-arguments">Scale arguments</a></li>
<li><a class="nav-link" href="#manual-adjustments">Manual adjustments</a></li>
<li><a class="nav-link" href="#continuous-axes-scales">Continuous axes scales</a></li>
<li><a class="nav-link" href="#gradient-scales">Gradient scales</a></li>
<li><a class="nav-link" href="#palettes">Palettes</a></li>
</ul>
</li>
<li><a class="nav-link" href="#change-order-of-discrete-variables"><span class="header-section-number">31.3</span> Change order of discrete variables</a></li>
<li><a class="nav-link" href="#contour-lines"><span class="header-section-number">31.4</span> Contour lines</a></li>
<li><a class="nav-link" href="#marginal-distributions"><span class="header-section-number">31.5</span> Marginal distributions</a></li>
<li><a class="nav-link" href="#smart-labeling"><span class="header-section-number">31.6</span> Smart Labeling</a></li>
<li><a class="nav-link" href="#time-axes"><span class="header-section-number">31.7</span> Time axes</a></li>
<li><a class="nav-link" href="#highlighting"><span class="header-section-number">31.8</span> Highlighting</a></li>
<li><a class="nav-link" href="#plotting-multiple-datasets"><span class="header-section-number">31.9</span> Plotting multiple datasets</a></li>
<li>
<a class="nav-link" href="#combine-plots"><span class="header-section-number">31.10</span> Combine plots</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#plot_grid">plot_grid()</a></li>
<li><a class="nav-link" href="#combine-legends">Combine legends</a></li>
<li><a class="nav-link" href="#inset-plots">Inset plots</a></li>
</ul>
</li>
<li><a class="nav-link" href="#dual-axes"><span class="header-section-number">31.11</span> Dual axes</a></li>
<li>
<a class="nav-link" href="#packages-to-help-you"><span class="header-section-number">31.12</span> Packages to help you</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#point-and-click-ggplot2-with-equisse">Point-and-click ggplot2 with equisse</a></li></ul>
</li>
<li>
<a class="nav-link" href="#miscellaneous"><span class="header-section-number">31.13</span> Miscellaneous</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#numeric-display">Numeric display</a></li></ul>
</li>
<li><a class="nav-link" href="#resources-24"><span class="header-section-number">31.14</span> Resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2023-07-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
