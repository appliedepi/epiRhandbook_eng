<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>50 Data Table | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.9/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.18/datatables.js"></script>
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.9.3/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
    <link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
    <script src="libs/vis-4.20.1/vis.min.js"></script>
    <script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script>
    <script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-8.1.2/highcharts.js"></script>
    <script src="libs/highcharts-8.1.2/highcharts-3d.js"></script>
    <script src="libs/highcharts-8.1.2/highcharts-more.js"></script>
    <script src="libs/highcharts-8.1.2/modules/stock.js"></script>
    <script src="libs/highcharts-8.1.2/modules/map.js"></script>
    <script src="libs/highcharts-8.1.2/modules/annotations.js"></script>
    <script src="libs/highcharts-8.1.2/modules/data.js"></script>
    <script src="libs/highcharts-8.1.2/modules/drilldown.js"></script>
    <script src="libs/highcharts-8.1.2/modules/item-series.js"></script>
    <script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-8.1.2/modules/exporting.js"></script>
    <script src="libs/highcharts-8.1.2/modules/export-data.js"></script>
    <script src="libs/highcharts-8.1.2/modules/funnel.js"></script>
    <script src="libs/highcharts-8.1.2/modules/heatmap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/treemap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/sankey.js"></script>
    <script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-8.1.2/modules/organization.js"></script>
    <script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script>
    <script src="libs/highcharts-8.1.2/modules/sunburst.js"></script>
    <script src="libs/highcharts-8.1.2/modules/vector.js"></script>
    <script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script>
    <script src="libs/highcharts-8.1.2/modules/xrange.js"></script>
    <script src="libs/highcharts-8.1.2/modules/tilemap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/venn.js"></script>
    <script src="libs/highcharts-8.1.2/modules/gantt.js"></script>
    <script src="libs/highcharts-8.1.2/modules/timeline.js"></script>
    <script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-8.1.2/modules/bullet.js"></script>
    <script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script>
    <script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script>
    <script src="libs/highcharts-8.1.2/modules/lollipop.js"></script>
    <script src="libs/highcharts-8.1.2/modules/series-label.js"></script>
    <script src="libs/highcharts-8.1.2/plugins/motion.js"></script>
    <script src="libs/highcharts-8.1.2/custom/reset.js"></script>
    <script src="libs/highcharts-8.1.2/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.8.2/highchart.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="data-table" class="section level1" number="50">
<h1><span class="header-section-number">50</span> Data Table</h1>
<p>The handbook focusses on the <strong>dplyr</strong> “verb” functions and the <strong>magrittr</strong> pipe operator <code>%&gt;%</code> as a method to clean and group data, but the <strong>data.table</strong> package offers an alternative method that you may encounter in your R career.</p>
<!-- ======================================================= -->
<div id="intro-to-data-tables" class="section level2" number="50.1">
<h2><span class="header-section-number">50.1</span> Intro to data tables</h2>
<p>A data table is a 2-dimensional data structure like a data frame that allows complex grouping operations to be performed. The data.table syntax is structured so that operations can be performed on rows, columns and groups.</p>
<p>The structure is <strong>DT[i, j, by]</strong>, separated by 3 parts; the <strong>i, j</strong> and <strong>by</strong> arguments. The <strong>i</strong> argument allows for subsetting of required rows, the <strong>j</strong> argument allows you to operate on columns and the <strong>by</strong> argument allows you operate on columns by groups.</p>
<p>This page will address the following topics:</p>
<ul>
<li>Importing data and use of <code>fread()</code> and <code>fwrite()</code></li>
<li>Selecting and filtering rows using the <strong>i</strong> argument</li>
<li>Using helper functions <code>%like%</code>, <code>%chin%</code>, <code>%between%</code></li>
<li>Selecting and computing on columns using the <strong>j</strong> argument</li>
<li>Computing by groups using the <strong>by</strong> argument</li>
<li>Adding and updating data to data tables using <code>:=</code></li>
</ul>
<!-- ======================================================= -->
</div>
<div id="load-packages-and-import-data" class="section level2" number="50.2">
<h2><span class="header-section-number">50.2</span> Load packages and import data</h2>
<div id="load-packages-34" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>Using the <code>p_load()</code> function from <strong>pacman</strong>, we load (and install if necessary) packages required for this analysis.</p>
<div class="sourceCode" id="cb1983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1983-1"><a href="data-table.html#cb1983-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1983-2"><a href="data-table.html#cb1983-2" aria-hidden="true" tabindex="-1"></a>  rio,        <span class="co"># to import data</span></span>
<span id="cb1983-3"><a href="data-table.html#cb1983-3" aria-hidden="true" tabindex="-1"></a>  data.table, <span class="co"># to group and clean data</span></span>
<span id="cb1983-4"><a href="data-table.html#cb1983-4" aria-hidden="true" tabindex="-1"></a>  tidyverse,  <span class="co"># allows use of pipe (%&gt;%) function in this chapter</span></span>
<span id="cb1983-5"><a href="data-table.html#cb1983-5" aria-hidden="true" tabindex="-1"></a>  here </span>
<span id="cb1983-6"><a href="data-table.html#cb1983-6" aria-hidden="true" tabindex="-1"></a>  ) </span></code></pre></div>
</div>
<div id="import-data-29" class="section level3 unnumbered">
<h3>Import data</h3>
<p>This page will explore some of the core functions of <strong>data.table</strong> using the case linelist referenced throughout the handbook.</p>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to download the data to follow step-by-step, see instructions in the [Download book and data] page. The dataset is imported using the <code>import()</code> function from the <strong>rio</strong> package. See the page on <a href="import-and-export.html#import-and-export">Import and export</a> for various ways to import data. From here we use <code>data.table()</code> to convert the data frame to a data table.</p>
<div class="sourceCode" id="cb1984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1984-1"><a href="data-table.html#cb1984-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;linelist_cleaned.xlsx&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">data.table</span>()</span></code></pre></div>
<p>The <code>fread()</code> function is used to directly import regular delimited files, such as .csv files, directly to a data table format. This function, and its counterpart, <code>fwrite()</code>, used for writing data.tables as regular delimited files are very fast and computationally efficient options for large databases.</p>
<p>The first 20 rows of <code>linelist</code>:</p>
<p>Base R commands such as <code>dim()</code> that are used for data frames can also be used for data tables</p>
<div class="sourceCode" id="cb1985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1985-1"><a href="data-table.html#cb1985-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(linelist) <span class="co">#gives the number of rows and columns in the data table</span></span></code></pre></div>
<pre><code>## [1] 5888   30</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="the-i-argument-selecting-and-filtering-rows" class="section level2" number="50.3">
<h2><span class="header-section-number">50.3</span> The i argument: selecting and filtering rows</h2>
<p>Recalling the <strong>DT[i, j, by]</strong> structure, we can filter rows using either row numbers or logical expressions. The i argument is first; therefore, the syntax <strong>DT[i]</strong> or <strong>DT[i,]</strong> can be used.</p>
<p>The first example retrieves the first 5 rows of the data table, the second example subsets cases are 18 years or over, and the third example subsets cases 18 years old or over but not diagnosed at the Central Hospital:</p>
<div class="sourceCode" id="cb1987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1987-1"><a href="data-table.html#cb1987-1" aria-hidden="true" tabindex="-1"></a>linelist[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="co">#returns the 1st to 5th row</span></span>
<span id="cb1987-2"><a href="data-table.html#cb1987-2" aria-hidden="true" tabindex="-1"></a>linelist[age <span class="sc">&gt;=</span> <span class="dv">18</span>] <span class="co">#subsets cases are equal to or over 18 years</span></span>
<span id="cb1987-3"><a href="data-table.html#cb1987-3" aria-hidden="true" tabindex="-1"></a>linelist[age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> hospital <span class="sc">!=</span> <span class="st">&quot;Central Hospital&quot;</span>] <span class="co">#subsets cases equal to or over 18 years old but not diagnosed at the Central Hospital</span></span></code></pre></div>
<p>Using .N in the i argument represents the total number of rows in the data table. This can be used to subset on the row numbers:</p>
<div class="sourceCode" id="cb1988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1988-1"><a href="data-table.html#cb1988-1" aria-hidden="true" tabindex="-1"></a>linelist[.N] <span class="co">#returns the last row</span></span>
<span id="cb1988-2"><a href="data-table.html#cb1988-2" aria-hidden="true" tabindex="-1"></a>linelist[<span class="dv">15</span><span class="sc">:</span>.N] <span class="co">#returns the 15th to the last row</span></span></code></pre></div>
<div id="using-helper-functions-for-filtering" class="section level3 unnumbered">
<h3>Using helper functions for filtering</h3>
<p>Data table uses helper functions that make subsetting rows easy. The <code>%like%</code> function is used to match a pattern in a column, <code>%chin%</code> is used to match a specific character, and the <code>%between%</code> helper function is used to match numeric columns within a prespecified range.</p>
<p>In the following examples we:
* filter rows where the hospital variable contains “Hospital”
* filter rows where the outcome is “Recover” or “Death”
* filter rows in the age range 40-60</p>
<div class="sourceCode" id="cb1989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1989-1"><a href="data-table.html#cb1989-1" aria-hidden="true" tabindex="-1"></a>linelist[hospital <span class="sc">%like%</span> <span class="st">&quot;Hospital&quot;</span>] <span class="co">#filter rows where the hospital variable contains “Hospital”</span></span>
<span id="cb1989-2"><a href="data-table.html#cb1989-2" aria-hidden="true" tabindex="-1"></a>linelist[outcome <span class="sc">%chin%</span> <span class="fu">c</span>(<span class="st">&quot;Recover&quot;</span>, <span class="st">&quot;Death&quot;</span>)] <span class="co">#filter rows where the outcome is “Recover” or “Death”</span></span>
<span id="cb1989-3"><a href="data-table.html#cb1989-3" aria-hidden="true" tabindex="-1"></a>linelist[age <span class="sc">%between%</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">60</span>)] <span class="co">#filter rows in the age range 40-60</span></span>
<span id="cb1989-4"><a href="data-table.html#cb1989-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1989-5"><a href="data-table.html#cb1989-5" aria-hidden="true" tabindex="-1"></a><span class="co">#%between% must take a vector of length 2, whereas %chin% can take vectors of length &gt;= 1</span></span></code></pre></div>
</div>
</div>
<div id="the-j-argument-selecting-and-computing-on-columns" class="section level2" number="50.4">
<h2><span class="header-section-number">50.4</span> The j argument: selecting and computing on columns</h2>
<p>Using the <strong>DT[i, j, by]</strong> structure, we can select columns using numbers or names. The <strong>j</strong> argument is second; therefore, the syntax <strong>DT[, j]</strong> is used. To facilitate computations on the <strong>j</strong> argument, the column is wrapped using either <code>list()</code> or <code>.()</code>.</p>
<div id="selecting-columns" class="section level3 unnumbered">
<h3>Selecting columns</h3>
<p>The first example retrieves the first, third and fifth columns of the data table, the second example selects all columns except the height, weight and gender columns. The third example uses the <code>.()</code> wrap to select the <strong>case_id</strong> and <strong>outcome</strong> columns.</p>
<div class="sourceCode" id="cb1990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1990-1"><a href="data-table.html#cb1990-1" aria-hidden="true" tabindex="-1"></a>linelist[ , <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb1990-2"><a href="data-table.html#cb1990-2" aria-hidden="true" tabindex="-1"></a>linelist[ , <span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;wt_kg&quot;</span>, <span class="st">&quot;ht_cm&quot;</span>)]</span>
<span id="cb1990-3"><a href="data-table.html#cb1990-3" aria-hidden="true" tabindex="-1"></a>linelist[ , <span class="fu">list</span>(case_id, outcome)] <span class="co">#linelist[ , .(case_id, outcome)] works just as well</span></span></code></pre></div>
</div>
<div id="computing-on-columns" class="section level3 unnumbered">
<h3>Computing on columns</h3>
<p>By combining the <strong>i</strong> and <strong>j</strong> arguments it is possible to filter rows and compute on the columns. Using <strong>.N</strong> in the <strong>j</strong> argument also represents the total number of rows in the data table and can be useful to return the number of rows after row filtering.</p>
<p>In the following examples we:
* Count the number of cases that stayed over 7 days in hospital
* Calculate the mean age of the cases that died at the military hospital
* Calculate the standard deviation, median, mean age of the cases that recovered at the central hospital</p>
<div class="sourceCode" id="cb1991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1991-1"><a href="data-table.html#cb1991-1" aria-hidden="true" tabindex="-1"></a>linelist[days_onset_hosp <span class="sc">&gt;</span> <span class="dv">7</span> , .N]</span></code></pre></div>
<pre><code>## [1] 189</code></pre>
<div class="sourceCode" id="cb1993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1993-1"><a href="data-table.html#cb1993-1" aria-hidden="true" tabindex="-1"></a>linelist[hospital <span class="sc">%like%</span> <span class="st">&quot;Military&quot;</span> <span class="sc">&amp;</span> outcome <span class="sc">%chin%</span> <span class="st">&quot;Death&quot;</span>, .(<span class="fu">mean</span>(age, <span class="at">na.rm =</span> T))] <span class="co">#na.rm = T removes N/A values</span></span></code></pre></div>
<pre><code>##         V1
## 1: 15.9084</code></pre>
<div class="sourceCode" id="cb1995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1995-1"><a href="data-table.html#cb1995-1" aria-hidden="true" tabindex="-1"></a>linelist[hospital <span class="sc">==</span> <span class="st">&quot;Central Hospital&quot;</span> <span class="sc">&amp;</span> outcome <span class="sc">==</span> <span class="st">&quot;Recover&quot;</span>, </span>
<span id="cb1995-2"><a href="data-table.html#cb1995-2" aria-hidden="true" tabindex="-1"></a>                 .(<span class="at">mean_age =</span> <span class="fu">mean</span>(age, <span class="at">na.rm =</span> T),</span>
<span id="cb1995-3"><a href="data-table.html#cb1995-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">median_age =</span> <span class="fu">median</span>(age, <span class="at">na.rm =</span> T),</span>
<span id="cb1995-4"><a href="data-table.html#cb1995-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sd_age =</span> <span class="fu">sd</span>(age, <span class="at">na.rm =</span> T))] <span class="co">#this syntax does not use the helper functions but works just as well</span></span></code></pre></div>
<pre><code>##    mean_age median_age   sd_age
## 1: 16.85185         14 12.93857</code></pre>
<p>Remember using the .() wrap in the j argument facilitates computation, returns a data table and allows for column naming.</p>
</div>
</div>
<div id="the-by-argument-computing-by-groups" class="section level2" number="50.5">
<h2><span class="header-section-number">50.5</span> The by argument: computing by groups</h2>
<p>The <strong>by</strong> argument is the third argument in the <strong>DT[i, j, by]</strong> structure. The <strong>by</strong> argument accepts both a character vector and the <code>list()</code> or <code>.()</code> syntax. Using the <code>.()</code> syntax in the <strong>by</strong> argument allows column renaming on the fly.</p>
<p>In the following examples we:<br />
* group the number of cases by hospital
* in cases 18 years old or over, calculate the mean height and weight of cases according to gender and whether they recovered or died
* in admissions that lasted over 7 days, count the number of cases according to the month they were admitted and the hospital they were admitted to</p>
<div class="sourceCode" id="cb1997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1997-1"><a href="data-table.html#cb1997-1" aria-hidden="true" tabindex="-1"></a>linelist[, .N, .(hospital)] <span class="co">#the number of cases by hospital</span></span></code></pre></div>
<pre><code>##                                hospital    N
## 1:                                Other  885
## 2:                              Missing 1469
## 3: St. Mark&#39;s Maternity Hospital (SMMH)  422
## 4:                        Port Hospital 1762
## 5:                    Military Hospital  896
## 6:                     Central Hospital  454</code></pre>
<div class="sourceCode" id="cb1999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1999-1"><a href="data-table.html#cb1999-1" aria-hidden="true" tabindex="-1"></a>linelist[age <span class="sc">&gt;</span> <span class="dv">18</span>, .(<span class="at">mean_wt =</span> <span class="fu">mean</span>(wt_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb1999-2"><a href="data-table.html#cb1999-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mean_ht =</span> <span class="fu">mean</span>(ht_cm, <span class="at">na.rm =</span> T)), .(gender, outcome)] <span class="co">#NAs represent the categories where the data is missing</span></span></code></pre></div>
<pre><code>##    gender outcome  mean_wt  mean_ht
## 1:      m Recover 71.90227 178.1977
## 2:      f   Death 63.27273 159.9448
## 3:      m   Death 71.61770 175.4726
## 4:      f    &lt;NA&gt; 64.49375 162.7875
## 5:      m    &lt;NA&gt; 72.65505 176.9686
## 6:      f Recover 62.86498 159.2996
## 7:   &lt;NA&gt; Recover 67.21429 175.2143
## 8:   &lt;NA&gt;   Death 69.16667 170.7917
## 9:   &lt;NA&gt;    &lt;NA&gt; 70.25000 175.5000</code></pre>
<div class="sourceCode" id="cb2001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2001-1"><a href="data-table.html#cb2001-1" aria-hidden="true" tabindex="-1"></a>linelist[days_onset_hosp <span class="sc">&gt;</span> <span class="dv">7</span>, .N, .(<span class="at">month =</span> <span class="fu">month</span>(date_hospitalisation), hospital)]</span></code></pre></div>
<pre><code>##     month                             hospital  N
##  1:     5                    Military Hospital  3
##  2:     6                        Port Hospital  4
##  3:     7                        Port Hospital  8
##  4:     8 St. Mark&#39;s Maternity Hospital (SMMH)  5
##  5:     8                    Military Hospital  9
##  6:     8                                Other 10
##  7:     8                        Port Hospital 10
##  8:     9                        Port Hospital 28
##  9:     9                              Missing 27
## 10:     9                     Central Hospital 10
## 11:     9 St. Mark&#39;s Maternity Hospital (SMMH)  6
## 12:    10                              Missing  2
## 13:    10                    Military Hospital  3
## 14:     3                        Port Hospital  1
## 15:     4                    Military Hospital  1
## 16:     5                                Other  2
## 17:     5                     Central Hospital  1
## 18:     5                              Missing  1
## 19:     6                              Missing  7
## 20:     6 St. Mark&#39;s Maternity Hospital (SMMH)  2
## 21:     6                    Military Hospital  1
## 22:     7                    Military Hospital  3
## 23:     7                                Other  1
## 24:     7                              Missing  2
## 25:     7 St. Mark&#39;s Maternity Hospital (SMMH)  1
## 26:     8                     Central Hospital  2
## 27:     8                              Missing  6
## 28:     9                                Other  9
## 29:     9                    Military Hospital 11
## 30:    10                        Port Hospital  3
## 31:    10                                Other  4
## 32:    10 St. Mark&#39;s Maternity Hospital (SMMH)  1
## 33:    10                     Central Hospital  1
## 34:    11                              Missing  2
## 35:    11                        Port Hospital  1
## 36:    12                        Port Hospital  1
##     month                             hospital  N</code></pre>
<p>Data.table also allows the chaining expressions as follows:</p>
<div class="sourceCode" id="cb2003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2003-1"><a href="data-table.html#cb2003-1" aria-hidden="true" tabindex="-1"></a>linelist[, .N, .(hospital)][<span class="fu">order</span>(<span class="sc">-</span>N)][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="co">#1st selects all cases by hospital, 2nd orders the cases in descending order, 3rd subsets the 3 hospitals with the largest caseload</span></span></code></pre></div>
<pre><code>##             hospital    N
## 1:     Port Hospital 1762
## 2:           Missing 1469
## 3: Military Hospital  896</code></pre>
<p>In these examples we are following the assumption that a row in the data table is equal to a new case, and so we can use the <strong>.N</strong> to represent the number of rows in the data table. Another useful function to represent the number of unique cases is <code>uniqueN()</code>, which returns the number of unique values in a given input. This is illustrated here:</p>
<div class="sourceCode" id="cb2005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2005-1"><a href="data-table.html#cb2005-1" aria-hidden="true" tabindex="-1"></a>linelist[, .(<span class="fu">uniqueN</span>(gender))] <span class="co">#remember .() in the j argument returns a data table</span></span></code></pre></div>
<pre><code>##    V1
## 1:  3</code></pre>
<p>The answer is 3, as the unique values in the gender column are m, f and N/A. Compare with the base R function <code>unique()</code>, which returns all the unique values in a given input:</p>
<div class="sourceCode" id="cb2007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2007-1"><a href="data-table.html#cb2007-1" aria-hidden="true" tabindex="-1"></a>linelist[, .(<span class="fu">unique</span>(gender))]</span></code></pre></div>
<pre><code>##      V1
## 1:    m
## 2:    f
## 3: &lt;NA&gt;</code></pre>
<p>To find the number of unique cases in a given month we would write the following:</p>
<div class="sourceCode" id="cb2009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2009-1"><a href="data-table.html#cb2009-1" aria-hidden="true" tabindex="-1"></a>linelist[, .(<span class="fu">uniqueN</span>(case_id)), .(<span class="at">month =</span> <span class="fu">month</span>(date_hospitalisation))]</span></code></pre></div>
<pre><code>##     month   V1
##  1:     5   62
##  2:     6  100
##  3:     7  198
##  4:     8  509
##  5:     9 1170
##  6:    10 1228
##  7:    11  813
##  8:    12  576
##  9:     1  434
## 10:     2  310
## 11:     3  290
## 12:     4  198</code></pre>
</div>
<div id="adding-and-updating-to-data-tables" class="section level2" number="50.6">
<h2><span class="header-section-number">50.6</span> Adding and updating to data tables</h2>
<p>The <code>:=</code> operator is used to add or update data in a data table. Adding columns to your data table can be done in the following ways:</p>
<div class="sourceCode" id="cb2011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2011-1"><a href="data-table.html#cb2011-1" aria-hidden="true" tabindex="-1"></a>linelist[, adult <span class="sc">:</span><span class="er">=</span> age <span class="sc">&gt;=</span> <span class="dv">18</span>] <span class="co">#adds one column</span></span>
<span id="cb2011-2"><a href="data-table.html#cb2011-2" aria-hidden="true" tabindex="-1"></a>linelist[, <span class="fu">c</span>(<span class="st">&quot;child&quot;</span>, <span class="st">&quot;wt_lbs&quot;</span>) <span class="sc">:</span><span class="er">=</span> .(age <span class="sc">&lt;</span> <span class="dv">18</span>, wt_kg<span class="sc">*</span><span class="fl">2.204</span>)] <span class="co">#to add multiple columns requires c(&quot;&quot;) and list() or .() syntax</span></span>
<span id="cb2011-3"><a href="data-table.html#cb2011-3" aria-hidden="true" tabindex="-1"></a>linelist[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span> (<span class="at">bmi_in_range =</span> (bmi <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;</span> <span class="dv">40</span>),</span>
<span id="cb2011-4"><a href="data-table.html#cb2011-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">no_infector_source_data =</span> <span class="fu">is.na</span>(infector) <span class="sc">|</span> <span class="fu">is.na</span>(source))] <span class="co">#this method uses := as a functional operator `:=`</span></span>
<span id="cb2011-5"><a href="data-table.html#cb2011-5" aria-hidden="true" tabindex="-1"></a>linelist[, adult <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>] <span class="co">#deletes the column</span></span></code></pre></div>
<p>Further complex aggregations are beyond the scope of this introductory chapter, but the idea is to provide a popular and viable alternative to <strong>dplyr</strong> for grouping and cleaning data. The <strong>data.table</strong> package is a great package that allows for neat and readable code.</p>
</div>
<div id="resources-41" class="section level2" number="50.7">
<h2><span class="header-section-number">50.7</span> Resources</h2>
<p>Here are some useful resources for more information:
* <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a>
* <a href="https://github.com/Rdatatable/data.table" class="uri">https://github.com/Rdatatable/data.table</a>
* <a href="https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf" class="uri">https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf</a>
* <a href="https://www.machinelearningplus.com/data-manipulation/datatable-in-r-complete-guide/" class="uri">https://www.machinelearningplus.com/data-manipulation/datatable-in-r-complete-guide/</a>
* <a href="https://www.datacamp.com/community/tutorials/data-table-r-tutorial" class="uri">https://www.datacamp.com/community/tutorials/data-table-r-tutorial</a></p>
<p>You can perform any summary function on grouped data; see the Cheat Sheet here for more info:
<a href="https://s3.amazonaws.com/assets.datacamp.com/blog_assets/datatable_Cheat_Sheet_R.pdf" class="uri">https://s3.amazonaws.com/assets.datacamp.com/blog_assets/datatable_Cheat_Sheet_R.pdf</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-08-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
