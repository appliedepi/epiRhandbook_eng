<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Справочник эпидемиолога R - 8&nbsp; Вычистка данных и ключевые функции</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../new_pages/dates.ru.html" rel="next">
<link href="../new_pages/importing.ru.html" rel="prev">
<link href="../images/Applied_Epi_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти",
    "search-label": "Поиск"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QXDW878QLX', { 'anonymize_ip': true});
</script>
<!-- Global site tag (gtag.js) - Google Analytics 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QXDW878QLX');
</script> -->

</head><body class="nav-sidebar floating"><div class="alert alert-info alert-dismissible">
  <!-- <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Need help learning R?</strong> Enroll in Applied Epi's <a href="https://www.appliedepi.org/live/"
    class="alert-link">intro R course</a>, try our <a href="https://www.appliedepi.org/tutorial/"
    class="alert-link">free R tutorials</a>, post in our <a href="https://community.appliedepi.org/"
    class="alert-link">Community Q&A forum</a>, or ask about our <a href="mailto:contact@appliedepi.org"
    class="alert-link">R Help Desk service</a>. -->
</div>

<script>

  // Function to extract the last two characters from the URL path to determine the language, adjusting for .html extension
  function getLanguageFromURL() {
    let path = window.location.pathname;
    
    // Check if the URL ends with .html and remove it
    if (path.endsWith('.html')) {
      path = path.substring(0, path.length - 5);
    }

    // Extract the last two characters for the language code
    const lang = path.substr(-2);
    return lang;
  }

  const language = getLanguageFromURL();
  const supportedLanguages = ['fr', 'es', 'vn', 'jp', 'pt', 'tr', 'ru'];
  const defaultLanguage = 'en';
  const isSupportedLanguage = supportedLanguages.includes(language);

  // Translations for the content
  const translations = {
    en: '<strong>Need help learning R?</strong> Enroll in Applied Epi\'s <a href="https://www.appliedepi.org/live/" class="alert-link">intro R course</a>, try our <a href="https://www.appliedepi.org/tutorial/" class="alert-link">free R tutorials</a>, post in our <a href="https://community.appliedepi.org/" class="alert-link">Community Q&A forum</a>, or ask about our <a href="mailto:contact@appliedepi.org" class="alert-link">R Help Desk service</a>.',
    fr: '<strong>Besoin d\'aide pour apprendre R ?</strong> Inscrivez-vous au <a href="https://www.appliedepi.org/live/" class="alert-link">cours d\'introduction à R</a> d\'Applied Epi, essayez nos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriels R gratuits</a>, postez dans notre forum de <a href="https://community.appliedepi.org/" class="alert-link">questions-réponses communautaires</a>, ou demandez-nous des informations sur <a href="mailto:contact@appliedepi.org" class="alert-link"> notre service d\'assistance R</a>.',
    es: '<strong>¿Necesitas ayuda para aprender R?</strong> Inscríbete en el <a href="https://www.appliedepi.org/live/" class="alert-link">Curso de introducción a R</a> de Applied Epi, prueba nuestros <a href="https://www.appliedepi.org/tutorial/" class="alert-link">Tutoriales gratuitos de R</a>, escribe en nuestro <a href="https://community.appliedepi.org/" class="alert-link">Foro de preguntas y respuestas,</a> o pregunta por nuestra <a href="mailto:contact@appliedepi.org" class="alert-link">Asistencia técnica para R</a>.',
    vn: '<strong>Bạn cần giúp đỡ trong việc học R?</strong> Hãy đăng ký khóa học R cơ bản của Applied Epi tại <a href="https://www.appliedepi.org/live/" class="alert-link">đây</a>, hoặc thử các <a href="https://www.appliedepi.org/tutorial/" class="alert-link">hướng dẫn R miễn phí</a>, đăng bài trong <a href="https://community.appliedepi.org/" class="alert-link">diễn đàn cộng đồng</a>, hoặc gửi câu hỏi tới <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ Trợ giúp R</a> của chúng tôi.',
    jp: '<strong>Rの学習について助けが必要ですか？</strong>Applied Epiの<a href="https://www.appliedepi.org/live/" class="alert-link">R入門コース</a>に登録するか、<a href="https://www.appliedepi.org/tutorial/" class="alert-link">無料Rチュートリアル</a>を試すか、<a href="https://community.appliedepi.org/" class="alert-link">コミュニティQ＆Aフォーラム</a>に投稿するか、<a href="mailto:contact@appliedepi.org" class="alert-link">Rヘルプデスクサービス</a>についてお問い合わせください。',
    pt: '<strong>Você precisa de ajuda para aprender R??</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R da Applied Epi</a>, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.',
    tr: '<strong>R öğrenmekte yardıma mı ihtiyacınız var?</strong> Applied Epi\'\nin <a href="https://www.appliedepi.org/live/" class="alert-link">R\'ye giriş kursuna</a> kaydolun, <a href="https://www.appliedepi.org/tutorial/" class="alert-link">ücretsiz R derslerimizi</a> deneyin, <a href="https://community.appliedepi.org/" class="alert-link">Topluluk Q&A forumunda</a> soru paylaşın, ya da <a href="mailto:contact@appliedepi.org" class="alert-link">R Yardım Masası hizmetimiz</a> hakkında sorun.',
    ru: '<strong>Нужна помощь в изучении R?</strong> Запишитесь на <a href="https://www.appliedepi.org/live/" class="alert-link">вводный курс по R</a> от Applied Epi, попробуйте наши <a href="https://www.appliedepi.org/tutorial/" class="alert-link">бесплатные учебные материалы по R</a>, задайте вопрос в нашем <a href="https://community.appliedepi.org/" class="alert-link">форуме вопросов и ответов сообщества</a>, или спросите о нашей услуге <a href="mailto:contact@appliedepi.org" class="alert-link">Службы поддержки по R</a>.'
  };

  // Default to English if the detected language is not supported
  const contentToDisplay = translations[isSupportedLanguage ? language : defaultLanguage];


  // Select the element where the content should be displayed
  const alertElement = document.querySelector('.alert');
  if (alertElement) {
    alertElement.innerHTML = contentToDisplay;
    alertElement.style.display = 'block'; // Make sure to display the element
  }

</script>
<link href="../site_libs/htmltools-fill-0.5.8/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.31/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="../site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="../site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="../site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="../site_libs/selectize-0.12.0/selectize.min.js"></script>






<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../new_pages/cleaning.ru.html">Управление данными</a></li><li class="breadcrumb-item"><a href="../new_pages/cleaning.ru.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Вычистка данных и ключевые функции</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/Applied_Epi_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Справочник эпидемиолога R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://twitter.com/appliedepi" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/company/appliedepi/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://github.com/appliedepi/epihandbook_quarto" title="Исходный код" class="quarto-navigation-tool px-1" aria-label="Исходный код"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Переключить темный режим"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Поиск"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Добро пожаловать</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Об этой книге</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/editorial_style.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Редакционные и технические замечания</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/data_used.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Скачивание руководства и данных</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Основы</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/basics.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Основы R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/transition_to_R.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Переход к R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/packages_suggested.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Рекомендованные пакеты</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/r_projects.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Проекты R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/importing.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Импорт и экспорт</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Управление данными</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/cleaning.ru.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Вычистка данных и ключевые функции</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/dates.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Работа с датами</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/characters_strings.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Текст и последовательности</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/factors.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Факторы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/pivoting.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Поворот данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/grouping.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Группирование данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/joining_matching.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Соединение данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/deduplication.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Дедупликация</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/iteration.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Итерации, циклы и списки</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Анализ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/tables_descriptive.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Описательные таблицы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/stat_tests.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Простые статистические тесты</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/regression.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Однофакторная и многофакторная регрессия</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/missing_data.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Отсутствующие данные</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/standardization.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Стандартизированные коэффициенты</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/moving_average.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Скользящие средние значения</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/time_series.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Временные ряды и обнаружение вспышек</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/epidemic_models.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Моделирование эпидемий</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/contact_tracing.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Отслеживание контактов</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/survey_analysis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Анализ опросов</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/survival_analysis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Анализ выживаемости</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/gis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Основы ГИС</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Визуализация данных</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/tables_presentation.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Таблицы для презентации</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/ggplot_basics.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Основы ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/ggplot_tips.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Советы по использованию ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/epicurves.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Эпидемические кривые</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/age_pyramid.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Демографические пирамиды и шкалы Лайкерта</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/heatmaps.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Тепловые диаграммы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/diagrams.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Диаграммы и схемы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/combination_analysis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Анализ комбинаций</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/transmission_chains.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Цепочки передачи</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/phylogenetic_trees.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Филогенетические деревья</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/interactive_plots.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Интерактивные графики</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Отчеты и информационные панели</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/rmarkdown.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Отчеты с помощью R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/reportfactory.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Структурирование рутинных отчетов</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/flexdashboard.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Информационные панели с R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/shiny_basics.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Информационные панели с Shiny</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Разное</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/writing_functions.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Написание функций</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/directories.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Взаимодействие директорий</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/collaboration.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Контроль версий и совместная работа с помощью Git и Github</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/errors.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Частые ошибки</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/help.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Получение помощи</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/network_drives.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">R на сетевых дисках</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/data_table.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Таблица данных</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#ключевые-функции" id="toc-ключевые-функции" class="nav-link active" data-scroll-target="#ключевые-функции">Ключевые функции</a></li>
  <li><a href="#номенклатура" id="toc-номенклатура" class="nav-link" data-scroll-target="#номенклатура">Номенклатура</a></li>
  <li><a href="#канал-вычистки" id="toc-канал-вычистки" class="nav-link" data-scroll-target="#канал-вычистки"><span class="header-section-number">8.1</span> Канал вычистки</a></li>
  <li><a href="#загрузка-пакетов" id="toc-загрузка-пакетов" class="nav-link" data-scroll-target="#загрузка-пакетов"><span class="header-section-number">8.2</span> Загрузка пакетов</a></li>
  <li><a href="#импорт-данных" id="toc-импорт-данных" class="nav-link" data-scroll-target="#импорт-данных"><span class="header-section-number">8.3</span> Импорт данных</a>
  <ul class="collapse">
  <li><a href="#импорт" id="toc-импорт" class="nav-link" data-scroll-target="#импорт">Импорт</a></li>
  <li><a href="#обзор" id="toc-обзор" class="nav-link" data-scroll-target="#обзор">Обзор</a></li>
  </ul></li>
  <li><a href="#имена-столбцов" id="toc-имена-столбцов" class="nav-link" data-scroll-target="#имена-столбцов"><span class="header-section-number">8.4</span> Имена столбцов</a>
  <ul class="collapse">
  <li><a href="#автоматическая-вычистка" id="toc-автоматическая-вычистка" class="nav-link" data-scroll-target="#автоматическая-вычистка">Автоматическая вычистка</a></li>
  <li><a href="#вычистка-имен-вручную" id="toc-вычистка-имен-вручную" class="nav-link" data-scroll-target="#вычистка-имен-вручную">Вычистка имен вручную</a></li>
  <li><a href="#прочие-сложности" id="toc-прочие-сложности" class="nav-link" data-scroll-target="#прочие-сложности">Прочие сложности</a></li>
  </ul></li>
  <li><a href="#выбор-или-смена-порядка-столбцов" id="toc-выбор-или-смена-порядка-столбцов" class="nav-link" data-scroll-target="#выбор-или-смена-порядка-столбцов"><span class="header-section-number">8.5</span> Выбор или смена порядка столбцов</a>
  <ul class="collapse">
  <li><a href="#сохранение-столбцов" id="toc-сохранение-столбцов" class="nav-link" data-scroll-target="#сохранение-столбцов">Сохранение столбцов</a></li>
  <li><a href="#clean_tidyselect" id="toc-clean_tidyselect" class="nav-link" data-scroll-target="#clean_tidyselect">Функции-помощники “tidyselect”</a></li>
  <li><a href="#удаление-столбцов" id="toc-удаление-столбцов" class="nav-link" data-scroll-target="#удаление-столбцов">Удаление столбцов</a></li>
  <li><a href="#отдельная-команда" id="toc-отдельная-команда" class="nav-link" data-scroll-target="#отдельная-команда">Отдельная команда</a></li>
  </ul></li>
  <li><a href="#дедупликация" id="toc-дедупликация" class="nav-link" data-scroll-target="#дедупликация"><span class="header-section-number">8.6</span> Дедупликация</a></li>
  <li><a href="#создание-и-преобразование-столбцов" id="toc-создание-и-преобразование-столбцов" class="nav-link" data-scroll-target="#создание-и-преобразование-столбцов"><span class="header-section-number">8.7</span> Создание и преобразование столбцов</a>
  <ul class="collapse">
  <li><a href="#новые-столбцы" id="toc-новые-столбцы" class="nav-link" data-scroll-target="#новые-столбцы">Новые столбцы</a></li>
  <li><a href="#конвертация-класса-столбцов" id="toc-конвертация-класса-столбцов" class="nav-link" data-scroll-target="#конвертация-класса-столбцов">Конвертация класса столбцов</a></li>
  <li><a href="#сгруппированные-данные" id="toc-сгруппированные-данные" class="nav-link" data-scroll-target="#сгруппированные-данные">Сгруппированные данные</a></li>
  <li><a href="#clean_across" id="toc-clean_across" class="nav-link" data-scroll-target="#clean_across">Трансформация нескольких столбцов</a></li>
  <li><a href="#coalesce" id="toc-coalesce" class="nav-link" data-scroll-target="#coalesce"><code>coalesce()</code></a></li>
  <li><a href="#кумулятивная-математика" id="toc-кумулятивная-математика" class="nav-link" data-scroll-target="#кумулятивная-математика">Кумулятивная математика</a></li>
  <li><a href="#использование-базового-r" id="toc-использование-базового-r" class="nav-link" data-scroll-target="#использование-базового-r">Использование <strong>базового</strong> R</a></li>
  <li><a href="#добавление-к-цепочке-канала" id="toc-добавление-к-цепочке-канала" class="nav-link" data-scroll-target="#добавление-к-цепочке-канала">Добавление к цепочке канала</a></li>
  </ul></li>
  <li><a href="#перекодирование-значений" id="toc-перекодирование-значений" class="nav-link" data-scroll-target="#перекодирование-значений"><span class="header-section-number">8.8</span> Перекодирование значений</a>
  <ul class="collapse">
  <li><a href="#конкретные-значения" id="toc-конкретные-значения" class="nav-link" data-scroll-target="#конкретные-значения">Конкретные значения</a></li>
  <li><a href="#по-логике" id="toc-по-логике" class="nav-link" data-scroll-target="#по-логике">По логике</a></li>
  <li><a href="#простая-логика" id="toc-простая-логика" class="nav-link" data-scroll-target="#простая-логика">Простая логика</a></li>
  <li><a href="#clean_case_when" id="toc-clean_case_when" class="nav-link" data-scroll-target="#clean_case_when">Сложная логика</a></li>
  <li><a href="#отсутствующие-значения" id="toc-отсутствующие-значения" class="nav-link" data-scroll-target="#отсутствующие-значения">Отсутствующие значения</a></li>
  <li><a href="#словарь-вычистки" id="toc-словарь-вычистки" class="nav-link" data-scroll-target="#словарь-вычистки">Словарь вычистки</a></li>
  </ul></li>
  <li><a href="#num_cats" id="toc-num_cats" class="nav-link" data-scroll-target="#num_cats"><span class="header-section-number">8.9</span> Числовые категории</a>
  <ul class="collapse">
  <li><a href="#обзор-распределения" id="toc-обзор-распределения" class="nav-link" data-scroll-target="#обзор-распределения">Обзор распределения</a></li>
  <li><a href="#age_categories" id="toc-age_categories" class="nav-link" data-scroll-target="#age_categories"><code>age_categories()</code></a></li>
  <li><a href="#cut" id="toc-cut" class="nav-link" data-scroll-target="#cut"><code>cut()</code></a></li>
  <li><a href="#разрывы-по-квантилям" id="toc-разрывы-по-квантилям" class="nav-link" data-scroll-target="#разрывы-по-квантилям">Разрывы по квантилям</a></li>
  <li><a href="#группы-равного-размера" id="toc-группы-равного-размера" class="nav-link" data-scroll-target="#группы-равного-размера">Группы равного размера</a></li>
  <li><a href="#case_when" id="toc-case_when" class="nav-link" data-scroll-target="#case_when"><code>case_when()</code></a></li>
  <li><a href="#добавление-в-цепочку-канала-2" id="toc-добавление-в-цепочку-канала-2" class="nav-link" data-scroll-target="#добавление-в-цепочку-канала-2">Добавление в цепочку канала</a></li>
  </ul></li>
  <li><a href="#добавление-строк" id="toc-добавление-строк" class="nav-link" data-scroll-target="#добавление-строк"><span class="header-section-number">8.10</span> Добавление строк</a>
  <ul class="collapse">
  <li><a href="#по-одной" id="toc-по-одной" class="nav-link" data-scroll-target="#по-одной">По одной</a></li>
  <li><a href="#связывание-строк" id="toc-связывание-строк" class="nav-link" data-scroll-target="#связывание-строк">Связывание строк</a></li>
  </ul></li>
  <li><a href="#фильтрация-строк" id="toc-фильтрация-строк" class="nav-link" data-scroll-target="#фильтрация-строк"><span class="header-section-number">8.11</span> Фильтрация строк</a>
  <ul class="collapse">
  <li><a href="#простой-фильтр" id="toc-простой-фильтр" class="nav-link" data-scroll-target="#простой-фильтр">Простой фильтр</a></li>
  <li><a href="#отфильтровывание-отсутствующих-значений" id="toc-отфильтровывание-отсутствующих-значений" class="nav-link" data-scroll-target="#отфильтровывание-отсутствующих-значений">Отфильтровывание отсутствующих значений</a></li>
  <li><a href="#фильтр-по-номеру-строки" id="toc-фильтр-по-номеру-строки" class="nav-link" data-scroll-target="#фильтр-по-номеру-строки">Фильтр по номеру строки</a></li>
  <li><a href="#сложный-фильтр" id="toc-сложный-фильтр" class="nav-link" data-scroll-target="#сложный-фильтр">Сложный фильтр</a></li>
  <li><a href="#отдельная-команда-1" id="toc-отдельная-команда-1" class="nav-link" data-scroll-target="#отдельная-команда-1">Отдельная команда</a></li>
  <li><a href="#быстрое-рассмотрение-записей" id="toc-быстрое-рассмотрение-записей" class="nav-link" data-scroll-target="#быстрое-рассмотрение-записей">Быстрое рассмотрение записей</a></li>
  </ul></li>
  <li><a href="#построчные-расчеты" id="toc-построчные-расчеты" class="nav-link" data-scroll-target="#построчные-расчеты"><span class="header-section-number">8.12</span> Построчные расчеты</a></li>
  <li><a href="#упорядочивание-и-сортировка" id="toc-упорядочивание-и-сортировка" class="nav-link" data-scroll-target="#упорядочивание-и-сортировка"><span class="header-section-number">8.13</span> Упорядочивание и сортировка</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../new_pages/cleaning.ru.html">Управление данными</a></li><li class="breadcrumb-item"><a href="../new_pages/cleaning.ru.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Вычистка данных и ключевые функции</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Вычистка данных и ключевые функции</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/data_cleaning.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="../images/data_cleaning.png" class="quarto-figure quarto-figure-center figure-img" style="height:10.0%" width="503"></a></p>
</figure>
</div>
</div>
</div>
<p>На данной странице представлены общие шаги процесса “вычистки” набора данных, а также объяснены многие важные функции управления данными в R.</p>
<p>Чтобы продемонстрировать вычистку данных, для начала мы импортируем сырой набор данных с построчным списком, а затем пошагово разберем процесс вычистки. В коде R это будет выражено в “цепочке канала”, которая использует “оператор канала” <code>%&gt;%</code>, который передает набор данных из одной операции в другую.</p>
<section id="ключевые-функции" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ключевые-функции">Ключевые функции</h3>
<p>Это руководство подчеркивает использование функций из семьи пакетов R <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>. Основные функции R, представленные на данной странице, перечислены ниже.</p>
<p>Многие из этих функций относятся к пакету R <a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a>, который предоставляет “глагольные” функции для решения проблем манипуляций с данными (название является отсылкой на “датафрейм-<a href="https://www.thefreedictionary.com/plier#:~:text=also%20ply%C2%B7er%20(pl%C4%AB%E2%80%B2,holding%2C%20bending%2C%20or%20cutting.)%22">Plier - щипцы</a>. <strong>dplyr</strong> является частью семьи пакетов R <strong>tidyverse</strong> (она также включает в себя <strong>ggplot2</strong>, <strong>tidyr</strong>, <strong>stringr</strong>, <strong>tibble</strong>, <strong>purrr</strong>, <strong>magrittr</strong>, <strong>forcats</strong> и другие).</p>
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 46%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th>Использование</th>
<th>Пакет</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>%&gt;%</code></td>
<td>“оператор канала” (передает) данные из одной функции в другую</td>
<td><strong>magrittr</strong></td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td>создает, трансформирует и переопределяет столбцы</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>select()</code></td>
<td>сохраняет, удаляет, выбирает или переименовывает столбцы</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>rename()</code></td>
<td>переименовывает столбцы</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>clean_names()</code></td>
<td>стандартизирует синтаксис названия столбцов</td>
<td><strong>janitor</strong></td>
</tr>
<tr class="even">
<td><code>as.character()</code>, <code>as.numeric()</code>, <code>as.Date()</code>, и т.п.</td>
<td>конвертирует класс столбца</td>
<td><strong>базовый</strong> R</td>
</tr>
<tr class="odd">
<td><code>across()</code></td>
<td>трансформирует несколько столбцов одновременно</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><strong>tidyselect</strong> функции</td>
<td>используют логику для выбора столбцов</td>
<td><strong>tidyselect</strong></td>
</tr>
<tr class="odd">
<td><code>filter()</code></td>
<td>сохраняет определенные строки</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>distinct()</code></td>
<td>дедупликация строк</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>rowwise()</code></td>
<td>операции по строкам/внутри строки</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>add_row()</code></td>
<td>добавление строк вручную</td>
<td><strong>tibble</strong></td>
</tr>
<tr class="odd">
<td><code>arrange()</code></td>
<td>сортировка строк</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>recode()</code></td>
<td>перекодировка зеачений в столбце</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>case_when()</code></td>
<td>перекодирует значения в столбце, используя более сложные логические критерии</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>replace_na()</code>, <code>na_if()</code>, <code>coalesce()</code></td>
<td>специальные функции для перекодирования</td>
<td><strong>tidyr</strong></td>
</tr>
<tr class="odd">
<td><code>age_categories()</code> и <code>cut()</code></td>
<td>создает категорийные группы из числового столбца</td>
<td><strong>epikit</strong> и <strong>базовый</strong> R</td>
</tr>
<tr class="even">
<td><code>match_df()</code></td>
<td>перекодирует/вычищает значения, используя словарь данных</td>
<td><strong>matchmaker</strong></td>
</tr>
<tr class="odd">
<td><code>which()</code></td>
<td>применяет логические критерии; выдает индексы</td>
<td><strong>базовый</strong> R</td>
</tr>
</tbody>
</table>
<p>Если вы хотите увидеть сравнение этих функций с командами в Stata или SAS, см. страницу [Переход к R]((transition_to_R.ru.qmd).</p>
<p>Вы можете столкнуться с альтернативной системой управления данными из пакета R <strong>data.table</strong> с такими операторами, как <code>:=</code> и частым использованием квадратных скобок <code>[ ]</code>. Такой подход и синтаксис кратко объясняются на странице <a href="../new_pages/data_table.ru.html">Таблицы данных</a>.</p>
</section>
<section id="номенклатура" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="номенклатура">Номенклатура</h3>
<p>В данном руководстве мы, как правило, используем понятия “столбцы” и “строки” вместо “переменных” и “наблюдений”. Как объясняется в данном пособии по <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">“аккуратным данным”</a>, большинство эпидемиологических статистических наборов данных структурно состоят из строк, столбцов и значений.</p>
<p><em>Переменные</em> содержат значения, которые измеряют одинаковую базовую характеристику (например, возрастную группу, исход или дату появления симптомов). <em>Наблюдения</em> содержат все значения, измеренные по той же единице (например, по человеку, месту или лабораторному образцу). Так что эти аспекты может быть сложно определить очень конкретно.</p>
<p>В “аккуратных” наборах данных каждый столбец представляет переменную, каждая строка - наблюдения, а каждая ячейка - одно значение. Однако в некоторых наборах данных, с которыми вы столкнетесь, эта схема не будет соблюдена. Например, в “широком/горизонтальном” наборе данных переменная может быть разделена на несколько столбцов (см. пример на странице <a href="../new_pages/pivoting.ru.html">Поворот данных</a>). Аналогично, наблюдения могут быть разделены на несколько строк.</p>
<p>Большая часть этого руководства посвящена управлению и преобразованию данных, поэтому ссылка на более конкретные структура строк и столбцов более актуальна, чем на более абстрактные понятия, такие как наблюдения и переменные. Есть исключения на страницах, посвященных анализу данных, где вы будете чаще встречать такие понятия, как переменные и наблюдения.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
<section id="канал-вычистки" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="канал-вычистки"><span class="header-section-number">8.1</span> Канал вычистки</h2>
<p><strong>На этой странице представлены типичные шаги по вычистке данных, и они последовательно добавляются в канал вычистки.</strong></p>
<p>В эпидемиологическом анализе и обработке данных шаги по вычистке часто проводятся последовательно и связываются вместе. В R это часто выглядит как “цепочка канала”, где <em>сырой набор данных передается или “ставится в канал” из одного шага вычистки в другой</em>.</p>
<p>Такие цепочки используют “глагольные функции” <strong>dplyr</strong> и оператор канала из <strong>magrittr</strong> <code>%&gt;%</code>. Этот канал начинается с “сырых” данных (“linelist_raw.xlsx”) и оканчивается “чистым” датафреймом в R (<code>linelist</code>), который можно использовать, сохранять, экспортировать и т.п.</p>
<p>В цепочке канала вычистки очень важен порядок шагов. Шаги по вычистке могут включать:</p>
<ul>
<li>Импорт данных<br>
</li>
<li>Вычистка или изменение названия столбцов<br>
</li>
<li>Дедупликация<br>
</li>
<li>Создание столбцов и трансформация (например, перекодирование или стандартизация значений)<br>
</li>
<li>Фильтрация или добавления строк</li>
</ul>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
<section id="загрузка-пакетов" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="загрузка-пакетов"><span class="header-section-number">8.2</span> Загрузка пакетов</h2>
<p>Данный фрагмент кода показывает загрузку пакетов, требуемых для анализа. В данном руководстве мы полагаемся на <code>p_load()</code> из <strong>pacman</strong>, который устанавливает пакеты, если необходимо, <em>и</em> загружает их для использования. Вы также можете загружать установленные пакеты с помощью <code>library()</code> из <strong>базового</strong> R. См. страницу <a href="../new_pages/basics.ru.html">Основы R</a> для получения более подробной информации о пакетах R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  rio,        <span class="co"># импорт данных  </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  here,       <span class="co"># относительные пути к файлу  </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  janitor,    <span class="co"># вычистка данных и таблицы</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  lubridate,  <span class="co"># работа с датами</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  matchmaker, <span class="co"># вычистка на основе словаря</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  epikit,     <span class="co"># функция age_categories() (возрастные категории)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  tidyverse   <span class="co"># управление данными и визуализация</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
<section id="импорт-данных" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="импорт-данных"><span class="header-section-number">8.3</span> Импорт данных</h2>
<section id="импорт" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="импорт">Импорт</h3>
<p>Здесь мы импортируем “сырой” Excel файл с построчным списком, используя функцию <code>import()</code> из пакета <strong>rio</strong>. Пакет <strong>rio</strong> гибко работает с многими типами файлов (например, .xlsx, .csv, .tsv, .rds. См. страницу <a href="../new_pages/importing.ru.html">Импорт и экспорт</a> для получения более подробной информации и советов по необычным ситуациям (например, пропуск строк, установка отсутствующих значений, импорт Google таблиц и т.п.).</p>
<p>Если вы хотите параллельно повторять эти действия, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_raw.xlsx" class="download-button">кликните для скачивания “сырого” построчного списка</a> (as .xlsx file).</p>
<p>Если ваш набор данных большой и требует много времени для импортирования, может быть полезно сделать импорт командой, отдельной от цепочки канала и сохранить “сырой” набор данных как отдельный файл. Это позволит легко проводить сопоставление между оригиналом и вычищенными версиями.</p>
<p>Ниже мы импортируем сырой Excel файл и сохраняем его как датафрейм <code>linelist_raw</code>. Мы предполагаем, что файл расположен в вашей рабочей директории или корневой папке проекта R, поэтому в пути к файлу не уточняются подпапки.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>linelist_raw <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"linelist_raw.xlsx"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вы можете видеть первые 50 строк датафрейма ниже. Примечание: <strong>базовая</strong> функция R <code>head(n)</code> позволяет вам просматривать только первое <code>n</code> количество строк в консоли R.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4408b766dec943c1535c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4408b766dec943c1535c">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08T00:00:00Z",null,null,"2014-05-04T00:00:00Z","2014-05-18T00:00:00Z","2014-05-03T00:00:00Z","2014-05-22T00:00:00Z","2014-05-28T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-06-09T00:00:00Z",null,null,null,"2014-06-23T00:00:00Z","2014-06-18T00:00:00Z","2014-06-24T00:00:00Z",null,null,"2014-07-03T00:00:00Z",null,"2014-07-10T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-18T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-12T00:00:00Z","2014-07-12T00:00:00Z","2014-06-13T00:00:00Z","2014-07-15T00:00:00Z","2014-06-20T00:00:00Z",null,null,"2014-07-20T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-18T00:00:00Z","2014-07-18T00:00:00Z","2014-07-27T00:00:00Z",null,"2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],[null,"2014-05-18T00:00:00Z","2014-05-30T00:00:00Z",null,"2014-05-29T00:00:00Z","2014-05-24T00:00:00Z","2014-06-01T00:00:00Z","2014-06-07T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-07-09T00:00:00Z",null,"2014-06-30T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-25T00:00:00Z","2014-07-06T00:00:00Z","2014-07-02T00:00:00Z","2014-07-09T00:00:00Z","2014-07-07T00:00:00Z","2014-07-20T00:00:00Z",null,"2014-07-22T00:00:00Z","2014-07-16T00:00:00Z","2014-07-14T00:00:00Z","2014-07-20T00:00:00Z","2014-07-16T00:00:00Z","2014-07-19T00:00:00Z","2014-07-27T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-08-14T00:00:00Z","2014-08-01T00:00:00Z","2014-07-23T00:00:00Z","2014-08-28T00:00:00Z","2014-07-28T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-08-03T00:00:00Z",null,null,null,"2014-08-06T00:00:00Z","2014-08-21T00:00:00Z","2014-09-13T00:00:00Z","2014-08-04T00:00:00Z",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],["2","3","56","18","3","16","16","0","61","27","12","42","19","7","7","13","35","17","11","11","19","54","14","28","6","3","31","6","67","14","10","21","20","45","1","12","3","15","20","36","7","13","14","3","10","1","0","20","26","14"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,18,24]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"infection date","targets":2},{"name":"date onset","targets":3},{"name":"hosp date","targets":4},{"name":"date_of_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"hospital","targets":8},{"name":"lon","targets":9},{"name":"lat","targets":10},{"name":"infector","targets":11},{"name":"source","targets":12},{"name":"age","targets":13},{"name":"age_unit","targets":14},{"name":"row_num","targets":15},{"name":"wt_kg","targets":16},{"name":"ht_cm","targets":17},{"name":"ct_blood","targets":18},{"name":"fever","targets":19},{"name":"chills","targets":20},{"name":"cough","targets":21},{"name":"aches","targets":22},{"name":"vomit","targets":23},{"name":"temp","targets":24},{"name":"time_admission","targets":25},{"name":"merged_header","targets":26},{"name":"...28","targets":27}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="обзор" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="обзор">Обзор</h3>
<p>Вы можете использовать функцию <code>skim()</code> из пакета <strong>skimr</strong>, чтобы сделать обзор всего датафрейма (см. страницу <a href="../new_pages/tables_descriptive.ru.html">Описательные таблицы</a> для получения более детальной информации). Столбцы резюмируются по классу/типу, например, текстовые, числовые. Примечание: “POSIXct” - это тип класса сырых данных (см. <a href="../new_pages/dates.ru.html">Работа с датами</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(linelist_raw)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">linelist_raw</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">6611</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">POSIXct</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">case_id</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5888</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">date onset</td>
<td style="text-align: right;">293</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">580</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">outcome</td>
<td style="text-align: right;">1500</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">324</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hospital</td>
<td style="text-align: right;">1512</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">infector</td>
<td style="text-align: right;">2323</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2697</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">source</td>
<td style="text-align: right;">2323</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_unit</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">fever</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chills</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">cough</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aches</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">vomit</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">time_admission</td>
<td style="text-align: right;">844</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1091</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">merged_header</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">…28</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">generation</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">16.60</td>
<td style="text-align: right;">5.71</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13.00</td>
<td style="text-align: right;">16.00</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">37.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">lon</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-13.23</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-13.27</td>
<td style="text-align: right;">-13.25</td>
<td style="text-align: right;">-13.23</td>
<td style="text-align: right;">-13.22</td>
<td style="text-align: right;">-13.21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lat</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">8.47</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">8.45</td>
<td style="text-align: right;">8.46</td>
<td style="text-align: right;">8.47</td>
<td style="text-align: right;">8.48</td>
<td style="text-align: right;">8.49</td>
</tr>
<tr class="even">
<td style="text-align: left;">row_num</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3240.91</td>
<td style="text-align: right;">1857.83</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1647.50</td>
<td style="text-align: right;">3241.00</td>
<td style="text-align: right;">4836.50</td>
<td style="text-align: right;">6481.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wt_kg</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">52.69</td>
<td style="text-align: right;">18.59</td>
<td style="text-align: right;">-11.00</td>
<td style="text-align: right;">41.00</td>
<td style="text-align: right;">54.00</td>
<td style="text-align: right;">66.00</td>
<td style="text-align: right;">111.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">ht_cm</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">125.25</td>
<td style="text-align: right;">49.57</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">91.00</td>
<td style="text-align: right;">130.00</td>
<td style="text-align: right;">159.00</td>
<td style="text-align: right;">295.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ct_blood</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">21.26</td>
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">16.00</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">22.00</td>
<td style="text-align: right;">22.00</td>
<td style="text-align: right;">26.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">temp</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">38.60</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">35.20</td>
<td style="text-align: right;">38.30</td>
<td style="text-align: right;">38.80</td>
<td style="text-align: right;">39.20</td>
<td style="text-align: right;">40.80</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">infection date</td>
<td style="text-align: right;">2322</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: left;">2012-04-09</td>
<td style="text-align: left;">2015-04-27</td>
<td style="text-align: left;">2014-10-04</td>
<td style="text-align: right;">538</td>
</tr>
<tr class="even">
<td style="text-align: left;">hosp date</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">2012-04-20</td>
<td style="text-align: left;">2015-04-30</td>
<td style="text-align: left;">2014-10-15</td>
<td style="text-align: right;">570</td>
</tr>
<tr class="odd">
<td style="text-align: left;">date_of_outcome</td>
<td style="text-align: right;">1068</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: left;">2012-05-14</td>
<td style="text-align: left;">2015-06-04</td>
<td style="text-align: left;">2014-10-26</td>
<td style="text-align: right;">575</td>
</tr>
</tbody>
</table>
</div>
</div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
</section>
<section id="имена-столбцов" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="имена-столбцов"><span class="header-section-number">8.4</span> Имена столбцов</h2>
<p>В R <em>имена</em> столбцов - это “заголовок” или “верхнее” значение в столбце. Они используются, чтобы ссылаться на столбцы в коде, а также являются значеними по умолчанию в подписях к диаграммам.</p>
<p>Другие статистические программы, такие как SAS и STATA используют <em>“подписи”</em>, которые существуют параллельно как более длинные печатные версии коротких имен столбцов. Хотя в R и есть возможность добавлять подписи столбцов к данным, на практике это не часто применяется. Чтобы сделать имена столбцов более удобными для печати графиков, как правило, их отображение корректируется в рамках команд для построения диаграммы, которые создают выходные данные (например, подписи осей или легенду для графика или заголовки столбцов в печатной таблице - см. <a href="../new_pages/ggplot_tips.ru.html#ggplot_tips_scales">раздел по шкалам на странице с советами по использованию ggplot</a> и страницу <a href="../new_pages/tables_presentation.ru.html">Таблицы для презентации</a>). Если вы хотите присвоить подписи столбцов в данных, более детально прочитайте об этом <a href="https://cran.r-project.org/web/packages/expss/vignettes/labels-support.html">тут</a> и <a href="https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html">тут</a>.</p>
<p>Так как имена столбцов очень часто используются в R, они должны иметь “чистый” синтаксис. Мы рекомендуем следующее:</p>
<ul>
<li>Короткие имена</li>
<li>Без пробелов (замените пробелы на нижние подчеркивания _ )</li>
<li>Без специальных знаков (&amp;, #, &lt;, &gt;, …)<br>
</li>
<li>Номенклатура в едином стиле (например, все столбцы с датами названы по принципу <strong>дата_</strong>заболевания, <strong>дата_</strong>регистрации, <strong>дата_</strong>смерти)</li>
</ul>
<p>Названия столбцов набора данных <code>linelist_raw</code> напечатаны ниже с помощью <code>names()</code> из <strong>базового</strong> R. Мы можем увидеть, что изначально:</p>
<ul>
<li>Некоторые имена содержат пробелы (например, <code>infection date</code>)<br>
</li>
<li>Для дат используются разные принципы именования (<code>date onset</code> или <code>infection date</code>)<br>
</li>
<li>Наверное, был <em>объединенный заголовок</em> в двух последних столбцах в .xlsx. Мы это знаем, поскольку имя двух объединенных столбцов (“merged_header”) было просто присвоено R первому столбцу, а второму столбцу было присвоено временное имя “…28” (поскольку он был пустым и это 28й столбец).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_raw)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"         "generation"      "infection date"  "date onset"     
 [5] "hosp date"       "date_of_outcome" "outcome"         "gender"         
 [9] "hospital"        "lon"             "lat"             "infector"       
[13] "source"          "age"             "age_unit"        "row_num"        
[17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"          
[21] "chills"          "cough"           "aches"           "vomit"          
[25] "temp"            "time_admission"  "merged_header"   "...28"          </code></pre>
</div>
</div>
<p><span style="color: black;"><strong><em>ПРИМЕЧАНИЕ:</em></strong> Чтобы ссылаться на имя столбца, которое содержит пробелы, заключите это имя в обратные одинарные кавычки, например: linelist$<code>` '\x60infection date\x60'`</code>. Обратите внимание, что на клавиатуре обратная кавычка (`) отличается от простой одинарной кавычки (’).</span></p>
<section id="автоматическая-вычистка" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="автоматическая-вычистка">Автоматическая вычистка</h3>
<p>Функция <code>clean_names()</code> из пакета <strong>janitor</strong> стандартизирует имена столбцов и делает их уникальными следующим образом:</p>
<ul>
<li>Конвертирует все имена так, чтобы они содержали только нижние подчеркивания, цифры и буквы<br>
</li>
<li>Символы с диакритическими знаками транслитерируются в ASCII (например, немецкая о умлаут становится “o”, испанская “энье” становится “n”)<br>
</li>
<li>Предпочтения по капитализации для новых имен столбцов можно указать, используя аргумент <code>case =</code> (“snake” это значение по умолчанию, альтернативами могут быть “sentence”, “title”, “small_camel”…)<br>
</li>
<li>Вы можете уточнить конкретную замену имен, указав вектор в аргументе <code>replace =</code> (например, <code>replace = c(onset = "date_of_onset")</code>)<br>
</li>
<li>Здесь есть онлайн <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">виньетка</a></li>
</ul>
<p>Ниже начинается цепочка канала вычистки, мы используем <code>clean_names()</code> для сырого построчного списка.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># подставляем сырой набор данных через функцию clean_names(), присваиваем результату имя "linelist"  </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># смотрим новые имена столбцов</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"         "generation"      "infection_date"  "date_onset"     
 [5] "hosp_date"       "date_of_outcome" "outcome"         "gender"         
 [9] "hospital"        "lon"             "lat"             "infector"       
[13] "source"          "age"             "age_unit"        "row_num"        
[17] "wt_kg"           "ht_cm"           "ct_blood"        "fever"          
[21] "chills"          "cough"           "aches"           "vomit"          
[25] "temp"            "time_admission"  "merged_header"   "x28"            </code></pre>
</div>
</div>
<p><span style="color: black;"><strong><em>ПРИМЕЧАНИЕ:</em></strong> Имя последнего столбца “…28” было изменено на “x28”.</span></p>
</section>
<section id="вычистка-имен-вручную" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="вычистка-имен-вручную">Вычистка имен вручную</h3>
<p>Часто даже после шага стандартизации, описанного выше, может потребоваться переименовать имена столбцов вручную. Ниже производится переименование с помощью функции <code>rename()</code> из пакета <strong>dplyr</strong> в рамках цепочки канала. <code>rename()</code> использует стиль <code>NEW = OLD</code> - новое имя столбца приводится до старого имени столбца.</p>
<p>Ниже к цепочке канала вычистки добавляется команда переименования. Пробелы добавляются стратегическим образом, чтобы выровнять код для облегчения его чтения.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ЦЕПОЧКА КАНАЛА ВЫЧИСТКИ (начинается с сырых данных, которые подставляются в шаги по вычистке)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># стандартизируем синтаксис имен столбцов</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># вручную переименовываем столбцы</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>           <span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вы можете увидеть, что изменились имена столбцов:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"              "generation"           "date_infection"      
 [4] "date_onset"           "date_hospitalisation" "date_outcome"        
 [7] "outcome"              "gender"               "hospital"            
[10] "lon"                  "lat"                  "infector"            
[13] "source"               "age"                  "age_unit"            
[16] "row_num"              "wt_kg"                "ht_cm"               
[19] "ct_blood"             "fever"                "chills"              
[22] "cough"                "aches"                "vomit"               
[25] "temp"                 "time_admission"       "merged_header"       
[28] "x28"                 </code></pre>
</div>
</div>
<section id="переименование-по-положению-столбца" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="переименование-по-положению-столбца">Переименование по положению столбца</h4>
<p>Вы можете также делать переименование по положению столбца вместо имени столбца, например:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="at">newNameForFirstColumn  =</span> <span class="dv">1</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">newNameForSecondColumn =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="переименование-с-помощью-select-и-summarise" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="переименование-с-помощью-select-и-summarise">Переименование с помощью <code>select()</code> и <code>summarise()</code></h4>
<p>В качестве быстрого способа вы также можете переименовывать столбцы с помощью функций <code>select()</code> и <code>summarise()</code> из <strong>dplyr</strong>. <code>select()</code> используется, чтобы сохранить только некоторые столбцы (она описана ниже на этой странице). Функция <code>summarise()</code> разбирается на страницах <a href="../new_pages/grouping.ru.html">Группирование данных</a> и <a href="../new_pages/tables_descriptive.ru.html">Описательные таблицы</a>. Эти функции также используют формат <code>new_name = old_name</code>. Пример:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>linelist_raw <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_infection       =</span> <span class="st">`</span><span class="at">infection date</span><span class="st">`</span>,    <span class="co"># переименовать и СОХРАНИТЬ ТОЛЬКО эти столбцы</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_hospitalisation =</span> <span class="st">`</span><span class="at">hosp date</span><span class="st">`</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="прочие-сложности" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="прочие-сложности">Прочие сложности</h3>
<section id="пустые-имена-столбцов-в-excel" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="пустые-имена-столбцов-в-excel">Пустые имена столбцов в Excel</h4>
<p>В R не может быть столбцов в наборе данных без имени столбца (заголовка). Поэтому если вы импортируете набор данных Excel с данными, но без заголовков столбцов, R заполнит эти заголовки названиями как “…1” или “…2”. Цифра представляет собой номер столбца (например, 4-й столбец в наборе данных не имеет заголовка, тогда R назовет его “…4”).</p>
<p>Вы можете вычистить эти имена вручную, указав номер их положения (см. пример выше), либо присвоенное им имя (<code>linelist_raw$...1</code>).</p>
</section>
<section id="объединенные-имена-столбцов-и-ячейки-в-excel" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="объединенные-имена-столбцов-и-ячейки-в-excel">Объединенные имена столбцов и ячейки в Excel</h4>
<p>Объединенные ячейки в Excel файле встречаются довольно часто в полученных данных. Как объясняется на странице <a href="../new_pages/transition_to_R.ru.html">Переход к R</a>, объединенные ячейки могут быть более удобны для чтения данных человеком, но не являются “аккуратными данными” и могут вызввать много проблем для машинного чтения данных. R не может справиться с объединенными ячейками.</p>
<p>Напоминайте людям, осуществляющим ввод данных, что <strong>данные, читаемые человеком - не то же самое, что машиночитаемые данные</strong>. Стремитесь обучать пользователей принципам <a href="https://r4ds.had.co.nz/tidy-data.html"><strong>аккуратных данных</strong></a>. Если возможно, попробуйте изменить процедуры, чтобы данные поступали в аккуратном формате без объединенных ячеек.</p>
<ul>
<li>У каждой переменной должен быть свой столбец.<br>
</li>
<li>У каждого наблюдения должна быть своя строка.<br>
</li>
<li>У каждого значения должна быть своя ячейка.</li>
</ul>
<p>При использовании функции <code>import()</code> из <strong>rio</strong>, значение в объединенной ячейке будет присвоено первой ячейке, а последующие ячейки останутся пустыми.</p>
<p>Одно из решений для проблемы объединенных ячеек - импортировать данные с помощью функции <code>readWorkbook()</code> из пакета <strong>openxlsx</strong>. Задайте аргумент <code>fillMergedCells = TRUE</code>. Это задает значение из объединенной ячейки для всех ячеек в объединенном диапазоне.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>linelist_raw <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">readWorkbook</span>(<span class="st">"linelist_raw.xlsx"</span>, <span class="at">fillMergedCells =</span> <span class="cn">TRUE</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span style="color: red;"><strong><em>ВНИМАНИЕ:</em></strong> Если имена столбцов объединены с помощью <code>readWorkbook()</code>, у вас получатся дублирующиеся имена столбцов, которые вам нужно будет исправить вручную - R не очень хорошо справляется с дублирующимися именами столбцов! Вы можете переименовать их, ссылаясь на их положение (например, столбец 5), как говорится в разделе по вычистке имен столбцов вручную.</span></p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
</section>
</section>
<section id="выбор-или-смена-порядка-столбцов" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="выбор-или-смена-порядка-столбцов"><span class="header-section-number">8.5</span> Выбор или смена порядка столбцов</h2>
<p>Используйте <code>select()</code> из пакета <strong>dplyr</strong> для выбора столбцов, которые вы хотите сохранить, а также для уточнения их порядка в датафрейме.</p>
<p><span style="color: orange;"><strong><em>ВНИМАНИЕ:</em></strong> В примерах ниже датафрейм <code>linelist</code> модифицируется с помощью <code>select()</code> и отображается, но не сохраняется. Это сделано в целях демонстрации. Модифицированные имена столбцов печатаются с помощью передачи датафрейм в канале в функцию <code>names()</code>.</span></p>
<p><strong>Здесь представлены ВСЕ имена столбцов в построчном списке на этом этапе цепочки канала вычистки:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"              "generation"           "date_infection"      
 [4] "date_onset"           "date_hospitalisation" "date_outcome"        
 [7] "outcome"              "gender"               "hospital"            
[10] "lon"                  "lat"                  "infector"            
[13] "source"               "age"                  "age_unit"            
[16] "row_num"              "wt_kg"                "ht_cm"               
[19] "ct_blood"             "fever"                "chills"              
[22] "cough"                "aches"                "vomit"               
[25] "temp"                 "time_admission"       "merged_header"       
[28] "x28"                 </code></pre>
</div>
</div>
<section id="сохранение-столбцов" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="сохранение-столбцов">Сохранение столбцов</h3>
<p><strong>Выберите только те столбцы, которые вы хотите сохранить</strong></p>
<p>Вставьте их имена в команду <code>select()</code> без кавычек. Они появятся в датафрейме в том порядке, который вы указали. Обратите внимание, что если вы включите имя несуществующего столбца, R выдаст ошибку (см. использование <code>any_of()</code> ниже, если вы хотите избежать ошибок в этой ситуации).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># набор данных linelist передается в канал в команду select(), а names() выводит на печать только имена столбцов</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, date_onset, date_hospitalisation, fever) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()  <span class="co"># отображает имена столбцов</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "case_id"              "date_onset"           "date_hospitalisation"
[4] "fever"               </code></pre>
</div>
</div>
</section>
<section id="clean_tidyselect" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="clean_tidyselect">Функции-помощники “tidyselect”</h3>
<p>Эти функции-помощники существуют, чтобы упростить уточнение того, какие столбцы сохранить, убрать или преобразовать. Это функции из пакета <strong>tidyselect</strong>, который включен в <strong>tidyverse</strong> и лежит в основе того, как столбцы выбираются в функциях <strong>dplyr</strong>.</p>
<p>Например, если вы хотите изменить порядок столбцов, полезной функцией является <code>everything()</code>, которая означает “все другие еще не упомянутые столбцы”. Команда ниже перемещает столбцы <code>date_onset</code> и <code>date_hospitalisation</code> в начало (влево) набора данных, но сохраняет все другие столбцы после. Обратите внимание, что <code>everything()</code> записана с пустыми скобками:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># перемещает date_onset и date_hospitalisation в начало</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date_onset, date_hospitalisation, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "date_onset"           "date_hospitalisation" "case_id"             
 [4] "generation"           "date_infection"       "date_outcome"        
 [7] "outcome"              "gender"               "hospital"            
[10] "lon"                  "lat"                  "infector"            
[13] "source"               "age"                  "age_unit"            
[16] "row_num"              "wt_kg"                "ht_cm"               
[19] "ct_blood"             "fever"                "chills"              
[22] "cough"                "aches"                "vomit"               
[25] "temp"                 "time_admission"       "merged_header"       
[28] "x28"                 </code></pre>
</div>
</div>
<p>Ниже представлены другие функции-помощники “tidyselect”, которые также работают <em>внутри</em> функций <strong>dplyr</strong>, такие как <code>select()</code>, <code>across()</code> и <code>summarise()</code>:</p>
<ul>
<li><code>everything()</code> - все другие не упомянутые столбцы<br>
</li>
<li><code>last_col()</code> - последний столбец<br>
</li>
<li><code>where()</code> - применяет функцию ко всем столбцам и выбирает, какие из них являются ИСТИНОЙ<br>
</li>
<li><code>contains()</code> - столбцы, содержащие последовательность знаков
<ul>
<li>пример: <code>select(contains("time"))</code><br>
</li>
</ul></li>
<li><code>starts_with()</code> - соответствует упомянутому префиксу
<ul>
<li>пример: <code>select(starts_with("date_"))</code><br>
</li>
</ul></li>
<li><code>ends_with()</code> - соответствует упомянутому суффиксу
<ul>
<li>пример: <code>select(ends_with("_post"))</code><br>
</li>
</ul></li>
<li><code>matches()</code> - для применения регулярного выражения (regex)
<ul>
<li>пример: <code>select(matches("[pt]al"))</code><br>
</li>
</ul></li>
<li><code>num_range()</code> - числовой диапазон, например, x01, x02, x03<br>
</li>
<li><code>any_of()</code> - соответствует ЕСЛИ столбец существует, но не выдает ошибку, если он не найден
<ul>
<li>пример: <code>select(any_of(date_onset, date_death, cardiac_arrest))</code></li>
</ul></li>
</ul>
<p>Кроме того, используйте обычные операторы, например, <code>c()</code>, чтобы перечислить несколько столбцов, <code>:</code> для последовательно расположенных столбцов, <code>!</code> для противоположных, <code>&amp;</code> для И, и <code>|</code> для ИЛИ.</p>
<p>Используйте <code>where()</code>, чтобы уточнить логические критерии для столбцов. Если вы представляете функцию внутри <code>where()</code>, не включайте пустые скобки функции. Команда ниже выбирает столбцы с числовым классом.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># выбирает столбцы в числовом классе</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "generation" "lon"        "lat"        "row_num"    "wt_kg"     
[6] "ht_cm"      "ct_blood"   "temp"      </code></pre>
</div>
</div>
<p>Используйте <code>contains()</code>, чтобы выбрать только те столбцы, в которых название столбцы содержит конкретную последовательность знаков. <code>ends_with()</code> и <code>starts_with()</code> дадут вам большую детализацию.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># выбирает столбцы, содержащие определенные знаки</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"date"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "date_infection"       "date_onset"           "date_hospitalisation"
[4] "date_outcome"        </code></pre>
</div>
</div>
<p>Функция <code>matches()</code> работает аналогично функции <code>contains()</code>, но ей может быть задано регулярное выражение (см. страницу <a href="../new_pages/characters_strings.ru.html">Текст и последовательности</a>), например, несколько последовательностей, разделенных чертами со значением ИЛИ внутри скобок:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># поиск нескольких соответствий знаков</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"onset|hosp|fev"</span>)) <span class="sc">%&gt;%</span>   <span class="co"># обратите внимание на символ ИЛИ "|"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "date_onset"           "date_hospitalisation" "hospital"            
[4] "fever"               </code></pre>
</div>
</div>
<p><span style="color: orange;"><strong><em>ВНИМАНИЕ:</em></strong> Если имя столбца, которое вы задали, не существует в данных, вам будет выдана ошибка, а выполнение кода будет остановлено. Рассмотрите возможность использования <code>any_of()</code>, чтобы перечислить столбцы, которые, возможно, не существуют, что особенно полезно при отрицательном выборе (удалении).</span></p>
<p>Существует только один из этих столбцов, но программа не выдает ошибку, и выполнение кода продолжается без остановки канала вычистки.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"date_onset"</span>, <span class="st">"village_origin"</span>, <span class="st">"village_detection"</span>, <span class="st">"village_residence"</span>, <span class="st">"village_travel"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "date_onset"</code></pre>
</div>
</div>
</section>
<section id="удаление-столбцов" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="удаление-столбцов">Удаление столбцов</h3>
<p><strong>Укажите, какие столбцы удалить</strong>, поставив знак минус “-” перед именем столбца (например, <code>select(-outcome)</code>), или вектором имен столбцов (как показано ниже). Все другие столбцы будут сохранены.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(date_onset, fever<span class="sc">:</span>vomit)) <span class="sc">%&gt;%</span> <span class="co"># удаляет date_onset и все столбцы от fever до vomit</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "case_id"              "generation"           "date_infection"      
 [4] "date_hospitalisation" "date_outcome"         "outcome"             
 [7] "gender"               "hospital"             "lon"                 
[10] "lat"                  "infector"             "source"              
[13] "age"                  "age_unit"             "row_num"             
[16] "wt_kg"                "ht_cm"                "ct_blood"            
[19] "temp"                 "time_admission"       "merged_header"       
[22] "x28"                 </code></pre>
</div>
</div>
<p>Вы можете также удалить столбец, используя <strong>базовый</strong> синтаксис R, определив его как <code>NULL</code>. Например:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>linelist<span class="sc">$</span>date_onset <span class="ot">&lt;-</span> <span class="cn">NULL</span>   <span class="co"># удаление столбца с помощью базового синтаксиса R </span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="отдельная-команда" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="отдельная-команда">Отдельная команда</h3>
<p><code>select()</code> также может использоваться как независимая команда (не как часть канала). В таком случае первым аргументом будет изначальный датафрейм, с которым проводится операция.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Создание нового построчного списка со столбцами с идентификатором и возрастом</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>linelist_age <span class="ot">&lt;-</span> <span class="fu">select</span>(linelist, case_id, <span class="fu">contains</span>(<span class="st">"age"</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># отображение имен столбцов</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(linelist_age)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "case_id"  "age"      "age_unit"</code></pre>
</div>
</div>
<section id="добавление-в-цепочку-канала" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="добавление-в-цепочку-канала">Добавление в цепочку канала</h4>
<p>В <code>linelist_raw</code>, существует несколько столбцов, которые нам не нужны: <code>row_num</code>, <code>merged_header</code> и <code>x28</code>. Мы удаляем их с помощью команды <code>select()</code> в цепочке канала вычистки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ЦЕПОЧКА КАНАЛА ВЫЧИСТКИ (начинается с сырых данных, которые передаются по шагам вычистки)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># начало цепочки канала вычистки</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># стандартизируем синтаксис имени столбца</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># переименовываем столбцы вручную</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ВЫШЕ ПОКАЗАНЫ РАНЕЕ ПРОДЕЛАННЫЕ И ПРЕДСТАВЛЕННЫЕ ШАГИ ВЫЧИСТКИ</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># удаляем столбцы</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
</section>
</section>
<section id="дедупликация" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="дедупликация"><span class="header-section-number">8.6</span> Дедупликация</h2>
<p>См. страницу руководства <a href="../new_pages/deduplication.ru.html">Дедупликация</a>, где показан широкий спектр вариантов дедупликации данных. Здесь представлен только простой пример дедупликации строки.</p>
<p>Пакет <strong>dplyr</strong> предлагает функцию <code>distinct()</code>. Эта функция рассматривает каждую строку и сокращает датафрейм только до уникальных строк. То есть, она удаляет те строки, которые являются 100% дубликатами.</p>
<p>При оценке дублирующихся строк она принимает во внимание диапазон столбцов - по умолчанию рассматриваются все столбцы. Как показано на странице по дедупликации, вы можете скорректировать диапазон столбцов, чтобы уникальность строк оценивуалась только по определенным столбцам.</p>
<p>В этом простом примере мы просто добавляем пустую команду <code>distinct()</code> в цепочку канала. Она сделает так, что не останется строк, которые являются 100% дубликатами других строк (оценивается по всем столбцам).</p>
<p>Мы начинаем с <code>nrow(linelist)</code> строк в <code>linelist</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>После дедупликации у нас осталось <code>nrow(linelist)</code> строк. Любые удаленные строки были 100% дубликатами других строк.</p>
<p>Ниже в цепочку канала добавляется команда <code>distinct()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ЦЕПОЧКА КАНАЛА ВЫЧИСТКИ (начинается с сырых данных, которые передаются по шагам вычистки)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># начало цепочки канала вычистки</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># стандартизируем синтаксис имен столбцов</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># переименовываем столбцы вручную</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># удаляем столбцы</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ВЫШЕ ПОКАЗАНЫ РАНЕЕ ПРОДЕЛАННЫЕ И ПРЕДСТАВЛЕННЫЕ ШАГИ ВЫЧИСТКИ</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># дедупликация</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
<section id="создание-и-преобразование-столбцов" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="создание-и-преобразование-столбцов"><span class="header-section-number">8.7</span> Создание и преобразование столбцов</h2>
<p><strong>Мы рекомендуем использовать функцию <code>mutate()</code> из dplyr, чтобы добавить новый столбец или преобразовать существующий.</strong></p>
<p>Ниже представлен пример создания нового столбца с помощью <code>mutate()</code>. Синтаксис: <code>mutate(новое_имя_столбца = значение или преобразование)</code></p>
<p>В Stata есть похожая команда <code>generate</code>, но функцию R <code>mutate()</code> можно также использовать для модификации существующего столбца.</p>
<section id="новые-столбцы" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="новые-столбцы">Новые столбцы</h3>
<p>Самая простая команда <code>mutate()</code> для создания нового столбца может выглядеть следующим образом. Она создает новый столбец <code>new_col</code>, где значения в каждой строке - 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_col =</span> <span class="dv">10</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вы также можете ссылаться на значения в других столбцах для проведения расчетов. Ниже создается столбец <code>bmi</code>, который должен содержать индекс массы тела (ИМТ) для каждого случая, он рассчитывается по формуле ИМТ = кг/м^2, используя столбец <code>ht_cm</code> и столбец <code>wt_kg</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Если вы создаете несколько новых столбцов, отделите каждый запятой и новой строкой. Ниже представлены некоторые примеры новых столбцов, включая те, которые состоят из значений из других столбцов, объединенных с помощью <code>str_glue()</code> из пакета <strong>stringr</strong> (см. страницу <a href="../new_pages/characters_strings.ru.html">Текст и последовательности</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>new_col_demo <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                       </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_dup    =</span> case_id,             <span class="co"># новый столбец = дубликат/копия другого существующего столбца</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_static =</span> <span class="dv">7</span>,                   <span class="co"># новый столбец = все значения такие же</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_static =</span> new_var_static <span class="sc">+</span> <span class="dv">5</span>,  <span class="co"># вы можете переписать столбец, это может быть расчет с использованием других переменных</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_var_paste  =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"{hospital} on ({date_hospitalisation})"</span>) <span class="co"># новый столбец = склейка значений других столбцов</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, hospital, date_hospitalisation, <span class="fu">contains</span>(<span class="st">"new"</span>))        <span class="co"># показывает только новые столбцы в демонстрационных целях</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Рассмотрите новые столбцы. В демонстрационных целях показаны только новые столбцы и столбцы, использованные для их создания:</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5c29f3584ff91ac96863" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5c29f3584ff91ac96863">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],["Other on (2014-05-15)","NA on (2014-05-14)","St. Mark's Maternity Hospital (SMMH) on (2014-05-18)","Port Hospital on (2014-05-20)","Military Hospital on (2014-05-22)","Port Hospital on (2014-05-23)","NA on (2014-05-29)","NA on (2014-06-03)","NA on (2014-06-06)","NA on (2014-06-07)","Port Hospital on (2014-06-08)","Military Hospital on (2014-06-15)","NA on (2014-06-17)","NA on (2014-06-17)","Other on (2014-06-20)","Port Hospital on (2014-06-19)","Port Hospital on (2014-06-23)","Port Hospital on (2014-06-24)","NA on (2014-06-27)","Other on (2014-06-28)","Port Hospital on (2014-06-29)","Port Hospital on (2014-07-03)","St. Mark's Maternity Hospital (SMMH) on (2014-07-09)","NA on (2014-07-09)","Other on (2014-07-11)","NA on (2014-07-11)","St. Marks Maternity Hopital (SMMH) on (2014-07-13)","Military Hospital on (2014-07-14)","Port Hospital on (2014-07-14)","Central Hospital on (2014-07-13)","Military Hospital on (2014-07-14)","Central Hospital on (2014-07-17)","NA on (2014-07-17)","Military Hospital on (2014-07-18)","Other on (2014-07-19)","NA on (2014-07-20)","NA on (2014-07-20)","Port Hospital on (2014-07-22)","Port Hospital on (2014-07-24)","Port Hospital on (2014-07-26)","NA on (2014-07-24)","Central Hospital on (2014-07-27)","Military Hospital on (2014-07-25)","Other on (2014-07-27)","Other on (2014-07-31)","Other on (2014-08-01)","NA on (2014-08-03)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","NA on (2014-08-04)"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>new_var_dup<\/th>\n      <th>new_var_static<\/th>\n      <th>new_var_paste<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4},{"name":"case_id","targets":0},{"name":"hospital","targets":1},{"name":"date_hospitalisation","targets":2},{"name":"new_var_dup","targets":3},{"name":"new_var_static","targets":4},{"name":"new_var_paste","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><span style="color: darkgreen;"><strong><em>СОВЕТ:</em></strong> Вариацией <code>mutate()</code> является функция <code>transmute()</code>. Эта функция добавляет новый столбец, как и <code>mutate()</code>, но также выкидывает/удаляет все другие столбцы, которые вы не упомянули внутри скобок.</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># СПРЯТАНО ОТ ЧИТАТЕЛЯ</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># удаляем новые демонстрационные столбцы, созданные выше</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># linelist &lt;- linelist %&gt;% </span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-contains("new_var"))</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="конвертация-класса-столбцов" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="конвертация-класса-столбцов">Конвертация класса столбцов</h3>
<p>Столбцы, содержащие значения, которые являются датами, числами или логическими значениями (ИСТИНА/ЛОЖЬ) будут вести себя в соответствии с ожиданиями, только если они правильно классифицированы. Есть разница между “2” в текстовом классе и 2 в числовом классе!</p>
<p>Существуют способы, чтобы задать класс столбцов в командах импорта, но это часто сложно сделать. См. раздел <a href="basics.tr.qmd">Основы R</a> по классам объектов, чтобы получить дополнительную информацию о конвертации класса объектов и столбцов.</p>
<p>Сначала давайте проведем некоторые проверки важных столбцов, чтобы посмотреть, к правильному классу ли они относятся. Мы это также видели в начале, когда выполняли команду <code>skim()</code>.</p>
<p>В настоящее время столбец <code>age</code> относится к текстовому классу. Чтобы провести количественный анализ, нам нужно, чтобы цифры распознавались как числовой класс!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>age)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>Класс столбца <code>date_onset</code> также является текстовым! Для проведения анализа даты должны распознаваться как даты!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>date_onset)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>Чтобы устранить эту проблему, используйте возможность функции <code>mutate()</code> по переопределению столбца с трансформацией. Мы определяем столбец как самого себя, но конвертируем его в другой класс. Здесь приведен базовый пример конвертации, чтобы класс столбца <code>age</code> был числовым:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.numeric</span>(age))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Аналогичным образом вы можете использовать <code>as.character()</code> и <code>as.logical()</code>. Чтобы конвертировать класс в Фактор, вы можете использовать <code>factor()</code> из <strong>базового</strong> R или <code>as_factor()</code> из <strong>forcats</strong>. Более подробно вы можете об этом узнать на странице <a href="../new_pages/factors.ru.html">Факторы</a>.</p>
<p>Вы должны быть осторожны при конвертации в класс Дата. На странице <a href="../new_pages/dates.ru.html">Работа с датами</a> объясняются несколько методов. Как правило, сырые значения даты должны быть в одинаковом формате, чтобы конвертация прошла правильно (например, “ММ/ДД/ГГГГ”, или “ДД ММ ГГГГ”). После конвертации в класс Дата, проверьте ваши данные, чтобы подтвердить, что каждое значение было сконвертировано верно.</p>
</section>
<section id="сгруппированные-данные" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="сгруппированные-данные">Сгруппированные данные</h3>
<p>Если ваш датафрейм уже <em>сгруппирован</em> (см. страницу <a href="../new_pages/grouping.ru.html">Группирование данных</a>), <code>mutate()</code> может повести себя иначе, чем в наборе данных без группировки. Любые резюмирующие функции, такие как <code>mean()</code> (среднее значение), <code>median()</code> (медиана), <code>max()</code> (максимум) и т.п. будут рассчитаны по группе, а не по всем строкам.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># возраст нормализован по среднему значению для ВСЕХ строк</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_norm =</span> age <span class="sc">/</span> <span class="fu">mean</span>(age, <span class="at">na.rm=</span>T))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># возраст нормализован по среднему значению по группе больниц</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_norm =</span> age <span class="sc">/</span> <span class="fu">mean</span>(age, <span class="at">na.rm=</span>T))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Более подробно об использовании <code>mutate ()</code> в сгруппированных датафреймах можно почитать в этой <a href="https://dplyr.tidyverse.org/reference/mutate.html">документации по tidyverse mutate</a>.</p>
</section>
<section id="clean_across" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="clean_across">Трансформация нескольких столбцов</h3>
<p>Часто чтобы написать краткий код, вы можете захотеть применить одинаковую трансформацию сразу к нескольким столбцам. Трансформацию можно применить одновременно к нескольким столбцам, используя функцию <code>across()</code> из пакета <strong>dplyr</strong> (также содержится внутри пакета <strong>tidyverse</strong>). <code>across()</code> можно использовать с любой функцией <strong>dplyr</strong>, но она часто используется внутри <code>select()</code>, <code>mutate()</code>, <code>filter()</code> или <code>summarise()</code>. См. применение этой функции к <code>summarise()</code> на странице <a href="../new_pages/tables_descriptive.ru.html">Описательные таблицы</a>.</p>
<p>Укажите столбцы в аргументе <code>.cols =</code> и функцию(и) к применению в <code>.fns =</code>. Любые дополнительные аргументы, которые должны быть заданы для функции <code>.fns</code> могут быть включены после запятой, все еще внутри <code>across()</code>.</p>
<section id="выбор-столбцов-в-across" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="выбор-столбцов-в-across">Выбор столбцов в <code>across()</code></h4>
<p>Укажите столбцы в аргументе <code>.cols =</code>. Вы можете назвать их по отдельности или использовать функцию-помощника “tidyselect”. Уточните функцию в <code>.fns =</code>. Обратите внимание, что в использовании режима функции ниже, функция пишется <em>без</em> скобок ( ).</p>
<p>Здесь трансформация <code>as.character()</code> применяется к конкретным столбцам, названным внутри <code>across()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(temp, ht_cm, wt_kg), <span class="at">.fns =</span> as.character))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Доступны функции-помощники “tidyselect”, которые помогут вам в указании столбцов. Они детально представлены выше в разделе по Выбору и изменению порядка столбцов, и включают в себя: <code>everything()</code>, <code>last_col()</code>, <code>where()</code>, <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code>, <code>matches()</code>, <code>num_range()</code> и <code>any_of()</code>.</p>
<p>Здесь приведен пример того, как можно изменить <strong>все столбцы</strong> в текстовый класс:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#чтобы изменить все столбцы на текстовый класс</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="at">.fns =</span> as.character))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Конвертация в текстовый класс всех столбцов, где в названии есть последовательность символов “date” (обратите внимание на размещение запятых и скобок):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#чтобы изменить все столбцы на текстовый класс</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">"date"</span>), <span class="at">.fns =</span> as.character))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ниже представлен пример мутации столбцов, которые в настоящее время относятся к классу POSIXct (сырой класс датывремени, который показывает метки времени) - иными словами, где функция <code>is.POSIXct()</code> оценивается как <code>TRUE</code> (истина). Затем мы хотим применить функцию <code>as.Date()</code> к этим столбцам, чтобы конвертировать их в обычный класс Дата.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.POSIXct), <span class="at">.fns =</span> as.Date))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Обратите внимание, что внутри <code>across()</code> мы также используем функцию <code>where()</code> как <code>is.POSIXct</code> для оценки ИСТИНА или ЛОЖЬ.<br>
</li>
<li>Обратите внимание, что <code>is.POSIXct()</code> относится к пакету <strong>lubridate</strong>. Другие похожие “is” функции, такие как <code>is.character()</code>, <code>is.numeric()</code> и <code>is.logical()</code> относятся к <strong>базовому R</strong></li>
</ul>
</section>
<section id="функции-across" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="функции-across">Функции <code>across()</code></h4>
<p>Вы можете прочитать документацию по <code>?across</code> для получения дополнительной информации о том, как задавать функции для <code>across()</code>. Несколько общих моментов: существует несколько способов, чтобы уточнить, какую(ие) функцию(и) выполнить для столбца, и вы даже можете задать собственные функции:</p>
<ul>
<li>Вы можете задать только имя функции (например, <code>mean</code> или <code>as.character</code>)<br>
</li>
<li>Вы можете задать функцию в стиле <strong>purrr</strong> (например, <code>~ mean(.x, na.rm = TRUE)</code>) (см. [эту страницу][Итерации, циклы и списки])<br>
</li>
<li>Вы можете задать несколько функций, представив список (например, <code>list(mean = mean, n_miss = ~ sum(is.na(.x))</code>).
<ul>
<li>Если вы задаете несколько функций, несколько трансформированных столбцов будут выданы вам на столбец входных данных, с уникальными именами в формате <code>col_fn</code>. Вы можете скорректировать, как будут названы новые столбцы с помощью аргумента <code>.names =</code>, используя синтаксис <strong>glue</strong> (см. страницу <a href="../new_pages/characters_strings.ru.html">Текст и последовательности</a>), где <code>{.col}</code> и <code>{.fn}</code> являются сокращениями для столбца входных данных и функции.</li>
</ul></li>
</ul>
<p>Вот несколько онлайн ресурсов по использованию <code>across()</code>: <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/">мысли/обоснование создателя Хэдли Уикема</a></p>
</section>
</section>
<section id="coalesce" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="coalesce"><code>coalesce()</code></h3>
<p>Эта функция <strong>dplyr</strong> находит первое неотсутствующее значение в каждом положении. Она “заполняет” отсутствующие значения первым доступным значением в указанном вами порядке.</p>
<p>Вот пример <em>вне контекста датафрейма</em>: Представим, что у вас есть два вектора, один содержит деревню, в которой выявлен пациент, а другой - деревню проживания пациента. Вы можете использовать coalesce для выбора первого неотсутствующего значения для каждого индекса:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>village_detection <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="cn">NA</span>,  <span class="cn">NA</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>village_residence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>village <span class="ot">&lt;-</span> <span class="fu">coalesce</span>(village_detection, village_residence)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>village    <span class="co"># печать</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "b" "a" "d"</code></pre>
</div>
</div>
<p>Это работает таким же образом, если вы зададите столбцы датафрейма: для каждой строки функция присвоит новое значение столбца с помощью первого неотсутствующего значения в указанных вами столбцах (в указанном порядке).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">village =</span> <span class="fu">coalesce</span>(village_detection, village_residence))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Это пример “построчной” операции. Чтобы посмотреть более сложные построчные расчеты, см. раздел ниже по построчным расчетам.</p>
</section>
<section id="кумулятивная-математика" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="кумулятивная-математика">Кумулятивная математика</h3>
<p>Если вы хотите, чтобы столбец отражал кумулятивную сумму/среднее значение/минимум/максимум и т.п., как оценено по строкам датафрейма на этот момент, используйте следующие функции:</p>
<p><code>cumsum()</code> выдает кумулятивную сумму, как показано ниже:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))     <span class="co"># выдает только одно число</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))  <span class="co"># выдает кумулятивную сумму на каждом шаге</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  6 21 31</code></pre>
</div>
</div>
<p>Это можно использовать в датафрейме при создании нового столбца. Например, чтобы рассчитать кумулятивное количество случаев в день при вспышке, можно использовать следующий код:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>cumulative_case_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>  <span class="co"># начинаем с построчного списка случаев</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date_onset) <span class="sc">%&gt;%</span>                 <span class="co"># подсчитываем строки в день как столбец 'n'   </span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative_cases =</span> <span class="fu">cumsum</span>(n))  <span class="co"># новый столбец кумулятивной суммы на каждой строке</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ниже представлены первые 10 строк:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cumulative_case_counts, <span class="dv">10</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   date_onset n cumulative_cases
1  2012-04-15 1                1
2  2012-05-05 1                2
3  2012-05-08 1                3
4  2012-05-31 1                4
5  2012-06-02 1                5
6  2012-06-07 1                6
7  2012-06-14 1                7
8  2012-06-21 1                8
9  2012-06-24 1                9
10 2012-06-25 1               10</code></pre>
</div>
</div>
<p>См. также страницу <a href="../new_pages/epicurves.ru.html">Эпидемические кривые</a>, чтобы узнать, как построить график кумулятивной заболеваемости с помощью эпидкривой.</p>
<p>См. также:<br>
<code>cumsum()</code>, <code>cummean()</code>, <code>cummin()</code>, <code>cummax()</code>, <code>cumany()</code>, <code>cumall()</code></p>
</section>
<section id="использование-базового-r" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="использование-базового-r">Использование <strong>базового</strong> R</h3>
<p>Чтобы определить новый столбец (или переопределить столбец), используя <strong>базовый</strong> R, напишите имя датафрейма, соединенного с помощью <code>$</code>, для <em>нового</em> столбца (или столбца, который должен быть модифицирован). Используйте оператор присваивания <code>&lt;-</code>, чтобы определить новое(ые) значение(я). Помните, что при использовании <strong>базового</strong> R вы должны уточнять имя датафрейма каждый раз перед именем столбца (например, <code>dataframe$column</code>). Здесь приведен пример создания столбца <code>bmi</code> с использованием <strong>базового</strong> R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>linelist<span class="sc">$</span>bmi <span class="ot">=</span> linelist<span class="sc">$</span>wt_kg <span class="sc">/</span> (linelist<span class="sc">$</span>ht_cm <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span><span class="er">)</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="добавление-к-цепочке-канала" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="добавление-к-цепочке-канала">Добавление к цепочке канала</h3>
<p><strong>Ниже добавляется новый столбец к цепочке канала, а также конвертируются некоторые классы.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ЦЕПОЧКА КАНАЛА ВЫЧИСТКИ (начинается с сырых данных, которые передаются по шагам вычистки)</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># начало цепочки канала вычистки</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># стандартизируем синтаксис имен столбцов</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># переименовываем столбцы вручную</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># удаляем столбцы</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># дедупликация</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ВЫШЕ ПОКАЗАНЫ РАНЕЕ ПРОДЕЛАННЫЕ И ПРЕДСТАВЛЕННЫЕ ШАГИ ВЫЧИСТКИ</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>    <span class="do">###################################################</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># добавляем новый столбец</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># конвертируем класс столбцов</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>), as.Date), </span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="перекодирование-значений" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="перекодирование-значений"><span class="header-section-number">8.8</span> Перекодирование значений</h2>
<p>Здесь представлено несколько сценариев, при которых вам нужно перекодировать (изменить) значения:</p>
<ul>
<li>чтобы редактировать одно конкретное значение (например, одна дата с неправильным годом или форматом)<br>
</li>
<li>чтобы сделать единообразными значения, которые имеют разное правописание</li>
<li>чтобы создать новый столбец категориальных значений<br>
</li>
<li>чтобы создать новый столбец числовых категорий (например, возрастные категории)</li>
</ul>
<section id="конкретные-значения" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="конкретные-значения">Конкретные значения</h3>
<p>Чтобы изменить значения вручную, вы можете использовать функцию <code>recode()</code> внутри функции <code>mutate()</code>.</p>
<p>Представьте,что в дате стоит какая-то бессмысленная дата (например, “2014-14-15”): вы можете исправить дату вручную в сырых исходных данных, либо вы можете записать изменение в рамках цепочки канала вычистки с помощью <code>mutate()</code> и <code>recode()</code>. Последний вариант будет более прозрачным и воспроизводимям, если кто-то захочет понять или повторить ваш анализ.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># исправление неправильных значений     # старое значение  # новое значение</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">recode</span>(date_onset, <span class="st">"2014-14-15"</span> <span class="ot">=</span> <span class="st">"2014-04-15"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Строку <code>mutate()</code> выше можно прочитать как: “изменить столбец <code>date_onset</code>, чтобы он был равен столбцу <code>date_onset</code> с перекодированием, так чтобы СТАРОЕ ЗНАЧЕНИЕ было изменено на НОВОЕ ЗНАЧЕНИЕ”. Обратите внимание, что эта последовательность (СТАРОЕ = НОВОЕ) в <code>recode()</code> противоположна большинству последовательностей в R (новое = старое). Сообщество разработчиков R уже работает над этим изменением.</p>
<p><strong>Вот еще один пример перекодирования нескольких значений в одном столбце.</strong></p>
<p>В <code>linelist</code> необходимо вычистить значения в столбце “hospital”. Есть несколько вариантов написания и много отсутствующих значений.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>hospital, <span class="at">useNA =</span> <span class="st">"always"</span>)  <span class="co"># печать таблицы всех уникальных значений, включая отсутствующие  </span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                     Central Hopital                     Central Hospital 
                                  11                                  457 
                          Hospital A                           Hospital B 
                                 290                                  289 
                    Military Hopital                    Military Hospital 
                                  32                                  798 
                    Mitylira Hopital                    Mitylira Hospital 
                                   1                                   79 
                               Other                         Port Hopital 
                                 907                                   48 
                       Port Hospital St. Mark's Maternity Hospital (SMMH) 
                                1756                                  417 
  St. Marks Maternity Hopital (SMMH)                                 &lt;NA&gt; 
                                  11                                 1512 </code></pre>
</div>
</div>
<p>Команда <code>recode()</code> ниже переопределяет столбец “hospital” (больницы) как текущий столбец “hospital”, но с указанными изменениями по перекодированию. Не забывайте запятые после каждого!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># для справки: СТАРОЕ = НОВОЕ</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hospital"</span> <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Military Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Port Hopital"</span>      <span class="ot">=</span> <span class="st">"Port Hospital"</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Central Hopital"</span>   <span class="ot">=</span> <span class="st">"Central Hospital"</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"other"</span>             <span class="ot">=</span> <span class="st">"Other"</span>,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>                      ))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Теперь мы видим, что написание в столбце <code>hospital</code> было исправлено и унифицировано:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>hospital, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                    Central Hospital                           Hospital A 
                                 468                                  290 
                          Hospital B                    Military Hospital 
                                 289                                  910 
                               Other                        Port Hospital 
                                 907                                 1804 
St. Mark's Maternity Hospital (SMMH)                                 &lt;NA&gt; 
                                 428                                 1512 </code></pre>
</div>
</div>
<p><span style="color: darkgreen;"><strong><em>СОВЕТ:</em></strong> Количество пробелов до и после знака равно не имеет значения. Упростите чтение вашего кода, выровнив знаки = для всех или большинства строк. Кроме того, рассмотрите возможность добавления комментария со знаком решетка, чтобы пояснить будущим читателям, какая сторона является СТАРОЙ, а какая - НОВОЙ. </span></p>
<p><span style="color: darkgreen;"><strong><em>СОВЕТ:</em></strong> Иногда в наборе данных может иметься <em>пустое</em> текстовое значение (не стандартное значение в R для отсутствующих значений - <code>NA</code>). Вы можете ссылаться на это значения с помощью двух кавычек без пробела между ними (““).</span></p>
</section>
<section id="по-логике" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="по-логике">По логике</h3>
<p>Ниже мы показываем, как перекодировать значения в столбце, используя логику и условия:</p>
<ul>
<li>Используя <code>replace()</code>, <code>ifelse()</code> и <code>if_else()</code> для простой логики</li>
<li>Используя <code>case_when()</code> для более сложной логики</li>
</ul>
</section>
<section id="простая-логика" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="простая-логика">Простая логика</h3>
<section id="replace" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="replace"><code>replace()</code></h4>
<p>Чтобы перекодировать с простыми логическими критериями, вы можете использовать <code>replace()</code> внутри <code>mutate()</code>. <code>replace()</code> - это функция из <strong>базового</strong> R. Используйте логическое условие, чтобы уточнить, какие строки менять. Общий синтаксис выглядит следующим образом:</p>
<p><code>mutate(col_to_change = replace(col_to_change, критерии для строк, новое значение))</code>.</p>
<p>Одна из частых ситуаций для использования <code>replace()</code> - это <strong>изменение только одного значения в одной строке, используя уникальный идентификатор строки</strong>. Ниже пол меняется на “Female” в строке, где столбец <code>case_id</code> равен “2195”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Пример: изменение пола в одном конкретном наблюдении на "Female" </span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">replace</span>(gender, case_id <span class="sc">==</span> <span class="st">"2195"</span>, <span class="st">"Female"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Эквивалент команды с использованием синтаксиса <strong>базового</strong> R и индексных квадратных скобок <code>[ ]</code> приведен ниже. Его следует читать как: “Изменить значение столбца <code>gender</code> в датаврейме <code>linelist</code> (для строк, где столбец <code>case_id</code> в <code>linelist</code> имеет значение ‘2195’) на ‘Female’”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>linelist<span class="sc">$</span>gender[linelist<span class="sc">$</span>case_id <span class="sc">==</span> <span class="st">"2195"</span>] <span class="ot">&lt;-</span> <span class="st">"Female"</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ifelse-и-if_else" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="ifelse-и-if_else"><code>ifelse()</code> и <code>if_else()</code></h4>
<p>Еще один инструмент простой логики - это <code>ifelse()</code> и функция-партнер <code>if_else()</code>. Однако в большинстве случаев перекодирования понятнее будет использовать <code>case_when()</code> (описан ниже). Эти команды “if else” (если не) являются упрощенными версиями программного утверждения <code>if</code> (если) и <code>else</code> (кроме). Общий синтаксис выглядит следующим образом:<br>
<code>ifelse(условие, значение, которое выдается, если условие оценено как ИСТИНА, значение, которое выдается, если условие оценено как ЛОЖЬ)</code></p>
<p>Ниже определяется столбец<code>source_known</code>. Его значение в соответствующей строке установлено на “known” (известен), если в столбце <code>source</code> <em>не</em> отсутствует значение строки. Если в столбце <code>source</code> <em>отсутствует</em> значение, тогда значение <code>source_known</code> устанавливается как “unknown” (неизвестен).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source_known =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(source), <span class="st">"known"</span>, <span class="st">"unknown"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>if_else()</code> - это специальная версия из <strong>dplyr</strong>, которая работает с датами. Обратите внимание, что если ‘true’ (истиным) значением является дата, то ‘false’ (ложное) значение должно также квалифицироваться как дата, поэтому вместо просто <code>NA</code> используется специальное значение <code>NA_real_</code> .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем столбец дата смерти, в котором значение будет NA, если пациент не умер.</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_death =</span> <span class="fu">if_else</span>(outcome <span class="sc">==</span> <span class="st">"Death"</span>, date_outcome, <span class="cn">NA_real_</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Избегайте использования чрезмерно большого количества команд ifelse одновременно… вместо этого используйте <code>case_when()</code>!</strong> <code>case_when()</code> гораздо легче читать, и вы допустите меньше ошибок.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/ifelse bad.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="../images/ifelse bad.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Вне контекста датафрейма, если вы хотите, чтобы объект, используемые в вашем коде, поменял значение, рассмотрите использование <code>switch()</code> из <strong>базового</strong> R.</p>
</section>
</section>
<section id="clean_case_when" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="clean_case_when">Сложная логика</h3>
<p>Используйте <code>case_when()</code> из <strong>dplyr</strong>, если вы перекодируете в большое количество новых групп, либо если вам нужно использовать сложные логические утверждения для перекодирования значений. Эта функция оценивает каждую строку в датафрейме, оценивает, соответствуют ли строки указанным критериям и присваивает правильное новое значение.</p>
<p>Команды <code>case_when()</code> состоят из утверждений, которые имеют правую сторону и левую сторону, разделенную “тильдой” <code>~</code>. Логические критерии указаны слева, а согласующиеся значения - справа в каждом утверждении. Утверждения разделяются запятыми.</p>
<p>Например, здесь мы используем столбцы <code>age</code> и <code>age_unit</code>, чтобы создать столбец <code>age_years</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>       age_unit <span class="sc">==</span> <span class="st">"years"</span>  <span class="sc">~</span> age,       <span class="co"># если единица возраста годы</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>       age_unit <span class="sc">==</span> <span class="st">"months"</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,    <span class="co"># если единица возраста месяцы, разделить возраст на 12</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">is.na</span>(age_unit)      <span class="sc">~</span> age))      <span class="co"># если единица возраста отсутствует, предположить, что это годы</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="co"># в любых других обстоятельствах - присвоить NA (отсутствует)</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>По мере того как оценивается каждая строка данных, применяются/оцениваются критерии в порядке написания утверждений <code>case_when()</code> - сверху вниз. Если верхний критерий оценивается как <code>TRUE</code> (истина) для определенной строки, присваивается значение из правой стороны, а остальные критерии даже не тестируются для этой строки данных. Таким образом, лучше сначала записать наиболее специфичный критерий, а последним записать наиболее общий критерий. Строке данных, которая не соответствует ни одному критерию, будет присвоено <code>NA</code>.</p>
<p>Иногда вы можете записать финальное утверждение, которое присваивает значение для всех прочих сценариев, не описанных в одной из предыдущих строк. Чтобы это сделать, разместите <code>TRUE</code> в левой стороне, что охватит любую строку, которая не соответствовала ни одному из предыдущих критериев. Правой стороне этого утверждения можно присвоить значение, например “проверь меня!” или отсутствует.</p>
<p>Ниже приведен еще один пример использования <code>case_when()</code> для создания нового столбца с классификацией пациента в соответствии с определением случая подтвержденного и подозрительного случая:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">case_status =</span> <span class="fu">case_when</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>          <span class="co"># если у пациента есть лабораторный тест и он положительный,</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># тогда он отмечается как подтвержденный случай </span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>          ct_blood <span class="sc">&lt;</span> <span class="dv">20</span>                   <span class="sc">~</span> <span class="st">"Confirmed"</span>,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>          <span class="co"># при условии, что у пациента нет положительного лабораторного теста,</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>          <span class="co"># если у пациента есть "источник" (эпидемиологическая связь) И есть жар, </span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>          <span class="co"># тогда он маркируется как подозрительный случай</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span><span class="fu">is.na</span>(source) <span class="sc">&amp;</span> fever <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">~</span> <span class="st">"Suspect"</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>          <span class="co"># любой другой пациент, не рассмотренный выше </span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>          <span class="co"># отмечается для  дальнейшего наблюдения</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span>                            <span class="sc">~</span> <span class="st">"To investigate"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span style="color: red;"><strong><em>ВНИМАНИЕ:</em></strong> <strong>Значения справа должны быть все в одном классе</strong> - либо числовые, текстовые, дата, логические и т.п. Чтобы присвоить отсутствующее значение (<code>NA</code>), вам может потребоваться использовать особые варианты <code>NA</code>, такие как <code>NA_character_</code>, <code>NA_real_</code> (для числовых или POSIX), и <code>as.Date(NA)</code>. Более детально см. страницу <a href="../new_pages/dates.ru.html">Работа с датами</a>.</span></p>
</section>
<section id="отсутствующие-значения" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="отсутствующие-значения">Отсутствующие значения</h3>
<p>Ниже приведены специальные функции для работы с отсутствующими значениями в контексте вычистки данных.</p>
<p>См. страницу <a href="../new_pages/missing_data.ru.html">Отсутствующие данные</a> для получения более детальных советов о том, как определять и работать с отсутствующими значениями. Например, функция <code>is.na()</code>, которая логически тестирует на предмет отсутствия.</p>
<p><strong><code>replace_na()</code></strong></p>
<p>Чтобы изменить отсутствующие значения (<code>NA</code>) на конкретное значение, например “Missing” (“Отсутствует”), используйте функцию <code>replace_na()</code> из <strong>dplyr</strong> внутри <code>mutate()</code>. Обратите внимание, что она используется таким же образом, как и <code>recode</code> выше - имя переменной необходимо повторить в <code>replace_na()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">"Missing"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>fct_explicit_na()</strong></p>
<p>Это функция из пакета <strong>forcats</strong>. Пакет <strong>forcats</strong> работает со столбцами с классом Фактор. Факторы - то, как R работает с <em>порядковыми</em> значениями, такими как <code>c("First" (первый), "Second" (второй), "Third"(третий))</code> или задает порядок, в котором появляются значения (например, больницы) в таблицах и графиках. См. страницу <a href="../new_pages/factors.ru.html">Факторы</a>.</p>
<p>Если ваши данные относятся к классу Фактор и вы попытаетесь конвертировать <code>NA</code> в “Missing” (“отсутствует”) с помощью <code>replace_na()</code>, вы увидите следующее сообщение об ошибке: <code>invalid factor level, NA generated</code> (недействительный уровень фактора, сгенерирован NA). Вы попытались добавить “Missing” как значение, а оно не было определено как возможный уровень фактора и было отклонено.</p>
<p>Самый простой способ решить эту проблему - использовать функцию из пакета <strong>forcats</strong> <code>fct_explicit_na()</code>, которая конвертирует столбец в класс фактор и конвертирует значения <code>NA</code> на текстовые “(Missing - отсутствует)”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">fct_explicit_na</span>(hospital))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Более медленная альтернатива - добавить уровень фактора, используя <code>fct_expand()</code> и затем конвертируя отсутствующие значения.</p>
<p><strong><code>na_if()</code></strong></p>
<p>Чтобы конвертировать <em>конкретное значение в</em> <code>NA</code>, используйте функцию <code>na_if()</code> из <strong>dplyr</strong>. Команда ниже проводит противоположную <code>replace_na()</code> операцию. В примере ниже любые значения “Missing” в столбце <code>hospital</code> конвертируются в <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">na_if</span>(hospital, <span class="st">"Missing"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Примечание: <code>na_if()</code> <strong>не может использоваться для логических критериев</strong> (например, “all values &gt; 99” (“все значения &gt; 99”)) - используйте <code>replace()</code> или <code>case_when()</code> для этих целей:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Конвертация температуры выше 40 в NA </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp =</span> <span class="fu">replace</span>(temp, temp <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="cn">NA</span>))</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Конвертация даты заболевания раньше, чем 1 января 2000 в отсутствующую</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">replace</span>(date_onset, date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2000-01-01"</span>), <span class="cn">NA</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="словарь-вычистки" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="словарь-вычистки">Словарь вычистки</h3>
<p>Используйте пакет R <strong>matchmaker</strong> и его функцию <code>match_df()</code> для вычистки датафрейма с помощью <em>словаря вычистки</em>.</p>
<ol type="1">
<li>Создайте словарь вычистки с 3 столбцами:
<ul>
<li>столбец “из” (неправильное значение)<br>
</li>
<li>столбец “в” (правильное значение)<br>
</li>
<li>столбец, указывающий столбец, к которому применяются изменения (или “.global”, чтобы применить ко всем столбцам)</li>
</ul></li>
</ol>
<p>Примечание: записи в словаре для конкретного столбца будут превалировать над записями в словаре .global.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/cleaning_dict.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="../images/cleaning_dict.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Импортируйте файл со словарем в R. Этот пример можно скачать, следуя инструкциям на странице <a href="../new_pages/data_used.ru.html">Скачивание руководства и данных</a>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>cleaning_dict <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"cleaning_dict.csv"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Поставьте сырой постройчный список в функцию <code>match_df()</code>, уточнив <code>dictionary =</code> датафрейм словаря вычистки. Аргумент <code>from =</code> должен указывать на имя столбца словаря, в котором содержатся “старые значения”, аргумент <code>by =</code> должен быть столбцом словаря, в котором содержатся соответствующие “новые” значения, а третий столбец указывает столбец, в котором необходимо проводить изменение. Используйте <code>.global</code> в столбце <code>by =</code>, чтобы применить изменение ко всем столбцам. Четвертый столбец словаря <code>order</code> может быть использован для уточнения порядка факторов новых значений.</li>
</ol>
<p>Дополнительные детали можно прочитать в <a href="https://cran.r-project.org/web/packages/matchmaker/vignettes/intro.html">документации по пакету</a>, выполнив <code>?match_df</code>. Обратите внимание, что эта функция может потребовать длительного времени выполнения для большого набора данных.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>     <span class="co"># укажите или поставьте в канал ваш набор данных</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>     matchmaker<span class="sc">::</span><span class="fu">match_df</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">dictionary =</span> cleaning_dict,  <span class="co"># имя вашего словаря</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">from =</span> <span class="st">"from"</span>,               <span class="co"># столбец со значениям, которые нужно заменить (по умолчанию столбец 1)</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">to =</span> <span class="st">"to"</span>,                   <span class="co"># столбец с итоговыми значениями (по умолчанию столбец 2)</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="st">"col"</span>                   <span class="co"># столбец с названиями столбцов (по умолчанию столбец 3)</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Теперь пролистайте вправо, чтобы увидеть, как изменились значения - особенно <code>gender</code> (со строчных на заглавные), а все столбцы с симптомами были трансформированы из yes/no в 1/0.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-edebbf84706a5a3651b6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-edebbf84706a5a3651b6">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1.407024e+12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["M","F","M","F","M","F","F","F","M","F","M","M","M","F","F","M","F","F","F","F","M","M","F","M","F","M","M","F","M","F","F","F","M","M","F","M","F","F","F","M","F","M","F","M","M","F","M","F","M","M"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","0","0","0","0","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","1","0",null,"0","0","0","1","0",null,"0","0","1",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","1","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","1","1","1","1","1","1","1","1","1",null,"1","1","1","1","1",null,"1","1","1",null,null,"1","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","1","1","1","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","1","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"1","1",null,"0","0",null,"0","0","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","0","1","0","0","0","1","0","0","0",null,"0","1","0","0","0",null,"0","0","0",null,null,"0","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","0","1","1","1",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>age_years<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,13,15,16,17,23,25,26]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"hospital","targets":8},{"name":"lon","targets":9},{"name":"lat","targets":10},{"name":"infector","targets":11},{"name":"source","targets":12},{"name":"age","targets":13},{"name":"age_unit","targets":14},{"name":"wt_kg","targets":15},{"name":"ht_cm","targets":16},{"name":"ct_blood","targets":17},{"name":"fever","targets":18},{"name":"chills","targets":19},{"name":"cough","targets":20},{"name":"aches","targets":21},{"name":"vomit","targets":22},{"name":"temp","targets":23},{"name":"time_admission","targets":24},{"name":"bmi","targets":25},{"name":"age_years","targets":26}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Обратите внимание, что ваши имена столбцов в словаре вычистки должны соответствовать именам столбцов в вашем скрипте вычистки <em>на данный момент</em>. См. <a href="https://www.repidemicsconsortium.org/linelist/reference/clean_data.html">онлайн ссылку для пакета по построчным спискам</a> для получения дополнительной информации.</p>
<section id="добавление-в-цепочку-канала-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="добавление-в-цепочку-канала-1">Добавление в цепочку канала</h4>
<p><strong>Ниже в цепочку канала добавляются некоторые новые столбцы и проводятся преобразования столбцов.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ЦЕПОЧКА КАНАЛА ВЫЧИСТКИ (начинается с сырых данных, которые передаются по шагам вычистки)</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># начало цепочки канала вычистки</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># стандартизируем синтаксис имен столбцов</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># переименовываем столбцы вручную</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># удаляем столбцы</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># дедупликация</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># добавляем столбец</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># конвертируем класс столбцов</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>), as.Date), </span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># добавляем столбец: задержка госпитализации</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>   <span class="co"># ВЫШЕ ПОКАЗАНЫ РАНЕЕ ПРОДЕЛАННЫЕ И ПРЕДСТАВЛЕННЫЕ ШАГИ ВЫЧИСТКИ</span></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>   <span class="do">###################################################</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># чистые значения столбца hospital</span></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hospital"</span> <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Military Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Port Hopital"</span>      <span class="ot">=</span> <span class="st">"Port Hospital"</span>,</span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Central Hopital"</span>   <span class="ot">=</span> <span class="st">"Central Hospital"</span>,</span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"other"</span>             <span class="ot">=</span> <span class="st">"Other"</span>,</span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">"Missing"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># создаем столбец age_years (из age и age_unit)</span></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">"years"</span> <span class="sc">~</span> age,</span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">"months"</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age,</span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
</section>
</section>
<section id="num_cats" class="level2" data-number="8.9">
<h2 data-number="8.9" class="anchored" data-anchor-id="num_cats"><span class="header-section-number">8.9</span> Числовые категории</h2>
<p>Здесь мы опишем некоторые особые подходы к созданию категорий из числовых столбцов. Частые примеры включают возрастные категории, группы лабораторных результатов и т.п. Здесь мы обсудим:</p>
<ul>
<li><code>age_categories()</code>, из пакета <strong>epikit</strong><br>
</li>
<li><code>cut()</code>, из <strong>базового</strong> R<br>
</li>
<li><code>case_when()</code><br>
</li>
<li>квантильные разбивки с помощью <code>quantile()</code> и <code>ntile()</code></li>
</ul>
<section id="обзор-распределения" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="обзор-распределения">Обзор распределения</h3>
<p>Для данного примера мы создадим столбец <code>age_cat</code>, используя столбец <code>age_years</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># проверьте класс переменной возраста в linelist</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>age_years)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Сначала рассмотрим распределение ваших данных, чтобы определить соответствующие пороговые точки. См. страницу <a href="ggplot_basics.qmd">основы ggplot</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># рассмотрим распределение</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(linelist<span class="sc">$</span>age_years)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="cleaning.ru_files/figure-html/unnamed-chunk-69-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="cleaning.ru_files/figure-html/unnamed-chunk-69-1.png" style="height:50.0%" width="672" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(linelist<span class="sc">$</span>age_years, <span class="at">na.rm=</span>T)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00    6.00   13.00   16.04   23.00   84.00     107 </code></pre>
</div>
</div>
<p><span style="color: orange;"><strong><em>ВНИМАНИЕ:</em></strong> Иногда числовые переменные импортируются как “текстовый” класс. Это происходит, если в каких-то значениях имеются нечисловые символы, например, запись возраста как “2 месяца” или (в зависимости от настроек вашего региона в R), если вместо точки используется запятая в десятичных числах (например, “4,5” как четыре с половиной года)..</span></p>
<!-- ======================================================= -->
</section>
<section id="age_categories" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="age_categories"><code>age_categories()</code></h3>
<p>С пакетом <strong>epikit</strong> вы можете использовать функцию <code>age_categories()</code>, чтобы легким образом разделить на категории и промаркировать числовые столбцы (примечание: эту функцию можно применить и к невозрастным числовым переменным). В качестве бонуса, получившийся столбец автоматически будет являться упорядоченным фактором.</p>
<p>Вот несколько требуемых входных данных:</p>
<ul>
<li>Числовой вектор (столбец)<br>
</li>
<li>Аргумент <code>breakers =</code> - предоставляет числовой вектор точек разрыва на новые группы</li>
</ul>
<p>Для начала самый простой пример:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Простой пример</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(epikit)                    <span class="co"># загружаем пакеты</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(             <span class="co"># создаем новый столбец</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>      age_years,                            <span class="co"># числовой столбец, из которого будут сделаны группы</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>,        <span class="co"># точки разрыва</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>)))</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># показать таблицу</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-69   70+  &lt;NA&gt; 
 1227  1223  1048   827  1216   597   251    78    27     7   107 </code></pre>
</div>
</div>
<p>Значения точек разрыва, которые вы указываете, по умолчанию будут нижними порогами - т.е. они включаются в “более высокую” группу / группы “открыты” с нижней/левой стороны. Как показано ниже, вы можете добавить 1 к каждому значению разрыва, чтобы создать группы, которые будут открыты сверху/справа.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Включаем верхние границы для тех же категорий</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>      age_years, </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">31</span>, <span class="dv">41</span>, <span class="dv">51</span>, <span class="dv">61</span>, <span class="dv">71</span>)))</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># показать таблицу</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0-5  6-10 11-15 16-20 21-30 31-40 41-50 51-60 61-70   71+  &lt;NA&gt; 
 1469  1195  1040   770  1149   547   231    70    24     6   107 </code></pre>
</div>
</div>
<p>Вы можете скорректировать то, как будут отображаться подписи с помощью <code>separator =</code>. По умолчанию ставится “-”</p>
<p>Вы можете скорректировать обращение с верхними цифрами с помощью аргумента <code>ceiling =</code>. Чтобы задать верхний разрыв установите <code>ceiling = TRUE</code>. В таком случае будет предоставлено самое высокое значение разрыва, которое будет “потолком” и не будет создаваться категория “XX+”. Любые значения выше наивысшего разрыва (или <code>upper =</code>, если он определен) будут категоризироваьтся как <code>NA</code>. Ниже представлен пример, где <code>ceiling = TRUE</code>, поэтому нет категории XX+ и значениям выше 70 (самое высокое значение разрыва) присваивается значение NA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># устанавливаем потолок на TRUE (ИСТИНА)</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>      age_years, </span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>),</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">ceiling =</span> <span class="cn">TRUE</span>)) <span class="co"># 70 - это потолок, все, что выше, становится NA</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># показать таблицу</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-70  &lt;NA&gt; 
 1227  1223  1048   827  1216   597   251    78    28   113 </code></pre>
</div>
</div>
<p>Альтернативно вместо <code>breakers =</code> вы можете предоставить все значения для <code>lower =</code>, <code>upper =</code>, и <code>by =</code>:</p>
<ul>
<li><code>lower =</code> самое нижнее число, которое вы хотите рассмотреть - по умолчанию 0<br>
</li>
<li><code>upper =</code> самое верхнее число, которое вы хотите рассмотреть<br>
</li>
<li><code>by =</code> количество лет между группами</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>      age_years, </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="dv">100</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="dv">10</span>))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># показать таблицу</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0-9 10-19 20-29 30-39 40-49 50-59 60-69 70-79 80-89 90-99  100+  &lt;NA&gt; 
 2450  1875  1216   597   251    78    27     6     1     0     0   107 </code></pre>
</div>
</div>
<p>См. справку по функции для получения дополнительной информации (введите <code>?age_categories</code> в консоли R).</p>
<!-- ======================================================= -->
</section>
<section id="cut" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="cut"><code>cut()</code></h3>
<p><code>cut()</code> - это альтернатива для <code>age_categories()</code> из <strong>базового</strong> R, но, я думаю, вы увидите, почему была разработана функция <code>age_categories()</code> для упрощения процесса. Некоторые заметные различия от <code>age_categories()</code> включают:</p>
<ul>
<li>Вам не нужно устанавливать/загружать другой пакет<br>
</li>
<li>Вы можете уточнить, будут ли группы открыты/закрыты справа/слева<br>
</li>
<li>Вы можете сами задать точные подписи<br>
</li>
<li>Если вы хотите, чтобы 0 был включен в самую нижнюю группу, вы должны это указать</li>
</ul>
<p>Базовый синтаксис внутри <code>cut()</code> - сначала задать числовой столбец, который нужно вырезать (<code>age_years</code>), и затем аргумент с <em>разрывами</em>, который является числовым вектором <code>c()</code> разрывов. При использовании <code>cut()</code>, получившийся в результате столбец будет упорядоченным фактором.</p>
<p>По умолчанию разделение на категории происходит таким образом, что правая/верхняя сторона является “открытой” и инклюзивной (а левая/нижняя сторона является “закрытой” или исключающей). Это поведение, противоположное функции <code>age_categories()</code>. По умолчанию подписи используют запись “(A, B]”, что означает, что A не включается, а B включается. <strong>Вы можете задать обратное поведение, указав аргумент <code>right = TRUE</code></strong>.</p>
<p>Таким образом, по умолчанию, значения “0” исключаются из самой нижней группы и категоризируются как <code>NA</code>! Значения “0” могут включать младенцев, закодированных как возраст 0, так что будьте осторожны! Чтобы это изменить, добавьте аргумент <code>include.lowest = TRUE</code>, чтобы любые значения с “0” включались в самую нижнюю группу. Автоматически сгенерированная подпись для самой нижней категории тогда будет “[A],B]”. Обратите внимание, что если вы включите аргумент <code>include.lowest = TRUE</code> <strong>и</strong> <code>right = TRUE</code>, экстремальное включение теперь будет применяться к <em>наивысшему</em> значению разрыва и категории, а не к самой нижней.</p>
<p>Вы можете задать вектор пользовательских подписей, используя аргумент <code>labels =</code>. Так как они записываются вручную, убедитесь, что они записаны правильно” Проверьте свою работу, используя кросс-табуляцию, как описано ниже.</p>
<p>В качестве примера применим <code>cut()</code> к <code>age_years</code>, чтобы создать новую переменную <code>age_cat</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Создаем новую переменную, разделив числовую переменную возраста</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># нижний разрыв исключается, а верхний разрыв включен в каждую категорию</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">cut</span>(</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>      age_years,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span>         <span class="co"># включаем 0 в самую нижнюю группу</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="co"># подсчитываем количество наблюдений в каждой группе</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   [0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50]  (50,70] (70,100] 
    1469     1195     1040      770     1149      778       94        6 
    &lt;NA&gt; 
     107 </code></pre>
</div>
</div>
<p><strong>Проверьте свою работу!!!</strong> Проверьте, что каждое значение возраста было распределено в правильную категорию, проведя кросс-табуляцию числовых и категориальных столбцов. Рассмотрите присвоение пограничных значений (например, 15, если соседние категории включают 10-15 и 16-20).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Кросс-табуляция числовыъ и категориальных столбцов. </span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="st">"Numeric Values"</span> <span class="ot">=</span> linelist<span class="sc">$</span>age_years,   <span class="co"># имена, указанные в таблице для ясности.</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Categories"</span>     <span class="ot">=</span> linelist<span class="sc">$</span>age_cat,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">useNA =</span> <span class="st">"always"</span>)                        <span class="co"># не забудьте проверить значения NA</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Categories
Numeric Values       [0,5] (5,10] (10,15] (15,20] (20,30] (30,50] (50,70]
  0                    136      0       0       0       0       0       0
  0.0833333333333333     1      0       0       0       0       0       0
  0.25                   2      0       0       0       0       0       0
  0.333333333333333      6      0       0       0       0       0       0
  0.416666666666667      1      0       0       0       0       0       0
  0.5                    6      0       0       0       0       0       0
  0.583333333333333      3      0       0       0       0       0       0
  0.666666666666667      3      0       0       0       0       0       0
  0.75                   3      0       0       0       0       0       0
  0.833333333333333      1      0       0       0       0       0       0
  0.916666666666667      1      0       0       0       0       0       0
  1                    275      0       0       0       0       0       0
  1.5                    2      0       0       0       0       0       0
  2                    308      0       0       0       0       0       0
  3                    246      0       0       0       0       0       0
  4                    233      0       0       0       0       0       0
  5                    242      0       0       0       0       0       0
  6                      0    241       0       0       0       0       0
  7                      0    256       0       0       0       0       0
  8                      0    239       0       0       0       0       0
  9                      0    245       0       0       0       0       0
  10                     0    214       0       0       0       0       0
  11                     0      0     220       0       0       0       0
  12                     0      0     224       0       0       0       0
  13                     0      0     191       0       0       0       0
  14                     0      0     199       0       0       0       0
  15                     0      0     206       0       0       0       0
  16                     0      0       0     186       0       0       0
  17                     0      0       0     164       0       0       0
  18                     0      0       0     141       0       0       0
  19                     0      0       0     130       0       0       0
  20                     0      0       0     149       0       0       0
  21                     0      0       0       0     158       0       0
  22                     0      0       0       0     149       0       0
  23                     0      0       0       0     125       0       0
  24                     0      0       0       0     144       0       0
  25                     0      0       0       0     107       0       0
  26                     0      0       0       0     100       0       0
  27                     0      0       0       0     117       0       0
  28                     0      0       0       0      85       0       0
  29                     0      0       0       0      82       0       0
  30                     0      0       0       0      82       0       0
  31                     0      0       0       0       0      68       0
  32                     0      0       0       0       0      84       0
  33                     0      0       0       0       0      78       0
  34                     0      0       0       0       0      58       0
  35                     0      0       0       0       0      58       0
  36                     0      0       0       0       0      33       0
  37                     0      0       0       0       0      46       0
  38                     0      0       0       0       0      45       0
  39                     0      0       0       0       0      45       0
  40                     0      0       0       0       0      32       0
  41                     0      0       0       0       0      34       0
  42                     0      0       0       0       0      26       0
  43                     0      0       0       0       0      31       0
  44                     0      0       0       0       0      24       0
  45                     0      0       0       0       0      27       0
  46                     0      0       0       0       0      25       0
  47                     0      0       0       0       0      16       0
  48                     0      0       0       0       0      21       0
  49                     0      0       0       0       0      15       0
  50                     0      0       0       0       0      12       0
  51                     0      0       0       0       0       0      13
  52                     0      0       0       0       0       0       7
  53                     0      0       0       0       0       0       4
  54                     0      0       0       0       0       0       6
  55                     0      0       0       0       0       0       9
  56                     0      0       0       0       0       0       7
  57                     0      0       0       0       0       0       9
  58                     0      0       0       0       0       0       6
  59                     0      0       0       0       0       0       5
  60                     0      0       0       0       0       0       4
  61                     0      0       0       0       0       0       2
  62                     0      0       0       0       0       0       1
  63                     0      0       0       0       0       0       5
  64                     0      0       0       0       0       0       1
  65                     0      0       0       0       0       0       5
  66                     0      0       0       0       0       0       3
  67                     0      0       0       0       0       0       2
  68                     0      0       0       0       0       0       1
  69                     0      0       0       0       0       0       3
  70                     0      0       0       0       0       0       1
  72                     0      0       0       0       0       0       0
  73                     0      0       0       0       0       0       0
  76                     0      0       0       0       0       0       0
  84                     0      0       0       0       0       0       0
  &lt;NA&gt;                   0      0       0       0       0       0       0
                    Categories
Numeric Values       (70,100] &lt;NA&gt;
  0                         0    0
  0.0833333333333333        0    0
  0.25                      0    0
  0.333333333333333         0    0
  0.416666666666667         0    0
  0.5                       0    0
  0.583333333333333         0    0
  0.666666666666667         0    0
  0.75                      0    0
  0.833333333333333         0    0
  0.916666666666667         0    0
  1                         0    0
  1.5                       0    0
  2                         0    0
  3                         0    0
  4                         0    0
  5                         0    0
  6                         0    0
  7                         0    0
  8                         0    0
  9                         0    0
  10                        0    0
  11                        0    0
  12                        0    0
  13                        0    0
  14                        0    0
  15                        0    0
  16                        0    0
  17                        0    0
  18                        0    0
  19                        0    0
  20                        0    0
  21                        0    0
  22                        0    0
  23                        0    0
  24                        0    0
  25                        0    0
  26                        0    0
  27                        0    0
  28                        0    0
  29                        0    0
  30                        0    0
  31                        0    0
  32                        0    0
  33                        0    0
  34                        0    0
  35                        0    0
  36                        0    0
  37                        0    0
  38                        0    0
  39                        0    0
  40                        0    0
  41                        0    0
  42                        0    0
  43                        0    0
  44                        0    0
  45                        0    0
  46                        0    0
  47                        0    0
  48                        0    0
  49                        0    0
  50                        0    0
  51                        0    0
  52                        0    0
  53                        0    0
  54                        0    0
  55                        0    0
  56                        0    0
  57                        0    0
  58                        0    0
  59                        0    0
  60                        0    0
  61                        0    0
  62                        0    0
  63                        0    0
  64                        0    0
  65                        0    0
  66                        0    0
  67                        0    0
  68                        0    0
  69                        0    0
  70                        0    0
  72                        1    0
  73                        3    0
  76                        1    0
  84                        1    0
  &lt;NA&gt;                      0  107</code></pre>
</div>
</div>
<p><strong>Смена подписи значений <code>NA</code></strong></p>
<p>Вам может потребоваться присвоить значениям <code>NA</code> подпись, например, “Missing” (отсутствует). Поскольку новый столбец относится к классу Фактор (ограниченные значения), вы не можете просто использовать <code>replace_na()</code>, поскольку это значение будет отклонено. Вместо этого используйте <code>fct_explicit_na()</code> из пакета <strong>forcats</strong>, как объясняется на странице <a href="../new_pages/factors.ru.html">Факторы</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cut() создает age_cat, автоматически в классе Фактор      </span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_cat =</span> <span class="fu">cut</span>(</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    age_years,</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),          </span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,        </span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70-100"</span>)),</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># делает отсутствующие значения явными</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">fct_explicit_na</span>(</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>      age_cat,</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">na_level =</span> <span class="st">"Missing age"</span>)  <span class="co"># вы можете задать подпись</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  )    </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `age_cat = fct_explicit_na(age_cat, na_level = "Missing age")`.
Caused by warning:
! `fct_explicit_na()` was deprecated in forcats 1.0.0.
ℹ Please use `fct_na_value_to_level()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># таблица для просмотра подсчета</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        0-4         5-9       10-14       15-19       20-29       30-49 
       1227        1223        1048         827        1216         848 
      50-69      70-100 Missing age        &lt;NA&gt; 
        105           7         107           0 </code></pre>
</div>
</div>
<p><strong>Быстрое создание разрывов и подписей</strong></p>
<p>Для быстрого создания разрывов и векторов подписей можно использовать код ниже. См. страницу <a href="../new_pages/basics.ru.html">Основы R</a> для получения информации о <code>seq()</code> и <code>rep()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Создание разрывов от 0 до 90 с шагом 5</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>age_seq</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Создание подписей для созданных выше категорий, предполагая настройки cut() по умолчанию</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>age_labels <span class="ot">=</span> <span class="fu">paste0</span>(age_seq <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"-"</span>, age_seq <span class="sc">+</span> <span class="dv">5</span>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>age_labels</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Проверьте, что оба вектора имеют одинаковую длину</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(age_seq) <span class="sc">==</span> <span class="fu">length</span>(age_labels)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Более подробно о <code>cut()</code> можно прочитать на странице Справки, введя <code>?cut</code> в консоли R.</p>
</section>
<section id="разрывы-по-квантилям" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="разрывы-по-квантилям">Разрывы по квантилям</h3>
<p>Как правило, “квантили” или “процентили” означают значение, ниже которого находится определенная доля значений. Например, 95-й процентиль возрастов в <code>linelist</code> будет возраст, ниже которого находится 95% всех возрастов.</p>
<p>Однако в простой речи “квартили” и “децили” могут также означать <em>группы данных</em>, равномерно разделенных на 4 или 10 групп (обратите внимание, будет на один разрыв больше, чем групп).</p>
<p>Чтобы получить разрывы по квантилям, можете использовать <code>quantile()</code> из пакета <strong>stats</strong> из <strong>базового</strong> R. Вы задаете числовой вектор (например, столбец в наборе данных) и вектор значений числовой вероятности, варьирующихся от 0 до 1.0. Разрывы будут выданы как числовой вектор. Детали статистической методологии можно изучить, введя <code>?quantile</code>.</p>
<ul>
<li>Если у вашего входного числового вектора есть какие-то отсутствующие значения, лучше установить <code>na.rm = TRUE</code><br>
</li>
<li>Задайте <code>names = FALSE</code>, чтобы получить неименованный числовой вектор</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(linelist<span class="sc">$</span>age_years,               <span class="co"># укажите числовой вектор, с которым надо работать</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">25</span>, .<span class="dv">50</span>, .<span class="dv">75</span>, .<span class="dv">90</span>, .<span class="dv">95</span>),   <span class="co"># укажите, какие процентили вам нужны</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)                            <span class="co"># игнорировать отсутствующие значения </span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 0% 25% 50% 75% 90% 95% 
  0   6  13  23  33  41 </code></pre>
</div>
</div>
<p>Вы можете использовать результаты <code>quantile()</code> в качестве разрывов в <code>age_categories()</code> или <code>cut()</code>. Ниже мы создаем новый столбец <code>deciles</code>, используя <code>cut()</code>, где разрывы задаются с использованием <code>quantiles()</code> для <code>age_years</code>. Ниже мы отображаем результаты, используя <code>tabyl()</code> из пакета <strong>janitor</strong>, чтобы вы могли увидеть проценты (см. страницу <a href="../new_pages/tables_descriptive.ru.html">Описательные таблицы</a>). Обратите внимание, что они не составляют точно 10% в каждой группе.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                                <span class="co"># начинаем с построчного списка</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deciles =</span> <span class="fu">cut</span>(age_years,           <span class="co"># создаем новый столбец decile через cut() по столбцу age_years</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">quantile</span>(                      <span class="co"># определяем разрывы, используя quantile()</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>      age_years,                               <span class="co"># операция для age_years</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),             <span class="co"># от 0.0 до 1.0 с шагом 0.1</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>),                           <span class="co"># игнорировать отсутствующие значения</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>             <span class="co"># для cut() включите возраст 0</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(deciles)                   <span class="co"># передайте по каналу для создания таблицы для отображения</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> deciles   n    percent valid_percent
   [0,2] 748 0.11319613    0.11505922
   (2,5] 721 0.10911017    0.11090601
   (5,7] 497 0.07521186    0.07644978
  (7,10] 698 0.10562954    0.10736810
 (10,13] 635 0.09609564    0.09767728
 (13,17] 755 0.11425545    0.11613598
 (17,21] 578 0.08746973    0.08890940
 (21,26] 625 0.09458232    0.09613906
 (26,33] 596 0.09019370    0.09167820
 (33,84] 648 0.09806295    0.09967697
    &lt;NA&gt; 107 0.01619249            NA</code></pre>
</div>
</div>
</section>
<section id="группы-равного-размера" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="группы-равного-размера">Группы равного размера</h3>
<p>Еще один инструмент для создания числовых групп - функция <code>ntile()</code> из пакета <strong>dplyr</strong>, которая попробует разбить ваши данные на n <em>групп равного размера</em> - <em>но помните, что в отличие от <code>quantile()</code>, одно и то же значение может появиться в нескольких группах.</em> Задайте числовой вектор и затем количество групп. Значения в новом созданном столбце - просто “номера” групп (например, от 1 до 10), а не диапазон самих значений, как при использовании <code>cut()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем группы с помощью ntile()</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>ntile_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">even_groups =</span> <span class="fu">ntile</span>(age_years, <span class="dv">10</span>))</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co"># создаем таблицу с подсчетом количества и пропорциями по группам</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>ntile_table <span class="ot">&lt;-</span> ntile_data <span class="sc">%&gt;%</span> </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(even_groups)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co"># присваиваем мин/макс значения, чтобы продемонстрировать диапазоны</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>ntile_ranges <span class="ot">&lt;-</span> ntile_data <span class="sc">%&gt;%</span> </span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(even_groups) <span class="sc">%&gt;%</span> </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(age_years, <span class="at">na.rm=</span>T)</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `summarise()`.
The first warning was:
ℹ In argument: `min = min(age_years, na.rm = T)`.
ℹ In group 11: `even_groups = NA`.
Caused by warning in `min()`:
! no non-missing arguments to min; returning Inf
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># объединяем и печатаем - обратите внимание, что значения присутствуют в нескольких группах</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(ntile_table, ntile_ranges, <span class="at">by =</span> <span class="st">"even_groups"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> even_groups   n    percent valid_percent min  max
           1 651 0.09851695    0.10013844   0    2
           2 650 0.09836562    0.09998462   2    5
           3 650 0.09836562    0.09998462   5    7
           4 650 0.09836562    0.09998462   7   10
           5 650 0.09836562    0.09998462  10   13
           6 650 0.09836562    0.09998462  13   17
           7 650 0.09836562    0.09998462  17   21
           8 650 0.09836562    0.09998462  21   26
           9 650 0.09836562    0.09998462  26   33
          10 650 0.09836562    0.09998462  33   84
          NA 107 0.01619249            NA Inf -Inf</code></pre>
</div>
</div>
<!-- ======================================================= -->
</section>
<section id="case_when" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="case_when"><code>case_when()</code></h3>
<p>Можно использовать функцию <code>case_when()</code> из <strong>dplyr</strong> для создания категорий из числового столбца, но легче использовать <code>age_categories()</code> из <strong>epikit</strong> или <code>cut()</code>, поскольку они автоматически создадут упорядоченный фактор.</p>
<p>При использовании <code>case_when()</code>, пожалуйста, проверьте правильность использования, как описывалось выше в разделе по перекодированию данной страницы. Также помните, что значения в правой стороне должны быть одного класса. Так что, если вы хотите видеть <code>NA</code> справа, вам следует написать “Missing” или использовать специальное значение <code>NA</code> в виде <code>NA_character_</code>.</p>
</section>
<section id="добавление-в-цепочку-канала-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="добавление-в-цепочку-канала-2">Добавление в цепочку канала</h3>
<p>Ниже код для создания двух категориальных столбцов возраста добавляется в цепочку канала вычистки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ЦЕПОЧКА КАНАЛА ВЫЧИСТКИ (начинается с сырых данных, которые передаются по шагам вычистки)</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># начало цепочки канала вычистки</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># стандартизируем синтаксис имен столбцов</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># переименовываем столбцы вручную</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># удаляем столбцы</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># дедупликация</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># добавляем столбец</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># конвертируем класс столбцов</span></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>), as.Date), </span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># добавляем столбец: задержка госпитализации</span></span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># чистые значения столбца hospital</span></span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># СТАРОЕ = НОВОЕ</span></span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hospital"</span> <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Military Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Port Hopital"</span>      <span class="ot">=</span> <span class="st">"Port Hospital"</span>,</span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Central Hopital"</span>   <span class="ot">=</span> <span class="st">"Central Hospital"</span>,</span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"other"</span>             <span class="ot">=</span> <span class="st">"Other"</span>,</span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">"Missing"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># создаем столбец age_years (из age и age_unit)</span></span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">"years"</span> <span class="sc">~</span> age,</span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">"months"</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age)) <span class="sc">%&gt;%</span> </span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ВЫШЕ ПОКАЗАНЫ РАНЕЕ ПРОДЕЛАННЫЕ И ПРЕДСТАВЛЕННЫЕ ШАГИ ВЫЧИСТКИ</span></span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>    <span class="do">###################################################   </span></span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>          <span class="co"># возрастные категории: пользовательские</span></span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a>          <span class="co"># возрастные категории: от 0 до 85 по 5 лет</span></span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat5 =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>)))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ======================================================= -->
</section>
</section>
<section id="добавление-строк" class="level2" data-number="8.10">
<h2 data-number="8.10" class="anchored" data-anchor-id="добавление-строк"><span class="header-section-number">8.10</span> Добавление строк</h2>
<section id="по-одной" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="по-одной">По одной</h3>
<p>Добавление строк вручную по одной является трудоемким процессом, но это можно сделать с помощью <code>add_row()</code> из пакета <strong>dplyr</strong>. Помните, что каждый столбец должен содержать значения только из одного класса (либо текстовые, либо числовые, либо логические и т.п.). Поэтому добавление строки требует определенных нюансов для сохранения этой структуры.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">row_num =</span> <span class="dv">666</span>,</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">case_id =</span> <span class="st">"abc"</span>,</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">generation =</span> <span class="dv">4</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">infection date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2020-10-10"</span>),</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">.before =</span> <span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Используйте <code>.before</code> и <code>.after.</code> для уточнения места размещения добавляемой строки. <code>.before = 3</code> разместит новую строку перед текущей 3-й строкой. По умолчанию строка добавляется в конце. Не уточненные столбцы останутся пустыми (<code>NA</code>).</p>
<p>Новый <em>номер строки</em> может выглядеть странно (“…23”) но номера строк ранее существовавших строк <em>изменились</em>. Поэтому если вы дважды используете команду, внимательно рассмотрите/протестируйте вставку.</p>
<p>Если класс, который вы задаете, не сходится, возникнет такое сообщение об ошибке:</p>
<pre><code>Error: Can't combine ..1$infection date &lt;date&gt; and ..2$infection date &lt;character&gt;</code></pre>
<p>(При вставке строки со значением даты, помните, что нужно дату нужно указать в функции <code>as.Date()</code>, например, <code>as.Date("2020-10-10")</code>).</p>
</section>
<section id="связывание-строк" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="связывание-строк">Связывание строк</h3>
<p>Чтобы объединить наборы данных путем связывания строк одного датафрейма с нижней частью другого датафрейма, вы можете использовать <code>bind_rows()</code> из пакета <strong>dplyr</strong>. Это более подробно объясняется на странице <a href="../new_pages/joining_matching.ru.html">Соединение данных</a>.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
</section>
<section id="фильтрация-строк" class="level2" data-number="8.11">
<h2 data-number="8.11" class="anchored" data-anchor-id="фильтрация-строк"><span class="header-section-number">8.11</span> Фильтрация строк</h2>
<p>Типичный шаг вычистки после того, как вы провели вычистку столбцов и перекодировали значения, включает <em>фильтрацию</em> датафрейма до конкретных строк, используя глагольную функцию <code>filter()</code> из пакета <strong>dplyr</strong>.</p>
<p>Внутри функции <code>filter()</code>, увкажите логику, которая должна быть истинной <code>TRUE</code>, чтобы сохранить строку в наборе данных. Ниже мы покажем, как отфильтровать строки на основе простых и сложных логических условий.</p>
<!-- ======================================================= -->
<section id="простой-фильтр" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="простой-фильтр">Простой фильтр</h3>
<p>Этот простой пример переопределяет датафрейм <code>linelist</code> как самого себя после фильтрации строк, чтобы они соответствовали логическому условию. <strong>Сохраняются только те строки, где логическое утверждение внутри скобок оценивается как истинное <code>TRUE</code>.</strong></p>
<p>В данном примере логическим утверждением является <code>gender == "f"</code>, которое проверяет, является ли значение в столбце <code>gender</code> равным “f” (чувствительно к регистру).</p>
<p>До применения фильтра количество строк в <code>linelist</code> равно <code>nrow(linelist)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">"f"</span>)   <span class="co"># сохраняются только те строки, где пол равен "f"</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>После применения фильтра количество строк в <code>linelist</code> равно <code>linelist %&gt;% filter(gender == "f") %&gt;% nrow()</code>.</p>
</section>
<section id="отфильтровывание-отсутствующих-значений" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="отфильтровывание-отсутствующих-значений">Отфильтровывание отсутствующих значений</h3>
<p>Достаточно часто нужно отфильтровывать строки, в которых имеются отсутствующие значения. Не поддавайтесь желанию просто записать <code>filter(!is.na(column) &amp; !is.na(column))</code>, а вместо этого используйте функцию <strong>tidyr</strong>, которая специально создана для этой цели: <code>drop_na()</code>. При выполнении с пустыми скобками она удаляет строки с <em>любыми</em> отсутствующими значениями. Альтернативно, вы можете указать имена конкретных столбцов, которые надо оценить на предмет отсутствия значений, либо использовать функции-помощники “tidyselect”, описанные <a href="#clean_tidyselect">выше</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(case_id, age_years)  <span class="co"># удаляет строки с отсутствующими значениями в case_id или age_years</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>См. страницу <a href="../new_pages/missing_data.ru.html">Отсутствующие данные</a>, где показаны многие приемы для анализа и управления отсутствующими значениями в ваших данных.</p>
</section>
<section id="фильтр-по-номеру-строки" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="фильтр-по-номеру-строки">Фильтр по номеру строки</h3>
<p>В датафрейме или таблице tibble у каждой строки, как правило, будет “номер строки”, который (при просмотре в окне просмотра R Viewer) появляется слева от первого столбца. Этот номер сам по себе не является истинным столбцом данных, но он может быть использован в утверждении для <code>filter()</code>.</p>
<p>Чтобы отфильтровать по “номеру строки”, вы можете использовать функцию <code>row_number()</code> из <strong>dplyr</strong> с открытыми скобками, как часть логического утверждения для фильтрации. Часто нужно использовать оператор <code>%in%</code> и диапазон чисел как часть логического утверждения, как показано ниже. Чтобы увидеть <em>первое</em> N количество строк, вы можете также использовать специальную функцию из <strong>dplyr</strong> <code>head()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Просмотр первых 100 строк</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">100</span>)     <span class="co"># или используйте tail(), чтобы просмотреть последнее n количество строк</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Показать только 5 строку</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">5</span>)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Просмотреть строки с 2 по 20, а также три конкретных столбца</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(date_onset, outcome, age)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вы также можете конвертировать номера строк в истинный столбец, передав ваш датафрейм в функцию <strong>tibble</strong> <code>rownames_to_column()</code> (ничего не пишите в скобках).</p>
<!-- ======================================================= -->
</section>
<section id="сложный-фильтр" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="сложный-фильтр">Сложный фильтр</h3>
<p>Можно выстроить более сложные логические утверждения с использованием скобок <code>( )</code>, операторов ИЛИ <code>|</code>, отрицание <code>!</code>, <code>%in%</code>, а также И <code>&amp;</code>. Пример приведен ниже:</p>
<p>Примечание: Вы можете использовать оператор <code>!</code> перед логическим критериями, чтобы их отрицать. Например, <code>!is.na(column)</code> оценивает как истину, если значения столбца <em>не</em> отсутствует. Аналогично, <code>!column %in% c("a", "b", "c")</code> оценивает как истину, если значение столбца <em>не является</em> вектором.</p>
<section id="рассмотрение-данных" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="рассмотрение-данных">Рассмотрение данных</h4>
<p>Ниже представлена простая команда из одной строки для создания гистограммы даты заболевания. Обратите внимание, что вторая более мелкая вспышка 2012-2013 гг. также включена в этот сырой набор данных. <strong>Для нашего анализа нам нужно удалить записи по этой более ранней вспышке.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(linelist<span class="sc">$</span>date_onset, <span class="at">breaks =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="cleaning.ru_files/figure-html/unnamed-chunk-87-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="cleaning.ru_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="как-фильтры-работают-с-отсутствующими-числовыми-значениями-и-датами" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="как-фильтры-работают-с-отсутствующими-числовыми-значениями-и-датами">Как фильтры работают с отсутствующими числовыми значениями и датами</h4>
<p>Можем ли мы просто отфильтровать по <code>date_onset</code> до строк только после июня 2013? <strong>Внимание! Применение кода <code>filter(date_onset &gt; as.Date("2013-06-01")))</code> удалит строки в более поздней эпидемии с отсутствующей датой заболевания!</strong></p>
<p><span style="color: red;"><strong><em>ВНИМАНИЕ:</em></strong> Фильтра по больше чем (&gt;) или меньше чем (&lt;) дата или число может удалить любые строки с отсутствующими значениями (<code>NA</code>)! Это происходит потому, что <code>NA</code> рассматривается как бесконечно большое или малое число.</span></p>
<p><em>(См. страницу <a href="../new_pages/dates.ru.html">Работа с датами</a> для получения более детальной информации о работе с датами и пакете <strong>lubridate</strong>)</em></p>
</section>
<section id="дизайн-фильтра" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="дизайн-фильтра">Дизайн фильтра</h4>
<p>Рассмотрите кросс-табуляцию, чтобы убедиться, что мы исключили только нужные строки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Hospital  =</span> linelist<span class="sc">$</span>hospital,                     <span class="co"># название больницы</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">YearOnset =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(linelist<span class="sc">$</span>date_onset),  <span class="co"># год в date_onset</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">useNA     =</span> <span class="st">"always"</span>)                              <span class="co"># показать отсутствующие значения</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      YearOnset
Hospital                               2012 2013 2014 2015 &lt;NA&gt;
  Central Hospital                        0    0  351   99   18
  Hospital A                            229   46    0    0   15
  Hospital B                            227   47    0    0   15
  Military Hospital                       0    0  676  200   34
  Missing                                 0    0 1117  318   77
  Other                                   0    0  684  177   46
  Port Hospital                           9    1 1372  347   75
  St. Mark's Maternity Hospital (SMMH)    0    0  322   93   13
  &lt;NA&gt;                                    0    0    0    0    0</code></pre>
</div>
</div>
<p>По каким еще критериям мы можем отфильтровать для удаления первой вспышки (в 2012 и2013) из набора данных? Мы видим, что:</p>
<ul>
<li>Первая эпидемия в 2012 и 2013 годах произошла в больницах Hospital A, Hospital B, а также было 10 случаев в Port Hospital.<br>
</li>
<li>Больницы Hospitals A и B <em>не</em> имели случаев во второй эпидемии, а в Port Hospital они были.</li>
</ul>
<p>Мы хотим исключить:</p>
<ul>
<li><code>nrow(linelist %&gt;% filter(hospital %in% c("Hospital A", "Hospital B") | date_onset &lt; as.Date("2013-06-01")))</code> строк и началом в 2012 и 2013 в больницах hospital A, B, или Port:
<ul>
<li>Исключить <code>nrow(linelist %&gt;% filter(date_onset &lt; as.Date("2013-06-01")))</code> строк с началом в 2012 и 2013</li>
<li>Исключить <code>nrow(linelist %&gt;% filter(hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> строк из Hospitals A и B с отсутствующими датами заболевания<br>
</li>
<li><strong>Не</strong> исключать <code>nrow(linelist %&gt;% filter(!hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> других строк с отсутствующими датами заболевания.</li>
</ul></li>
</ul>
<p>Мы начинаем с пострточного списка из <code></code>nrow(linelist)` строк. Ниже представлено наше утверждение для фильтра:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># сохраняет строки, где дата заболевания после 1 июня 2013 ИЛИ где отсутствует дата заболевания и это была больница КРОМЕ Hospital A или B</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2013-06-01"</span>) <span class="sc">|</span> (<span class="fu">is.na</span>(date_onset) <span class="sc">&amp;</span> <span class="sc">!</span>hospital <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span>)))</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(linelist)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6019</code></pre>
</div>
</div>
<p>Когда мы повторно делаем кросс-табуляцию, мы видим, что Hospitals A и B были полностью удалены, также удалены 10 случаев из больницы Port Hospital от 2012 и 2013 года, а другие значения остались - как мы и хотели.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Hospital  =</span> linelist<span class="sc">$</span>hospital,                     <span class="co"># название больницы</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">YearOnset =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(linelist<span class="sc">$</span>date_onset),  <span class="co"># год date_onset</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">useNA     =</span> <span class="st">"always"</span>)                              <span class="co"># показать отсутствующие значения</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      YearOnset
Hospital                               2014 2015 &lt;NA&gt;
  Central Hospital                      351   99   18
  Military Hospital                     676  200   34
  Missing                              1117  318   77
  Other                                 684  177   46
  Port Hospital                        1372  347   75
  St. Mark's Maternity Hospital (SMMH)  322   93   13
  &lt;NA&gt;                                    0    0    0</code></pre>
</div>
</div>
<p>В одну команду фильтра можно включить несколько утверждений (отделенных запятыми), либо вы всегда можете поставить в канал отдельную команду filter() для ясности.</p>
<p><em>Примечание: некоторые читатели могут заметить, что было бы проще просто отфильтровать по <code>date_hospitalisation</code>, поскольку этот столбец заполнен на 100% без отсутствующих значений. Это верно. Но <code>date_onset</code> использовался для демонстрации сложного фильтра.</em></p>
</section>
</section>
<section id="отдельная-команда-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="отдельная-команда-1">Отдельная команда</h3>
<p>Фильтрацию можно также выполнять как отдельную команду (не как часть цепочки канала). Как и другие глагольные функции <strong>dplyr</strong>, в данном случае первым аргументом должен быть сам набор данных.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># датафрейм &lt;- фильтр(датафрейм, условие(я) для сохранения строк)</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">filter</span>(linelist, <span class="sc">!</span><span class="fu">is.na</span>(case_id))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вы можете также использовать <strong>базовый</strong> R, для выделения подмножества, используя квадратные скобки, которые отражают [строки, столбцы], которые вы хотите сохранить.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># датафрейм &lt;- датафрейм[условия строки, условия столбца] (пустое пространство означает сохранить все)</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist[<span class="sc">!</span><span class="fu">is.na</span>(case_id), ]</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="быстрое-рассмотрение-записей" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="быстрое-рассмотрение-записей">Быстрое рассмотрение записей</h3>
<p>Часто вам может быть необходимо быстро просмотреть несколько записей только по некоторым столбцам. <strong>Базовая</strong> функция R <code>View()</code> напечатает датафрейм для просмотра в RStudio.</p>
<p>Просмотр построчного списка в RStudio:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(linelist)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Здесь приведены два примера просмотра конкретных ячеек (конкретные строки и конкретные столбцы):</p>
<p><strong>С функциями dplyr <code>filter()</code> и <code>select()</code>:</strong></p>
<p>В функции <code>View()</code> передайте набор данных в функцию <code>filter()</code>, чтобы сохранить определенные строки, затем <code>select()</code> для сохранения определенных столбцов. Например, чтобы рассмотреть даты заболевания и госпитализации по 3 конкретным случаям:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(linelist <span class="sc">%&gt;%</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(case_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">select</span>(date_onset, date_hospitalisation))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вы можете сделать то же самое с синтаксисом <strong>базового</strong> R, используя квадратные скобки <code>[ ]</code>, чтобы определить подмножество, которое вы хотите видеть.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(linelist[linelist<span class="sc">$</span>case_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span>), <span class="fu">c</span>(<span class="st">"date_onset"</span>, <span class="st">"date_hospitalisation"</span>)])</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="добавление-в-цепочку-канала-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="добавление-в-цепочку-канала-3">Добавление в цепочку канала</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ЦЕПОЧКА КАНАЛА ВЫЧИСТКИ (начинается с сырых данных, которые передаются по шагам вычистки)</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co"># начало цепочки канала вычистки</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># стандартизируем синтаксис имен столбцов</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># переименовываем столбцы вручную</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>           <span class="co"># НОВОЕ имя             # СТАРОЕ имя</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># удаляем столбцы</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># дедупликация</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># добавляем столбец</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># конвертируем класс столбцов</span></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>), as.Date), </span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># добавляем столбец: задержка госпитализации</span></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># чистые значения столбца hospital</span></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># СТАРОЕ = НОВОЕ</span></span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mitylira Hospital"</span> <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Military Hopital"</span>  <span class="ot">=</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Port Hopital"</span>      <span class="ot">=</span> <span class="st">"Port Hospital"</span>,</span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Central Hopital"</span>   <span class="ot">=</span> <span class="st">"Central Hospital"</span>,</span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"other"</span>             <span class="ot">=</span> <span class="st">"Other"</span>,</span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span></span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">"Missing"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># создаем столбец age_years (из age и age_unit)</span></span>
<span id="cb128-49"><a href="#cb128-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-50"><a href="#cb128-50" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">"years"</span> <span class="sc">~</span> age,</span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">"months"</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a>          <span class="co"># возрастные категории: пользовательские</span></span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a>          <span class="co"># возрастные категории: от 0 до 85 по 5 лет</span></span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat5 =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-61"><a href="#cb128-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ВЫШЕ ПОКАЗАНЫ РАНЕЕ ПРОДЕЛАННЫЕ И ПРЕДСТАВЛЕННЫЕ ШАГИ ВЫЧИСТКИ</span></span>
<span id="cb128-62"><a href="#cb128-62" aria-hidden="true" tabindex="-1"></a>    <span class="do">###################################################</span></span>
<span id="cb128-63"><a href="#cb128-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb128-64"><a href="#cb128-64" aria-hidden="true" tabindex="-1"></a>          <span class="co"># сохраняем только строки, где case_id не отсутствует</span></span>
<span id="cb128-65"><a href="#cb128-65" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span><span class="fu">is.na</span>(case_id),  </span>
<span id="cb128-66"><a href="#cb128-66" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb128-67"><a href="#cb128-67" aria-hidden="true" tabindex="-1"></a>          <span class="co"># также фильтруем, чтобы сохранить только вторую вспышку</span></span>
<span id="cb128-68"><a href="#cb128-68" aria-hidden="true" tabindex="-1"></a>          date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2013-06-01"</span>) <span class="sc">|</span> (<span class="fu">is.na</span>(date_onset) <span class="sc">&amp;</span> <span class="sc">!</span>hospital <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span>)))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</section>
</section>
</section>
<section id="построчные-расчеты" class="level2" data-number="8.12">
<h2 data-number="8.12" class="anchored" data-anchor-id="построчные-расчеты"><span class="header-section-number">8.12</span> Построчные расчеты</h2>
<p>Если вы хотите провести расчеты внутри строки, вы можете использовать функцию <code>rowwise()</code> из <strong>dplyr</strong>. См. эту онлайн виньетку по <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html">построчным расчетам</a>.<br>
Например, этот код применяет <code>rowwise()</code> и затем создает новый столбец, который складывает количество указанных столбцов симптомов, которые имеют значение “yes” (да), для каждой строки в построчном списке. Столбцы указываются внутри функции <code>sum()</code> по имени внутри вектора <code>c()</code>. <code>rowwise()</code>, по сути, является особым типом <code>group_by()</code>, так что лучше использовать <code>ungroup()</code>, когда вы закончите (см. страницу <a href="../new_pages/grouping.ru.html">Группирование данных</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_symptoms =</span> <span class="fu">sum</span>(<span class="fu">c</span>(fever, chills, cough, aches, vomit) <span class="sc">==</span> <span class="st">"yes"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fever, chills, cough, aches, vomit, num_symptoms) <span class="co"># for display</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,888 × 6
   fever chills cough aches vomit num_symptoms
   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;
 1 no    no     yes   no    yes              2
 2 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
 3 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
 4 no    no     no    no    no               0
 5 no    no     yes   no    yes              2
 6 no    no     yes   no    yes              2
 7 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
 8 no    no     yes   no    yes              2
 9 no    no     yes   no    yes              2
10 no    no     yes   no    no               1
# ℹ 5,878 more rows</code></pre>
</div>
</div>
<p>При указании столбцов для оценки вы можете использовать функции-помощники “tidyselect”, описанные в разделе <code>select()</code> данной страницы. Вам может потребоваться лишь одна корректировка (поскольку вы не используете их внутри функции <strong>dplyr</strong>, такой как <code>select()</code> или <code>summarise()</code>).</p>
<p>Поместите критерии, уточняющие столбец, внутрь функции <code>c_across()</code> из <strong>dplyr</strong>. Это необходимо сделать, поскольку <code>c_across</code> (<a href="https://dplyr.tidyverse.org/reference/c_across.html">документация</a>) разработан для работы конкретно с <code>rowwise()</code>. Например, следующий код:</p>
<ul>
<li>Применяет <code>rowwise()</code>, так что следующая операция (<code>sum()</code>) применяется к каждой строке (не сумма по всем столбцам)<br>
</li>
<li>Создает новый столбец <code>num_NA_dates</code>, определенный для каждой строки как число столбцов (с именем, содержащим “date”), для которого <code>is.na()</code> оценивается как TRUE (истина) (в них отсутствуют данные).<br>
</li>
<li><code>ungroup()</code> для удаления эффектов от применения <code>rowwise()</code> для последующих шагов</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_NA_dates =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>))))) <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(num_NA_dates, <span class="fu">contains</span>(<span class="st">"date"</span>)) <span class="co"># для отображения</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,888 × 5
   num_NA_dates date_infection date_onset date_hospitalisation date_outcome
          &lt;int&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
 1            1 2014-05-08     2014-05-13 2014-05-15           NA          
 2            1 NA             2014-05-13 2014-05-14           2014-05-18  
 3            1 NA             2014-05-16 2014-05-18           2014-05-30  
 4            1 2014-05-04     2014-05-18 2014-05-20           NA          
 5            0 2014-05-18     2014-05-21 2014-05-22           2014-05-29  
 6            0 2014-05-03     2014-05-22 2014-05-23           2014-05-24  
 7            0 2014-05-22     2014-05-27 2014-05-29           2014-06-01  
 8            0 2014-05-28     2014-06-02 2014-06-03           2014-06-07  
 9            1 NA             2014-06-05 2014-06-06           2014-06-18  
10            1 NA             2014-06-05 2014-06-07           2014-06-09  
# ℹ 5,878 more rows</code></pre>
</div>
</div>
<p>Вы также можете задать другие функции, такие как <code>max()</code>, чтобы получить последнюю или наиболее недавнюю дату для каждой строки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">latest_date =</span> <span class="fu">max</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>)), <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(latest_date, <span class="fu">contains</span>(<span class="st">"date"</span>))  <span class="co"># для отображения</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,888 × 5
   latest_date date_infection date_onset date_hospitalisation date_outcome
   &lt;date&gt;      &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
 1 2014-05-15  2014-05-08     2014-05-13 2014-05-15           NA          
 2 2014-05-18  NA             2014-05-13 2014-05-14           2014-05-18  
 3 2014-05-30  NA             2014-05-16 2014-05-18           2014-05-30  
 4 2014-05-20  2014-05-04     2014-05-18 2014-05-20           NA          
 5 2014-05-29  2014-05-18     2014-05-21 2014-05-22           2014-05-29  
 6 2014-05-24  2014-05-03     2014-05-22 2014-05-23           2014-05-24  
 7 2014-06-01  2014-05-22     2014-05-27 2014-05-29           2014-06-01  
 8 2014-06-07  2014-05-28     2014-06-02 2014-06-03           2014-06-07  
 9 2014-06-18  NA             2014-06-05 2014-06-06           2014-06-18  
10 2014-06-09  NA             2014-06-05 2014-06-07           2014-06-09  
# ℹ 5,878 more rows</code></pre>
</div>
</div>
</section>
<section id="упорядочивание-и-сортировка" class="level2" data-number="8.13">
<h2 data-number="8.13" class="anchored" data-anchor-id="упорядочивание-и-сортировка"><span class="header-section-number">8.13</span> Упорядочивание и сортировка</h2>
<p>Используйте функцию <code>arrange()</code> из <strong>dplyr</strong> для сортировки или упорядочивания строк по значениям столбцов.</p>
<p>Просто перечислите столбцы в порядке, в котором они должны быть отсортированы. Укажите <code>.by_group = TRUE</code>, если вы хотите, чтобы сортировка сначала произошла по любым <em>группировкам</em>, применяемым к данным (см. страницу <a href="../new_pages/grouping.ru.html">Группирование данных</a>).</p>
<p>По умолчанию столбец будет отсортирован в “возрастающем” порядке (который применяется как к числовым, так и текстовым столбцам). Вы можете отсортировать переменную в “убывающем” порядке, обернув ее в <code>desc()</code>.</p>
<p>Сортировка данных с помощью <code>arrange()</code> особенно полезна, когда вы готовите <a href="../new_pages/tables_presentation.ru.html">Таблицы для презентации</a>, используя <code>slice()</code>, чтобы взять “верхние” строки в каждой группе, либо чтобы задать порядок уровня факторов по порядку появления.</p>
<p>Например, чтобы отсортировать строки нашего построчного списка по больницам <code>hospital</code>, затем по дате заболевания <code>date_onset</code> в убывающем порядке, мы используем:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(hospital, <span class="fu">desc</span>(date_onset))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../new_pages/importing.ru.html" class="pagination-link" aria-label="Импорт и экспорт">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Импорт и экспорт</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../new_pages/dates.ru.html" class="pagination-link" aria-label="Работа с датами">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Работа с датами</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","loop":false,"openEffect":"zoom","selector":".lightbox","descPosition":"bottom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>