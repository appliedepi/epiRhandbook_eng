<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Справочник эпидемиолога R - 30&nbsp; Основы ggplot</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../new_pages/ggplot_tips.ru.html" rel="next">
<link href="../new_pages/tables_presentation.ru.html" rel="prev">
<link href="../images/Applied_Epi_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти",
    "search-label": "Поиск"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QXDW878QLX', { 'anonymize_ip': true});
</script>
<!-- Global site tag (gtag.js) - Google Analytics 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QXDW878QLX');
</script> -->

</head><body class="nav-sidebar floating"><div class="alert alert-info alert-dismissible">
  <!-- <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Need help learning R?</strong> Enroll in Applied Epi's <a href="https://www.appliedepi.org/live/"
    class="alert-link">intro R course</a>, try our <a href="https://www.appliedepi.org/tutorial/"
    class="alert-link">free R tutorials</a>, post in our <a href="https://community.appliedepi.org/"
    class="alert-link">Community Q&A forum</a>, or ask about our <a href="mailto:contact@appliedepi.org"
    class="alert-link">R Help Desk service</a>. -->
</div>

<script>

  // Function to extract the last two characters from the URL path to determine the language, adjusting for .html extension
  function getLanguageFromURL() {
    let path = window.location.pathname;
    
    // Check if the URL ends with .html and remove it
    if (path.endsWith('.html')) {
      path = path.substring(0, path.length - 5);
    }

    // Extract the last two characters for the language code
    const lang = path.substr(-2);
    return lang;
  }

  const language = getLanguageFromURL();
  const supportedLanguages = ['fr', 'es', 'vn', 'jp', 'pt', 'tr', 'ru'];
  const defaultLanguage = 'en';
  const isSupportedLanguage = supportedLanguages.includes(language);

  // Translations for the content
  const translations = {
    en: '<strong>Need help learning R?</strong> Enroll in Applied Epi\'s <a href="https://www.appliedepi.org/live/" class="alert-link">intro R course</a>, try our <a href="https://www.appliedepi.org/tutorial/" class="alert-link">free R tutorials</a>, post in our <a href="https://community.appliedepi.org/" class="alert-link">Community Q&A forum</a>, or ask about our <a href="mailto:contact@appliedepi.org" class="alert-link">R Help Desk service</a>.',
    fr: '<strong>Besoin d\'aide pour apprendre R ?</strong> Inscrivez-vous au <a href="https://www.appliedepi.org/live/" class="alert-link">cours d\'introduction à R</a> d\'Applied Epi, essayez nos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriels R gratuits</a>, postez dans notre forum de <a href="https://community.appliedepi.org/" class="alert-link">questions-réponses communautaires</a>, ou demandez-nous des informations sur <a href="mailto:contact@appliedepi.org" class="alert-link"> notre service d\'assistance R</a>.',
    es: '<strong>¿Necesitas ayuda para aprender R?</strong> Inscríbete en el <a href="https://www.appliedepi.org/live/" class="alert-link">Curso de introducción a R</a> de Applied Epi, prueba nuestros <a href="https://www.appliedepi.org/tutorial/" class="alert-link">Tutoriales gratuitos de R</a>, escribe en nuestro <a href="https://community.appliedepi.org/" class="alert-link">Foro de preguntas y respuestas,</a> o pregunta por nuestra <a href="mailto:contact@appliedepi.org" class="alert-link">Asistencia técnica para R</a>.',
    vn: '<strong>Bạn cần giúp đỡ trong việc học R?</strong> Hãy đăng ký khóa học R cơ bản của Applied Epi tại <a href="https://www.appliedepi.org/live/" class="alert-link">đây</a>, hoặc thử các <a href="https://www.appliedepi.org/tutorial/" class="alert-link">hướng dẫn R miễn phí</a>, đăng bài trong <a href="https://community.appliedepi.org/" class="alert-link">diễn đàn cộng đồng</a>, hoặc gửi câu hỏi tới <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ Trợ giúp R</a> của chúng tôi.',
    jp: '<strong>Rの学習について助けが必要ですか？</strong>Applied Epiの<a href="https://www.appliedepi.org/live/" class="alert-link">R入門コース</a>に登録するか、<a href="https://www.appliedepi.org/tutorial/" class="alert-link">無料Rチュートリアル</a>を試すか、<a href="https://community.appliedepi.org/" class="alert-link">コミュニティQ＆Aフォーラム</a>に投稿するか、<a href="mailto:contact@appliedepi.org" class="alert-link">Rヘルプデスクサービス</a>についてお問い合わせください。',
    pt: '<strong>Você precisa de ajuda para aprender R??</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R da Applied Epi</a>, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.',
    tr: '<strong>R öğrenmekte yardıma mı ihtiyacınız var?</strong> Applied Epi\'\nin <a href="https://www.appliedepi.org/live/" class="alert-link">R\'ye giriş kursuna</a> kaydolun, <a href="https://www.appliedepi.org/tutorial/" class="alert-link">ücretsiz R derslerimizi</a> deneyin, <a href="https://community.appliedepi.org/" class="alert-link">Topluluk Q&A forumunda</a> soru paylaşın, ya da <a href="mailto:contact@appliedepi.org" class="alert-link">R Yardım Masası hizmetimiz</a> hakkında sorun.',
    ru: '<strong>Нужна помощь в изучении R?</strong> Запишитесь на <a href="https://www.appliedepi.org/live/" class="alert-link">вводный курс по R</a> от Applied Epi, попробуйте наши <a href="https://www.appliedepi.org/tutorial/" class="alert-link">бесплатные учебные материалы по R</a>, задайте вопрос в нашем <a href="https://community.appliedepi.org/" class="alert-link">форуме вопросов и ответов сообщества</a>, или спросите о нашей услуге <a href="mailto:contact@appliedepi.org" class="alert-link">Службы поддержки по R</a>.'
  };

  // Default to English if the detected language is not supported
  const contentToDisplay = translations[isSupportedLanguage ? language : defaultLanguage];


  // Select the element where the content should be displayed
  const alertElement = document.querySelector('.alert');
  if (alertElement) {
    alertElement.innerHTML = contentToDisplay;
    alertElement.style.display = 'block'; // Make sure to display the element
  }

</script>
<link href="../site_libs/htmltools-fill-0.5.8/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.31/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="../site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="../site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="../site_libs/selectize-0.12.0/selectize.min.js"></script>
<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>






<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../new_pages/tables_presentation.ru.html">Визуализация данных</a></li><li class="breadcrumb-item"><a href="../new_pages/ggplot_basics.ru.html"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Основы ggplot</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/Applied_Epi_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Справочник эпидемиолога R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://twitter.com/appliedepi" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/company/appliedepi/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://github.com/appliedepi/epihandbook_quarto" title="Исходный код" class="quarto-navigation-tool px-1" aria-label="Исходный код"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Переключить темный режим"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Поиск"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Добро пожаловать</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Об этой книге</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/editorial_style.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Редакционные и технические замечания</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/data_used.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Скачивание руководства и данных</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Основы</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/basics.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Основы R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/transition_to_R.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Переход к R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/packages_suggested.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Рекомендованные пакеты</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/r_projects.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Проекты R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/importing.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Импорт и экспорт</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Управление данными</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/cleaning.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Вычистка данных и ключевые функции</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/dates.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Работа с датами</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/characters_strings.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Текст и последовательности</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/factors.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Факторы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/pivoting.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Поворот данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/grouping.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Группирование данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/joining_matching.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Соединение данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/deduplication.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Дедупликация</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/iteration.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Итерации, циклы и списки</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Анализ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/tables_descriptive.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Описательные таблицы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/stat_tests.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Простые статистические тесты</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/regression.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Однофакторная и многофакторная регрессия</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/missing_data.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Отсутствующие данные</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/standardization.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Стандартизированные коэффициенты</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/moving_average.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Скользящие средние значения</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/time_series.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Временные ряды и обнаружение вспышек</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/epidemic_models.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Моделирование эпидемий</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/contact_tracing.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Отслеживание контактов</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/survey_analysis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Анализ опросов</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/survival_analysis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Анализ выживаемости</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/gis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Основы ГИС</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Визуализация данных</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/tables_presentation.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Таблицы для презентации</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/ggplot_basics.ru.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Основы ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/ggplot_tips.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Советы по использованию ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/epicurves.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Эпидемические кривые</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/age_pyramid.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Демографические пирамиды и шкалы Лайкерта</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/heatmaps.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Тепловые диаграммы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/diagrams.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Диаграммы и схемы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/combination_analysis.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Анализ комбинаций</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/transmission_chains.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Цепочки передачи</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/phylogenetic_trees.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Филогенетические деревья</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/interactive_plots.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Интерактивные графики</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Отчеты и информационные панели</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/rmarkdown.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Отчеты с помощью R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/reportfactory.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Структурирование рутинных отчетов</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/flexdashboard.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Информационные панели с R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/shiny_basics.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Информационные панели с Shiny</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Разное</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Переключить раздел">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/writing_functions.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Написание функций</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/directories.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Взаимодействие директорий</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/collaboration.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Контроль версий и совместная работа с помощью Git и Github</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/errors.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Частые ошибки</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/help.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Получение помощи</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/network_drives.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">R на сетевых дисках</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/data_table.ru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Таблица данных</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#подготовка" id="toc-подготовка" class="nav-link active" data-scroll-target="#подготовка"><span class="header-section-number">30.1</span> Подготовка</a>
  <ul class="collapse">
  <li><a href="#загрузка-пакетов" id="toc-загрузка-пакетов" class="nav-link" data-scroll-target="#загрузка-пакетов">Загрузка пакетов</a></li>
  <li><a href="#импорт-данных" id="toc-импорт-данных" class="nav-link" data-scroll-target="#импорт-данных">Импорт данных</a></li>
  <li><a href="#общая-вычистка" id="toc-общая-вычистка" class="nav-link" data-scroll-target="#общая-вычистка">Общая вычистка</a></li>
  <li><a href="#поворот-в-длину" id="toc-поворот-в-длину" class="nav-link" data-scroll-target="#поворот-в-длину">Поворот в длину</a></li>
  </ul></li>
  <li><a href="#основы-ggplot" id="toc-основы-ggplot" class="nav-link" data-scroll-target="#основы-ggplot"><span class="header-section-number">30.2</span> Основы ggplot</a></li>
  <li><a href="#ggplot" id="toc-ggplot" class="nav-link" data-scroll-target="#ggplot"><span class="header-section-number">30.3</span> <code>ggplot()</code></a></li>
  <li><a href="#геомы" id="toc-геомы" class="nav-link" data-scroll-target="#геомы"><span class="header-section-number">30.4</span> Геомы</a></li>
  <li><a href="#ggplot_basics_mapping" id="toc-ggplot_basics_mapping" class="nav-link" data-scroll-target="#ggplot_basics_mapping"><span class="header-section-number">30.5</span> Сопоставление данных с графиком</a>
  <ul class="collapse">
  <li><a href="#эстетика-графика" id="toc-эстетика-графика" class="nav-link" data-scroll-target="#эстетика-графика">Эстетика графика</a></li>
  <li><a href="#установить-статистическое-значение" id="toc-установить-статистическое-значение" class="nav-link" data-scroll-target="#установить-статистическое-значение">Установить статистическое значение</a></li>
  <li><a href="#масштабирование-по-значениям-столбца" id="toc-масштабирование-по-значениям-столбца" class="nav-link" data-scroll-target="#масштабирование-по-значениям-столбца">Масштабирование по значениям столбца</a></li>
  <li><a href="#ggplot_basics_map_loc" id="toc-ggplot_basics_map_loc" class="nav-link" data-scroll-target="#ggplot_basics_map_loc">Где делать назначения по сопоставлению</a></li>
  <li><a href="#ggplotgroups" id="toc-ggplotgroups" class="nav-link" data-scroll-target="#ggplotgroups">Группы</a></li>
  </ul></li>
  <li><a href="#ggplot_basics_facet" id="toc-ggplot_basics_facet" class="nav-link" data-scroll-target="#ggplot_basics_facet"><span class="header-section-number">30.6</span> Фасеты/малые множества</a>
  <ul class="collapse">
  <li><a href="#facet_wrap" id="toc-facet_wrap" class="nav-link" data-scroll-target="#facet_wrap"><code>facet_wrap()</code></a></li>
  <li><a href="#facet_grid" id="toc-facet_grid" class="nav-link" data-scroll-target="#facet_grid"><code>facet_grid()</code></a></li>
  <li><a href="#свободные-или-фиксированные-оси" id="toc-свободные-или-фиксированные-оси" class="nav-link" data-scroll-target="#свободные-или-фиксированные-оси">Свободные или фиксированные оси</a></li>
  <li><a href="#порядок-уровней-факторов-в-фасетах" id="toc-порядок-уровней-факторов-в-фасетах" class="nav-link" data-scroll-target="#порядок-уровней-факторов-в-фасетах">Порядок уровней факторов в фасетах</a></li>
  </ul></li>
  <li><a href="#хранение-графиков" id="toc-хранение-графиков" class="nav-link" data-scroll-target="#хранение-графиков"><span class="header-section-number">30.7</span> Хранение графиков</a>
  <ul class="collapse">
  <li><a href="#сохранение-графиков" id="toc-сохранение-графиков" class="nav-link" data-scroll-target="#сохранение-графиков">Сохранение графиков</a></li>
  <li><a href="#изменение-сохраненных-графиков" id="toc-изменение-сохраненных-графиков" class="nav-link" data-scroll-target="#изменение-сохраненных-графиков">Изменение сохраненных графиков</a></li>
  <li><a href="#экспорт-графиков" id="toc-экспорт-графиков" class="nav-link" data-scroll-target="#экспорт-графиков">Экспорт графиков</a></li>
  </ul></li>
  <li><a href="#метки" id="toc-метки" class="nav-link" data-scroll-target="#метки"><span class="header-section-number">30.8</span> Метки</a></li>
  <li><a href="#ggplot_basics_themes" id="toc-ggplot_basics_themes" class="nav-link" data-scroll-target="#ggplot_basics_themes"><span class="header-section-number">30.9</span> Темы</a>
  <ul class="collapse">
  <li><a href="#полные-темы" id="toc-полные-темы" class="nav-link" data-scroll-target="#полные-темы">Полные темы</a></li>
  <li><a href="#изменение-темы" id="toc-изменение-темы" class="nav-link" data-scroll-target="#изменение-темы">Изменение темы</a></li>
  </ul></li>
  <li><a href="#цвета" id="toc-цвета" class="nav-link" data-scroll-target="#цвета"><span class="header-section-number">30.10</span> Цвета</a></li>
  <li><a href="#привязывание-к-ggplot2" id="toc-привязывание-к-ggplot2" class="nav-link" data-scroll-target="#привязывание-к-ggplot2"><span class="header-section-number">30.11</span> Привязывание к <strong>ggplot2</strong></a></li>
  <li><a href="#построение-графика-непрерывных-данных" id="toc-построение-графика-непрерывных-данных" class="nav-link" data-scroll-target="#построение-графика-непрерывных-данных"><span class="header-section-number">30.12</span> Построение графика непрерывных данных</a>
  <ul class="collapse">
  <li><a href="#гистограммы" id="toc-гистограммы" class="nav-link" data-scroll-target="#гистограммы">Гистограммы</a></li>
  <li><a href="#коробчатые-диаграммы" id="toc-коробчатые-диаграммы" class="nav-link" data-scroll-target="#коробчатые-диаграммы">Коробчатые диаграммы</a></li>
  <li><a href="#скрипичный-график-графис-с-дрожанием-и-график-sina" id="toc-скрипичный-график-графис-с-дрожанием-и-график-sina" class="nav-link" data-scroll-target="#скрипичный-график-графис-с-дрожанием-и-график-sina">Скрипичный график, графис с “дрожанием” и график sina</a></li>
  <li><a href="#две-непрерывные-переменные" id="toc-две-непрерывные-переменные" class="nav-link" data-scroll-target="#две-непрерывные-переменные">Две непрерывные переменные</a></li>
  <li><a href="#три-непрерывные-переменные" id="toc-три-непрерывные-переменные" class="nav-link" data-scroll-target="#три-непрерывные-переменные">Три непрерывные переменные</a></li>
  </ul></li>
  <li><a href="#построение-графиков-категориальных-данных" id="toc-построение-графиков-категориальных-данных" class="nav-link" data-scroll-target="#построение-графиков-категориальных-данных"><span class="header-section-number">30.13</span> Построение графиков категориальных данных</a>
  <ul class="collapse">
  <li><a href="#подготовка-1" id="toc-подготовка-1" class="nav-link" data-scroll-target="#подготовка-1">Подготовка</a></li>
  <li><a href="#ggplot_basics_bars" id="toc-ggplot_basics_bars" class="nav-link" data-scroll-target="#ggplot_basics_bars"><code>geom_bar()</code></a></li>
  <li><a href="#geom_col" id="toc-geom_col" class="nav-link" data-scroll-target="#geom_col"><code>geom_col()</code></a></li>
  <li><a href="#geom_histogram" id="toc-geom_histogram" class="nav-link" data-scroll-target="#geom_histogram"><code>geom_histogram()</code></a></li>
  </ul></li>
  <li><a href="#ресурсы" id="toc-ресурсы" class="nav-link" data-scroll-target="#ресурсы"><span class="header-section-number">30.14</span> Ресурсы</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../new_pages/tables_presentation.ru.html">Визуализация данных</a></li><li class="breadcrumb-item"><a href="../new_pages/ggplot_basics.ru.html"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Основы ggplot</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Основы ggplot</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/ggplot_basics_top.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="../images/ggplot_basics_top.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>ggplot2</strong> - самый популярный пакет R для визуализации данных. В основе этого пакета лежит функция <code>ggplot()</code>, а весь подход в целом известен как <em>“ggplot”</em>, а получаемые рисунки иногда ласково называют “ggplots”. Буквы “gg” в этих названиях означают “<strong>g</strong>грамматику <strong>g</strong>графики”, используемую для построения рисунков. В <strong>ggplot2</strong> используется большое количество дополнительных пакетов R, которые расширяют его функциональность.</p>
<p>Синтаксис значительно отличается от синтаксиса построения графиков в <strong>базовом</strong> <code>R</code> и требует определенного обучения. Использование <strong>ggplot2</strong>, как правило, требует от пользователя форматирования данных с высокой степенью совместимости с <strong>tidyverse</strong>, что в конечном итоге делает совместное использование этих пакетов очень эффективным.</p>
<p>На этой странице мы рассмотрим основы построения графиков с помощью <strong>ggplot2</strong>. Предложения и дополнительные приемы, позволяющие сделать графики действительно красивыми, см. на странице [Советы по использованию ggplot].</p>
<p>В разделе “Ресурсы” есть несколько подробных учебных пособий по <strong>ggplot2</strong>. Вы также можете скачать материал <a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">Шпаргалка по визуализации данных с помощью ggplot</a> с сайта RStudio. Если вы хотите найти вдохновение для творческого подхода к визуализации данных, мы рекомендуем обратиться к таким сайтам, как <a href="https://www.r-graph-gallery.com/">галерея графиков R</a> и <a href="https://www.data-to-viz.com/caveats.html">от данных к визуализации</a>.</p>
<!-- ======================================================= -->
<section id="подготовка" class="level2" data-number="30.1">
<h2 data-number="30.1" class="anchored" data-anchor-id="подготовка"><span class="header-section-number">30.1</span> Подготовка</h2>
<section id="загрузка-пакетов" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="загрузка-пакетов">Загрузка пакетов</h3>
<p>В этом фрагменте кода показана загрузка пакетов, необходимых для проведения анализа. В данном руководстве мы делаем акцент на <code>p_load()</code> из <strong>pacman</strong>, которая при необходимости устанавливает пакет <em>и</em> загружает его для использования. Установленные пакеты можно также загрузить с помощью <code>library()</code> из <strong>базового</strong> R. Более подробную информацию о пакетах R см. на странице [Основы R].</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  tidyverse,      <span class="co"># включает ggplot2 и другие средства управления данными</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  janitor,        <span class="co"># чистящие и сводные таблицы</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ggforce,        <span class="co"># Дополнения к ggplot</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  rio,            <span class="co"># импорт/экспорт</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  here,           <span class="co"># локатор файлов</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  stringr         <span class="co"># работа с символами   </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="импорт-данных" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="импорт-данных">Импорт данных</h3>
<p>Импортируем набор данных случаев из смоделированной эпидемии лихорадки Эбола. Если вы хотите выполнять действия параллельно, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">щелкните мышью, чтобы загрузить “чистый” построчный список</a> (в виде файла .rds). Импортируйте данные с помощью функции <code>import()</code> из пакета <strong>rio</strong> (она принимает множество типов файлов, таких как .xlsx, .rds, .csv - подробности см. на странице [Импорт и экспорт]).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"linelist_cleaned.rds"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ниже представлены первые 50 строк построчного списка. Мы сосредоточимся на непрерывных переменных <code>age</code>(возраст), <code>wt_kg</code> (вес в килограммах), <code>ct_blood</code>(значения CT) и <code>days_onset_hosp</code> (разница между датой начала заболевания и госпитализацией).</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-13b4c7c50c975a7d684d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-13b4c7c50c975a7d684d">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1.407024e+12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"age","targets":8},{"name":"age_unit","targets":9},{"name":"age_years","targets":10},{"name":"age_cat","targets":11},{"name":"age_cat5","targets":12},{"name":"hospital","targets":13},{"name":"lon","targets":14},{"name":"lat","targets":15},{"name":"infector","targets":16},{"name":"source","targets":17},{"name":"wt_kg","targets":18},{"name":"ht_cm","targets":19},{"name":"ct_blood","targets":20},{"name":"fever","targets":21},{"name":"chills","targets":22},{"name":"cough","targets":23},{"name":"aches","targets":24},{"name":"vomit","targets":25},{"name":"temp","targets":26},{"name":"time_admission","targets":27},{"name":"bmi","targets":28},{"name":"days_onset_hosp","targets":29}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="общая-вычистка" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="общая-вычистка">Общая вычистка</h3>
<p>При подготовке данных к построению графиков лучше всего сделать так, чтобы они максимально соответствовали понятию <a href="https://r4ds.had.co.nz/tidy-data.html">стандарты “аккуратных” данных</a>. О том, как этого добиться, рассказывается на страницах этого руководства, посвященных управлению данными, например, в разделе [Вычистка данных и ключевые функции].</p>
<p>Некоторые простые способы подготовки данных для построения графиков могут включать в себя улучшение качества отображения содержимого данных, что не обязательно означает улучшение качества работы с данными. Например:</p>
<ul>
<li>Заменить значения <code>NA</code> в текстовом столбце на последовательность символов “Неизвестно”.<br>
</li>
<li>Рассмотреть возможность преобразования столбца в класс <em>фактор</em>, чтобы его значения имели предписанные порядковые уровни<br>
</li>
<li>Вычистка некоторых столбцов с заменой “дружественных к данным” значений с подчеркиваниями и т.п. на обычный текстовый или заглавный регистр (см. [Текст и последовательности])</li>
</ul>
<p>Приведем несколько примеров этого в действии:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># сделать версию отображения столбцов с более удобными названиями</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender_disp =</span> <span class="fu">case_when</span>(gender <span class="sc">==</span> <span class="st">"m"</span> <span class="sc">~</span> <span class="st">"Male"</span>,        <span class="co"># м на Муж </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                            gender <span class="sc">==</span> <span class="st">"f"</span> <span class="sc">~</span> <span class="st">"Female"</span>,      <span class="co"># ж на Жен,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">is.na</span>(gender) <span class="sc">~</span> <span class="st">"Unknown"</span>),    <span class="co"># NA на неизвестно </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_disp =</span> <span class="fu">replace_na</span>(outcome, <span class="st">"Unknown"</span>)          <span class="co"># заменить исход NA на "неизвестно"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="поворот-в-длину" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="поворот-в-длину">Поворот в длину</h3>
<p>С точки зрения структуры данных, для <strong>ggplot2</strong> мы часто также хотим разворачивать данные в <em>более длинные</em> форматы. Подробнее об этом можно прочитать на странице [Поворот данных].</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/pivoting/pivot_longer_new.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="../images/pivoting/pivot_longer_new.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Например, мы хотим построить график данных в “широком” формате, например, для каждого случая в построчном списке<code>linelist</code> и его симптомов. Ниже мы создадим мини построчный список с названием <code>symptoms_data</code>, содержащий только столбцы <code>case_id</code> и симптомы.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>symptoms_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(case_id, fever, chills, cough, aches, vomit))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Вот как выглядят первые 50 строк этого мини построчного списка - посмотрите, как они отформатированы “в ширину” с каждым симптомом в виде столбца:</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4eb62432bacb7ec782be" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4eb62432bacb7ec782be">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"name":"case_id","targets":0},{"name":"fever","targets":1},{"name":"chills","targets":2},{"name":"cough","targets":3},{"name":"aches","targets":4},{"name":"vomit","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Если бы мы хотели построить график количества случаев с определенными симптомами, мы были бы ограничены тем, что каждый симптом - это отдельный столбец. Однако мы можем <em>повернуть</em> столбцы симптомов в более длинный формат, например, так:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>symptoms_data_long <span class="ot">&lt;-</span> symptoms_data <span class="sc">%&gt;%</span>    <span class="co"># начать с "мини" построчного списка под названием symptoms_data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>case_id,                       <span class="co"># повернуть все столбцы, кроме case_id (все столбцы симптомов)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"symptom_name"</span>,             <span class="co"># присвоить название новому столбцу, в котором будут содержаться симптомы</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"symptom_is_present"</span>) <span class="sc">%&gt;%</span>  <span class="co"># присвоить название новому столбцу, в котором будут находиться значения (да/нет)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">symptom_is_present =</span> <span class="fu">replace_na</span>(symptom_is_present, <span class="st">"unknown"</span>)) <span class="co"># преобразовать NA в "неизвестно"</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Здесь представлены первые 50 строк. Обратите внимание на то, что случай имеет 5 строк - по одной для каждого возможного симптома. Новые столбцы <code>symptom_name</code> и <code>symptom_is_present</code> являются результатом поворота. Заметим, что этот формат может быть не очень удобен для других операций, но полезен для построения графиков.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-58a0507d5e5843f23d03" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-58a0507d5e5843f23d03">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","5fe599","5fe599","5fe599","5fe599","8689b7","8689b7","8689b7","8689b7","8689b7","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","b8812a","b8812a","b8812a","b8812a","b8812a","893f25","893f25","893f25","893f25","893f25","be99c8","be99c8","be99c8","be99c8","be99c8","07e3e8","07e3e8","07e3e8","07e3e8","07e3e8","369449","369449","369449","369449","369449","f393b4","f393b4","f393b4","f393b4","f393b4","1389ca","1389ca","1389ca","1389ca","1389ca"],["fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit"],["no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","no","no","no","no","no","no","no","yes","no","yes","no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","no","no","yes","no","yes","no","no","yes","no","yes","no","no","yes","no","no"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>symptom_name<\/th>\n      <th>symptom_is_present<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"name":"case_id","targets":0},{"name":"symptom_name","targets":1},{"name":"symptom_is_present","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ======================================================= -->
</section>
</section>
<section id="основы-ggplot" class="level2" data-number="30.2">
<h2 data-number="30.2" class="anchored" data-anchor-id="основы-ggplot"><span class="header-section-number">30.2</span> Основы ggplot</h2>
<p><strong>“Грамматика графики” - ggplot2</strong></p>
<p>Построение графиков с помощью <strong>ggplot2</strong> основано на “наложении” друг на друга слоев и элементов оформления, причем каждая команда добавляется к предыдущим с помощью символа плюса (<code>+</code>). В результате получается многослойный графический объект, который можно сохранять, изменять, распечатывать, экспортировать и т.д.</p>
<p>Объекты ggplot могут быть очень сложными, но основной порядок слоев обычно выглядит следующим образом:</p>
<ol type="1">
<li>Начните с базовой команды <code>ggplot()</code> - она “открывает” ggplot и позволяет добавлять последующие функции с помощью <code>+</code>. Как правило, в этой команде также указывается набор данных<br>
</li>
<li>Добавьте слои “geom” - эти функции визуализируют данные в виде <em>геометрии</em> (<em>фигуры</em>), например, в виде гистограммы, линейного графика, диаграммы рассеяния, гистограммы (или их комбинации!). Все эти функции начинаются с префикса <code>geom_</code>.<br>
</li>
<li>Добавьте элементы оформления графика, такие как метки осей, заголовок, шрифты, размеры, цветовые схемы, легенды или поворот осей.</li>
</ol>
<p>Простой пример скелетного кода приведен ниже. Пояснения к каждому компоненту будут даны в следующих разделах.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># построить график данных из столбца my_data в виде красных точек</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> my_data)<span class="sc">+</span>                   <span class="co"># использование набора данных "my_data"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(                             <span class="co"># добавить слой точек</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> col1, <span class="at">y =</span> col2),    <span class="co"># "привязка" столбца данных к осям</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span>                       <span class="co"># другая спецификация для геом</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>()<span class="sc">+</span>                                 <span class="co"># здесь добавляются заголовки, метки осей и т.д.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()                                 <span class="co"># Здесь настраиваются цвет, шрифт, размер и т.д. элементов графика, не относящихся к данным (оси, заголовок и т.д.) </span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ggplot" class="level2" data-number="30.3">
<h2 data-number="30.3" class="anchored" data-anchor-id="ggplot"><span class="header-section-number">30.3</span> <code>ggplot()</code></h2>
<p>Открывающей командой любого графика ggplot2 является команда <code>ggplot()</code>. Эта команда просто создает чистый холст, на который можно добавлять слои. Она “открывает” путь для добавления последующих слоев с помощью символа <code>+</code>.</p>
<p>Обычно команда <code>ggplot()</code> включает аргумент <code>data =</code> для построения графика. Это задает набор данных по умолчанию, который будет использоваться для последующих слоев графика.</p>
<p>Команда завершается символом <code>+</code> после закрывающих круглых скобок. Таким образом, команда остается “открытой”. ggplot будет выполняться/появляться только в том случае, если полная команда включает последний слой <em>без</em> <code>+</code> в конце.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Это позволит создать график, представляющий собой чистый холст</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="геомы" class="level2" data-number="30.4">
<h2 data-number="30.4" class="anchored" data-anchor-id="геомы"><span class="header-section-number">30.4</span> Геомы</h2>
<p>Чистого холста, конечно, недостаточно - необходимо создать геометрию (фигуры) из наших данных (например, столбчатые диаграммы, гистограммы, диаграммы рассеяния, коробчатой диаграммы).</p>
<p>Это делается путем добавления слоев “геомов” к исходной команде <code>ggplot()</code>. Существует множество функций <strong>ggplot2</strong>, создающих “геомы”. Каждая из этих функций начинается с символа “geom_”, поэтому мы будем называть их обобщенно <code>geom_XXXX()</code>. В <strong>ggplot2</strong> существует более 40 геомов и множество других, созданных поклонниками. Ознакомиться с ними можно на сайте <a href="https://exts.ggplot2.tidyverse.org/gallery/">галерея ggplot2</a>. Ниже перечислены некоторые распространенные геомы:</p>
<ul>
<li>Гистограммы - <code>geom_histogram()</code><br>
</li>
<li>Столбчатые диаграммы - <code>geom_bar()</code> or <code>geom_col()</code> (see <a href="#ggplot_basics_bars">“Bar plot” section</a>)<br>
</li>
<li>Бокс-диаграммы - <code>geom_boxplot()</code><br>
</li>
<li>Точки (н-р диаграммы рассеивания) - <code>geom_point()</code><br>
</li>
<li>Линейные графики - <code>geom_line()</code> or <code>geom_path()</code><br>
</li>
<li>Графики трендов - <code>geom_smooth()</code></li>
</ul>
<p>На одном графике можно отобразить один или несколько геомов. Каждый из них добавляется к предыдущим командам <strong>ggplot2</strong> с помощью знака <code>+</code>, и они строятся последовательно, так что последующие геомы строятся поверх предыдущих.</p>
</section>
<section id="ggplot_basics_mapping" class="level2" data-number="30.5">
<h2 data-number="30.5" class="anchored" data-anchor-id="ggplot_basics_mapping"><span class="header-section-number">30.5</span> Сопоставление данных с графиком</h2>
<p>Большинству функций геомов необходимо указать, <em>что использовать для создания фигур</em>, поэтому вы должны указать им, как <em>сопоставить (назначить) столбцы ваших данных</em> с компонентами графика, такими как оси, цвета фигур, размеры фигур и т.д. Для большинства геомов основными компонентами, которые должны быть сопоставлены со столбцами данных, являются ось x и (при необходимости) ось y.</p>
<p>Это ” сопоставление” происходит с помощью аргумента <code>mapping =</code>. Сопоставления, которые вы передаете в <code>mapping</code>, должны быть обернуты в функцию <code>aes()</code>, поэтому вы напишете что-то вроде <code>mapping = aes(x = col1, y = col2)</code>, как показано ниже.</p>
<p>Ниже, в команде <code>ggplot()</code>, данные задаются в виде построчного списка <code>linelist</code>. В аргументе <code>mapping = aes()</code> столбец <code>age</code> возраст отображается на ось x, а столбец <code>wt_kg</code> - на ось y.</p>
<p>После <code>+</code> продолжаются команды построения графика. Фигура создается с помощью функции ” геом” <code>geom_point()</code>. Этот геом <em>наследует</em> отображения из команды <code>ggplot()</code>, описанной выше, - он знает назначение осей и столбцов и визуализирует эти отношения в виде <em>точек</em> на холсте.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>В качестве другого примера можно привести следующие команды, использующие те же данные, несколько иное отображение и другой геом. Для функции <code>geom_histogram()</code> требуется только столбец, сопоставленный с осью x, так как ось y генерируется автоматически.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="эстетика-графика" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="эстетика-графика">Эстетика графика</h3>
<p>В терминологии ggplot ““эстетика”” графика имеет специфическое значение. Она относится к визуальному свойству <em>данных графика</em>. Заметим, что “эстетика” здесь относится к <em>данным, отображаемым в геомах/фигурах</em>, а не к окружающему отображению, такому как заголовки, метки осей, цвет фона, которые можно ассоциировать со словом “эстетика” в обычном понимании. В ggplot эти детали называются “темами” и настраиваются в рамках команды <code>theme()</code> (см. <a href="#ggplot_basics_themes">этот раздел</a>).</p>
<p>Поэтому <em>эстетикой</em> объектов графика могут быть цвета, размеры, прозрачность, расположение и т.д. <em>относительно данных на графике</em>. Не все геомы будут иметь одинаковые эстетические возможности, но многие из них могут быть использованы большинством геомов. Вот некоторые примеры:</p>
<ul>
<li><code>shape =</code> Отображение точки с помощью <code>geom_point()</code> в виде точки, звезды, треугольника или квадрата…<br>
</li>
<li><code>fill =</code> Внутренний цвет (например, столбчатой или коробчатой диаграммы)<br>
</li>
<li><code>color =</code> Внешняя линия столбца, диаграммы и т.д., или цвет точки при использовании <code>geom_point()</code>.<br>
</li>
<li><code>size =</code> Размер (например, толщина линии, размер точки)<br>
</li>
<li><code>alpha =</code> Прозрачность (1 = непрозрачный, 0 = невидимый)<br>
</li>
<li><code>binwidth =</code> Ширина корзин гистограммы<br>
</li>
<li><code>width =</code> Ширина столбцов ” столбчатой диаграммы”<br>
</li>
<li><code>linetype =</code> Тип линии (например, сплошная, пунктирная, точечная)</li>
</ul>
<p>Этим эстетическим характеристикам объектов могут быть присвоены значения двумя способами:</p>
<ol type="1">
<li>Присвоить статическое значение (например, <code>color = "blue"</code>), которое будет применяться ко всем изображениям на графике<br>
</li>
<li>Присваивается одному из столбцов данных (например, <code>color = hospital</code>) так, что отображение каждого изображения зависит от его значения в этом столбце</li>
</ol>
<!-- *Эстетика вне оси может иметь статическое значение (например, `size = 1`) или может быть привязана к столбцу (например, `size = age`).* Если вы хотите, чтобы эстетика имела статическое значение, то привязка размещается *вне* параметра `mapping = aes()`. Если необходимо, чтобы эстетика масштабировалась/зависела от значения в каждой строке данных, то присвоение производится *внутри* `mapping = aes()`.   -->
</section>
<section id="установить-статистическое-значение" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="установить-статистическое-значение">Установить статистическое значение</h3>
<p>Если вы хотите, чтобы эстетика объекта графика была статичной, т.е. одинаковой для каждого объекта, вы пишете его назначение внутри геома, но <em>вне</em> любого утверждения <code>mapping = aes()</code>. Эти привязки могут выглядеть как <code>size = 1</code> или <code>color = "blue"</code>. Приведем два примера:</p>
<ul>
<li>В первом примере в команде <code>ggplot()</code> задано <code>mapping = aes()</code>, и оси сопоставлены со столбцами возраста и веса в данных. Эстетические параметры графика <code>color =</code>, <code>size =</code> и <code>alpha =</code> (прозрачность) присваиваются статическим значениям. Для наглядности это сделано в функции <code>geom_point()</code>, так как впоследствии можно добавить другие геомы, которые будут принимать другие значения для эстетики графика.<br>
</li>
<li>Во втором примере для гистограммы требуется только ось x, отображенная на столбец. Параметры гистограммы <code>binwidth =</code>, <code>color =</code>, <code>fill =</code> (внутренний цвет) и <code>alpha =</code> снова устанавливаются в геоме в статические значения.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># диаграмма рассеяния</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  <span class="co"># задать данные и отображение осей</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)         <span class="co"># задать эстетику статической точки</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># гистограмма</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>       <span class="co"># задать данные и оси</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(              <span class="co"># отобразить гистограмму</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">7</span>,                <span class="co"># ширина корзин гистаграмм </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,               <span class="co"># цвет линии корзины </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"blue"</span>,               <span class="co"># внутренний цвет корзины</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span>)                 <span class="co"># прозрачность корзины</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-16-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="масштабирование-по-значениям-столбца" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="масштабирование-по-значениям-столбца">Масштабирование по значениям столбца</h3>
<p>Альтернативным вариантом является масштабирование эстетики объекта графика по значениям в столбце. При таком подходе отображение эстетики зависит от значения в этом столбце данных. Если значения столбца непрерывны, то и шкала отображения (легенда) для этой эстетики будет непрерывной. Если значения столбца дискретны, то в легенде будет отображаться каждое значение, а данные на графике будут выглядеть как четко “сгруппированные” (подробнее об этом читайте в разделе <a href="#ggplotgroups">группирование</a> на этой странице).</p>
<p>Для этого необходимо сопоставить эстетику графика с названием <em>столбца</em> (не в кавычках). Это должно быть сделано *в функции <code>mapping = aes()</code> (примечание: в коде есть несколько мест, где можно задать это сопоставление, о чем говорится <a href="##ggplot_basics_map_loc">ниже</a>).</p>
<p>Ниже приведены два примера.</p>
<ul>
<li>В первом примере эстетика <code>color =</code> (каждой точки) сопоставлена со столбцом <code>age</code> - и в легенде появилась шкала! Пока просто отметим, что шкала существует - в последующих разделах мы покажем, как ее модифицировать.<br>
</li>
<li>Во втором примере два новых эстетических свойства графика также сопоставлены столбцам (<code>color =</code> и <code>Size =</code>), в то время как эстетические свойства графика <code>shape =</code> и <code>alpha =</code> сопоставлены статическим значениям вне какой-либо функции <code>mapping = aes()</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># диаграмма рассеяния</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,   <span class="co"># задать данные</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># сопоставление эстетических характеристик со значениями столбцов</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># сопоставить ось x с осью возраста            </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># сопоставить ось y с весом</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>       )<span class="sc">+</span>     <span class="co"># сопоставить цвет с возрастом</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()         <span class="co"># отобразить данные в виде точек </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># диаграмма рассеяния</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,   <span class="co"># задать данные</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># сопоставление эстетических характеристик со значениями столбцов</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># сопоставить ось x с осью возраста            </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># сопоставить ось y с весом</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age,       <span class="co"># сопоставить цвет с возрастом</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> age))<span class="sc">+</span>      <span class="co"># сопоставить размер с возрастом</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(             <span class="co"># отобразить данные в виде точек</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"diamond"</span>,      <span class="co"># отображение точек в виде ромбиков</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>)            <span class="co"># прозрачность точек на уровне 30%</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-17-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Примечание: Назначения осей всегда привязываются к столбцам данных (а не к статическим значениям), и это всегда делается в рамках <code>mapping = aes()</code>.</p>
<p>При построении более сложных графиков, например, графиков с несколькими геомами, важно следить за слоями и эстетикой графиков. В приведенном ниже примере эстетика <code>size =</code> присваивается дважды - один раз для <code>geom_point()</code> и один раз для <code>geom_smooth()</code> - оба раза как статическое значение.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(           <span class="co"># сопоставить эстетику со столбцами</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age_years)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(                   <span class="co"># добавить точки для каждой строки данных</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(                  <span class="co"># добавить линию тенденции </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,              <span class="co"># линейным методом</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>)                   <span class="co"># размер (ширина строки) 2</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggplot_basics_map_loc" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ggplot_basics_map_loc">Где делать назначения по сопоставлению</h3>
<p>Эстетическое сопоставление в рамках <code>mapping = aes()</code> может быть записано в нескольких местах в ваших командах построения графиков и даже может быть записано более одного раза. Его можно записать в верхней команде <code>ggplot()</code>, и/или для каждого отдельного геома под ним. К тонкостям относятся:</p>
<ul>
<li>Назначения сопоставления, сделанные в верхней команде <code>ggplot()</code>, будут наследоваться по умолчанию для всех нижележащих геомов, подобно тому, как наследуются значения <code>x =</code> и <code>y =</code>.</li>
<li>Назначения сопоставления, сделанные в пределах одного геома, применяются только к этому геому.</li>
</ul>
<p>Аналогично, <code>data =</code>, указанные в верхней команде <code>ggplot()</code>, будут применяться по умолчанию ко всем нижележащим геомам, но можно также указать данные для каждого геома (но это сложнее).</p>
<p>Таким образом, каждая из следующих команд создаст один и тот же график:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># В результате выполнения этих команд будет получен один и тот же график</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ggplotgroups" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ggplotgroups">Группы</h3>
<p>Вы можете легко сгруппировать данные и построить “график по группам”. Фактически, вы уже это сделали!</p>
<p>Назначьте столбец “группирование” соответствующей эстетике графика в рамках <code>mapping = aes()</code>. Выше мы продемонстрировали это на примере непрерывных величин, когда присвоили точке <code>size =</code> столбец <code>age</code>. Однако это работает и для дискретных/категориальных столбцов.</p>
<p>Например, если необходимо отобразить точки по полу, то задайте <code>mapping = aes(color = gender)</code>. При этом автоматически появляется легенда. Это назначение может быть сделано внутри команды <code>mapping = aes()</code> в верхней команде <code>ggplot()</code> (и наследоваться геомом), либо задано в отдельной команде <code>mapping = aes()</code> внутри геома. Оба подхода показаны ниже:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg, <span class="at">color =</span> gender))<span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Этот альтернативный код дает тот же самый график</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> gender),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Обратите внимание, что в зависимости от геома для группировки данных необходимо использовать различные аргументы. Для <code>geom_point()</code> вы, скорее всего, будете использовать <code>color =</code>, <code>shape =</code> или `<code>size =</code>. В то время как для <code>geom_bar()</code>, скорее всего, будет использоваться <code>fill =</code>. Это зависит только от геома и от того, какой эстетикой графика вы хотите отразить группирование.</p>
<p>Для справки - самый простой способ группирования данных - это использование только аргумента <code>group =</code> в <code>mapping = aes()</code>. Однако это само по себе не изменит ни цвета, ни заливки, ни формы. Также не будет создана легенда. Тем не менее, данные группируются, что может повлиять на отображение статистики.</p>
<p>Чтобы изменить порядок групп на графике, см. страницу [советы по использованию ggplot] или страницу [Факторы]. В приведенных ниже разделах, посвященных построению непрерывных и категориальных данных, можно найти множество примеров сгруппированных графиков.</p>
</section>
</section>
<section id="ggplot_basics_facet" class="level2" data-number="30.6">
<h2 data-number="30.6" class="anchored" data-anchor-id="ggplot_basics_facet"><span class="header-section-number">30.6</span> Фасеты/малые множества</h2>
<p>Для разбиения одного графика на многопанельные фигуры используются фасеты или “малые множества”, причем на каждую группу данных приходится одна панель (“фасет”). Один и тот же вид графика создается несколько раз, каждый раз с использованием подгруппы одного и того же набора данных.</p>
<p>Разбиение на фасеты - это функциональность, заложенная в <strong>ggplot2</strong>, поэтому легенды и оси “панелей” фасетов автоматически выравниваются. Существуют и другие пакеты, обсуждаемые на странице [советы по использованию ggplot], которые используются для объединения совершенно разных графиков (<strong>cowplot</strong> и <strong>patchwork</strong>) в один рисунок.</p>
<p>Разбиение на фасеты выполняется с помощью одной из следующих функций <strong>ggplot2</strong>:</p>
<ol type="1">
<li><code>facet_wrap()</code> Для отображения различных панелей для каждого уровня <em>одной</em> переменной. Примером может служить показ различных эпидемических кривых для каждой больницы в регионе. Фасеты упорядочиваются в алфавитном порядке, если только переменная не является фактором с другим порядком следования.<br>
</li>
</ol>
<ul>
<li><p>Вы можете использовать некоторые опции для определения расположения фасет, например, <code>nrow = 1</code> или <code>ncol = 1</code> для управления количеством строк или столбцов, в которых располагаются графики с фасетами.</p>
<ol start="2" type="1">
<li><code>facet_grid()</code> Используется в тех случаях, когда необходимо ввести вторую переменную в схему разбиения на фасеты. Здесь каждая панель сетки показывает пересечение значений в <em>двух столбцах</em>. Например, эпидемические кривые для каждой комбинации больница-возрастная группа с больницами сверху (столбцы) и возрастными группами по бокам (строки).<br>
</li>
</ol>
<ul>
<li><code>nrow</code> и <code>ncol</code> не имеют значения, так как подгруппы представлены в виде сетки</li>
</ul></li>
</ul>
<p>Каждая из этих функций принимает синтаксис формулы, задающей столбец (столбцы) для разбиения на фасеты. Обе принимают до двух столбцов, по одному с каждой стороны тильды <code>~</code>.</p>
<ul>
<li><p>Для <code>facet_wrap()</code> чаще всего пишется только один столбец, которому предшествует тильда <code>~</code>, например <code>facet_wrap(~hospital)</code>. Однако можно написать и два столбца <code>facet_wrap( outcome ~ hospital)</code> - каждая уникальная комбинация будет отображаться на отдельной панели, но они не будут расположены в виде сетки. В заголовках будут отображаться комбинированные термины, и они не будут иметь специфической логики для столбцов и строк. Если задается только одна переменная разбиения на фасеты, то точка <code>.</code> используется в качестве заполнителя на другой стороне формулы - см. примеры кода.</p></li>
<li><p>Для <code>facet_grid()</code> можно также указать в формуле одну или две строки (сетка <code>rows ~ columns</code>). Если требуется указать только один столбец, можно поставить точку <code>.</code> по другую сторону тильды, например, <code>facet_grid(. ~ hospital)</code> или <code>facet_grid(hospital ~ .)</code>.</p></li>
</ul>
<p>В фасетах может быстро оказаться слишком много информации, поэтому следует убедиться, что у вас не слишком много уровней каждой переменной, по которой вы решили построить фасет. Приведем несколько быстрых примеров с набором данных по малярии (см. [Скачивание руководства и данных]), который состоит из ежедневных подсчетов случаев заболевания малярией в учреждениях с разбивкой по возрастным группам.</p>
<p>Ниже мы импортируем данные и сделаем несколько быстрых модификаций для простоты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Эти данные представляют собой ежедневные подсчеты случаев заболевания малярией с разбивкой по дням пребывания в учреждении.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>malaria_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span>)) <span class="sc">%&gt;%</span>  <span class="co"># импорт</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>submitted_date, <span class="sc">-</span>Province, <span class="sc">-</span>newid)                                 <span class="co"># удалить ненужные столбцы</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ниже приведены первые 50 строк данных по малярии. Обратите внимание на наличие столбца <code>malaria_tot</code>, а также столбцов для подсчетов по возрастным группам (они будут использованы во втором примере <code>facet_grid()</code>).</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-a26b371d3f63934f0f63" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a26b371d3f63934f0f63">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1596499200000\" data-max=\"1597190400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"81\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"56\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"96\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"233\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 2","Facility 3","Facility 4","Facility 5","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 7","Facility 8","Facility 9","Facility 10","Facility 11","Facility 12","Facility 13","Facility 14","Facility 15","Facility 16","Facility 17","Facility 18","Facility 19","Facility 19","Facility 20","Facility 21","Facility 19","Facility 22","Facility 23","Facility 23","Facility 24","Facility 25","Facility 26","Facility 27","Facility 28","Facility 29","Facility 30","Facility 30","Facility 31","Facility 31","Facility 32","Facility 33","Facility 33","Facility 7","Facility 30","Facility 30","Facility 30","Facility 30","Facility 34","Facility 35"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-09","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-09","2020-08-11","2020-08-11","2020-08-12","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-06","2020-08-04","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-07","2020-08-09","2020-08-10","2020-08-11","2020-08-11","2020-08-10"],["Spring","Bolo","Dingo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Bolo","Spring","Bolo","Spring","Dingo","Bolo","Dingo","Barnard","Barnard","Barnard","Bolo","Bolo","Bolo","Barnard","Bolo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Spring","Dingo","Bolo","Bolo","Dingo","Dingo","Spring","Barnard","Barnard","Spring","Bolo","Bolo","Bolo","Bolo","Dingo","Spring"],[11,11,8,16,9,3,4,15,11,19,12,7,27,0,17,36,0,5,6,9,4,7,12,4,14,28,5,11,8,8,21,7,3,7,9,19,28,9,11,7,26,0,4,8,5,25,21,9,4,81],[12,10,5,16,2,1,0,14,11,15,7,1,8,10,15,36,0,1,3,9,4,0,2,7,9,18,3,4,7,7,0,3,2,4,7,4,14,8,2,10,35,2,4,9,9,14,25,20,9,56],[23,5,5,17,6,4,3,13,13,15,13,20,18,24,28,62,0,10,2,16,1,6,18,41,14,5,24,13,16,16,41,13,5,11,33,23,54,10,11,16,30,8,2,11,29,31,38,26,17,96],[46,26,18,49,17,8,7,42,35,49,32,28,53,34,60,134,0,16,11,34,9,13,32,52,37,51,32,28,31,31,62,23,10,22,49,46,96,27,24,33,91,10,10,28,43,70,84,55,30,233]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_rdt_0-4<\/th>\n      <th>malaria_rdt_5-14<\/th>\n      <th>malaria_rdt_15<\/th>\n      <th>malaria_tot<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]},{"name":"location_name","targets":0},{"name":"data_date","targets":1},{"name":"District","targets":2},{"name":"malaria_rdt_0-4","targets":3},{"name":"malaria_rdt_5-14","targets":4},{"name":"malaria_rdt_15","targets":5},{"name":"malaria_tot","targets":6}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="facet_wrap" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="facet_wrap"><code>facet_wrap()</code></h3>
<p>Пока остановимся на столбцах <code>malaria_tot</code> и <code>District</code>. Столбцы с возрастными показателями пока проигнорируем. Мы построим эпидемические кривые с помощью функции <code>geom_col()</code>, которая создает столбец для каждого дня на заданной высоте оси y, указанной в столбце <code>malaria_tot</code> (данные уже являются ежедневными подсчетами, поэтому мы используем <code>geom_col()</code> - см. раздел <a href="#ggplot_basics_bars">” Столбчатая диаграмма” ниже</a>).</p>
<p>При добавлении команды <code>facet_wrap()</code> мы указываем тильду, а затем столбец для создания фасет (в данном случае <code>District</code>). Вы можете поместить еще один столбец слева от тильды - это создаст по одному фасету для каждой комбинации, - но мы рекомендуем вместо этого использовать команду <code>facet_grid()</code>. В данном случае для каждого уникального значения <code>District</code> создается один фасет.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># График с фасетами по районам</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       <span class="co"># построить график данных подсчета в виде столбцов</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                              <span class="co"># упростить фоновые панели</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(                                         <span class="co"># добавить метки графика, заголовок и т.д.</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date of report"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Malaria cases"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Malaria cases by district"</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>District)                       <span class="co"># создаются фасеты</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="facet_grid" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="facet_grid"><code>facet_grid()</code></h3>
<p>Для пересечения двух переменных мы можем использовать подход <code>facet_grid()</code>. Допустим, мы хотим пересечь <code>District</code> и возраст. Тогда нам необходимо выполнить некоторые преобразования данных в столбцах возраста, чтобы привести эти данные к предпочтительному для ggplot “длинному” формату. У возрастных групп есть свои собственные столбцы - мы хотим, чтобы они были в одном столбце <code>age_group</code> и в другом <code>num_cases</code>. Подробнее об этом см. на странице [Поворот данных].</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>malaria_age <span class="ot">&lt;-</span> malaria_data <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>malaria_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"malaria_rdt_"</span>)),  <span class="co"># выбрать столбцы для поворота в длину</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"age_group"</span>,      <span class="co"># названия столбцов становятся возрастными группами</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"num_cases"</span>      <span class="co"># значения в один столбец (num_cases)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">str_replace</span>(age_group, <span class="st">"malaria_rdt_"</span>, <span class="st">""</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(age_group, <span class="st">"5-14"</span>, <span class="at">after =</span> <span class="dv">1</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Теперь первые 50 строк данных выглядят следующим образом:</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-36f83ffcde9828bdbccf" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-36f83ffcde9828bdbccf">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1596844800000\" data-max=\"1.597104e+12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-14&quot;,&quot;15&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"62\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 1","Facility 1","Facility 2","Facility 2","Facility 2","Facility 3","Facility 3","Facility 3","Facility 4","Facility 4","Facility 4","Facility 5","Facility 5","Facility 5","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 7","Facility 7","Facility 7","Facility 8","Facility 8","Facility 8","Facility 9","Facility 9","Facility 9","Facility 10","Facility 10","Facility 10","Facility 11","Facility 11","Facility 11","Facility 12","Facility 12","Facility 12","Facility 13","Facility 13"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-09","2020-08-09","2020-08-09","2020-08-08","2020-08-08","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11"],["Spring","Spring","Spring","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Dingo","Dingo","Dingo","Bolo","Bolo"],["0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14"],[11,12,23,11,10,5,8,5,5,16,16,17,9,2,6,3,1,4,4,0,3,15,14,13,11,11,13,19,15,15,12,7,13,7,1,20,27,8,18,0,10,24,17,15,28,36,36,62,0,0]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>age_group<\/th>\n      <th>num_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4},{"name":"location_name","targets":0},{"name":"data_date","targets":1},{"name":"District","targets":2},{"name":"age_group","targets":3},{"name":"num_cases","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>При передаче двух переменных в <code>facet_grid()</code> проще всего использовать формулу(например, <code>x ~ y</code>), где x - это строки, а y - столбцы. Вот график, использующий <code>facet_grid()</code> для отображения графиков для каждой комбинации столбцов <code>age_group</code> и <code>District</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_age, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> num_cases)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date of report"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Malaria cases"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Malaria cases by district and age group"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(District <span class="sc">~</span> age_group)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="свободные-или-фиксированные-оси" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="свободные-или-фиксированные-оси">Свободные или фиксированные оси</h3>
<p>Масштабы осей, отображаемые при делении на фасеты, по умолчанию одинаковы (фиксированы) для всех фасет. Это полезно для перекрестного сравнения, но не всегда уместно.</p>
<p>При использовании <code>facet_wrap()</code> или <code>facet_grid()</code> можно добавить <code>scales = "free_y"</code>, чтобы “освободить” или отпустить оси y панелей для масштабирования в соответствии с их подмножеством данных. Это особенно полезно, если фактические значения для одной из подкатегорий невелики и тенденции трудно заметить. Вместо “free_y” можно также написать “free_x”, чтобы сделать то же самое для оси x (например, для дат), или “free” для обеих осей. Обратите внимание на то, что в <code>facet_grid</code> масштабы y будут одинаковыми для фасет в одной строке, а масштабы x - для фасет в одном столбце.</p>
<p>При использовании только <code>facet_grid</code> можно добавить <code>space = "free_y"</code> или <code>space = "free_x"</code>, чтобы фактическая высота или ширина фасета взвешивалась по отношению к значениям фигур внутри нее. Это работает только в том случае, если уже применено <code>scales = "free"</code> (y или x).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Свободная ось y</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       <span class="co"># построить график данных подсчета в виде столбцов</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                              <span class="co"># упростить фоновые панели</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(                                         <span class="co"># добавить метки графика, заголовок и т.д.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date of report"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Malaria cases"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Malaria cases by district - 'free' x and y axes"</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>District, <span class="at">scales =</span> <span class="st">"free"</span>)        <span class="co"># создаются фасеты</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<!-- ```{r fig.show='hold', message=FALSE, warning=FALSE, out.width=c('50%', '50%')} -->
<!-- # A) Фасет Дата госпитализации по больнице, свободная ось y -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # фильтр удаляет неизвестную больницу -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "A) Histogram with free y axis scales")+ -->
<!--   facet_grid(hospital~., # Фасет с больницей в качестве строки  -->
<!--              scales = "free_y") # Свободный масштаб оси для каждого фасета -->
<!-- # B) Фасет Дата госпитализации по больницам, свободная ось y и вертикальный интервал -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # фильтр удаляет неизвестную больницу -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "B) Histogram with free y axis scales and spacing")+ -->
<!--   facet_grid(hospital~., # Фасет с больницей в качестве строки  -->
<!--              scales = "free_y", # Свободный масштаб оси для каждого фасета -->
<!--              space = "free_y") # Свободное вертикальное расположение каждого фасета для оптимизации пространства -->
<!-- ``` -->
</section>
<section id="порядок-уровней-факторов-в-фасетах" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="порядок-уровней-факторов-в-фасетах">Порядок уровней факторов в фасетах</h3>
<p>О том, как переупорядочить уровни факторов <em>внутри</em> фасетов, см. этот <a href="https://juliasilge.com/blog/reorder-within/">пост</a>.</p>
</section>
</section>
<section id="хранение-графиков" class="level2" data-number="30.7">
<h2 data-number="30.7" class="anchored" data-anchor-id="хранение-графиков"><span class="header-section-number">30.7</span> Хранение графиков</h2>
<section id="сохранение-графиков" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="сохранение-графиков">Сохранение графиков</h3>
<p>По умолчанию при выполнении команды <code>ggplot()</code> график выводится на панель Plots RStudio. Однако можно сохранить график как объект, используя оператор присваивания <code>&lt;-</code> и задав ему название. Тогда он не будет печататься, пока не будет запущено само название объекта. Можно также вывести его на печать, обернув название графика в <code>print()</code>, но это необходимо только в некоторых случаях, например, если график создается <em>внутри цикла</em>, используемого для печати нескольких графиков одновременно (см. страницу [Итерации, циклы и списки]).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># определить график</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>age_by_wt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age_years, <span class="at">y =</span> wt_kg, <span class="at">color =</span> age_years))<span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># печать</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>age_by_wt    </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-29-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="изменение-сохраненных-графиков" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="изменение-сохраненных-графиков">Изменение сохраненных графиков</h3>
<p>Удобство работы с <strong>ggplot2</strong> заключается в том, что вы можете определить график (как описано выше), а затем добавить к нему слои, начиная с его названия. При этом не нужно повторять все команды, создавшие исходный график!</p>
<p>Например, чтобы изменить график <code>age_by_wt</code>, который был определен выше, и включить в него вертикальную линию в возрасте 50 лет, достаточно добавить <code>+</code> и начать добавлять дополнительные слои к графику.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>age_by_wt<span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">50</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="экспорт-графиков" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="экспорт-графиков">Экспорт графиков</h3>
<p>Экспорт ggplots упрощается с помощью функции <code>ggsave()</code> из <strong>ggplot2</strong>. Она может работать двумя способами:</p>
<ul>
<li>Укажите имя объекта графика, затем путь к файлу и его название с расширением
<ul>
<li>Например: <code>ggsave(my_plot, here("plots", "my_plot.png"))</code>.<br>
</li>
</ul></li>
<li>Выполните команду, указав только путь к файлу, чтобы сохранить последний распечатанный график
<ul>
<li>Например: <code>ggsave(here("plots", "my_plot.png"))</code></li>
</ul></li>
</ul>
<p>Можно экспортировать в png, pdf, jpeg, tiff, bmp, svg или в несколько других типах файлов, указав расширение файла в пути к нему.</p>
<p>Также можно указать аргументы <code>width =</code>, <code>height =</code> и <code>units =</code> (либо ” дюйм”, либо “см”, либо “мм”). Также можно указать <code>dpi =</code> с числом для разрешения графика (например, 300). Подробнее о функции можно узнать, введя <code>?ggsave</code> или прочитав <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">документацию онлайн</a>.</p>
<p>Помните, что для указания нужного пути к файлу можно использовать синтаксис <code>here()</code>. Более подробную информацию см. на странице [Импорт и экспорт].</p>
</section>
</section>
<section id="метки" class="level2" data-number="30.8">
<h2 data-number="30.8" class="anchored" data-anchor-id="метки"><span class="header-section-number">30.8</span> Метки</h2>
<p>Наверняка вы захотите добавить или скорректировать метки графика. Это проще всего сделать в функции <code>labs()</code>, которая добавляется к графику с помощью <code>+</code> так же, как и геомы.</p>
<p>В функции <code>labs()</code> можно указать последовательность символов для этих аргументов:</p>
<ul>
<li><code>x =</code> и <code>y =</code> Заголовок (метки) оси x и оси y<br>
</li>
<li><code>title =</code> Основной заголовок графика<br>
</li>
<li><code>subtitle =</code> Подзаголовок графика, более мелким шрифтом под заголовком<br>
</li>
<li><code>caption =</code> Подпись к графику, по умолчанию в правом нижнем углу</li>
</ul>
<p>Вот график, который мы сделали ранее, но с более красивыми метками:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>age_by_wt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist,   <span class="co"># задать данные</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># сопоставить эстетические характеристики со значениями столбцов</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># сопоставить ось x с возрастом            </span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># сопоставить ось y с весом</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age))<span class="sc">+</span>     <span class="co"># сопоставить цвет с возрастом</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span>           <span class="co"># отобразить данные в виде точек</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Age and weight distribution"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Fictional Ebola outbreak, 2014"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age in years"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Weight in kilos"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Age"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"Data as of {max(linelist$date_hospitalisation, na.rm=T)}"</span>))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>age_by_wt</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-31-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Обратите внимание на то, как в задании по созданию подписи мы использовали <code>str_glue()</code> из пакета <strong>stringr</strong> для встраивания динамического кода R в текст строки. В подписи будет отображаться дата “Данные по состоянию на:”, которая отражает максимальную дату госпитализации в построчном списке. Подробнее об этом читайте на странице [текст и последовательности].</p>
<p>Относительно указания названия <em>легенды</em>: Не существует единого аргумента “название легенды”, поскольку в легенде может быть несколько шкал. Внутри <code>labs()</code> можно написать аргумент для эстетики графика, используемой для создания легенды, и таким образом указать название. Например, выше мы назначили <code>color = age</code> для создания легенды. Следовательно, мы указываем <code>color =</code> to <code>labs()</code> и присваиваем легенде желаемый заголовок (“Возраст” с большой буквы). Если вы создаете легенду с помощью <code>aes(fill = COLUMN)</code>, то в <code>labs()</code> вы напишете <code>fill =</code>, чтобы настроить заголовок этой легенды. Раздел о цветовых шкалах на странице [советы по использованию ggplot] содержит более подробную информацию о редактировании легенд, а также альтернативный подход с использованием функций <code>scales_()</code>.</p>
</section>
<section id="ggplot_basics_themes" class="level2" data-number="30.9">
<h2 data-number="30.9" class="anchored" data-anchor-id="ggplot_basics_themes"><span class="header-section-number">30.9</span> Темы</h2>
<p>Одним из преимуществ <strong>ggplot2</strong> является возможность контроля над графиком - вы можете определить все, что угодно! Как уже говорилось выше, дизайн графика, который <em>не</em> связан с формами/геометриями данных, настраивается в рамках функции <code>theme()</code>. Например, цвет фона графика, наличие/отсутствие линий сетки, шрифт/размер/цвет/выравнивание текста (заголовки, подзаголовки, подписи, текст осей…). Эти настройки могут быть выполнены одним из двух способов:</p>
<ul>
<li>Добавить настройку <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><em>полная тема</em></a> <code>theme_()</code> для выполнения комплексных изменений - например, <code>theme_classic()</code>, <code>theme_minimal()</code>, <code>theme_dark()</code>, <code>theme_light()</code>, <code>theme_grey()</code>, <code>theme_bw()</code> и др.<br>
</li>
<li>Настроить каждый мельчайший аспект графика индивидуально в рамках <code>theme()</code></li>
</ul>
<section id="полные-темы" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="полные-темы">Полные темы</h3>
<p>Поскольку они достаточно просты, мы продемонстрируем функции полной темы ниже и не будем описывать их здесь. Обратите внимание, что любые микрокорректировки с помощью <code>theme()</code> должны производиться <em>после</em> использования полной темы.</p>
<p>Записывайте их с пустыми круглыми скобками.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme classic"</span>)<span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme bw"</span>)<span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme minimal"</span>)<span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme gray"</span>)<span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-32-4.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="изменение-темы" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="изменение-темы">Изменение темы</h3>
<p>Функция <code>theme()</code> может принимать большое количество аргументов, каждый из которых изменяет очень специфический аспект графика. Мы не сможем рассказать обо всех аргументах, но опишем их общий вид и покажем, как найти название нужного аргумента. Основной синтаксис выглядит следующим образом:</p>
<ol type="1">
<li>Внутри <code>theme()</code> запишите название аргумента для редактируемого элемента графика, например, <code>plot.title =</code>.<br>
</li>
<li>Присвойте аргументу функцию <code>element_()</code>.
<ul>
<li>Чаще всего используется <code>element_text()</code>, но можно использовать и другие функции, например <code>element_rect()</code> для цвета фона полотна или <code>element_blank()</code> для удаления элементов графика<br>
</li>
</ul></li>
<li>Внутри функции <code>element_()</code> напишите назначения аргументов, чтобы выполнить желаемые настройки</li>
</ol>
<p>Итак, это описание было достаточно абстрактным, поэтому приведем несколько примеров.</p>
<p>Приведенный ниже график выглядит довольно глупо, но он служит для того, чтобы показать разнообразие способов настройки графика.</p>
<ul>
<li>Мы начинаем с графика <code>age_by_wt</code>, определенного чуть выше, и добавляем <code>theme_classic()</code>.<br>
</li>
<li>Для более детальной настройки мы добавляем <code>theme()</code> и включаем по одному аргументу для каждого элемента графика, который необходимо настроить.</li>
</ul>
<p>Не лишним будет организовать аргументы в логические секции. Ниже описаны лишь некоторые из них:</p>
<ul>
<li><code>legend.position =</code> уникален тем, что принимает такие простые значения, как ““низ”“,”верх”“,”лево”” и “право”“. Но обычно аргументы, связанные с текстом, требуют размещения деталей <em>в пределах</em> <code>element_text()</code>.<br>
</li>
<li>Размер заголовка меняется с помощью <code>element_text(size = 30)</code><br>
</li>
<li>Выравнивание заголовка по горизонтали - с помощью <code>element_text(hjust = 0)</code> (справа налево)<br>
</li>
<li>Подзаголовок выделяется курсивом с помощью <code>element_text(face = "italic")</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>age_by_wt <span class="sc">+</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span>                                 <span class="co"># предварительно заданные настройки темы</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,                    <span class="co"># перенести легенду в нижнюю часть</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),          <span class="co"># размер заголовка до 30</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),        <span class="co"># надпись с выравниванием по левому краю</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>), <span class="co"># выделение подзаголовка курсивом</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">15</span>, <span class="at">angle =</span> <span class="dv">90</span>), <span class="co"># корректирует только текст по оси x</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),         <span class="co"># корректирует только текст по оси y</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)           <span class="co"># корректирует заголовки обеих осей</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    )     </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Вот некоторые особенно часто встречающиеся аргументы <code>theme()</code>. Вы узнаете некоторые закономерности, например, добавление <code>.x</code> или <code>.y</code> для применения изменения только к одной оси.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 49%">
</colgroup>
<thead>
<tr class="header">
<th>аргумент <code>theme()</code></th>
<th>Что он корректирует</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plot.title = element_text()</code></td>
<td>Заголовок</td>
</tr>
<tr class="even">
<td><code>plot.subtitle = element_text()</code></td>
<td>Подзаголовок</td>
</tr>
<tr class="odd">
<td><code>plot.caption = element_text()</code></td>
<td>Подпись (обводка, цвет, размер, угол, vjust, hjust…)</td>
</tr>
<tr class="even">
<td><code>axis.title = element_text()</code></td>
<td>Заголовки осей (как x, так и y) ( размер, обводка, угол, цвет…)</td>
</tr>
<tr class="odd">
<td><code>axis.title.x = element_text()</code></td>
<td>Заголовок оси только по оси x ( используйте <code>.y</code> только для оси y)</td>
</tr>
<tr class="even">
<td><code>axis.text = element_text()</code></td>
<td>Текст оси (как по оси x, так и по оси y)</td>
</tr>
<tr class="odd">
<td><code>axis.text.x = element_text()</code></td>
<td>Текст оси только по оси x (используйте <code>.y</code> только для оси y)</td>
</tr>
<tr class="even">
<td><code>axis.ticks = element_blank()</code></td>
<td>Удаление отметок оси</td>
</tr>
<tr class="odd">
<td><code>axis.line = element_line()</code></td>
<td>Линии оси (цвет, размер, тип линии: сплошная пунктирная и т.д.)</td>
</tr>
<tr class="even">
<td><code>strip.text = element_text()</code></td>
<td>Текст полосы фасета (цвет, обводка, размер, угол наклона…)</td>
</tr>
<tr class="odd">
<td><code>strip.background = element_rect()</code></td>
<td>Полоса фасета (заливка, цвет, размер…)</td>
</tr>
</tbody>
</table>
<p>Но ведь аргументов тем так много! Как же их запомнить? Не волнуйтесь - запомнить их все невозможно. К счастью, есть ряд инструментов, которые вам помогут:</p>
<p>Существует документация <strong>tidyverse</strong> по вопросу <a href="https://ggplot2.tidyverse.org/reference/theme.html">изменение темы</a>, в которой приведен полный список.</p>
<p><span style="color: darkgreen;"><strong><em>СОВЕТ:</em></strong> Запустите <code>theme_get()</code> из <strong>ggplot2</strong>, чтобы вывести на консоль список всех 90+ аргументов <code>theme()</code>.</span></p>
<p><span style="color: darkgreen;"><strong><em>СОВЕТ:</em></strong> При необходимости удалить элемент графика это можно сделать и через <code>theme()</code>. Достаточно передать в качестве аргумента <code>element_blank()</code>, чтобы он полностью исчез. Для легенд задайте <code>legend.position = "none".</code></span>.</p>
</section>
</section>
<section id="цвета" class="level2" data-number="30.10">
<h2 data-number="30.10" class="anchored" data-anchor-id="цвета"><span class="header-section-number">30.10</span> Цвета</h2>
<p>Посмотрите этот <a href="ggplot_tips.ru.html#ggplot_tips_colors">раздел о цветовых шкалах страницы советы по использованию ggplot</a>.</p>
</section>
<section id="привязывание-к-ggplot2" class="level2" data-number="30.11">
<h2 data-number="30.11" class="anchored" data-anchor-id="привязывание-к-ggplot2"><span class="header-section-number">30.11</span> Привязывание к <strong>ggplot2</strong></h2>
<p>При использовании каналов для вычистки и преобразования данных можно легко передать преобразованные данные в функцию <code>ggplot()</code>.</p>
<p>Каналы, передающие набор данных от функции к функции, перейдут в <code>+</code> после вызова функции <code>ggplot()</code>. Обратите внимание на то, что в этом случае нет необходимости указывать аргумент <code>data =</code>, так как он автоматически определяется как передаваемый по каналу набор данных.</p>
<p>Вот как это может выглядеть:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                                                     <span class="co"># начать с построчного списка</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(case_id, fever, chills, cough, aches, vomit)) <span class="sc">%&gt;%</span>     <span class="co"># выбрать столбцы</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(                                                  <span class="co"># повернуть в длину</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>case_id,                                  </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"symptom_name"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"symptom_is_present"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(                                                        <span class="co"># заменить отсутствующие значения</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">symptom_is_present =</span> <span class="fu">replace_na</span>(symptom_is_present, <span class="st">"unknown"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(                                                        <span class="co"># начать ggplot!</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> symptom_name, <span class="at">fill =</span> symptom_is_present))<span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span>                    </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Symptom"</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Symptom status (proportion)"</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="построение-графика-непрерывных-данных" class="level2" data-number="30.12">
<h2 data-number="30.12" class="anchored" data-anchor-id="построение-графика-непрерывных-данных"><span class="header-section-number">30.12</span> Построение графика непрерывных данных</h2>
<p>На этой странице вы уже видели множество примеров построения графиков непрерывных данных. Здесь мы кратко обобщим их и представим несколько вариантов.<br>
Здесь рассматриваются такие виды визуализации, как:</p>
<ul>
<li>Графики для одной непрерывной переменной:
<ul>
<li><strong>Гистограмма</strong> - классический график для представления распределения непрерывной переменной.</li>
</ul></li>
<li><strong>Коробчатая диаграмма</strong> (также называемая “ящиком с усами”) позволяет показать 25-й, 50-й и 75-й процентили, хвостовые части распределения и выбивающиеся значения (<a href="https://www.data-to-viz.com/caveat/boxplot.html">важные ограничения</a>).<br>
</li>
<li><strong>График с функцией дрожания</strong> - отображение всех значений в виде точек, которые “дрожат”, так что все они (в основном) видны, даже если два из них имеют одинаковое значение.</li>
<li><strong>Скрипичный график</strong>, показывает распределение непрерывной переменной на основе симметричной ширины “скрипки”.</li>
<li><strong>График Sinaplot</strong> - комбинация графиков с функцией джиттера и скрипичного графика, где отдельные точки отображаются, но в симметричной форме распределения (с помощью пакета <strong>ggforce</strong>).<br>
</li>
<li><strong>График рассеяния</strong> для двух непрерывных переменных.<br>
</li>
<li><strong>Тепловые графики</strong> для трех непрерывных переменных (ссылка на страницу [Тепловые графики])</li>
</ul>
<section id="гистограммы" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="гистограммы">Гистограммы</h3>
<p>Гистограммы похожи на столбчатые диаграммы, но отличаются от них тем, что измеряют распределение <em>непрерывной</em> переменной. Пробелы между “столбиками” отсутствуют, и в <code>geom_histogram()</code> передается только один столбец.</p>
<p>Ниже приведен код для создания <strong>гистограмм</strong>, которые группируют непрерывные данные по диапазонам и отображают в виде смежных столбиков разной высоты. Для этого используется функция <code>geom_histogram()</code>. Разницу между <code>geom_histogram()</code>, <code>geom_bar()</code> и <code>geom_col()</code> см. в разделе <a href="#ggplot_basics_bars">” Столбчатые диаграммы”</a> на странице Основы ggplot.</p>
<p>Мы покажем распределение возрастов случаев. В <code>mapping = aes()</code> укажите, по какому столбцу вы хотите видеть распределение. Этот столбец можно отнести как к оси x, так и к оси y.</p>
<p>Строки будут распределены по “корзинам” в зависимости от их числового возраста, и эти корзины будут графически представлены в виде столбцов. Если задать число корзин с помощью параметра <code>bins =</code>, то точки разрыва будут равномерно распределены между минимальными и максимальными значениями гистограммы. Если <code>bins =</code> не задано, то будет предложено соответствующее количество корзин, и после построения графика будет выведено соответствующее сообщение:</p>
<pre><code>## `stat_bin()`, используя `bins = 30`. Подберите лучшее значение с помощью `binwidth`.</code></pre>
<p>Если вы не хотите указывать число корзин в <code>bins =</code>, то в качестве альтернативы можно указать <code>binwidth =</code> в единицах измерения оси. Приведем несколько примеров, демонстрирующих различные корзины и ширину корзин:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Обычная гистограмма</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># предоставить переменную x</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Default histogram (30 bins)"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Больше корзин</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># предоставить переменную x</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>)<span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Set to 50 bins"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># C) Меньше корзин </span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># предоставить переменную x</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C) Set to 5 bins"</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co"># D) Больше корзин </span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># предоставить переменную x</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"D) binwidth of 1"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-3.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-35-4.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Для получения сглаженных пропорций можно использовать <code>geom_density()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Частота с осью пропорций, сглаженных</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportional density"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Сложенные частоты с осью пропорций, сглаженных</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">"stack"</span>)<span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"'Stacked' proportional densities"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-36-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-36-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Чтобы получить гистограмму “с накоплением” (непрерывного столбца данных), можно выполнить одно из следующих действий:</p>
<ol type="1">
<li>Использовать <code>geom_histogram()</code> с аргументом <code>fill =</code> внутри <code>aes()</code> и назначением столбца группировки, или<br>
</li>
<li>Использовать функцию <code>geom_freqpoly()</code>, которая, скорее всего, будет более удобной для чтения (при этом можно задать <code>binwidth =</code>)<br>
</li>
<li>Чтобы увидеть пропорции всех значений, задайте <code>y = after_stat(density)</code> (используйте именно этот синтаксис - он не изменен для ваших данных). Примечание: эти пропорции будут показаны <em>для каждой группы</em>.</li>
</ol>
<p>Ниже показан каждый вариант (*обратите внимание на использование <code>color =</code> по сравнению с <code>fill =</code> в каждом случае):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Гистограмма с накоплением</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"'Stacked' histogram"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Частота </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Freqpoly"</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Частота с осью пропорций</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportional freqpoly"</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Частота с осью пропорций, сглаженных</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportional, smoothed with geom_density()"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-3.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-37-4.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Если вы хотите немного развлечься, попробуйте <code>geom_density_ridges</code> из пакета <strong>ggridges</strong> (<a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html">виньетка здесь</a>.</p>
<p>Более подробно о гистограммах можно прочитать на <strong>tidyverse</strong> <a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">страница geom_histogram()</a>.</p>
</section>
<section id="коробчатые-диаграммы" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="коробчатые-диаграммы">Коробчатые диаграммы</h3>
<p>Коробчатые диаграммы широко распространены, но имеют существенные ограничения. Они могут скрывать реальное распределение - например, бимодальное распределение. Подробнее об этом см. здесь <a href="https://www.r-graph-gallery.com/boxplot.html">галерея R graph</a> и здесь <a href="https://www.data-to-viz.com/caveat/boxplot.html">статья “От данных к визуализации”</a>. Однако они хорошо отображают интерквартильный диапазон и выпадающие значения, поэтому их можно накладывать поверх других типов графиков, которые показывают распределение более подробно.</p>
<p>Ниже мы напомним вам о различных компонентах коробочной диаграммы:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/boxplot.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="../images/boxplot.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>При использовании <code>geom_boxplot()</code> для создания коробчатой диаграммы обычно задается только одна ось (x или y) в рамках <code>aes()</code>. Указанная ось определяет, будут ли графики горизонтальными или вертикальными.</p>
<p>В большинстве геомов график для каждой группы создается путем привязки эстетики типа <code>color =</code> или <code>fill =</code> к столбцу в <code>aes()</code>. Однако для коробчатых диаграмм это достигается путем назначения столбца группировки на неназначенную ось (x или y). Ниже приведен код для построения коробчатой диаграммы <em>всех</em> значений возраста в наборе данных, а второй код - для отображения одной коробчатой диаграммы для каждого (не пропущенного) пола в наборе данных. Обратите внимание, что значения <code>NA</code> (“отсутствующие”) будут отображаться в виде отдельной коробчатой диаграммы, если их не удалить. В этом примере мы также установили <code>fill</code> для столбца <code>outcome</code>, чтобы каждый график был разного цвета - но это не обязательно.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) вся коробчатая диаграмма</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span>  </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age))<span class="sc">+</span>   <span class="co"># сопоставлена только ось y (не x)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Overall boxplot"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Коробчатая диаграмма по группам </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age, <span class="at">x =</span> gender, <span class="at">fill =</span> gender)) <span class="sc">+</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span>                     </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span>   <span class="co"># удалить легенду (лишняя)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Boxplot by gender"</span>)      </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-39-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-39-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-39-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Код для добавления коробчатой диаграммы к краям диаграммы рассеяния (“маргинальные” графики) приведен на странице [советы по использованию ggplot].</p>
</section>
<section id="скрипичный-график-графис-с-дрожанием-и-график-sina" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="скрипичный-график-графис-с-дрожанием-и-график-sina">Скрипичный график, графис с “дрожанием” и график sina</h3>
<p>Ниже приведен код для построения <strong>скрипичных графиков</strong> (<code>geom_violin</code>) и <strong>графиков с фугкцией дрожания</strong> (<code>geom_jitter</code>) для отображения распределений. Вы можете указать, что заливка или цвет также определяются данными, вставив эти опции в <code>aes()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) График с функцией дрожания по группам</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome),      <span class="co"># удаление отсутствующих значений</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age,                     <span class="co"># Непрерывная переменная</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> outcome,                           <span class="co"># Переменная группировки</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> outcome))<span class="sc">+</span>                     <span class="co"># Переменная цвета</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()<span class="sc">+</span>                                  <span class="co"># Создание скрипичного графика</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) jitter plot by gender"</span>)     </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Скрипичный график по группам</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome),       <span class="co"># удаление отсутствующих значений</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age,                      <span class="co"># Непрерывная переменная</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> outcome,                            <span class="co"># Переменная группировки</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> outcome))<span class="sc">+</span>                       <span class="co"># Переменная заливки (цвета)</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()<span class="sc">+</span>                                   <span class="co"># Создание скрипичного графика</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) violin plot by gender"</span>)    </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-40-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-40-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-40-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Их можно объединить с помощью функции <code>geom_sina()</code> из пакета <strong>ggforce</strong>. Функция sina строит графики точек дрожания в форме скрипичного графика. При наложении на скрипичный график (регулируя прозрачность) это может быть легче визуально интерпретировать.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) График Sina по группам </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> age,           <span class="co"># числовая переменная</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> outcome)) <span class="sc">+</span>    <span class="co"># переменная группы</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> outcome), <span class="co"># заливка (цвет фона скрипки)</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>,     <span class="co"># белый контур</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span>        <span class="co"># прозрачность</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sina</span>(</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="dv">1</span>,                <span class="co"># Изменение величины дрожания</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> outcome))<span class="sc">+</span> <span class="co"># цвет (цвет точек)</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(       <span class="co"># Определить заливку для фона скрипки по смерти/выздоровлению</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Death"</span> <span class="ot">=</span> <span class="st">"#bf5300"</span>, </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Recover"</span> <span class="ot">=</span> <span class="st">"#11118c"</span>)) <span class="sc">+</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(      <span class="co"># Определение цветов для точек по смерти/выздоровлению</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Death"</span> <span class="ot">=</span> <span class="st">"#bf5300"</span>, </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Recover"</span> <span class="ot">=</span> <span class="st">"#11118c"</span>)) <span class="sc">+</span> </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>                                <span class="co"># удалить серый фон</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span>                <span class="co"># Удалить ненужную легенду</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) violin and sina plot by gender, with extra formatting"</span>)      </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-41-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="две-непрерывные-переменные" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="две-непрерывные-переменные">Две непрерывные переменные</h3>
<p>Используя аналогичный синтаксис, функция <code>geom_point()</code> позволяет построить <strong>график рассеивания</strong> двух непрерывных переменных относительно друг друга. Это удобно для отображения фактических значений, а не их распределений. Базовый график рассеивания возраста и веса показан в (A). В (B) мы снова используем <code>facet_grid()</code>, чтобы показать связь между двумя непрерывными переменными в построчном списке.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Базовый график рассеяния веса и возраста</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Scatter plot of weight and age"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># График рассеивания веса и возраста в зависимости от пола и исхода болезни Эбола</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(gender, outcome), <span class="co"># фильтр сохраняет непропущенные пол/результат</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Scatter plot of weight and age faceted by gender and outcome"</span>)<span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(gender <span class="sc">~</span> outcome) </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-42-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="три-непрерывные-переменные" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="три-непрерывные-переменные">Три непрерывные переменные</h3>
<p>С помощью аргумента <code>fill =</code> можно отобразить три непрерывные переменные, создав <em>тепловой график</em>. Цвет каждой “ячейки” будет отражать значение третьего непрерывного столбца данных. Более подробную информацию и несколько примеров см. на странице [советы по использованию ggplot] и на странице [Тепловые графики].</p>
<p>Существуют способы построения трехмерных графиков в R, но для прикладной эпидемиологии они часто трудно интерпретируемы и поэтому менее полезны для принятия решений.</p>
</section>
</section>
<section id="построение-графиков-категориальных-данных" class="level2" data-number="30.13">
<h2 data-number="30.13" class="anchored" data-anchor-id="построение-графиков-категориальных-данных"><span class="header-section-number">30.13</span> Построение графиков категориальных данных</h2>
<p>Категориальные данные могут представлять собой символьные значения, могут быть логическими (“ИСТИНА/ЛОЖЬ”) или факторами (см. страницу [Факторы]).</p>
<section id="подготовка-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="подготовка-1">Подготовка</h3>
<section id="структура-данных" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="структура-данных">Структура данных</h4>
<p>Прежде всего, необходимо понять, в каком виде существуют категориальные данные: в виде необработанных наблюдений, например, в виде построчного списка случаев, или в виде сводного или агрегированного датафрейма, содержащего подсчеты или пропорции. Состояние данных будет влиять на то, какую функцию построения графиков вы будете использовать:</p>
<ul>
<li>Если данные представляют собой необработанные наблюдения с одной строкой на наблюдение, то, скорее всего, будет использована функция <code>geom_bar()</code>.<br>
</li>
<li>Если данные уже агрегированы в виде подсчетов или пропорций, то, скорее всего, используется <code>geom_col()</code>.</li>
</ul>
</section>
<section id="класс-столбца-и-упорядочение-значений" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="класс-столбца-и-упорядочение-значений">Класс столбца и упорядочение значений</h4>
<p>Далее исследуйте класс столбцов, которые вы хотите построить. Мы рассматриваем <code>hospital</code>, сначала с помощью <code>class()</code> из <strong>базового</strong> R, а затем с помощью <code>tabyl()</code> из <strong>janitor</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Посмотрите на класс столбца больницы - мы видим, что это символ</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>hospital)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Рассмотрите значения и пропорции в столбце больниц</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(hospital)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             hospital    n    percent
                     Central Hospital  454 0.07710598
                    Military Hospital  896 0.15217391
                              Missing 1469 0.24949049
                                Other  885 0.15030571
                        Port Hospital 1762 0.29925272
 St. Mark's Maternity Hospital (SMMH)  422 0.07167120</code></pre>
</div>
</div>
<p>Мы видим, что значения внутри являются символами, так как это названия больниц, и по умолчанию они упорядочены в алфавитном порядке. Имеются значения “прочие” и “отсутствующие”, которые мы предпочли бы видеть последними подкатегориями при представлении разбивки. Поэтому мы меняем этот столбец на фактор и переупорядочиваем его. Более подробно это рассматривается на странице [Факторы].</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Преобразование в фактор и определение порядка уровней, чтобы "Прочие" и "Отсутствующие" были последними</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hospital =</span> <span class="fu">fct_relevel</span>(hospital, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Port Hospital"</span>, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Central Hospital"</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Military Hospital"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Other"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Missing"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(linelist<span class="sc">$</span>hospital)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "St. Mark's Maternity Hospital (SMMH)"
[2] "Port Hospital"                       
[3] "Central Hospital"                    
[4] "Military Hospital"                   
[5] "Other"                               
[6] "Missing"                             </code></pre>
</div>
</div>
</section>
</section>
<section id="ggplot_basics_bars" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ggplot_basics_bars"><code>geom_bar()</code></h3>
<p>Используйте <code>geom_bar()</code>, если хотите, чтобы высота столбцов (или высота компонентов сложенных столбцов) отражала <em>количество соответствующих строк в данных</em>. Между этими столбиками будут оставаться промежутки, если только не будет настроена эстетика графика <code>width =</code>.</p>
<ul>
<li>Укажите только один столбец оси (обычно ось x). Если указать x и y, то будет получено сообщение <code>Error: stat_count() can only have an x or y aesthetic.</code>.<br>
</li>
<li>Вы можете создать сложенные столбцы, добавив назначение столбца <code>fill =</code> внутри <code>mapping = aes()</code>.<br>
</li>
<li>Противоположная ось по умолчанию будет называться ” подсчет”, поскольку она представляет собой количество строк</li>
</ul>
<p>Ниже мы отнесли исходы к оси y, но с тем же успехом их можно отнести и к оси x. Если у вас есть длинные символьные значения, то иногда лучше перевернуть столбики на бок и поместить легенду внизу. Это может повлиять на порядок расположения уровней факторов - в данном случае мы меняем их местами с помощью <code>fct_rev()</code>, чтобы поместить отсутствующие и другие в нижнюю часть.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Исходы во всех случаях</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome)) <span class="sc">+</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fct_rev</span>(hospital)), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Number of cases by hospital"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Hospital"</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Исходы во всех случаях с разбивкой по больницам</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome)) <span class="sc">+</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fct_rev</span>(hospital), <span class="at">fill =</span> outcome), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Number of recovered and dead Ebola cases, by hospital"</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Hospital"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-46-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_col" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="geom_col"><code>geom_col()</code></h3>
<p>Используйте <code>geom_col()</code>, если хотите, чтобы высота столбиков (или высота компонентов сложенных столбиков) отражала предварительно вычисленные <em>значения</em>, имеющиеся в данных. Часто это суммарные или “агрегированные” подсчеты, или пропорции.</p>
<p>Задайте в <code>geom_col()</code> назначение столбцов для обеих осей. Обычно столбец оси x является дискретным, а столбец оси y - числовым.</p>
<p>Допустим, у нас есть набор данных <code>outcomes</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  outcome     n proportion
  &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
1 Death    1022       56.2
2 Recover   796       43.8</code></pre>
</div>
</div>
<p>Ниже приведен код с использованием <code>geom_col</code> для создания простых столбчатых диаграмм, отображающих распределение исходов у пациентов с лихорадкой Эбола. При использовании функции geom_col необходимо указать как x, так и y. Здесь x - категориальная переменная по оси x, а y - сгенерированный столбец пропорций <code>proportion</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Исходы во всех случаях</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outcomes) <span class="sc">+</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>outcome, <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Number of recovered and dead Ebola cases"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-48-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="432"></a></p>
</figure>
</div>
</div>
</div>
<p>Для того чтобы показать разбивку по больницам, необходимо, чтобы таблица содержала больше информации и имела “длинный” формат. Мы создаем эту таблицу с частотами комбинированных категорий <code>outcome</code> и <code>hospital</code> (советы по группировке см. на странице [Группирование данных]).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>outcomes2 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hospital, outcome) <span class="sc">%&gt;%</span>  <span class="co"># получить подсчеты по больницам и исходам</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>        <span class="co"># Сгруппировать таким образом, чтобы пропорции были вне общего значения по больнице </span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)<span class="sc">*</span><span class="dv">100</span>) <span class="co"># рассчитать пропорции от общего значения по больнице</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(outcomes2) <span class="co"># Предварительный просмотр данных</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   hospital [3]
  hospital                             outcome     n proportion
  &lt;fct&gt;                                &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
1 St. Mark's Maternity Hospital (SMMH) Death     199       61.2
2 St. Mark's Maternity Hospital (SMMH) Recover   126       38.8
3 Port Hospital                        Death     785       57.6
4 Port Hospital                        Recover   579       42.4
5 Central Hospital                     Death     193       53.9
6 Central Hospital                     Recover   165       46.1</code></pre>
</div>
</div>
<p>Затем мы создаем ggplot с некоторым дополнительным форматированием:</p>
<ul>
<li><strong>Переворот оси</strong>: Поменяли оси местами с помощью <code>coord_flip()</code>, чтобы можно было читать названия больниц.</li>
<li><strong>Столбцы бок о бок</strong>: Добавлен аргумент <code>position = "dodge"</code>, чтобы столбцы для смерти и выздоровления были представлены рядом, а не сложенными. Обратите внимание, что по умолчанию столбцы представлены в виде сложенных столбиков.</li>
<li><strong>Ширина столбца</strong>: Указано значение ‘width’, поэтому столбцы будут вдвое тоньше, чем при полной возможной ширине.</li>
<li><strong>Порядок столбцов</strong>: Изменили порядок категорий на оси y так, чтобы “Другое” и “Отсутствующие” оказались внизу, с помощью <code>scale_x_discrete(limits=rev)</code>. Обратите внимание, что мы использовали именно этот метод, а не <code>scale_y_discrete</code>, поскольку больница указывается в аргументе <code>x</code> в <code>aes()</code>, даже если визуально она находится на оси y. Мы делаем это потому, что Ggplot, по-видимому, представляет категории в обратном порядке, если мы не запрещаем ему это делать.<br>
</li>
<li><strong>Другие сведения</strong>: Добавлены метки/названия и цвета в <code>labs</code> и <code>scale_fill_color</code> соответственно.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Исходы во всех случаях в разбивке по больницам</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outcomes2) <span class="sc">+</span>  </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> proportion,                 <span class="co"># показать предварительно рассчитанные значения пропорций</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">fct_rev</span>(hospital),          <span class="co"># обратный порядок уровней, чтобы отсутствующие/другие находились внизу</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> outcome),                <span class="co"># сложенные по результатам</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.5</span>)<span class="sc">+</span>                    <span class="co"># более тонкие столбики (из 1)</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>                  <span class="co"># Минимальная тема </span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Number of recovered and dead Ebola cases, by hospital"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Outcome"</span>,             <span class="co"># заголовок легенды</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>,                  <span class="co"># заголовок оси y</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Hospital of admission"</span>)<span class="sc">+</span> <span class="co"># Заголовок оси x</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(                 <span class="co"># добавление цветов вручную</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Death"</span><span class="ot">=</span> <span class="st">"#3B1c8C"</span>,</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Recover"</span> <span class="ot">=</span> <span class="st">"#21908D"</span> )) </span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ggplot_basics.ru_files/figure-html/unnamed-chunk-50-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="ggplot_basics.ru_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="768"></a></p>
</figure>
</div>
</div>
</div>
<p>Обратите внимание на то, что пропорции являются бинарными, поэтому мы можем предпочесть опустить слово “выздоровление” и показать только долю умерших. Это просто для наглядности.</p>
<p>При использовании <code>geom_col()</code> с данными о датах (например, эпикривая из агрегированных данных) необходимо настроить аргумент <code>width =</code>, чтобы убрать “промежуточные” линии между столбиками. При использовании ежедневных данных задайте <code>width = 1</code>. Если данные еженедельные, то <code>width = 7</code>. Использование месяцев невозможно, поскольку каждый месяц имеет разное количество дней.</p>
</section>
<section id="geom_histogram" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="geom_histogram"><code>geom_histogram()</code></h3>
<p>Гистограммы похожи на столбчатые диаграммы, но отличаются от них тем, что измеряют распределение <em>непрерывной</em> переменной. Пробелы между “столбиками” отсутствуют, и в <code>geom_histogram()</code> передается только один столбец. Существуют такие специфические для гистограмм аргументы, как <code>bin_width =</code> и <code>breaks =</code> для указания способа разбиения данных на столбцы. Дополнительную информацию можно найти в приведенном выше разделе о непрерывных данных и на странице [Эпидемические кривые].</p>
</section>
</section>
<section id="ресурсы" class="level2" data-number="30.14">
<h2 data-number="30.14" class="anchored" data-anchor-id="ресурсы"><span class="header-section-number">30.14</span> Ресурсы</h2>
<p>В Интернете имеется огромное количество справочной информации, особенно по ggplot. См:</p>
<ul>
<li><a href="http://r-statistics.co/ggplot2-cheatsheet.html">шпаргалка по ggplot2</a></li>
<li><a href="https://biostats.w.uib.no/the-ggplot2-cheat-sheet-by-rstudio/">еще одна шпаргалка</a></li>
<li><a href="https://ggplot2.tidyverse.org/reference/">страница основ tidyverse ggplot</a><br>
</li>
<li><a href="http://www.sthda.com/english/articles/32-r-graphics-essentials/131-plot-two-continuous-variables-scatter-graph-and-alternatives/">построение графиков непрерывных переменных</a></li>
<li>Страницы R для науки о данных <a href="https://r4ds.had.co.nz/data-visualisation.html">визуализация данных</a></li>
<li><a href="https://r4ds.had.co.nz/graphics-for-communication.html">графика для коммуникаций</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../new_pages/tables_presentation.ru.html" class="pagination-link" aria-label="Таблицы для презентации">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Таблицы для презентации</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../new_pages/ggplot_tips.ru.html" class="pagination-link" aria-label="Советы по использованию ggplot">
        <span class="nav-page-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Советы по использованию ggplot</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","loop":false,"descPosition":"bottom","openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>