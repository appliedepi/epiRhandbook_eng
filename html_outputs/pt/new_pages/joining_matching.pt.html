<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Manual de R para Epidemiologistas - 14&nbsp; Juntando dados (Joins)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../new_pages/deduplication.pt.html" rel="next">
<link href="../new_pages/grouping.pt.html" rel="prev">
<link href="../images/Applied_Epi_logo.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QXDW878QLX', { 'anonymize_ip': true});
</script>
<!-- Global site tag (gtag.js) - Google Analytics 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QXDW878QLX');
</script> -->

</head><body class="nav-sidebar floating"><div class="alert alert-info alert-dismissible">
  <!-- <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Need help learning R?</strong> Enroll in Applied Epi's <a href="https://www.appliedepi.org/live/"
    class="alert-link">intro R course</a>, try our <a href="https://www.appliedepi.org/tutorial/"
    class="alert-link">free R tutorials</a>, post in our <a href="https://community.appliedepi.org/"
    class="alert-link">Community Q&A forum</a>, or ask about our <a href="mailto:contact@appliedepi.org"
    class="alert-link">R Help Desk service</a>. -->
</div>

<script>

  // Function to extract the last two characters from the URL path to determine the language, adjusting for .html extension
  function getLanguageFromURL() {
    let path = window.location.pathname;
    
    // Check if the URL ends with .html and remove it
    if (path.endsWith('.html')) {
      path = path.substring(0, path.length - 5);
    }

    // Extract the last two characters for the language code
    const lang = path.substr(-2);
    return lang;
  }

  const language = getLanguageFromURL();
  const supportedLanguages = ['fr', 'es', 'vn', 'jp', 'pt', 'tr', 'ru'];
  const defaultLanguage = 'en';
  const isSupportedLanguage = supportedLanguages.includes(language);

  // Translations for the content
  const translations = {
    en: '<strong>Need help learning R?</strong> Enroll in Applied Epi\'s <a href="https://www.appliedepi.org/live/" class="alert-link">intro R course</a>, try our <a href="https://www.appliedepi.org/tutorial/" class="alert-link">free R tutorials</a>, post in our <a href="https://community.appliedepi.org/" class="alert-link">Community Q&A forum</a>, or ask about our <a href="mailto:contact@appliedepi.org" class="alert-link">R Help Desk service</a>.',
    fr: '<strong>Besoin d\'aide pour apprendre R ?</strong> Inscrivez-vous au <a href="https://www.appliedepi.org/live/" class="alert-link">cours d\'introduction à R</a> d\'Applied Epi, essayez nos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriels R gratuits</a>, postez dans notre forum de <a href="https://community.appliedepi.org/" class="alert-link">questions-réponses communautaires</a>, ou demandez-nous des informations sur <a href="mailto:contact@appliedepi.org" class="alert-link"> notre service d\'assistance R</a>.',
    es: '<strong>¿Necesitas ayuda para aprender R?</strong> Inscríbete en el <a href="https://www.appliedepi.org/live/" class="alert-link">Curso de introducción a R</a> de Applied Epi, prueba nuestros <a href="https://www.appliedepi.org/tutorial/" class="alert-link">Tutoriales gratuitos de R</a>, escribe en nuestro <a href="https://community.appliedepi.org/" class="alert-link">Foro de preguntas y respuestas,</a> o pregunta por nuestra <a href="mailto:contact@appliedepi.org" class="alert-link">Asistencia técnica para R</a>.',
    vn: '<strong>Bạn cần giúp đỡ trong việc học R?</strong> Hãy đăng ký khóa học R cơ bản của Applied Epi tại <a href="https://www.appliedepi.org/live/" class="alert-link">đây</a>, hoặc thử các <a href="https://www.appliedepi.org/tutorial/" class="alert-link">hướng dẫn R miễn phí</a>, đăng bài trong <a href="https://community.appliedepi.org/" class="alert-link">diễn đàn cộng đồng</a>, hoặc gửi câu hỏi tới <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ Trợ giúp R</a> của chúng tôi.',
    jp: '<strong>Rの学習について助けが必要ですか？</strong>Applied Epiの<a href="https://www.appliedepi.org/live/" class="alert-link">R入門コース</a>に登録するか、<a href="https://www.appliedepi.org/tutorial/" class="alert-link">無料Rチュートリアル</a>を試すか、<a href="https://community.appliedepi.org/" class="alert-link">コミュニティQ＆Aフォーラム</a>に投稿するか、<a href="mailto:contact@appliedepi.org" class="alert-link">Rヘルプデスクサービス</a>についてお問い合わせください。',
    pt: '<strong>Você precisa de ajuda para aprender R??</strong> Inscreva-se no curso de <a href="https://www.appliedepi.org/live/" class="alert-link">introdução ao R da Applied Epi</a>, experimente nossos <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriais gratuitos sobre o R</a>, publique em nosso <a href="https://community.appliedepi.org/" class="alert-link">fórum de perguntas e respostas</a>, ou solicite nosso <a href="mailto:contact@appliedepi.org" class="alert-link">suporte ao R</a>.',
    tr: '<strong>R öğrenmekte yardıma mı ihtiyacınız var?</strong> Applied Epi\'\nin <a href="https://www.appliedepi.org/live/" class="alert-link">R\'ye giriş kursuna</a> kaydolun, <a href="https://www.appliedepi.org/tutorial/" class="alert-link">ücretsiz R derslerimizi</a> deneyin, <a href="https://community.appliedepi.org/" class="alert-link">Topluluk Q&A forumunda</a> soru paylaşın, ya da <a href="mailto:contact@appliedepi.org" class="alert-link">R Yardım Masası hizmetimiz</a> hakkında sorun.',
    ru: '<strong>Нужна помощь в изучении R?</strong> Запишитесь на <a href="https://www.appliedepi.org/live/" class="alert-link">вводный курс по R</a> от Applied Epi, попробуйте наши <a href="https://www.appliedepi.org/tutorial/" class="alert-link">бесплатные учебные материалы по R</a>, задайте вопрос в нашем <a href="https://community.appliedepi.org/" class="alert-link">форуме вопросов и ответов сообщества</a>, или спросите о нашей услуге <a href="mailto:contact@appliedepi.org" class="alert-link">Службы поддержки по R</a>.'
  };

  // Default to English if the detected language is not supported
  const contentToDisplay = translations[isSupportedLanguage ? language : defaultLanguage];


  // Select the element where the content should be displayed
  const alertElement = document.querySelector('.alert');
  if (alertElement) {
    alertElement.innerHTML = contentToDisplay;
    alertElement.style.display = 'block'; // Make sure to display the element
  }

</script>
<link href="../site_libs/htmltools-fill-0.5.8/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.31/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="../site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="../site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="../site_libs/selectize-0.12.0/selectize.min.js"></script>
<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>






<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../new_pages/cleaning.pt.html">Gerenciamento de Dados</a></li><li class="breadcrumb-item"><a href="../new_pages/joining_matching.pt.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Juntando dados (Joins)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/Applied_Epi_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Manual de R para Epidemiologistas</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://twitter.com/appliedepi" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/company/appliedepi/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://github.com/appliedepi/epihandbook_quarto" title="Código fonte" class="quarto-navigation-tool px-1" aria-label="Código fonte"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Alternar modo escuro"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bem-vindo</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Sobre este livro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/editorial_style.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Notas editoriais e técnicas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/data_used.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Baixe o livro e os dados</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Básico</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/basics.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introdução ao R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/transition_to_R.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transição para o R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/packages_suggested.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Pacotes sugeridos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/r_projects.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/importing.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Importar e exportar</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Gerenciamento de Dados</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/cleaning.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Limpeza de dados e principais funções</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/dates.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Trabalhando com datas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/characters_strings.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Caracteres e strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/factors.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fatores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/pivoting.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Pivoteando dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/grouping.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Agrupando dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/joining_matching.pt.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Juntando dados (Joins)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/deduplication.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Eliminação de duplicidades</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/iteration.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Iterações, loops e listas</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Análise dos Dados</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/tables_descriptive.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Tabelas descritivas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/stat_tests.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Testes estatísticos simples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/regression.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Regressão simples e múltipla</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/missing_data.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Campos em branco/faltantes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/standardization.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Normalização de taxas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/moving_average.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Médias móveis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/time_series.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Séries temporais e detecção de surtos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/epidemic_models.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Modelagem de epidemias</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/contact_tracing.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Rastreamento de contatos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/survey_analysis.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Analises de pesquisa de questionários (<em>survey</em>)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/survival_analysis.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Análise de sobrevivência</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/gis.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Introdução ao GIS</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Visualização de Dados</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/tables_presentation.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Tabelas para apresentação</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/ggplot_basics.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">O básico do ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/ggplot_tips.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Dicas do ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/epicurves.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Curvas epidêmicas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/age_pyramid.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Pirâmides demográficas e escalas Likert</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/heatmaps.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Gráficos de calor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/diagrams.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Diagramas e gráficos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/combination_analysis.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Análise de Combinações</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/transmission_chains.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Cadeias de Transmissão</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/phylogenetic_trees.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Árvores filogenéticas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/interactive_plots.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Gráficos interativos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Relatórios e dashboards</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/rmarkdown.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Relatórios com R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/reportfactory.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Organização de relatórios de rotina</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/flexdashboard.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Painéis (Dashboards) com R Markdown</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/shiny_basics.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Painéis com Shiny</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Miscelânea</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/writing_functions.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Escrevendo funções</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/directories.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Interações de diretório</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/collaboration.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Controle de versão e colaboração com Git e Github</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/errors.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Erros comuns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/help.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Conseguindo ajuda</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/network_drives.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">R em drives (pastas) na rede</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../new_pages/data_table.pt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Data Table</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#preparação" id="toc-preparação" class="nav-link active" data-scroll-target="#preparação"><span class="header-section-number">14.1</span> Preparação</a>
  <ul class="collapse">
  <li><a href="#carregue-os-pacotes-r" id="toc-carregue-os-pacotes-r" class="nav-link" data-scroll-target="#carregue-os-pacotes-r">Carregue os pacotes R</a></li>
  <li><a href="#importe-dados" id="toc-importe-dados" class="nav-link" data-scroll-target="#importe-dados">Importe dados</a></li>
  <li><a href="#base-de-dados-de-exemplo" id="toc-base-de-dados-de-exemplo" class="nav-link" data-scroll-target="#base-de-dados-de-exemplo">Base de dados de exemplo</a></li>
  <li><a href="#pré-limpeza" id="toc-pré-limpeza" class="nav-link" data-scroll-target="#pré-limpeza">Pré-limpeza</a></li>
  </ul></li>
  <li><a href="#joins-com-dplyr" id="toc-joins-com-dplyr" class="nav-link" data-scroll-target="#joins-com-dplyr"><span class="header-section-number">14.2</span> Joins com <strong>dplyr</strong></a>
  <ul class="collapse">
  <li><a href="#sintaxe-geral" id="toc-sintaxe-geral" class="nav-link" data-scroll-target="#sintaxe-geral">Sintaxe geral</a></li>
  <li><a href="#left-joins-e-right-joins" id="toc-left-joins-e-right-joins" class="nav-link" data-scroll-target="#left-joins-e-right-joins">Left joins e right joins</a></li>
  <li><a href="#full-join" id="toc-full-join" class="nav-link" data-scroll-target="#full-join">Full join</a></li>
  <li><a href="#inner-join" id="toc-inner-join" class="nav-link" data-scroll-target="#inner-join">Inner join</a></li>
  <li><a href="#semi-join" id="toc-semi-join" class="nav-link" data-scroll-target="#semi-join">Semi join</a></li>
  <li><a href="#anti-join" id="toc-anti-join" class="nav-link" data-scroll-target="#anti-join">Anti join</a></li>
  </ul></li>
  <li><a href="#combinação-probabilística" id="toc-combinação-probabilística" class="nav-link" data-scroll-target="#combinação-probabilística"><span class="header-section-number">14.3</span> Combinação probabilística</a>
  <ul class="collapse">
  <li><a href="#combinação-probabilística-probabilistic-matching" id="toc-combinação-probabilística-probabilistic-matching" class="nav-link" data-scroll-target="#combinação-probabilística-probabilistic-matching">Combinação Probabilística (probabilistic matching)</a></li>
  <li><a href="#remoção-de-duplicidades-probabilística" id="toc-remoção-de-duplicidades-probabilística" class="nav-link" data-scroll-target="#remoção-de-duplicidades-probabilística">Remoção de duplicidades probabilística</a></li>
  </ul></li>
  <li><a href="#anexando-binding-e-alinhando" id="toc-anexando-binding-e-alinhando" class="nav-link" data-scroll-target="#anexando-binding-e-alinhando"><span class="header-section-number">14.4</span> Anexando (binding) e alinhando</a>
  <ul class="collapse">
  <li><a href="#anexar-linhas-bind-rows" id="toc-anexar-linhas-bind-rows" class="nav-link" data-scroll-target="#anexar-linhas-bind-rows">Anexar linhas (bind rows)</a></li>
  <li><a href="#anexar-colunas" id="toc-anexar-colunas" class="nav-link" data-scroll-target="#anexar-colunas">Anexar colunas</a></li>
  </ul></li>
  <li><a href="#recursos" id="toc-recursos" class="nav-link" data-scroll-target="#recursos"><span class="header-section-number">14.5</span> Recursos</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../new_pages/cleaning.pt.html">Gerenciamento de Dados</a></li><li class="breadcrumb-item"><a href="../new_pages/joining_matching.pt.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Juntando dados (Joins)</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="joining-matching" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Juntando dados (Joins)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="../images/left-join.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="../images/left-join.gif" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p><em>Acima: um exemplo animado de uma operação de left join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">image source</a>)</em></p>
<p>Essa página descreve maneiras de combinar diferentes data frames com operações do tipo “join”, “match”, “link” e “bind”.</p>
<p>Raramente nosso fluxo de análise epidemiológica não envolverá múltiplas fontes de dados e relações entre múltiplas bases. Talvez você precise conectar dados laboratoriais com desfechos clínicos dos pacientes, ou dados de mobilidade do Google às tendências de doenças infecciosas, ou ainda, uma base de dados em um estágio da análise com uma versão transormada dessa mesma base.</p>
<p>Nessa página vamos demonstrar como escrever código para:</p>
<ul>
<li>Conduzir <em>joins</em> de dois dataframes de forma que as linhas sejam combinadas com base nos valores comuns das colunas de identificadores</li>
<li>Juntar dois dataframes baseados na combinação <em>probabilística</em> (verossímil) entre valores<br>
</li>
<li>Expandir um dataframe através da ligação/anexação direta (<em>binding</em> ou <em>“appending”</em>) de linhas ou colunas de outro dataframe</li>
</ul>
<!-- ======================================================= -->
<section id="preparação" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="preparação"><span class="header-section-number">14.1</span> Preparação</h2>
<section id="carregue-os-pacotes-r" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="carregue-os-pacotes-r">Carregue os pacotes R</h3>
<p>O código abaixo realiza o carregamento dos pacotes necessários para a análise dos dados. Neste manual, enfatizamos o uso da função <code>p_load()</code>, do <strong>pacman</strong>, que instala os pacotes, caso não estejam instalados, <em>e</em> os carrega no R para utilização. Também é possível carregar pacotes instalados utilizando a função <code>library()</code>, do R <strong>base</strong>. Para mais informações sobre os pacotes do R, veja a página <a href="basics.pt.html">Introdução ao R</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  rio, <span class="co"># importar and exportar</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  here, <span class="co"># localizar arquivos</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  tidyverse, <span class="co"># gerenciamento e visualização de dados</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  RecordLinkage, <span class="co"># combinações probabilisticas</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  fastLink <span class="co"># combinações probabilisticas</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importe-dados" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="importe-dados">Importe dados</h3>
<p>Para iniciar, importaremos a versão limpa da linelist de casos de uma epidemia simulada de Ebola. Se você quiser acompanhar, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">clique para baixar a linelist “limpa”</a> (com um arquivo .rds). Importe os dados com a função <code>import()</code> do pacote <strong>rio</strong> (ela manipula vários tipos de arquivo, tais como .xlsx, .csv, .rds - veja na página <a href="importing.pt.html">Importando and exportando</a> para detalhes).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importa a linelist de casos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"linelist_cleaned.rds"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As primeiras 50 linhas da linelist são mostradas abaixo.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-e7c50503dafc3d0a21e3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e7c50503dafc3d0a21e3">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1.407024e+12\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente","Port Hospital","Military Hospital","Ausente","Ausente","Other","Port Hospital","Port Hospital","Port Hospital","Ausente","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Ausente","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Ausente","Military Hospital","Other","Ausente","Ausente","Port Hospital","Port Hospital","Port Hospital","Ausente","Central Hospital","Military Hospital","Other","Other","Other","Ausente","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Ausente"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"age","targets":8},{"name":"age_unit","targets":9},{"name":"age_years","targets":10},{"name":"age_cat","targets":11},{"name":"age_cat5","targets":12},{"name":"hospital","targets":13},{"name":"lon","targets":14},{"name":"lat","targets":15},{"name":"infector","targets":16},{"name":"source","targets":17},{"name":"wt_kg","targets":18},{"name":"ht_cm","targets":19},{"name":"ct_blood","targets":20},{"name":"fever","targets":21},{"name":"chills","targets":22},{"name":"cough","targets":23},{"name":"aches","targets":24},{"name":"vomit","targets":25},{"name":"temp","targets":26},{"name":"time_admission","targets":27},{"name":"bmi","targets":28},{"name":"days_onset_hosp","targets":29}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ======================================================= -->
</section>
<section id="base-de-dados-de-exemplo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="base-de-dados-de-exemplo">Base de dados de exemplo</h3>
<p>Para demonstrar um join na seção abaixo, utilizaremos as seguintes bases de dados:</p>
<ol type="1">
<li>Uma versão “miniatura” da <code>linelist</code> de casos, contendo apenas as colunas <code>case_id</code>, <code>date_onset</code>, e <code>hospital</code>, e apenas as primeiras 10 linhas</li>
<li>Um dataframe separado chamado <code>hosp_info</code>, que contém mais detalhes sobre cada hospital</li>
</ol>
<p>Na seção de combinação probabilística, utilizaremos outras duas bases diferentes. O código para criar essas bases serão mostradas naquela seção.</p>
<section id="joins_llmini" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="joins_llmini">Linelist de casos “miniatura”</h4>
<p>Abaixo está a miniatura da linelist de casos, que contém apenas 10 linhas e só as colunas <code>case_id</code>, <code>date_onset</code>, e <code>hospital</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> <span class="co"># começa com a linelist original</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, date_onset, hospital) <span class="sc">%&gt;%</span> <span class="co"># seleciona colunas</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="co"># seleciona apenas 10 primeira linhas</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-80c42ff228cc983000d7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-80c42ff228cc983000d7">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="joins_hosp_info" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="joins_hosp_info">Dataframe com informações dos hospitais</h4>
<p>Abaixo está o código para criar um dataframe separado com informações adicionais sobre sete hospitais (abrangência populacional e o nível de atenção disponível). Note que o nome “Military Hospital” pertence a dois hospitais diferentes - um no primeiro nível servindo 10000 residentes e outro no nível secundário servindo 50280 residentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria o dataframe de informação dos hospitais</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">hosp_name     =</span> <span class="fu">c</span>(<span class="st">"central hospital"</span>, <span class="st">"military"</span>, <span class="st">"military"</span>, <span class="st">"port"</span>, <span class="st">"St. Mark's"</span>, <span class="st">"ignace"</span>, <span class="st">"sisters"</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">catchment_pop =</span> <span class="fu">c</span>(<span class="dv">1950280</span>, <span class="dv">40500</span>, <span class="dv">10000</span>, <span class="dv">50280</span>, <span class="dv">12000</span>, <span class="dv">5000</span>, <span class="dv">4200</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">level         =</span> <span class="fu">c</span>(<span class="st">"Tertiary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Primary"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aqui está esse dataframe:</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-f943a4ad117774797beb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f943a4ad117774797beb">{"x":{"filter":"none","vertical":false,"data":[["central hospital","military","military","port","St. Mark's","ignace","sisters"],[1950280,40500,10000,50280,12000,5000,4200],["Tertiary","Secondary","Primary","Secondary","Secondary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"columnDefs":[{"className":"dt-right","targets":1},{"name":"hosp_name","targets":0},{"name":"catchment_pop","targets":1},{"name":"level","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ======================================================= -->
</section>
</section>
<section id="pré-limpeza" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="pré-limpeza">Pré-limpeza</h3>
<p>Joins tradicionais (não-probabilísticos) são sensíveis ao caso (maiúsculos/minúsculos) e necessitam que os caracteres combinem de forma exata (<strong>exact match</strong>) entre os valores nos dois dataframes. Para demonstrar alguns dos passos de limpeza que você possa precisar executar antes de iniciar um join, vamos limpar e alinhar as bases <code>linelist_mini</code> e <code>hosp_info</code> agora.</p>
<p><strong>Identifique as diferenças</strong></p>
<p>Precisamos que os valores da coluna <code>hosp_name</code> no dataframe <code>hosp_info</code> combinem com os valores da coluna <code>hospital</code> no dataframe <code>linelist_mini</code>.</p>
<p>Aqui estão os valores do dataframe <code>linelist_mini</code>, impressos com a função <code>unique()</code> do R <strong>base</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(linelist_mini<span class="sc">$</span>hospital)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Other"                               
[2] "Ausente"                             
[3] "St. Mark's Maternity Hospital (SMMH)"
[4] "Port Hospital"                       
[5] "Military Hospital"                   </code></pre>
</div>
</div>
<p>e aqui estão os valores do dataframe <code>hosp_info</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(hosp_info<span class="sc">$</span>hosp_name)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "central hospital" "military"         "port"             "St. Mark's"      
[5] "ignace"           "sisters"         </code></pre>
</div>
</div>
<p>Você pode ver que apesar de alguns dos hospitais existirem em ambos dataframes, existem muitas diferenças na forma como os nomes estão escritos.</p>
<p><strong>Alinhando valores</strong></p>
<p>Vamos começar limpando os valores do dataframe <code>hosp_info</code>. Como explicado na página <a href="cleaning.pt.html">Limpando dados e funções principais</a>, podemos recodificar valores com critérios lógicos utilizando a função <code>case_when()</code> do pacote <strong>dplyr</strong>. Para os quatro hospitais que existem em ambos os dataframes, vamos mudar os valores para alinhar com os valores da <code>linelist_mini</code>. Para os outros hospitais, deixaremos os valores como estão (<code>TRUE ~ hosp_name</code>).</p>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Tipicamente, quando estamos limpando dataframes devemos criar uma nova coluna (ex: <code>hosp_name_clean</code>), mas para facilitar a demonstração vamos mostrar diretamente a modificação da antiga coluna</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="ot">&lt;-</span> hosp_info <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">hosp_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># critério                         # novo valor</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">"military"</span> <span class="sc">~</span> <span class="st">"Military Hospital"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">"port"</span> <span class="sc">~</span> <span class="st">"Port Hospital"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">"St. Mark's"</span> <span class="sc">~</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">"central hospital"</span> <span class="sc">~</span> <span class="st">"Central Hospital"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> hosp_name</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Os nomes dos hospitais que aparecem em ambos os dataframes estão alinhados. Existem dois hospitais em <code>hosp_info</code> que não estão presentes em <code>linelist_mini</code> - vamos lidar com estes depois, no join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(hosp_info<span class="sc">$</span>hosp_name)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Central Hospital"                    
[2] "Military Hospital"                   
[3] "Port Hospital"                       
[4] "St. Mark's Maternity Hospital (SMMH)"
[5] "ignace"                              
[6] "sisters"                             </code></pre>
</div>
</div>
<p>Antes de fazer um join, geralmente o mais fácil é converter uma coluna completamente para letras minúsculas (lowercase) ou letras maiúsculas (uppercase). Se você precisar converter todos os valores de uma coluna para MAIÚSCULO ou minúsculo, utilize a função <code>mutate()</code> e envolva a coluna com alguma dessas funções do pacote <strong>stringr</strong>, como mostrado na página <a href="characters_strings.pt.html">Caracteres e strings</a>.</p>
<p><code>str_to_upper()</code><br>
<code>str_to_upper()</code><br>
<code>str_to_title()</code></p>
<!-- ======================================================= -->
</section>
</section>
<section id="joins-com-dplyr" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="joins-com-dplyr"><span class="header-section-number">14.2</span> Joins com <strong>dplyr</strong></h2>
<p>O pacote <strong>dplyr</strong> oferece várias funções diferentes de join. <strong>dplyr</strong> está incluso no pacote <strong>tidyverse</strong>. Essas funções de join são descritas abaixo, com casos de uso simples.</p>
<p>Agradecimentos a <a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">https://github.com/gadenbuie</a> pelos gifs informativos!</p>
<!-- ======================================================= -->
<section id="sintaxe-geral" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sintaxe-geral">Sintaxe geral</h3>
<p>Os comandos de join podem ser executados individualmente para juntar dois dataframes em um novo objeto, ou podem ser usados em uma cadeia de comandos com pipe (<code>%&gt;%</code>) para mesclar um dataframe em outro à medida que ele vai sendo limpo ou modificado de alguma outra forma.</p>
<p>No exemplo abaixo, a função <code>left_join()</code> é utilizada como um comando individual para criar um novo dataframe chamado <code>joined_data</code>. As entradas (inputs) são os dataframes 1 e 2 (<code>df1</code> e <code>df2</code>). O primeiro dataframe listado é o dataframe de base e o segundo é o dataframe que será mesclado a (joined <em>to</em>) ele.</p>
<p>O terceiro argumento <code>by =</code> é onde você especifica as colunas em cada dataframe que serão utilizadas para alinhar as linhas dos dois dataframes. Se os nomes dessas colunas forem diferentes, insira o nome delas com um vetor <code>c()</code> como mostrado abaixo, onde as linhas são combinadas com base nos valores comuns entre a coluna <code>ID</code> em <code>df1</code> e a coluna <code>identifier</code> em <code>df2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Faz o join baseado nos valores comuns entre a coluna "ID" (primeiro dataframe) e coluna "identifier" (segundo dataframe)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID"</span> <span class="ot">=</span> <span class="st">"identifier"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se as colunas utilizadas no parâmetro <code>by</code> tiverem exatamente o mesmo nome em ambos os dataframes, você pode inserir apenas esse nome, entre aspas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join baseado nos valores comuns da coluna "ID" em ambos os dataframes</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="st">"ID"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se você estiver juntando dataframes baseado em valores comuns ao longo de múltiplos campos, liste esses campos em um vetor <code>c()</code>. Esse exemplo junta linhas se os valores em três colunas em cada base de dado se alinham de forma exata.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join baseado nos mesmos primeiro nome, último nome e idade</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"name"</span> <span class="ot">=</span> <span class="st">"firstname"</span>, <span class="st">"surname"</span> <span class="ot">=</span> <span class="st">"lastname"</span>, <span class="st">"Age"</span> <span class="ot">=</span> <span class="st">"age"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Os comandos de join também podem ser rodados em uma cadeia de comandos com pipe. Isso irá modificar o dataframe que está sendo passado pelo pipe.</p>
<p>No exemplo abaixo, <code>df1</code> está sendo pessado pelos pipes, <code>df2</code> será juntado a ele e <code>df1</code> então será modificado e redefinido.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> df1 <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date_onset <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2020-03-05"</span>)) <span class="sc">%&gt;%</span> <span class="co"># miscellaneous cleaning</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID"</span> <span class="ot">=</span> <span class="st">"identifier"</span>)) <span class="co"># join df2 to df1</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span style="color: orange;"><strong><em>CUIDADO:</em></strong> Joins são caso-específicos (maiúsculas e minúsculas)! Então, é útil converter todos os valores para minúsculo ou maiúsculo antes de fazer o join. Veja a página sobre caracteres/strings.</span></p>
<!-- ======================================================= -->
</section>
<section id="left-joins-e-right-joins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="left-joins-e-right-joins">Left joins e right joins</h3>
<p><strong>Um left join ou right join é normalmente utilizado para adicionar informação a um dataframe</strong> - novas informações são adicionadas apenas a linhas que já existem no data frame base. Esses são tipos de joins comuns em trabalhos epidemiológicos pois eles são utilizados para adicionar informações de uma base de dado em outra.</p>
<p>Para utilizar esses joins, a ordem em que os dataframes estão escritos nos comandos é importante*.</p>
<ul>
<li>Em um <em>left join</em>, o <em>primeiro</em> dataframe escrito é o de base<br>
</li>
<li>Em um <em>right join</em>, o <em>segundo</em> dataframe escrito é o de base</li>
</ul>
<p><strong>Todas as linhas do dataframe base são mantidas.</strong> As informações no outro dataframe (secundário) será juntada ao dataframe de base <em>apenas se houver a combinação via as colunas dos identificadores</em>. E ainda:</p>
<ul>
<li>Linhas no dataframe secundário que não combinam são removidas.</li>
<li>Se houver muitas linhas no dataframe base que combinam com uma linha no secundário (muitos-para-um), a informação do secundário é adicionada a <em>cada linha do base que combina</em>.<br>
</li>
<li>Se uma linha do base combina com múltiplas linhas no secundário (um-para-muitos), todas as combinações são dadas, o que significa que <em>novas linhas podem ser adicionadas ao dataframe resultante!</em></li>
</ul>
<p>Exemplos animados de left e right joins (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="../images/left-join.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="../images/left-join.gif" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="../images/right-join.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="../images/right-join.gif" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p><strong>Exemplo</strong></p>
<p>Abaixo está a saída de um <code>left_join()</code> do <code>hosp_info</code> (dataframe secundário, <a href="#joins_hosp_info">veja aqui</a>) <em>em</em> <code>linelist_mini</code> (dataframe base, <a href="#joins_llmini">veja aqui</a>). O <code>linelist_mini</code> tem <code>nrow(linelist_mini)</code> linhas. O <code>linelist_mini</code> modificado é mostrado. Note o seguinte:</p>
<ul>
<li>Duas novas colunas, <code>catchment_pop</code> e <code>level</code> foram adicionadas ao lado esquerdo da <code>linelist_mini</code><br>
</li>
<li>Todas as linhas originais do dataframe base <code>linelist_mini</code> são mantidas</li>
<li>Quaisquer linhas originais do <code>linelist_mini</code> para “Military Hospital” foram duplicadas porque combinaram com <em>duas</em> linhas no dataframe secundário, então ambas as combinações são retornadas</li>
<li>A coluna de identificador do join na base secundária (<code>hosp_name</code>) desapareceu pois está em redundância com a coluna de identificador da base primária (<code>hospital</code>)<br>
</li>
<li>Quando a linha da base não combina com nenhuma linha da base secundária (ex: quando <code>hospital</code> é “Other” ou “Missing”), as colunas do dataframe secundário serão preenchidas com <code>NA</code> (em branco)</li>
<li>Linhas no dataframe secundário sem nenhuma combinação no dataframe base (hospitais “sisters” e “ignace”) foram removidas</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hospital"</span> <span class="ot">=</span> <span class="st">"hosp_name"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 5 of `x` matches multiple rows in `y`.
ℹ Row 4 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-f3083c5efec050b8a573" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f3083c5efec050b8a573">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="devo-fazer-um-right-join-ou-um-left-join" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="devo-fazer-um-right-join-ou-um-left-join">“Devo fazer um right join, ou um left join?”</h4>
<p>Para responder à pergunta acima, pergunte-se “qual dataframe deve manter todas as suas linhas?” - utilize esse como o base. Um <em>left join</em> manterá todas as linhas do primeiro dataframe escrito no comando, enquanto um <em>right join</em> manterá todas as linhas do segundo dataframe.</p>
<p>Os dois comandos abaixo geram a mesma saída - um join de 10 linhas do <code>hosp_info</code> <em>em</em> <code>linelist_mini</code> (base), mas eles usam joins diferentes. O resultado é que a ordem das colunas vai diferir se <code>hosp_info</code> aparecer na direita (em um left join) ou na esquerda (em um right join). A ordem das linhas também pode mudar de posição da mesma forma. No entanto, ambas essas consequências podem ser resolvidas depois utilizando <code>select()</code> para reordenar as colunas, ou <code>arrange()</code> para ordenar (<em>sort</em>) as linhas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Os dois comandos abaixo geram os memso dados, mas com linhas e colunas em ordem diferentes</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(linelist_mini, hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hospital"</span> <span class="ot">=</span> <span class="st">"hosp_name"</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(hosp_info, linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hosp_name"</span> <span class="ot">=</span> <span class="st">"hospital"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aqui está o resultado do join de <code>hosp_info</code> em <code>linelist_mini</code> por meio de um left join (novas colunas vindas da direita)</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(linelist_mini, hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 5 of `x` matches multiple rows in `y`.
ℹ Row 4 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-aeedd870c18432989cec" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-aeedd870c18432989cec">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Aqui, o resultado do join de <code>hosp_info</code> em <code>linelist_mini</code> por meio de um right join (novas colunas vindas da esquerda)</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in right_join(hosp_info, linelist_mini, by = c(hosp_name = "hospital")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 4 of `x` matches multiple rows in `y`.
ℹ Row 5 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b29daaf135f6ce1cf42d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b29daaf135f6ce1cf42d">{"x":{"filter":"none","vertical":false,"data":[["Military Hospital","Military Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Ausente","Ausente","Ausente","Ausente","Ausente"],[40500,10000,50280,50280,12000,null,null,null,null,null,null],["Secondary","Primary","Secondary","Secondary","Secondary",null,null,null,null,null,null],["893f25","893f25","b8812a","be99c8","11f8ea","5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-21","2014-05-21","2014-05-18","2014-05-22","2014-05-16","2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":1},{"name":"hosp_name","targets":0},{"name":"catchment_pop","targets":1},{"name":"level","targets":2},{"name":"case_id","targets":3},{"name":"date_onset","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Considere também se seu caso de uso está em meio a uma cadeia de comandos com pipe (<code>%&gt;%</code>). Se os dados passando através dos pipes for o dataframe base, você irá preferivelmente utilizar um left join para adicionar mais dados a ele.</p>
<!-- ======================================================= -->
</section>
</section>
<section id="full-join" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="full-join">Full join</h3>
<p><strong>Um full join é o mais <em>inclusivo</em> dos joins</strong> - ele retorna todas as linhas de ambos os dataframes.</p>
<p>Se houver alguma linha presente em um mas não em outro (onde não foi encontrada nenhuma combinação entre os dados), o dataframe vai incluir essa linha e tornar-se mais longo. Os valores <code>NA</code> para representar valores ausentes serão utilizados para preencher os espaços vazios criados. À medida que você for executando o join, monitore cuidadosamente o número de colunas e linhas para resolver problemas de sensitividade de caso (maiúsculo/minúsculo) ou combinação exata de caracteres.</p>
<p>O dataframe base será aquele escrito primeiro no comando. Mudar essa posição não vai impactar em quais registros serão retornados pelo join, mas pode impactar na ordem das colunas e linhas resultantes e também em quais colunas de identificadores serão mantidos.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="../images/full-join.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="../images/full-join.gif" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Exemplo animado de um full join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<p><strong>Exemplo</strong></p>
<p>Abaixo está uma saída de um <code>full_join()</code> do <code>hosp_info</code> (originalmente <code>nrow(hosp_info)</code>, <a href="#joins_hosp_info">veja aqui</a>) <em>em</em> <code>linelist_mini</code> (originalmente <code>nrow(linelist_mini)</code>, <a href="#joins_llmini">veja aqui</a>). Note o seguinte:</p>
<ul>
<li>Todas as linhas do dataframe base são mantidas (<code>linelist_mini</code>)<br>
</li>
<li>Linhas no dataframe secundário que não combinam com o dataframe base são mantidas (“ignace” e “sisters”), com valores nas colunas correspondentes do base (<code>case_id</code> e <code>onset</code>) preenchidas com os valores ausentes <code>NA</code></li>
<li>Da mesma forma, linhas no dataframe base que não combinam com o secundário (“Other” e “Missing”) são mantidas, com as colunas <code>catchment_pop</code> e <code>level</code> do secundário preenchidas com <code>NA</code></li>
<li>Nos casos das combinações um-para-muitos ou muitos-para-um (ex: linhas para “Military Hospital”), todas as combinações possíveis são retornadas (aumentando o tamanho do dataframe final)<br>
</li>
<li>Apenas a coluna do identificador do dataframe base foi mantida (<code>hospital</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hospital"</span> <span class="ot">=</span> <span class="st">"hosp_name"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in full_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 5 of `x` matches multiple rows in `y`.
ℹ Row 4 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-59eca26955378b1dc757" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-59eca26955378b1dc757">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca",null,null,null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05",null,null,null],["Other","Ausente","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Ausente","Ausente","Ausente","Ausente","Central Hospital","ignace","sisters"],[null,null,12000,50280,40500,10000,50280,null,null,null,null,1950280,5000,4200],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null,"Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ======================================================= -->
</section>
<section id="inner-join" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="inner-join">Inner join</h3>
<p><strong>Um inner join é o mais <em>restritivo</em> dos joins</strong> - ele retona apenas as linhas que combinam em ambos os dataframes. Isso significa que o número linhas no dataframe base pode, de fato, <em>reduzir</em>. Ajustes em relação a qual dataframe será o base (escrito primeiro na função) não irá impactar quais linhas serão retornadas, mas vai impactar na ordem das colunas e linhas, e quais colunas de identificadores serão mantidas.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="../images/inner-join.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="../images/inner-join.gif" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Exemplo animado de um inner join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<p><strong>Exemplo</strong></p>
<p>Abaixo está a saída de um <code>inner_join()</code> de <code>linelist_mini</code> (base) com <code>hosp_info</code> (secundário). Note o seguinte:</p>
<ul>
<li>As linhas do dataframe base que não combinam com as do secundário são removidas (linhas onde <code>hospital</code> é “Missing” ou “Other”)<br>
</li>
<li>De forma análoga, linhas do secundário que não combinam com o base são removidas (linhas onde <code>hosp_name</code> é “sisters” ou “ignace”)<br>
</li>
<li>Apenas a coluna de identificador do base foi mantida (<code>hospital</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hospital"</span> <span class="ot">=</span> <span class="st">"hosp_name"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 5 of `x` matches multiple rows in `y`.
ℹ Row 4 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-9219c108a1b0dacc81b2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9219c108a1b0dacc81b2">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<!-- ======================================================= -->
</section>
<section id="semi-join" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="semi-join">Semi join</h3>
<p>Um semi join é “join filtro” que utiliza outra base de dados <em>não para adicionar linhas ou colunas, mas para fazer uma filtragem</em>.</p>
<p>Um <strong>semi-join mantém todas as observações do dataframe base que combinam com algum valor do dataframe secundário</strong> (mas não adiciona novas colunas nem duplica nenhuma linha para o caso de múltiplas combinações). Leia mais sobre esses joins “filtros” <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">aqui</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="../images/semi-join.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="../images/semi-join.gif" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Exemplo de um semi join animado (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<p>Como um exemplo, o código abaixo retorna as linhas do dataframe <code>hosp_info</code> que tem combinações em <code>linelist_mini</code> baseados no nome do hospital.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hosp_name"</span> <span class="ot">=</span> <span class="st">"hospital"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             hosp_name catchment_pop     level
1                    Military Hospital         40500 Secondary
2                    Military Hospital         10000   Primary
3                        Port Hospital         50280 Secondary
4 St. Mark's Maternity Hospital (SMMH)         12000 Secondary</code></pre>
</div>
</div>
</section>
<section id="anti-join" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="anti-join">Anti join</h3>
<!-- ======================================================= -->
<p><strong>O anti join é um outro tipo de “join filtro” que retorna linhas no dataframe base que <em>não</em> possuem uma combinação no dataframe secundário.</strong></p>
<p>Leia mais sobre esses joins “filtros” <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">aqui</a>.</p>
<p>Cenários comuns para anti-join incluem identificar registros que não estão presentes em outro data frame, checar erros de grafia em um join (revisão de registros que <em>deveriam</em> ter combinado) e examinar registros que foram excluídos depois de outro join.</p>
<p><strong>Assim como com <code>right_join()</code> e <code>left_join()</code>, o dataframe <em>base</em> (listado primeiro) é importante</strong>. As linhas retornadas serão apenas do dataframe base. Veja no gif abaixo qu e a linha no dataframe secundário (linha roxa 4) não é retornada mesmo que ela não tenha combinado com o base.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="../images/anti-join.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="../images/anti-join.gif" class="img-fluid figure-img" style="width:50.0%"></a></p>
</figure>
</div>
</div>
</div>
<p>Exemplo animado de um anti join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fonte da imagem</a>)</p>
<section id="um-exemplo-simples-de-anti_join" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="um-exemplo-simples-de-anti_join">Um exemplo simples de <code>anti_join()</code></h4>
<p>Para um exemplo simples, vamos achar os hospitais de <code>hosp_info</code> que não possuem nenhum caso presente em <code>linelist_mini</code>. Nós listamos <code>hosp_info</code> primeiro, como o dataframe base. Os hospitais que não estão presentes em <code>linelist_mini</code> são retornados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>hosp_info <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hosp_name"</span> <span class="ot">=</span> <span class="st">"hospital"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-6a3c47a942fb911ad487" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6a3c47a942fb911ad487">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","ignace","sisters"],[1950280,5000,4200],["Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":1},{"name":"hosp_name","targets":0},{"name":"catchment_pop","targets":1},{"name":"level","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="exemplo-complexo-de-anti_join" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="exemplo-complexo-de-anti_join">Exemplo complexo de <code>anti_join()</code></h4>
<p>Para outro exemplo, vamos supor que rodamos um <code>inner_join()</code> entre <code>linelist_mini</code> e <code>hosp_info</code>. Será retornado apenas um subconjunto dos registros originais de <code>linelist_mini</code>, visto que alguns não estão presentes em <code>hosp_info</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hospital"</span> <span class="ot">=</span> <span class="st">"hosp_name"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(., hosp_info, by = c(hospital = "hosp_name")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 5 of `x` matches multiple rows in `y`.
ℹ Row 4 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1987d4187819f1245b6c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1987d4187819f1245b6c">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Para revisar os registros de <code>linelist_mini</code> que foram excluídos no inner join, podemos rodar um anti-join com as mesmas configurações (<code>linelist_mini</code> como o dataframe base).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"hospital"</span> <span class="ot">=</span> <span class="st">"hosp_name"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1475d666426f109f6c47" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1475d666426f109f6c47">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Ausente","Ausente","Ausente","Ausente","Ausente"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Para ver os registros de <code>hosp_info</code> que foram excluídos no inner join, também podemos rodar um anti-join com <code>hosp_info</code> como o dataframe base.</p>
<!-- ======================================================= -->
</section>
</section>
</section>
<section id="combinação-probabilística" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="combinação-probabilística"><span class="header-section-number">14.3</span> Combinação probabilística</h2>
<p>Se você não tiver um único identificador comum entre as bases de dados para fazer o join, considere utilizar um algoritmo de combinação probabilística. Ele acharia combinações entre os registros baseados em similaridade (ex: distância de strings de Jaro–Winkler, ou distância numérica). Abaixo temos um exemplo simples utilizando o pacote <strong>fastLink</strong> .</p>
<p><strong>Carregue o pacote</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  tidyverse, <span class="co"># manipulação e visualização de dados</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  fastLink <span class="co"># combinação dos registros</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aque estão duas pequenas bases de dados que nós iremos utilizar para demonstrar a combinação probabilística (<code>cases</code> e <code>test_results</code>):</p>
<p>Aqui está o código utilizado para construir as bases de dados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cria as bases de dados</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>cases <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>gender, <span class="sc">~</span>first, <span class="sc">~</span>middle, <span class="sc">~</span>last, <span class="sc">~</span>yr, <span class="sc">~</span>mon, <span class="sc">~</span>day, <span class="sc">~</span>district,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Amir"</span>, <span class="cn">NA</span>, <span class="st">"Khan"</span>, <span class="dv">1989</span>, <span class="dv">11</span>, <span class="dv">22</span>, <span class="st">"River"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Anthony"</span>, <span class="st">"B."</span>, <span class="st">"Smith"</span>, <span class="dv">1970</span>, <span class="dv">09</span>, <span class="dv">19</span>, <span class="st">"River"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Marialisa"</span>, <span class="st">"Contreras"</span>, <span class="st">"Rodrigues"</span>, <span class="dv">1972</span>, <span class="dv">04</span>, <span class="dv">15</span>, <span class="st">"River"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Elizabeth"</span>, <span class="st">"Casteel"</span>, <span class="st">"Chase"</span>, <span class="dv">1954</span>, <span class="dv">03</span>, <span class="dv">03</span>, <span class="st">"City"</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Jose"</span>, <span class="st">"Sanchez"</span>, <span class="st">"Lopez"</span>, <span class="dv">1996</span>, <span class="dv">01</span>, <span class="dv">06</span>, <span class="st">"City"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Cassidy"</span>, <span class="st">"Jones"</span>, <span class="st">"Davis"</span>, <span class="dv">1980</span>, <span class="dv">07</span>, <span class="dv">20</span>, <span class="st">"City"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Michael"</span>, <span class="st">"Murphy"</span>, <span class="st">"O'Calaghan"</span>, <span class="dv">1969</span>, <span class="dv">04</span>, <span class="dv">12</span>, <span class="st">"Rural"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Oliver"</span>, <span class="st">"Laurent"</span>, <span class="st">"De Bordow"</span>, <span class="dv">1971</span>, <span class="dv">02</span>, <span class="dv">04</span>, <span class="st">"River"</span>,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Blessing"</span>, <span class="cn">NA</span>, <span class="st">"Adebayo"</span>, <span class="dv">1955</span>, <span class="dv">02</span>, <span class="dv">14</span>, <span class="st">"Rural"</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>gender, <span class="sc">~</span>first, <span class="sc">~</span>middle, <span class="sc">~</span>last, <span class="sc">~</span>yr, <span class="sc">~</span>mon, <span class="sc">~</span>day, <span class="sc">~</span>district, <span class="sc">~</span>result,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Amir"</span>, <span class="cn">NA</span>, <span class="st">"Khan"</span>, <span class="dv">1989</span>, <span class="dv">11</span>, <span class="dv">22</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Tony"</span>, <span class="st">"B"</span>, <span class="st">"Smith"</span>, <span class="dv">1970</span>, <span class="dv">09</span>, <span class="dv">19</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Maria"</span>, <span class="st">"Contreras"</span>, <span class="st">"Rodriguez"</span>, <span class="dv">1972</span>, <span class="dv">04</span>, <span class="dv">15</span>, <span class="st">"Cty"</span>, <span class="st">"negative"</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Betty"</span>, <span class="st">"Castel"</span>, <span class="st">"Chase"</span>, <span class="dv">1954</span>, <span class="dv">03</span>, <span class="dv">30</span>, <span class="st">"City"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Andrea"</span>, <span class="cn">NA</span>, <span class="st">"Kumaraswamy"</span>, <span class="dv">2001</span>, <span class="dv">01</span>, <span class="dv">05</span>, <span class="st">"Rural"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Caroline"</span>, <span class="cn">NA</span>, <span class="st">"Wang"</span>, <span class="dv">1988</span>, <span class="dv">12</span>, <span class="dv">11</span>, <span class="st">"Rural"</span>, <span class="st">"negative"</span>,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Trang"</span>, <span class="cn">NA</span>, <span class="st">"Nguyen"</span>, <span class="dv">1981</span>, <span class="dv">06</span>, <span class="dv">10</span>, <span class="st">"Rural"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Olivier"</span>, <span class="st">"Laurent"</span>, <span class="st">"De Bordeaux"</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Mike"</span>, <span class="st">"Murphy"</span>, <span class="st">"O'Callaghan"</span>, <span class="dv">1969</span>, <span class="dv">04</span>, <span class="dv">12</span>, <span class="st">"Rural"</span>, <span class="st">"negative"</span>,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Cassidy"</span>, <span class="st">"Jones"</span>, <span class="st">"Davis"</span>, <span class="dv">1980</span>, <span class="dv">07</span>, <span class="dv">02</span>, <span class="st">"City"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Mohammad"</span>, <span class="cn">NA</span>, <span class="st">"Ali"</span>, <span class="dv">1942</span>, <span class="dv">01</span>, <span class="dv">17</span>, <span class="st">"City"</span>, <span class="st">"negative"</span>,</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>, <span class="st">"Jose"</span>, <span class="st">"Sanchez"</span>, <span class="st">"Lopez"</span>, <span class="dv">1995</span>, <span class="dv">01</span>, <span class="dv">06</span>, <span class="st">"City"</span>, <span class="st">"negative"</span>,</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"M"</span>, <span class="st">"Abubakar"</span>, <span class="cn">NA</span>, <span class="st">"Abullahi"</span>, <span class="dv">1960</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="st">"River"</span>, <span class="st">"positive"</span>,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F"</span>, <span class="st">"Maria"</span>, <span class="st">"Salinas"</span>, <span class="st">"Contreras"</span>, <span class="dv">1955</span>, <span class="dv">03</span>, <span class="dv">03</span>, <span class="st">"River"</span>, <span class="st">"positive"</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>A base de dados <code>cases</code> possui 9 registros</strong> de pacientes que estão esperando para testar resultados.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1df48913c901bad5d06a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1df48913c901bad5d06a">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><strong>A base de dados <code>test_results</code></strong> possui 14 registros e contém a coluna <code>result</code>, que nós queremos adicionar aos registros <code>cases</code> baseados nas combinações probabilísticas dos registros.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-aed7ef8d4b0c83954a6b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-aed7ef8d4b0c83954a6b">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","F","F","F","M","M","F","M",null,"M","F"],["Amir","Tony","Maria","Betty","Andrea","Caroline","Trang","Olivier","Mike","Cassidy","Mohammad","Jose","Abubakar","Maria"],[null,"B","Contreras","Castel",null,null,null,"Laurent","Murphy","Jones",null,"Sanchez",null,"Salinas"],["Khan","Smith","Rodriguez","Chase","Kumaraswamy","Wang","Nguyen","De Bordeaux","O'Callaghan","Davis","Ali","Lopez","Abullahi","Contreras"],[1989,1970,1972,1954,2001,1988,1981,null,1969,1980,1942,1995,1960,1955],[11,9,4,3,1,12,6,null,4,7,1,1,1,3],[22,19,15,30,5,11,10,null,12,2,17,6,1,3],["River","River","Cty","City","Rural","Rural","Rural","River","Rural","City","City","City","River","River"],["positive","positive","negative","positive","positive","negative","positive","positive","negative","positive","negative","negative","positive","positive"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":14,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7},{"name":"result","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,14,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="combinação-probabilística-probabilistic-matching" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="combinação-probabilística-probabilistic-matching">Combinação Probabilística (probabilistic matching)</h3>
<p>A função <code>fastlink()</code> do pacote <strong>fastlink</strong> pode ser utilizada para aplicar um algoritmo que busca as combinações entre os valores. Aqui estão as informações básicas. Você pode ler mais detalhes digitando <code>?fastlink</code> no seu console.</p>
<ul>
<li>Defina os dois dataframes que serão comparados nos argumentos <code>dfA =</code> e <code>dfB =</code><br>
</li>
<li>Em <code>varnames =</code> defina todos os nomes de colunas que serão utilizadas para testar a combinação. Todas devem existir tanto em <code>dfA</code> quanto em <code>dfB</code>.<br>
</li>
<li>Em <code>stringdist.match =</code> defina o nome das colunas que estão em <code>varnames</code> que serão avaliadas pela “distancia” entre strings.<br>
</li>
<li>Em <code>numeric.match =</code> defina o nome das colunas que estão em <code>varnames</code> que serão avaliadas pela distância numérica.<br>
</li>
<li>Valores ausentes serão ignorados</li>
<li>Por padrão, cada linha em qualquer dos dataframes será combinada com no máximo uma linha do outro dataframe. Se você quiser ver todas as combinações que foram avaliadas defina o parâmetro <code>dedupe.matches = FALSE</code>. A deduplicação é feita utilizando a solução de Winkler para atribuição linear.</li>
</ul>
<p><em>Dica: divida uma coluna única de data em 3 colunas numéricas separadas utilizadando <code>day()</code>, <code>month()</code>, e <code>year()</code> do pacote <strong>lubridate</strong></em></p>
<p>O limiar padrão para as combinações é 0.94 (<code>threshold.match =</code>) mas você pode ajustar para maior ou menor. Se você for ajustar manualmente o limiar, considere que com limiares mais altos você pode gerar mais falsos negativos (linhas que não combinam quando na verdade deveriam combinar) e, da mesma forma, um limiar mais baixo pode gerar falsos positivos.</p>
<p>Abaixo, os dados estão sendo combinados pela distância de strings nas colunas de nome e distrito, e na distância numérica para ano, mês e dia do nascimento. Um limiar para combinação de 95% de probabilidade foi configurado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fl_output <span class="ot">&lt;-</span> fastLink<span class="sc">::</span><span class="fu">fastLink</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfA =</span> cases,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfB =</span> results,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringdist.match =</span> <span class="fu">c</span>(<span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"district"</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">numeric.match =</span> <span class="fu">c</span>(<span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold.match =</span> <span class="fl">0.95</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================== 
fastLink(): Fast Probabilistic Record Linkage
==================== 

If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
Calculating matches for each variable.
Getting counts for parameter estimation.
    Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
Running the EM algorithm.
Getting the indices of estimated matches.
    Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
Deduping the estimated matches.
Getting the match patterns for each estimated match.</code></pre>
</div>
</div>
<p><strong>Revisando as combinações</strong></p>
<p>Nós definimos o objeto retornado da função <code>fastLink()</code> como <code>fl_output</code>. Ele é da classe <code>list</code>, e de fato contém vários dataframes internamente que detalham os resultados da combinação. Um desses dataframes é <code>matches</code>, que vai conter as combinações mais prováveis entre <code>cases</code> e <code>results</code>. Você pode acessar esse dataframe de combinações com <code>fl_output$matches</code>. Abaixo, ele está sendo salvo como <code>my_matches</code> para facilitar o acesso depois.</p>
<p>Quando <code>my_matches</code> é impresso no console, você vê duas colunas de vetores: os pares de número de linhas/índices (também chamados “rownames”) em <code>cases</code> (“inds.a”) e em <code>results</code> (“inds.b”) representando as melhores combinações. Se o número da linha de um dataframe estiver ausente, então nenhuma combinação foi achada no outro dataframe no limiar de combinação especificado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print matches</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>my_matches <span class="ot">&lt;-</span> fl_output<span class="sc">$</span>matches</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>my_matches</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  inds.a inds.b
1      1      1
2      2      2
3      3      3
4      4      4
5      8      8
6      7      9
7      6     10
8      5     12</code></pre>
</div>
</div>
<p>Algumas coisas para se ter em mente:</p>
<ul>
<li>As combinações ocorrem apesar de algumas diferenças sutis na grafia dos nomes ou nas datas de nascimento:
<ul>
<li>“Tony B. Smith” combinou com “Anthony B Smith”<br>
</li>
<li>“Maria Rodriguez” combinou com “Marialisa Rodrigues”<br>
</li>
<li>“Betty Chase” combinou com “Elizabeth Chase”<br>
</li>
<li>“Olivier Laurent De Bordeaux” combinou com “Oliver Laurent De Bordow” (data de nascimneto ausente foi ignorada)<br>
</li>
</ul></li>
<li>Uma linha de <code>cases</code> (para “Blessing Adebayo”, linha 9) não teve nenhuma boa combinação em <code>results</code>, por isso não está prente em <code>my_matches</code>.</li>
</ul>
<p><strong>Join baseado em combinações probabilísticas</strong></p>
<p>Para utilizar essas combinações para fazer um join de <code>results</code> e <code>cases</code>, uma estratégia seria:</p>
<ol type="1">
<li>Utilizar <code>left_join()</code> para fazer o join de <code>my_matches</code> em <code>cases</code> (combinando os nomes das colunas em <code>cases</code> com “inds.a” em <code>my_matches</code>)<br>
</li>
<li>Depois, utilizar outro <code>left_join()</code> para fazer o join de <code>results</code> em <code>cases</code> (combinando o recém adquirido “inds.b” em <code>cases</code> com os nomes das linhas em <code>results</code>)</li>
</ol>
<p>Antes dos joins, devemos limpar os três dataframes:</p>
<ul>
<li>Ambos <code>dfA</code> e <code>dfB</code> devem ter seus números de linhas (“rowname”) convertidos para uma coluna propriamente dita.<br>
</li>
<li>Ambas as colunas de <code>my_matches</code> devem ser convertidas para a classe <em>character</em>, para que o join possa ser feito com os nomes de coluna que são caracteres</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpeza dos dados antes do join</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># converte os nomes das linhas de cases em coluna</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>cases_clean <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># converte os nomes das linhas de test_results em coluna</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>results_clean <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># converte todas as colunas no dataframe de combinações (my_matches) para character, para que o join possa ser feito com os nomes das linhas</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>matches_clean <span class="ot">&lt;-</span> my_matches <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Faça o join das combinações com dfA, e depois adicione dfB</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># a coluna "inds.b" é adicionada ao dfA</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cases_clean, matches_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"rowname"</span> <span class="ot">=</span> <span class="st">"inds.a"</span>))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co"># colunas do dfB são adicionadas</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(complete, results_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"inds.b"</span> <span class="ot">=</span> <span class="st">"rowname"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como feito no código acima, o dataframe <code>complete</code>, resultado dos joins, vai conter <em>todas</em> as colunas de <code>cases</code> e <code>results</code>. Muitas delas estarão com sufixos “.x” e “.y”, por que, caso contrário, o nome das colunas seriam duplicados.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8b7d29f9c32727a3e0fb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8b7d29f9c32727a3e0fb">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["M","M","F","F",null,"F","M","M",null],["Amir","Tony","Maria","Betty","Jose","Cassidy","Mike","Olivier",null],[null,"B","Contreras","Castel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodriguez","Chase","Lopez","Davis","O'Callaghan","De Bordeaux",null],[1989,1970,1972,1954,1995,1980,1969,null,null],[11,9,4,3,1,7,4,null,null],[22,19,15,30,6,2,12,null,null],["River","River","Cty","City","City","City","Rural","River",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender.x<\/th>\n      <th>first.x<\/th>\n      <th>middle.x<\/th>\n      <th>last.x<\/th>\n      <th>yr.x<\/th>\n      <th>mon.x<\/th>\n      <th>day.x<\/th>\n      <th>district.x<\/th>\n      <th>inds.b<\/th>\n      <th>gender.y<\/th>\n      <th>first.y<\/th>\n      <th>middle.y<\/th>\n      <th>last.y<\/th>\n      <th>yr.y<\/th>\n      <th>mon.y<\/th>\n      <th>day.y<\/th>\n      <th>district.y<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,14,15,16]},{"name":"rowname","targets":0},{"name":"gender.x","targets":1},{"name":"first.x","targets":2},{"name":"middle.x","targets":3},{"name":"last.x","targets":4},{"name":"yr.x","targets":5},{"name":"mon.x","targets":6},{"name":"day.x","targets":7},{"name":"district.x","targets":8},{"name":"inds.b","targets":9},{"name":"gender.y","targets":10},{"name":"first.y","targets":11},{"name":"middle.y","targets":12},{"name":"last.y","targets":13},{"name":"yr.y","targets":14},{"name":"mon.y","targets":15},{"name":"day.y","targets":16},{"name":"district.y","targets":17},{"name":"result","targets":18}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Como opção, para ter apenas os 9 registros “originais” em <code>cases</code> com as novaas colunas de <code>results</code>, utilize <code>select()</code> em <code>results</code> antes dos joins, de forma que ela contenha apenas os nomes de linhas e colunas que você queira adicionar a <code>cases</code> (ex: a coluna <code>result</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cases_clean <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>results_clean <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rowname, result) <span class="co"># selecion apenas algumas colunas</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>matches_clean <span class="ot">&lt;-</span> my_matches <span class="sc">%&gt;%</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># joins</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cases_clean, matches_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"rowname"</span> <span class="ot">=</span> <span class="st">"inds.a"</span>))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(complete, results_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"inds.b"</span> <span class="ot">=</span> <span class="st">"rowname"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7e5a5c656f3a3cda9104" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7e5a5c656f3a3cda9104">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>inds.b<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7]},{"name":"rowname","targets":0},{"name":"gender","targets":1},{"name":"first","targets":2},{"name":"middle","targets":3},{"name":"last","targets":4},{"name":"yr","targets":5},{"name":"mon","targets":6},{"name":"day","targets":7},{"name":"district","targets":8},{"name":"inds.b","targets":9},{"name":"result","targets":10}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Se você quiser um subconjunto de qualquer um dos dataframes contendo apenas as linhas que combinaram, você pode utilizar o código abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cases_matched <span class="ot">&lt;-</span> cases[my_matches<span class="sc">$</span>inds.a, ] <span class="co"># Linhas em cases que combinaram com uma linha em results</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>results_matched <span class="ot">&lt;-</span> results[my_matches<span class="sc">$</span>inds.b, ] <span class="co"># Linhas em results que combinaram com uma linha em cases</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou, para ver apenas as linhas que <strong>não</strong> combinaram:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cases_not_matched <span class="ot">&lt;-</span> cases[<span class="sc">!</span><span class="fu">rownames</span>(cases) <span class="sc">%in%</span> my_matches<span class="sc">$</span>inds.a, ] <span class="co"># Linhas em cases que NÃO combinaram com uma linha em results</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>results_not_matched <span class="ot">&lt;-</span> results[<span class="sc">!</span><span class="fu">rownames</span>(results) <span class="sc">%in%</span> my_matches<span class="sc">$</span>inds.b, ] <span class="co"># Linhas em results que NÃO combinaram com uma linha em cases</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remoção-de-duplicidades-probabilística" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="remoção-de-duplicidades-probabilística">Remoção de duplicidades probabilística</h3>
<p>A combinação probabilística também pode ser utilizada para remover duplicidades uma base de dados. Veja a página de remoção de duplicidades para outros métodos de deduplicação.</p>
<p>Aqui, vamos começar com a base <code>cases</code>, mas a partir daqui chamaremos ela de <code>cases_dup</code>, pois ela tem 2 linhas adicionais que podem ser duplicidades de linhas anteriores: Veja “Tony” com “Anthony”, e “Marialisa Rodrigues” com “Maria Rodriguez”.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b486d985143dcba47742" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b486d985143dcba47742">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Execute <code>fastLink()</code> como anteriormente, mas compare o dataframe <code>cases_dup</code> com ele mesmo. Quando os dois dataframes passados para a função são idênticos, ela assume que você quer fazer a remoção de duplicidades. Note que nós não especificamos <code>stringdist.match =</code> ou <code>numeric.match =</code> como havíamos feito anteriormente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Execute fastLink na mesma base de dados</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>dedupe_output <span class="ot">&lt;-</span> <span class="fu">fastLink</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfA =</span> cases_dup,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfB =</span> cases_dup,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================== 
fastLink(): Fast Probabilistic Record Linkage
==================== 

If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
dfA and dfB are identical, assuming deduplication of a single data set.
Setting return.all to FALSE.

Calculating matches for each variable.
Getting counts for parameter estimation.
    Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
Running the EM algorithm.
Getting the indices of estimated matches.
    Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
Calculating the posterior for each pair of matched observations.
Getting the match patterns for each estimated match.</code></pre>
</div>
</div>
<p>Agora, você pode revisar as duplicidades em potencial com <code>getMatches()</code>. Passe o dataframe tanto como <code>dfA =</code> como <code>dfB =</code>, e passa a saída da função <code>fastLink()</code> como <code>fl.out =</code>. <code>fl.out</code> deve ser da classe <code>fastLink.dedupe</code>, ou em outras palavras, o resultado de <code>fastLink()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Execute getMatches()</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>cases_dedupe <span class="ot">&lt;-</span> <span class="fu">getMatches</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfA =</span> cases_dup,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dfB =</span> cases_dup,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fl.out =</span> dedupe_output</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Veja a coluna da extrema direita, que indica os IDs das duplicatas - as duas últimas linhas estão identificadas como sendo potenciais duplicatadas das linhas 2 e 3.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-615efe2719a1cdb592e2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-615efe2719a1cdb592e2">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"],[1,2,3,4,5,6,7,8,9,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>dedupe.ids<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6,8]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7},{"name":"dedupe.ids","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Para retornar o número de linhas que são potenciais duplicidades, você pode contar o número de linhas por valores únicos na coluna <code>dedupe.ids</code>, e aí filtrar para manter apenas aquelas com mais de uma linha. Nesse caso, isso deixaria as linhas 2 e 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>cases_dedupe <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(dedupe.ids) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  dedupe.ids n
1          2 2
2          3 2</code></pre>
</div>
</div>
<p>Para investigar a totalidade das linhas que poderiam ser duplicidades, coloque o número da linha nesse comando:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mostra a linha 2 e todas as possíveis duplicidades dela</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>cases_dedupe[cases_dedupe<span class="sc">$</span>dedupe.ids <span class="sc">==</span> <span class="dv">2</span>, ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   gender   first middle  last   yr mon day district dedupe.ids
2       M Anthony     B. Smith 1970   9  19    River          2
10      M    Tony     B. Smith 1970   9  19    River          2</code></pre>
</div>
</div>
</section>
</section>
<section id="anexando-binding-e-alinhando" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="anexando-binding-e-alinhando"><span class="header-section-number">14.4</span> Anexando (binding) e alinhando</h2>
<p>Um outro método de combinar dois dataframes é anexando (“binding”) um ao outro. Você também pode pensar nisso como incluir (“appending”) ou adicionar (“adding”) linhas ou colunas.</p>
<p>Essa seção também vai discutir como “alinhar” a ordem das linhas de um dataframe à ordem de outro dataframe. Esse tópico é discutido abaixo na seção de Anexar colunas.</p>
<section id="anexar-linhas-bind-rows" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="anexar-linhas-bind-rows">Anexar linhas (bind rows)</h3>
<p>Para anexar linhas de um dataframe no final de outro dataframe, utilize a função <code>bind_rows()</code> do pacote <strong>dplyr</strong>. Essa é uma função bastante inclusiva, então, todas as colunas presentes em cada dataframe será incluída na saída. Algumas notas:</p>
<ul>
<li>Diferente da versão <code>row.bind()</code> do R <strong>base</strong>, <code>bind_rows()</code> do <strong>dplyr</strong> não exige que a ordem das colunas seja a mesma em ambos os dataframes. Contanto que os nomes das colunas estejam grafados de forma idêntica, a função vai alinhá-las corretamente.<br>
</li>
<li>Você poder, opcionalmente, especificar o argumento <code>.id =</code>. Passe um nome de coluna para o argumento. Isso vai produzir uma nova coluna que serve para identificar de qual dataframe cada linha veio originalmente.</li>
<li>Você pode usar <code>bind_rows()</code> em uma <code>lista</code> de dataframes que tenham estrutura semelhante para combiná-los em um só. Veja um exemplo na página <a href="iteration.pt.html">Iteração, loops e listas</a> que envolve a importação de múltimplas linelists com <strong>purrr</strong>.</li>
</ul>
<p>Um exemplo comum de anexação de linhas é anexar uma linha de “total” no final de uma tabela descritiva feita utilizando a função <code>summarise()</code> do <strong>dplyr</strong>. Abaixo nós criamos uma tabela de contagem de casos e medianas dos valores de CT por hospital com uma linha total.</p>
<p>A função <code>summarise()</code> é utilizada em dados agrupados por hospital para retornar um dataframe sumárizado por hospital. Porém, a função <code>summarise()</code> não gera colunas de “totais” automaticamente, então, nós criamos uma sumarizando os dados <em>novamente</em>, mas com os dados não agrupados por hospital. Isso produz um segundo dataframe de apenas uma linha. Nós podemos anexar (bind) esses dataframes um ao outro para chegar na tabela final.</p>
<p>Veja outros exemplos práticos como esse nas páginas <a href="tables_descriptive.pt.html">Tabelas descritivas</a> e <a href="tables_presentation.pt.html">Tabelas para apresentação</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria a tabela principal</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>hosp_summary <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> <span class="co"># Agrupa os dados por hospital</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="co"># Cria colunas sumário dos indicadores de interesse</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(), <span class="co"># Número de linhas por grupo hospital-desfecho</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ct_value_med =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm =</span> T)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="co"># valores medianos de CT por grupo</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aqui está o dataframe <code>hosp_summary</code>:</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-3a8e484b7091f0925c0a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3a8e484b7091f0925c0a">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[1469,454,896,885,1762,422],[21,22,21,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"hospital","targets":0},{"name":"cases","targets":1},{"name":"ct_value_med","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Cria um dataframe com as estatísticas de “total” (<em>sem o agrupamento por hospital</em>). Isso vai retornar apenas uma linha.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cria totais</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="do">###############</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(), <span class="co"># Número de linhas da base de dados inteira</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ct_value_med =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm =</span> T)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="co"># CT Mediano para toda a base de dados</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>E abaixo está o dataframe <code>totals</code>. Note como tem apenas duas colunas. Essas colunas também está em <code>hosp_summary</code>, mas tem uma coluna em <code>hosp_summary</code> que não está em <code>totals</code> (<code>hospital</code>).</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c8223da38d131681094c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c8223da38d131681094c">{"x":{"filter":"none","vertical":false,"data":[[5888],[22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]},{"name":"cases","targets":0},{"name":"ct_value_med","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Agora podemos anexar as linhas com <code>bind_rows()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind data frames together</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(hosp_summary, totals)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora podemos visualizar o resultado. Veja como na última linha, um valor vazio, <code>NA</code>, preenche a coluna <code>hospital</code> que não estava em <code>hosp_summary</code>. Como explicado na página <a href="tables_presentation.pt.html">Tabelas para apresentação</a>, você pode preencher essa célula com “Total” utilizando <code>replace_na()</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ec6e91919588ca9323ce" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ec6e91919588ca9323ce">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null],[1469,454,896,885,1762,422,5888],[21,22,21,22,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"hospital","targets":0},{"name":"cases","targets":1},{"name":"ct_value_med","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="anexar-colunas" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="anexar-colunas">Anexar colunas</h3>
<p>Existe uma função similar no <strong>dplyr</strong>, a <code>bind_cols()</code> que você pode utilizar para combinar dois dataframes “lateralmente”. Note que as linhas são combinadas umas com as outras <em>por posição</em> (não como no <em>join</em> acima) - por exemplo, a 12ª linha de cada dataframe estarão alinhadas.</p>
<p>Para demonstrar, vamos anexar várias tabelas de sumário juntas. Para fazer isso, também demonstraremos como rearranjar a ordem das linhas de um dataframe para combinar com a ordem do outro, com <code>match()</code>.</p>
<p>Aqui nós definimos <code>case_info</code> como um dataframe de sumário dos casos da linelist, por hospital, com o número de casos e o número de mortes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Informação dos casos</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>case_info <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">"Death"</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-88aeee3ab3fa3b236b43" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-88aeee3ab3fa3b236b43">{"x":{"filter":"none","vertical":false,"data":[["Ausente","Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[1469,454,896,885,1762,422],[611,193,399,395,785,199]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"hospital","targets":0},{"name":"cases","targets":1},{"name":"deaths","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Então, digamos que haja um dataframe diferente, <code>contact_fu</code> (<em>fu</em> -&gt; <em>follow up</em>), contendo informação acerca da porcentagem de contatos expostos que foram investigados e “acompanhados” (<em>follow-up</em>), novamente por hospital.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>contact_fu <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">hospital =</span> <span class="fu">c</span>(<span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>, <span class="st">"Military Hospital"</span>, <span class="st">"Missing"</span>, <span class="st">"Central Hospital"</span>, <span class="st">"Port Hospital"</span>, <span class="st">"Other"</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">investigated =</span> <span class="fu">c</span>(<span class="st">"80%"</span>, <span class="st">"82%"</span>, <span class="cn">NA</span>, <span class="st">"78%"</span>, <span class="st">"64%"</span>, <span class="st">"55%"</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">per_fu =</span> <span class="fu">c</span>(<span class="st">"60%"</span>, <span class="st">"25%"</span>, <span class="cn">NA</span>, <span class="st">"20%"</span>, <span class="st">"75%"</span>, <span class="st">"80%"</span>) <span class="co"># fu -&gt; follow up</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-6c3a7d6188469b5485ec" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6c3a7d6188469b5485ec">{"x":{"filter":"none","vertical":false,"data":[["St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Central Hospital","Port Hospital","Other"],["80%","82%",null,"78%","64%","55%"],["60%","25%",null,"20%","75%","80%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"hospital","targets":0},{"name":"investigated","targets":1},{"name":"per_fu","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Note que os hospitais são os mesmos, mas estão em ordens diferentes em cada dataframe. A solução mais fácil seria utilizar <code>left_join()</code> na coluna <code>hospital</code>, mas você poderia também utilizar <code>bind_cols()</code> com um passo extra.</p>
<section id="utilize-match-para-alinhar-a-ordem" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="utilize-match-para-alinhar-a-ordem">Utilize <code>match()</code> para alinhar a ordem</h4>
<p>Pelo fato da ordem das linhas ser diferente, um simples <code>bind_cols()</code> resultaria em um desalinhamento dos dados. Para consertar isso, podemos utilizar <code>match()</code> do <strong>base</strong> R para alinhar as linhas de um dataframe na mesma ordem de outro. Vamos assumir, para essa abordagem, que não há valores duplicados em nenhum dos dataframes.</p>
<p>Quando utilizamos <code>match()</code>, a sintaxe é <code>match(ORDEM DO VETOR ALVO, COLUNA PARA MUDAR)</code>, onde o primeiro argumento é a ordem desejada (seja um vetor individual, ou nesse caso, uma coluna do dataframe), e o segundo argumento é uma coluna do dataframe que será reordenado. A saída do <code>match()</code> é um vetor de números representando a posição correta do ordenamento. Você pode ler mais com <code>?match</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match</span>(case_info<span class="sc">$</span>hospital, contact_fu<span class="sc">$</span>hospital)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA  4  2  6  5  1</code></pre>
</div>
</div>
<p>Você pode utilizar esse vetor numérico para reordenar o dataframe - coloque ele entre colchetes <code>[ ]</code> <em>antes da vírgula</em>. Leia mais sobre a sintaxe de subconjuntos com colchetes no <strong>base</strong> R na página <a href="basics.pt.html">Introdução ao R</a>. O comando abaixo cria um novo dataframe, definido como o anterior em que as linhas estão ordenadas de acordo com o vetor numérico acima.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>contact_fu_aligned <span class="ot">&lt;-</span> contact_fu[<span class="fu">match</span>(case_info<span class="sc">$</span>hospital, contact_fu<span class="sc">$</span>hospital), ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-073874e1ec7f7d409db9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-073874e1ec7f7d409db9">{"x":{"filter":"none","vertical":false,"data":[[null,"Central Hospital","Military Hospital","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[null,"78%","82%","55%","64%","80%"],[null,"20%","25%","80%","75%","60%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"hospital","targets":0},{"name":"investigated","targets":1},{"name":"per_fu","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Agora podemos anexar as colunas dos dataframes um no outro, com a ordem de linhas correta. Note que algumas colunas estão duplicadas e vão precisar de uma limpeza utilizando <code>rename()</code>. Leia mais sobre <code>bind_rows()</code> <a href="https://dplyr.tidyverse.org/reference/bind.html">aqui</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(case_info, contact_fu)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `hospital` -&gt; `hospital...1`
• `hospital` -&gt; `hospital...4`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  hospital...1                     cases deaths hospital...4 investigated per_fu
  &lt;chr&gt;                            &lt;int&gt;  &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt; 
1 Ausente                           1469    611 St. Mark's … 80%          60%   
2 Central Hospital                   454    193 Military Ho… 82%          25%   
3 Military Hospital                  896    399 Missing      &lt;NA&gt;         &lt;NA&gt;  
4 Other                              885    395 Central Hos… 78%          20%   
5 Port Hospital                     1762    785 Port Hospit… 64%          75%   
6 St. Mark's Maternity Hospital (…   422    199 Other        55%          80%   </code></pre>
</div>
</div>
<p>Uma alternativo do R <strong>base</strong> a <code>bind_cols</code> é a função <code>cbind()</code>, que faz a mesma operação.</p>
<!-- ======================================================= -->
</section>
</section>
</section>
<section id="recursos" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="recursos"><span class="header-section-number">14.5</span> Recursos</h2>
<p>A <a href="https://dplyr.tidyverse.org/reference/join.html">página do tidyverse sobre joins</a></p>
<p>A <a href="https://r4ds.had.co.nz/relational-data.html">página do R for Data Science sobre dados relacionais</a></p>
<p>A <a href="https://dplyr.tidyverse.org/reference/bind.html">página do tidyverse no dplyr</a> sobre binding (ligação)</p>
<p>Uma vignette sobre <a href="https://github.com/kosukeimai/fastLink">fastLink</a> na página do Github do pacote</p>
<p>Publicação descrevendo a metodologia do <a href="https://imai.fas.harvard.edu/research/files/linkage.pdf">fastLink</a></p>
<p>Publicação descrevendo o <a href="https://journal.r-project.org/archive/2010/RJ-2010-017/RJ-2010-017.pdf">pacote RecordLinkage</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../new_pages/grouping.pt.html" class="pagination-link" aria-label="Agrupando dados">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Agrupando dados</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../new_pages/deduplication.pt.html" class="pagination-link" aria-label="Eliminação de duplicidades">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Eliminação de duplicidades</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","descPosition":"bottom","openEffect":"zoom","loop":false,"closeEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>