<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>34 Heat plots | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.9/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.18/datatables.js"></script>
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.9.3/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
    <link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
    <script src="libs/vis-4.20.1/vis.min.js"></script>
    <script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script>
    <script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-8.1.2/highcharts.js"></script>
    <script src="libs/highcharts-8.1.2/highcharts-3d.js"></script>
    <script src="libs/highcharts-8.1.2/highcharts-more.js"></script>
    <script src="libs/highcharts-8.1.2/modules/stock.js"></script>
    <script src="libs/highcharts-8.1.2/modules/map.js"></script>
    <script src="libs/highcharts-8.1.2/modules/annotations.js"></script>
    <script src="libs/highcharts-8.1.2/modules/data.js"></script>
    <script src="libs/highcharts-8.1.2/modules/drilldown.js"></script>
    <script src="libs/highcharts-8.1.2/modules/item-series.js"></script>
    <script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-8.1.2/modules/exporting.js"></script>
    <script src="libs/highcharts-8.1.2/modules/export-data.js"></script>
    <script src="libs/highcharts-8.1.2/modules/funnel.js"></script>
    <script src="libs/highcharts-8.1.2/modules/heatmap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/treemap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/sankey.js"></script>
    <script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-8.1.2/modules/organization.js"></script>
    <script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script>
    <script src="libs/highcharts-8.1.2/modules/sunburst.js"></script>
    <script src="libs/highcharts-8.1.2/modules/vector.js"></script>
    <script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script>
    <script src="libs/highcharts-8.1.2/modules/xrange.js"></script>
    <script src="libs/highcharts-8.1.2/modules/tilemap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/venn.js"></script>
    <script src="libs/highcharts-8.1.2/modules/gantt.js"></script>
    <script src="libs/highcharts-8.1.2/modules/timeline.js"></script>
    <script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-8.1.2/modules/bullet.js"></script>
    <script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script>
    <script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script>
    <script src="libs/highcharts-8.1.2/modules/lollipop.js"></script>
    <script src="libs/highcharts-8.1.2/modules/series-label.js"></script>
    <script src="libs/highcharts-8.1.2/plugins/motion.js"></script>
    <script src="libs/highcharts-8.1.2/custom/reset.js"></script>
    <script src="libs/highcharts-8.1.2/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.8.2/highchart.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="heat-plots" class="section level1" number="34">
<h1><span class="header-section-number">34</span> Heat plots</h1>
<p>Heat plots, also known as “heat maps” or “heat tiles”, can be useful visualizations when trying to display 3 variables (x-axis, y-axis, and fill). Below we demonstrate two examples:</p>
<ul>
<li>A visual matrix of transmission events by age (“who infected whom”)<br />
</li>
<li>Tracking reporting metrics across many facilities/jurisdictions over time</li>
</ul>
<p><img src="images/transmission_matrix.png" width="50%" /><img src="images/heat_tile.png" width="50%" /></p>
<!-- ======================================================= -->
<div id="preparation-27" class="section level2" number="34.1">
<h2><span class="header-section-number">34.1</span> Preparation</h2>
<div id="load-packages-23" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code>library()</code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<div class="sourceCode" id="cb1630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1630-1"><a href="heat-plots.html#cb1630-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1630-2"><a href="heat-plots.html#cb1630-2" aria-hidden="true" tabindex="-1"></a>  tidyverse,       <span class="co"># data manipulation and visualization</span></span>
<span id="cb1630-3"><a href="heat-plots.html#cb1630-3" aria-hidden="true" tabindex="-1"></a>  rio,             <span class="co"># importing data </span></span>
<span id="cb1630-4"><a href="heat-plots.html#cb1630-4" aria-hidden="true" tabindex="-1"></a>  lubridate        <span class="co"># working with dates</span></span>
<span id="cb1630-5"><a href="heat-plots.html#cb1630-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>Datasets</strong></p>
<p>This page utilizes the case linelist of a simulated outbreak for the transmission matrix section, and a separate dataset of daily malaria case counts by facility for the metrics tracking section. They are loaded and cleaned in their individual sections.</p>
</div>
</div>
<div id="transmission-matrix" class="section level2" number="34.2">
<h2><span class="header-section-number">34.2</span> Transmission matrix</h2>
<p>Heat tiles can be useful to visualize matrices. One example is to display “who-infected-whom” in an outbreak. This assumes that you have information on transmission events.</p>
<p>Note that the <a href="contact-tracing-1.html#contact-tracing-1">Contact tracing</a> page contains another example of making a heat tile contact matrix, using a different (perhaps more simple) dataset where the ages of cases and their sources are neatly aligned in the same row of the data frame. This same data is used to make a <em>density</em> map in the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page. This example below begins from a case linelist and so involves considerable data manipulation prior to achieving a plotable data frame. So there are many scenarios to chose from…</p>
<p>We begin from the case linelist of a simulated Ebola epidemic. If you want to follow along, <a href='https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>click to download the “clean” linelist</a> (as .rds file). Import your data with the <code>import()</code> function from the <strong>rio</strong> package (it accepts many file types like .xlsx, .rds, .csv - see the <a href="import-and-export.html#import-and-export">Import and export</a> page for details).</p>
<p>The first 50 rows of the linelist are shown below for demonstration:</p>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1631-1"><a href="heat-plots.html#cb1631-1" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
<p>In this linelist:</p>
<ul>
<li>There is one row per case, as identified by <code>case_id</code><br />
</li>
<li>There is a later column <code>infector</code> that contains the <code>case_id</code> of the <em>infector</em>, who is also a case in the linelist</li>
</ul>
<div id="htmlwidget-289c6479e498d59c360d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-289c6479e498d59c360d">{"x":{"filter":"none","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div id="data-preparation" class="section level3 unnumbered">
<h3>Data preparation</h3>
<p><strong>Objective</strong>: We need to achieve a “long”-style data frame that contains one row per possible age-to-age transmission route, with a numeric column containing that row’s proportion of all observed transmission events in the linelist.</p>
<p>This will take several data manuipulation steps to achieve:</p>
<div id="make-cases-data-frame" class="section level4 unnumbered">
<h4>Make cases data frame</h4>
<p>To begin, we create a data frame of the cases, their ages, and their infectors - we call the data frame <code>case_ages</code>. The first 50 rows are displayed below.</p>
<div class="sourceCode" id="cb1632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1632-1"><a href="heat-plots.html#cb1632-1" aria-hidden="true" tabindex="-1"></a>case_ages <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1632-2"><a href="heat-plots.html#cb1632-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(case_id, infector, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb1632-3"><a href="heat-plots.html#cb1632-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;case_age_cat&quot;</span> <span class="ot">=</span> <span class="st">&quot;age_cat&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-51050c4b2a55a792f2ce" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-51050c4b2a55a792f2ce">{"x":{"filter":"none","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>infector<\/th>\n      <th>case_age_cat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="make-infectors-data-frame" class="section level4 unnumbered">
<h4>Make infectors data frame</h4>
<p>Next, we create a data frame of the infectors - at the moment it consists of a single column. These are the infector IDs from the linelist. Not every case has a known infector, so we remove missing values. The first 50 rows are displayed below.</p>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1633-1"><a href="heat-plots.html#cb1633-1" aria-hidden="true" tabindex="-1"></a>infectors <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1633-2"><a href="heat-plots.html#cb1633-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(infector) <span class="sc">%&gt;%</span> </span>
<span id="cb1633-3"><a href="heat-plots.html#cb1633-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(infector)</span></code></pre></div>
<div id="htmlwidget-6b79b49fac51ccef91b4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6b79b49fac51ccef91b4">{"x":{"filter":"none","data":[["f547d6","f90f5f","11f8ea","aec8ec","893f25","133ee7","996f3a","133ee7","37a6f6","9f6884","4802b1","a75c7f","8e104d","ab634e","b799eb","5d9e4d","a15e13","ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277","d6584f","312ecf","52ea64","cfd79c","d145b7","174288","53608c","3b096b","f5c142","d05405","700448","a2e5cc","7fd086","4e08f2","3789ee","c2595d","b7641e","ce4ec6","09f7ab","4b501e","006775","1f8797","2b36fa","068c6a","535760"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>infector<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Next, we use joins to procure the ages of the infectors. This is not simple, because in the <code>linelist</code>, the infector’s ages are not listed as such. We achieve this result by joining the case <code>linelist</code> to the infectors. We begin with the infectors, and <code>left_join()</code> (add) the case <code>linelist</code> such that the <code>infector</code> id column left-side “baseline” data frame joins to the <code>case_id</code> column in the right-side <code>linelist</code> data frame.</p>
<p>Thus, the data from the infector’s case record in the linelist (including age) is added to the infector row. The 50 first rows are displayed below.</p>
<div class="sourceCode" id="cb1634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1634-1"><a href="heat-plots.html#cb1634-1" aria-hidden="true" tabindex="-1"></a>infector_ages <span class="ot">&lt;-</span> infectors <span class="sc">%&gt;%</span>             <span class="co"># begin with infectors</span></span>
<span id="cb1634-2"><a href="heat-plots.html#cb1634-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(                               <span class="co"># add the linelist data to each infector  </span></span>
<span id="cb1634-3"><a href="heat-plots.html#cb1634-3" aria-hidden="true" tabindex="-1"></a>    linelist,</span>
<span id="cb1634-4"><a href="heat-plots.html#cb1634-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;infector&quot;</span> <span class="ot">=</span> <span class="st">&quot;case_id&quot;</span>)) <span class="sc">%&gt;%</span>    <span class="co"># match infector to their information as a case</span></span>
<span id="cb1634-5"><a href="heat-plots.html#cb1634-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(infector, age_cat) <span class="sc">%&gt;%</span>            <span class="co"># keep only columns of interest</span></span>
<span id="cb1634-6"><a href="heat-plots.html#cb1634-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;infector_age_cat&quot;</span> <span class="ot">=</span> <span class="st">&quot;age_cat&quot;</span>)   <span class="co"># rename for clarity</span></span></code></pre></div>
<div id="htmlwidget-98e5dbc6f616ca12a1c5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-98e5dbc6f616ca12a1c5">{"x":{"filter":"none","data":[["f547d6","f90f5f","11f8ea","aec8ec","893f25","133ee7","996f3a","133ee7","37a6f6","9f6884","4802b1","a75c7f","8e104d","ab634e","b799eb","5d9e4d","a15e13","ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277","d6584f","312ecf","52ea64","cfd79c","d145b7","174288","53608c","3b096b","f5c142","d05405","700448","a2e5cc","7fd086","4e08f2","3789ee","c2595d","b7641e","ce4ec6","09f7ab","4b501e","006775","1f8797","2b36fa","068c6a","535760"],["15-19",null,"50-69",null,"0-4","20-29",null,"20-29",null,"15-19",null,null,"10-14",null,"10-14",null,null,null,null,"50-69",null,null,null,null,null,"5-9",null,"10-14","10-14","0-4","20-29",null,null,"20-29",null,"5-9",null,"10-14",null,"20-29","10-14","5-9","0-4",null,null,null,"5-9","15-19",null,null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>infector<\/th>\n      <th>infector_age_cat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Then, we combine the cases and their ages with the infectors and their ages. Each of these data frame has the column <code>infector</code>, so it is used for the join. The first rows are displayed below:</p>
<div class="sourceCode" id="cb1635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1635-1"><a href="heat-plots.html#cb1635-1" aria-hidden="true" tabindex="-1"></a>ages_complete <span class="ot">&lt;-</span> case_ages <span class="sc">%&gt;%</span>  </span>
<span id="cb1635-2"><a href="heat-plots.html#cb1635-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1635-3"><a href="heat-plots.html#cb1635-3" aria-hidden="true" tabindex="-1"></a>    infector_ages,</span>
<span id="cb1635-4"><a href="heat-plots.html#cb1635-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;infector&quot;</span>) <span class="sc">%&gt;%</span>        <span class="co"># each has the column infector</span></span>
<span id="cb1635-5"><a href="heat-plots.html#cb1635-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()                     <span class="co"># drop rows with any missing data</span></span></code></pre></div>
<div id="htmlwidget-f8b53dbd039f09ab25fd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f8b53dbd039f09ab25fd">{"x":{"filter":"none","data":[["5fe599","5fe599","5fe599","893f25","893f25","893f25","893f25","893f25","07e3e8","369449","369449","57a565","57a565","2eaa9a","ddddee","bc2adf","bc2adf","8ebf6e","f5c142","062638","c76676","c76676","c76676","baacc1","497372","c71dcd","c71dcd","422831","2b36fa","2b36fa","2b36fa","4ade58","9f0c37","f97626","7d99f2","7d99f2","babc2d","d5f3c0","d5f3c0","8b4b24","bd5a25","564652","564652","890de4","890de4","890de4","890de4","cc71ea","cc71ea","3c0ca7"],["f547d6","f547d6","f547d6","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","893f25","133ee7","133ee7","133ee7","133ee7","9f6884","8e104d","b799eb","b799eb","567136","d6584f","52ea64","cfd79c","cfd79c","cfd79c","d145b7","174288","f5c142","f5c142","700448","7fd086","7fd086","7fd086","3789ee","c2595d","b7641e","ce4ec6","ce4ec6","1f8797","2b36fa","2b36fa","108b95","5b2dd9","92e129","92e129","9a9a84","9a9a84","9a9a84","9a9a84","68623f","68623f","088b66"],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","15-19","0-4","0-4","30-49","30-49","5-9","10-14","20-29","20-29","10-14","20-29","10-14","10-14","10-14","10-14","0-4","10-14","20-29","20-29","10-14","15-19","15-19","15-19","30-49","10-14","5-9","5-9","5-9","20-29","5-9","5-9","15-19","20-29","15-19","15-19","30-49","30-49","30-49","30-49","30-49","30-49","5-9"],["15-19","15-19","15-19","50-69","50-69","50-69","50-69","50-69","0-4","20-29","20-29","20-29","20-29","15-19","10-14","10-14","10-14","50-69","5-9","10-14","10-14","10-14","10-14","0-4","20-29","20-29","20-29","5-9","10-14","10-14","10-14","20-29","10-14","5-9","0-4","0-4","5-9","15-19","15-19","15-19","30-49","10-14","10-14","70+","70+","70+","70+","30-49","30-49","30-49"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>infector<\/th>\n      <th>case_age_cat<\/th>\n      <th>infector_age_cat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Below, a simple cross-tabulation of counts between the case and infector age groups. Labels added for clarity.</p>
<div class="sourceCode" id="cb1636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1636-1"><a href="heat-plots.html#cb1636-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">cases =</span> ages_complete<span class="sc">$</span>case_age_cat,</span>
<span id="cb1636-2"><a href="heat-plots.html#cb1636-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">infectors =</span> ages_complete<span class="sc">$</span>infector_age_cat)</span></code></pre></div>
<pre><code>##        infectors
## cases   0-4 5-9 10-14 15-19 20-29 30-49 50-69 70+
##   0-4   105 156   105   114   143   117    13   0
##   5-9   102 132   110   102   117    96    12   5
##   10-14 104 109    91    79   120    80    12   4
##   15-19  85 105    82    39    75    69     7   5
##   20-29 101 127   109    80   143   107    22   4
##   30-49  72  97    56    54    98    61     4   5
##   50-69   5   6    15     9     7     5     2   0
##   70+     1   0     2     0     0     0     0   0</code></pre>
<p>We can convert this table to a data frame with <code>data.frame()</code> from <strong>base</strong> R, which also automatically converts it to “long” format, which is desired for the <code>ggplot()</code>. The first rows are shown below.</p>
<div class="sourceCode" id="cb1638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1638-1"><a href="heat-plots.html#cb1638-1" aria-hidden="true" tabindex="-1"></a>long_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(</span>
<span id="cb1638-2"><a href="heat-plots.html#cb1638-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases     =</span> ages_complete<span class="sc">$</span>case_age_cat,</span>
<span id="cb1638-3"><a href="heat-plots.html#cb1638-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">infectors =</span> ages_complete<span class="sc">$</span>infector_age_cat))</span></code></pre></div>
<div id="htmlwidget-f71c207cb5184cece431" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f71c207cb5184cece431">{"x":{"filter":"none","data":[["0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9"],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","5-9","5-9","5-9","5-9","5-9","5-9","5-9","5-9","10-14","10-14","10-14","10-14","10-14","10-14","10-14","10-14","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","20-29","20-29","20-29","20-29","20-29","20-29","20-29","20-29","30-49","30-49","30-49","30-49","30-49","30-49","30-49","30-49","50-69","50-69"],[105,102,104,85,101,72,5,1,156,132,109,105,127,97,6,0,105,110,91,82,109,56,15,2,114,102,79,39,80,54,9,0,143,117,120,75,143,98,7,0,117,96,80,69,107,61,5,0,13,12]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>infectors<\/th>\n      <th>Freq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Now we do the same, but apply <code>prop.table()</code> from <strong>base</strong> R to the table so instead of counts we get proportions of the total. The first 50 rows are shown below.</p>
<div class="sourceCode" id="cb1639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1639-1"><a href="heat-plots.html#cb1639-1" aria-hidden="true" tabindex="-1"></a>long_prop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(</span>
<span id="cb1639-2"><a href="heat-plots.html#cb1639-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">cases =</span> ages_complete<span class="sc">$</span>case_age_cat,</span>
<span id="cb1639-3"><a href="heat-plots.html#cb1639-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">infectors =</span> ages_complete<span class="sc">$</span>infector_age_cat)))</span></code></pre></div>
<div id="htmlwidget-166feec4d8ff9aaafea0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-166feec4d8ff9aaafea0">{"x":{"filter":"none","data":[["0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9"],["0-4","0-4","0-4","0-4","0-4","0-4","0-4","0-4","5-9","5-9","5-9","5-9","5-9","5-9","5-9","5-9","10-14","10-14","10-14","10-14","10-14","10-14","10-14","10-14","15-19","15-19","15-19","15-19","15-19","15-19","15-19","15-19","20-29","20-29","20-29","20-29","20-29","20-29","20-29","20-29","30-49","30-49","30-49","30-49","30-49","30-49","30-49","30-49","50-69","50-69"],[0.0284784377542718,0.0276647681041497,0.0282072145375644,0.0230539734201248,0.0273935448874424,0.0195280716029292,0.00135611608353675,0.00027122321670735,0.0423108218063466,0.0358014646053702,0.0295633306211012,0.0284784377542718,0.0344453485218335,0.026308652020613,0.0016273393002441,0,0.0284784377542718,0.0298345538378085,0.0246813127203689,0.0222403037700027,0.0295633306211012,0.0151885001356116,0.00406834825061025,0.0005424464334147,0.0309194467046379,0.0276647681041497,0.0214266341198807,0.0105777054515867,0.021697857336588,0.0146460537021969,0.00244100895036615,0,0.0387849199891511,0.03173311635476,0.032546786004882,0.0203417412530513,0.0387849199891511,0.0265798752373203,0.00189856251695145,0,0.03173311635476,0.0260374288039056,0.021697857336588,0.0187144019528072,0.0290208841876865,0.0165446162191484,0.00135611608353675,0,0.00352590181719555,0.0032546786004882]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>infectors<\/th>\n      <th>Freq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="create-heat-plot" class="section level3 unnumbered">
<h3>Create heat plot</h3>
<p>Now finally we can create the heat plot with <strong>ggplot2</strong> package, using the <code>geom_tile()</code> function. See the <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> page to learn more extensively about color/fill scales, especially the <code>scale_fill_gradient()</code> function.</p>
<ul>
<li>In the aesthetics <code>aes()</code> of <code>geom_tile()</code> set the x and y as the case age and infector age<br />
</li>
<li>Also in <code>aes()</code> set the argument <code>fill =</code> to the <code>Freq</code> column - this is the value that will be converted to a tile color<br />
</li>
<li>Set a scale color with <code>scale_fill_gradient()</code> - you can specify the high/low colors
<ul>
<li>Note that <code>scale_color_gradient()</code> is different! In this case you want the fill<br />
</li>
</ul></li>
<li>Because the color is made via “fill”, you can use the <code>fill =</code> argument in <code>labs()</code> to change the legend title</li>
</ul>
<div class="sourceCode" id="cb1640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1640-1"><a href="heat-plots.html#cb1640-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> long_prop)<span class="sc">+</span>       <span class="co"># use long data, with proportions as Freq</span></span>
<span id="cb1640-2"><a href="heat-plots.html#cb1640-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(                    <span class="co"># visualize it in tiles</span></span>
<span id="cb1640-3"><a href="heat-plots.html#cb1640-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb1640-4"><a href="heat-plots.html#cb1640-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> cases,         <span class="co"># x-axis is case age</span></span>
<span id="cb1640-5"><a href="heat-plots.html#cb1640-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> infectors,     <span class="co"># y-axis is infector age</span></span>
<span id="cb1640-6"><a href="heat-plots.html#cb1640-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> Freq))<span class="sc">+</span>            <span class="co"># color of the tile is the Freq column in the data</span></span>
<span id="cb1640-7"><a href="heat-plots.html#cb1640-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(          <span class="co"># adjust the fill color of the tiles</span></span>
<span id="cb1640-8"><a href="heat-plots.html#cb1640-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb1640-9"><a href="heat-plots.html#cb1640-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;orange&quot;</span>)<span class="sc">+</span></span>
<span id="cb1640-10"><a href="heat-plots.html#cb1640-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(                         <span class="co"># labels</span></span>
<span id="cb1640-11"><a href="heat-plots.html#cb1640-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Case age&quot;</span>,</span>
<span id="cb1640-12"><a href="heat-plots.html#cb1640-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Infector age&quot;</span>,</span>
<span id="cb1640-13"><a href="heat-plots.html#cb1640-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Who infected whom&quot;</span>,</span>
<span id="cb1640-14"><a href="heat-plots.html#cb1640-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Frequency matrix of transmission events&quot;</span>,</span>
<span id="cb1640-15"><a href="heat-plots.html#cb1640-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Proportion of all</span><span class="sc">\n</span><span class="st">tranmsission events&quot;</span>     <span class="co"># legend title</span></span>
<span id="cb1640-16"><a href="heat-plots.html#cb1640-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1244-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="reporting-metrics-over-time" class="section level2" number="34.3">
<h2><span class="header-section-number">34.3</span> Reporting metrics over time</h2>
<p>Often in public health, one objective is to assess trends over time for many entities (facilities, jurisdictions, etc.). One way to visualize such trends over time is a heat plot where the x-axis is time and on the y-axis are the many entities.</p>
<div id="data-preparation-1" class="section level3 unnumbered">
<h3>Data preparation</h3>
<p>We begin by importing a dataset of daily malaria reports from many facilities. The reports contain a date, province, district, and malaria counts. See the page on <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> for information on how to download these data. Below are the first 30 rows:</p>
<div class="sourceCode" id="cb1641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1641-1"><a href="heat-plots.html#cb1641-1" aria-hidden="true" tabindex="-1"></a>facility_count_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;malaria_facility_count_data.rds&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-bb533e63ab32bd727399" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bb533e63ab32bd727399">{"x":{"filter":"none","data":[["Facility 1","Facility 2","Facility 3","Facility 4","Facility 5","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 7","Facility 8","Facility 9","Facility 10","Facility 11","Facility 12","Facility 13","Facility 14","Facility 15","Facility 16","Facility 17","Facility 18","Facility 19","Facility 19","Facility 20","Facility 21","Facility 19","Facility 22","Facility 23","Facility 23"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-09","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-09","2020-08-11","2020-08-11","2020-08-12"],["Spring","Bolo","Dingo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Bolo","Spring","Bolo","Spring","Dingo","Bolo","Dingo","Barnard","Barnard","Barnard","Bolo","Bolo","Bolo","Barnard","Bolo","Bolo","Bolo","Dingo","Dingo"],[46,26,18,49,17,8,7,42,35,49,32,28,53,34,60,134,0,16,11,34,9,13,32,52,37,51,32,28,31,31]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_tot<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div id="aggregate-and-summarize" class="section level4 unnumbered">
<h4>Aggregate and summarize</h4>
<p><strong>The objective in this example</strong> is to transform the daily facility <em>total</em> malaria case counts (seen in previous tab) into <em>weekly</em> summary statistics of facility reporting performance - in this case <em>the proportion of days per week that the facility reported any data</em>. For this example we will show data only for <strong>Spring District</strong>.</p>
<p>To achieve this we will do the following data management steps:</p>
<ol style="list-style-type: decimal">
<li>Filter the data as appropriate (by place, date)<br />
</li>
<li>Create a week column using <code>floor_date()</code> from package <strong>lubridate</strong>
<ul>
<li>This function returns the start-date of a given date’s week, using a specified start date of each week (e.g. “Mondays”)<br />
</li>
</ul></li>
<li>The data are grouped by columns “location” and “week” to create analysis units of “facility-week”<br />
</li>
<li>The function <code>summarise()</code> creates new columns to reflecting summary statistics per facility-week group:
<ul>
<li>Number of days per week (7 - a static value)<br />
</li>
<li>Number of reports received from the facility-week (could be more than 7!)<br />
</li>
<li>Sum of malaria cases reported by the facility-week (just for interest)<br />
</li>
<li>Number of <em>unique</em> days in the facility-week for which there is data reported<br />
</li>
<li><strong>Percent of the 7 days per facility-week for which data was reported</strong><br />
</li>
</ul></li>
<li>The data frame is joined with <code>right_join()</code> to a comprehensive list of all possible facility-week combinations, to make the dataset complete. The matrix of all possible combinations is created by applying <code>expand()</code> to those two columns of the data frame as it is at that moment in the pipe chain (represented by <code>.</code>). Because a <code>right_join()</code> is used, all rows in the <code>expand()</code> data frame are kept, and added to <code>agg_weeks</code> if necessary. These new rows appear with <code>NA</code> (missing) summarized values.</li>
</ol>
<p>Below we demonstrate step-by-step:</p>
<div class="sourceCode" id="cb1642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1642-1"><a href="heat-plots.html#cb1642-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weekly summary dataset</span></span>
<span id="cb1642-2"><a href="heat-plots.html#cb1642-2" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> facility_count_data <span class="sc">%&gt;%</span> </span>
<span id="cb1642-3"><a href="heat-plots.html#cb1642-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1642-4"><a href="heat-plots.html#cb1642-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter the data as appropriate</span></span>
<span id="cb1642-5"><a href="heat-plots.html#cb1642-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb1642-6"><a href="heat-plots.html#cb1642-6" aria-hidden="true" tabindex="-1"></a>    District <span class="sc">==</span> <span class="st">&quot;Spring&quot;</span>,</span>
<span id="cb1642-7"><a href="heat-plots.html#cb1642-7" aria-hidden="true" tabindex="-1"></a>    data_date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-08-01&quot;</span>)) </span></code></pre></div>
<p>Now the dataset has <code>nrow(agg_weeks)</code> rows, when it previously had <code>nrow(facility_count_data)</code>.</p>
<p>Next we create a <code>week</code> column reflecting the start date of the week for each record. This is achieved with the <strong>lubridate</strong> package and the function <code>floor_date()</code>, which is set to “week” and for the weeks to begin on Mondays (day 1 of the week - Sundays would be 7). The top rows are shown below.</p>
<div class="sourceCode" id="cb1643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1643-1"><a href="heat-plots.html#cb1643-1" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1643-2"><a href="heat-plots.html#cb1643-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create week column from data_date</span></span>
<span id="cb1643-3"><a href="heat-plots.html#cb1643-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1643-4"><a href="heat-plots.html#cb1643-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(                     <span class="co"># create new column of weeks</span></span>
<span id="cb1643-5"><a href="heat-plots.html#cb1643-5" aria-hidden="true" tabindex="-1"></a>      data_date,                                      <span class="co"># date column</span></span>
<span id="cb1643-6"><a href="heat-plots.html#cb1643-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">unit =</span> <span class="st">&quot;week&quot;</span>,                                  <span class="co"># give start of the week</span></span>
<span id="cb1643-7"><a href="heat-plots.html#cb1643-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">week_start =</span> <span class="dv">1</span>))                                <span class="co"># weeks to start on Mondays </span></span></code></pre></div>
<p>The new week column can be seen on the far right of the data frame</p>
<div id="htmlwidget-c2c03ba63e56bfe77763" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c2c03ba63e56bfe77763">{"x":{"filter":"none","data":[["Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 51","Facility 51","Facility 51","Facility 56","Facility 7","Facility 7","Facility 7","Facility 11","Facility 35","Facility 35","Facility 28","Facility 28","Facility 28","Facility 28"],["2020-07-31","2020-07-30","2020-07-29","2020-07-28","2020-07-27","2020-07-31","2020-07-30","2020-07-29","2020-07-28","2020-07-27","2020-07-26","2020-07-25","2020-07-24","2020-07-23","2020-07-22","2020-07-21","2020-07-30","2020-07-29","2020-07-28","2020-06-25","2020-07-31","2020-07-30","2020-07-29","2020-07-31","2020-07-30","2020-07-29","2020-07-30","2020-07-29","2020-07-28","2020-07-27"],["Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring","Spring"],[13,14,74,75,91,80,39,44,44,43,28,41,61,40,33,66,32,32,32,200,0,0,21,21,43,179,1,35,31,45],["2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-20","2020-07-20","2020-07-20","2020-07-20","2020-07-20","2020-07-20","2020-07-27","2020-07-27","2020-07-27","2020-06-22","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27","2020-07-27"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_tot<\/th>\n      <th>week<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Now we group the data into facility-weeks and summarise them to produce statistics per facility-week. See the page on <a href="descriptive-tables.html#descriptive-tables">Descriptive tables</a> for tips. The grouping itself doesn’t change the data frame, but it impacts how the subsequent summary statistics are calculated.</p>
<p>The top rows are shown below. Note how the columns have completely changed to reflect the desired summary statistics. Each row reflects one facility-week.</p>
<div class="sourceCode" id="cb1644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1644-1"><a href="heat-plots.html#cb1644-1" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span>   </span>
<span id="cb1644-2"><a href="heat-plots.html#cb1644-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1644-3"><a href="heat-plots.html#cb1644-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group into facility-weeks</span></span>
<span id="cb1644-4"><a href="heat-plots.html#cb1644-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_name, week) <span class="sc">%&gt;%</span></span>
<span id="cb1644-5"><a href="heat-plots.html#cb1644-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1644-6"><a href="heat-plots.html#cb1644-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create summary statistics columns on the grouped data</span></span>
<span id="cb1644-7"><a href="heat-plots.html#cb1644-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb1644-8"><a href="heat-plots.html#cb1644-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_days          =</span> <span class="dv">7</span>,                                          <span class="co"># 7 days per week           </span></span>
<span id="cb1644-9"><a href="heat-plots.html#cb1644-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_reports       =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),                                 <span class="co"># number of reports received per week (could be &gt;7)</span></span>
<span id="cb1644-10"><a href="heat-plots.html#cb1644-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">malaria_tot     =</span> <span class="fu">sum</span>(malaria_tot, <span class="at">na.rm =</span> T),                <span class="co"># total malaria cases reported</span></span>
<span id="cb1644-11"><a href="heat-plots.html#cb1644-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_days_reported =</span> <span class="fu">length</span>(<span class="fu">unique</span>(data_date)),                  <span class="co"># number of unique days reporting per week</span></span>
<span id="cb1644-12"><a href="heat-plots.html#cb1644-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_days_reported =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>(n_days_reported <span class="sc">/</span> n_days)))      <span class="co"># percent of days reporting</span></span></code></pre></div>
<div id="htmlwidget-4c4803251478622c57ca" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4c4803251478622c57ca">{"x":{"filter":"none","data":[["Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28"],["2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-05-11","2020-05-18","2020-05-25","2020-06-01","2020-06-08","2020-06-15","2020-06-22","2020-06-29"],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[2,7,7,7,7,7,7,4,2,8,6,2,3,1,5,2,7,6,5,7,6,5,2,7,7,7,7,7,9,7],[0,0,0,101,402,570,378,131,354,853,502,317,245,0,0,0,17,147,136,118,88,86,26,216,155,120,319,256,475,352],[2,7,7,7,7,7,7,4,2,7,6,2,3,1,5,2,5,6,5,7,6,5,2,7,7,7,7,7,7,7],[29,100,100,100,100,100,100,57,29,100,86,29,43,14,71,29,71,86,71,100,86,71,29,100,100,100,100,100,100,100]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>week<\/th>\n      <th>n_days<\/th>\n      <th>n_reports<\/th>\n      <th>malaria_tot<\/th>\n      <th>n_days_reported<\/th>\n      <th>p_days_reported<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Finally, we run the command below to ensure that ALL possible facility-weeks are present in the data, even if they were missing before.</p>
<p>We are using a <code>right_join()</code> on itself (the dataset is represented by “.”) but having been expanded to include all possible combinations of the columns <code>week</code> and <code>location_name</code>. See documentation on the <code>expand()</code> function in the page on [Pivoting]. Before running this code the dataset contains <code>nrow(agg_weeks)</code> rows.</p>
<div class="sourceCode" id="cb1645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1645-1"><a href="heat-plots.html#cb1645-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame of every possible facility-week</span></span>
<span id="cb1645-2"><a href="heat-plots.html#cb1645-2" aria-hidden="true" tabindex="-1"></a>expanded_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1645-3"><a href="heat-plots.html#cb1645-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">as.factor</span>(week)) <span class="sc">%&gt;%</span>         <span class="co"># convert date to a factor so expand() works correctly</span></span>
<span id="cb1645-4"><a href="heat-plots.html#cb1645-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(., week, location_name) <span class="sc">%&gt;%</span>  <span class="co"># expand data frame to include all possible facility-week combinations</span></span>
<span id="cb1645-5"><a href="heat-plots.html#cb1645-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="co"># note: &quot;.&quot; represents the dataset at that moment in the pipe chain</span></span>
<span id="cb1645-6"><a href="heat-plots.html#cb1645-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">as.Date</span>(week))               <span class="co"># re-convert week to class Date so the subsequent right_join works</span></span></code></pre></div>
<p>Here is <code>expanded_weeks</code>:</p>
<div id="htmlwidget-4824d69f7c23adf931c6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4824d69f7c23adf931c6">{"x":{"filter":"none","data":[["2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25","2020-06-08","2020-06-15","2020-06-22","2020-06-29","2020-07-06","2020-07-13","2020-07-20","2020-07-27","2020-06-01","2020-05-11","2020-05-18","2020-05-25"],["Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 1","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 11","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 27","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 28","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 32","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 35","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 39","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 50","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 51","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 56","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 58","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 59","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 65","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 7","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9","Facility 9"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week<\/th>\n      <th>location_name<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Before running this code, <code>agg_weeks</code> contains <code>nrow(agg_weeks)</code> rows.</p>
<div class="sourceCode" id="cb1646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1646-1"><a href="heat-plots.html#cb1646-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a right-join with the expanded facility-week list to fill-in the missing gaps in the data</span></span>
<span id="cb1646-2"><a href="heat-plots.html#cb1646-2" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span>      </span>
<span id="cb1646-3"><a href="heat-plots.html#cb1646-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(expanded_weeks) <span class="sc">%&gt;%</span>                            <span class="co"># Ensure every possible facility-week combination appears in the data</span></span>
<span id="cb1646-4"><a href="heat-plots.html#cb1646-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_days_reported =</span> <span class="fu">replace_na</span>(p_days_reported, <span class="dv">0</span>))  <span class="co"># convert missing values to 0                           </span></span></code></pre></div>
<pre><code>## Joining, by = c(&quot;location_name&quot;, &quot;week&quot;)</code></pre>
<p>After running this code, <code>agg_weeks</code> contains <code>nrow(agg_weeks)</code> rows.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="create-heat-plot-1" class="section level3 unnumbered">
<h3>Create heat plot</h3>
<p>The <code>ggplot()</code> is made using <code>geom_tile()</code> from the <strong>ggplot2</strong> package:</p>
<ul>
<li>Weeks on the x-axis is transformed to dates, allowing use of <code>scale_x_date()</code><br />
</li>
<li><code>location_name</code> on the y-axis will show all facility names<br />
</li>
<li>The <code>fill</code> is <code>p_days_reported</code>, the performance for that facility-week (numeric)<br />
</li>
<li><code>scale_fill_gradient()</code> is used on the numeric fill, specifying colors for high, low, and <code>NA</code><br />
</li>
<li><code>scale_x_date()</code> is used on the x-axis specifying labels every 2 weeks and their format<br />
</li>
<li>Display themes and labels can be adjusted as necessary</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="basic" class="section level3 unnumbered">
<h3>Basic</h3>
<p>A basic heat plot is produced below, using the default colors, scales, etc. As explained above, within the <code>aes()</code> for <code>geom_tile()</code> you must provide an x-axis column, y-axis column, <strong>and</strong> a column for the the <code>fill =</code>. The fill is the numeric value that presents as tile color.</p>
<div class="sourceCode" id="cb1648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1648-1"><a href="heat-plots.html#cb1648-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span></span>
<span id="cb1648-2"><a href="heat-plots.html#cb1648-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1648-3"><a href="heat-plots.html#cb1648-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1648-4"><a href="heat-plots.html#cb1648-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1648-5"><a href="heat-plots.html#cb1648-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1256-1.png" width="672" /></p>
</div>
<div id="cleaned-plot" class="section level3 unnumbered">
<h3>Cleaned plot</h3>
<p>We can make this plot look better by adding additional <strong>ggplot2</strong> functions, as shown below. See the page on <a href="ggplot-tips.html#ggplot-tips">ggplot tips</a> for details.</p>
<div class="sourceCode" id="cb1649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1649-1"><a href="heat-plots.html#cb1649-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span> </span>
<span id="cb1649-2"><a href="heat-plots.html#cb1649-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1649-3"><a href="heat-plots.html#cb1649-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show data as tiles</span></span>
<span id="cb1649-4"><a href="heat-plots.html#cb1649-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1649-5"><a href="heat-plots.html#cb1649-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1649-6"><a href="heat-plots.html#cb1649-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1649-7"><a href="heat-plots.html#cb1649-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported),      </span>
<span id="cb1649-8"><a href="heat-plots.html#cb1649-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span>                 <span class="co"># white gridlines</span></span>
<span id="cb1649-9"><a href="heat-plots.html#cb1649-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1649-10"><a href="heat-plots.html#cb1649-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb1649-11"><a href="heat-plots.html#cb1649-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb1649-12"><a href="heat-plots.html#cb1649-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb1649-13"><a href="heat-plots.html#cb1649-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">&quot;grey80&quot;</span>)<span class="sc">+</span></span>
<span id="cb1649-14"><a href="heat-plots.html#cb1649-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1649-15"><a href="heat-plots.html#cb1649-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># date axis</span></span>
<span id="cb1649-16"><a href="heat-plots.html#cb1649-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1649-17"><a href="heat-plots.html#cb1649-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),             <span class="co"># remove extra space on sides</span></span>
<span id="cb1649-18"><a href="heat-plots.html#cb1649-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 weeks&quot;</span>,     <span class="co"># labels every 2 weeks</span></span>
<span id="cb1649-19"><a href="heat-plots.html#cb1649-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">%b&quot;</span>)<span class="sc">+</span>     <span class="co"># format is day over month (\n in newline)</span></span>
<span id="cb1649-20"><a href="heat-plots.html#cb1649-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1649-21"><a href="heat-plots.html#cb1649-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1649-22"><a href="heat-plots.html#cb1649-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                                  <span class="co"># simplify background</span></span>
<span id="cb1649-23"><a href="heat-plots.html#cb1649-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1649-24"><a href="heat-plots.html#cb1649-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1649-25"><a href="heat-plots.html#cb1649-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1649-26"><a href="heat-plots.html#cb1649-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text  =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1649-27"><a href="heat-plots.html#cb1649-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),           <span class="co"># height of legend key</span></span>
<span id="cb1649-28"><a href="heat-plots.html#cb1649-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width  =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>,<span class="st">&quot;cm&quot;</span>),         <span class="co"># width of legend key</span></span>
<span id="cb1649-29"><a href="heat-plots.html#cb1649-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1649-30"><a href="heat-plots.html#cb1649-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),              <span class="co"># axis text size</span></span>
<span id="cb1649-31"><a href="heat-plots.html#cb1649-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="fl">0.2</span>),            <span class="co"># axis text alignment</span></span>
<span id="cb1649-32"><a href="heat-plots.html#cb1649-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.4</span>),               </span>
<span id="cb1649-33"><a href="heat-plots.html#cb1649-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),  <span class="co"># axis title size and bold</span></span>
<span id="cb1649-34"><a href="heat-plots.html#cb1649-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1649-35"><a href="heat-plots.html#cb1649-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">14</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),  <span class="co"># title right-aligned, large, bold</span></span>
<span id="cb1649-36"><a href="heat-plots.html#cb1649-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)  <span class="co"># caption right-aligned and italic</span></span>
<span id="cb1649-37"><a href="heat-plots.html#cb1649-37" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb1649-38"><a href="heat-plots.html#cb1649-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1649-39"><a href="heat-plots.html#cb1649-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot labels</span></span>
<span id="cb1649-40"><a href="heat-plots.html#cb1649-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>,</span>
<span id="cb1649-41"><a href="heat-plots.html#cb1649-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Facility name&quot;</span>,</span>
<span id="cb1649-42"><a href="heat-plots.html#cb1649-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Reporting</span><span class="sc">\n</span><span class="st">performance (%)&quot;</span>,           <span class="co"># legend title, because legend shows fill</span></span>
<span id="cb1649-43"><a href="heat-plots.html#cb1649-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Percent of days per week that facility reported data&quot;</span>,</span>
<span id="cb1649-44"><a href="heat-plots.html#cb1649-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;District health facilities, May-July 2020&quot;</span>,</span>
<span id="cb1649-45"><a href="heat-plots.html#cb1649-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;7-day weeks beginning on Mondays.&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1257-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="ordered-y-axis" class="section level3 unnumbered">
<h3>Ordered y-axis</h3>
<p>Currently, the facilities are ordered “alpha-numerically” from the bottom to the top. If you want to adjust the order the y-axis facilities, convert them to class factor and provide the order. See the page on <a href="factors.html#factors">Factors</a> for tips.</p>
<p>Since there are many facilities and we don’t want to write them all out, we will try another approach - ordering the facilities in a data frame and using the resulting column of names as the factor level order. Below, the column <code>location_name</code> is converted to a factor, and the order of its levels is set based on the total number of reporting days filed by the facility across the whole time-span.</p>
<p>To do this, we create a data frame which represents the total number of reports per facility, arranged in ascending order. We can use this vector to order the factor levels in the plot.</p>
<div class="sourceCode" id="cb1650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1650-1"><a href="heat-plots.html#cb1650-1" aria-hidden="true" tabindex="-1"></a>facility_order <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1650-2"><a href="heat-plots.html#cb1650-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_name) <span class="sc">%&gt;%</span> </span>
<span id="cb1650-3"><a href="heat-plots.html#cb1650-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_reports =</span> <span class="fu">sum</span>(n_days_reported, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb1650-4"><a href="heat-plots.html#cb1650-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(tot_reports) <span class="co"># ascending order</span></span></code></pre></div>
<p>See the data frame below:</p>
<div id="htmlwidget-f195b6ab427c1327e24d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f195b6ab427c1327e24d">{"x":{"filter":"none","data":[["Facility 56","Facility 65","Facility 11","Facility 39","Facility 59","Facility 27","Facility 51","Facility 32","Facility 7","Facility 1","Facility 9","Facility 35","Facility 50","Facility 58","Facility 28"],[1,6,20,33,35,42,42,43,44,48,50,52,53,55,77]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>tot_reports<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Now use a column from the above data frame (<code>facility_order$location_name</code>) to be the order of the factor levels of <code>location_name</code> in the data frame <code>agg_weeks</code>:</p>
<div class="sourceCode" id="cb1651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1651-1"><a href="heat-plots.html#cb1651-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load package </span></span>
<span id="cb1651-2"><a href="heat-plots.html#cb1651-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(forcats)</span>
<span id="cb1651-3"><a href="heat-plots.html#cb1651-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1651-4"><a href="heat-plots.html#cb1651-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create factor and define levels manually</span></span>
<span id="cb1651-5"><a href="heat-plots.html#cb1651-5" aria-hidden="true" tabindex="-1"></a>agg_weeks <span class="ot">&lt;-</span> agg_weeks <span class="sc">%&gt;%</span> </span>
<span id="cb1651-6"><a href="heat-plots.html#cb1651-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location_name =</span> <span class="fu">fct_relevel</span>(</span>
<span id="cb1651-7"><a href="heat-plots.html#cb1651-7" aria-hidden="true" tabindex="-1"></a>    location_name, facility_order<span class="sc">$</span>location_name)</span>
<span id="cb1651-8"><a href="heat-plots.html#cb1651-8" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>And now the data are re-plotted, with location_name being an ordered factor:</p>
<div class="sourceCode" id="cb1652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1652-1"><a href="heat-plots.html#cb1652-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span> </span>
<span id="cb1652-2"><a href="heat-plots.html#cb1652-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1652-3"><a href="heat-plots.html#cb1652-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show data as tiles</span></span>
<span id="cb1652-4"><a href="heat-plots.html#cb1652-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1652-5"><a href="heat-plots.html#cb1652-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1652-6"><a href="heat-plots.html#cb1652-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1652-7"><a href="heat-plots.html#cb1652-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported),      </span>
<span id="cb1652-8"><a href="heat-plots.html#cb1652-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span>                 <span class="co"># white gridlines</span></span>
<span id="cb1652-9"><a href="heat-plots.html#cb1652-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1652-10"><a href="heat-plots.html#cb1652-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb1652-11"><a href="heat-plots.html#cb1652-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb1652-12"><a href="heat-plots.html#cb1652-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb1652-13"><a href="heat-plots.html#cb1652-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">&quot;grey80&quot;</span>)<span class="sc">+</span></span>
<span id="cb1652-14"><a href="heat-plots.html#cb1652-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1652-15"><a href="heat-plots.html#cb1652-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># date axis</span></span>
<span id="cb1652-16"><a href="heat-plots.html#cb1652-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1652-17"><a href="heat-plots.html#cb1652-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),             <span class="co"># remove extra space on sides</span></span>
<span id="cb1652-18"><a href="heat-plots.html#cb1652-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 weeks&quot;</span>,     <span class="co"># labels every 2 weeks</span></span>
<span id="cb1652-19"><a href="heat-plots.html#cb1652-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">%b&quot;</span>)<span class="sc">+</span>     <span class="co"># format is day over month (\n in newline)</span></span>
<span id="cb1652-20"><a href="heat-plots.html#cb1652-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1652-21"><a href="heat-plots.html#cb1652-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1652-22"><a href="heat-plots.html#cb1652-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                                  <span class="co"># simplify background</span></span>
<span id="cb1652-23"><a href="heat-plots.html#cb1652-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1652-24"><a href="heat-plots.html#cb1652-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1652-25"><a href="heat-plots.html#cb1652-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1652-26"><a href="heat-plots.html#cb1652-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text  =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1652-27"><a href="heat-plots.html#cb1652-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),           <span class="co"># height of legend key</span></span>
<span id="cb1652-28"><a href="heat-plots.html#cb1652-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width  =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>,<span class="st">&quot;cm&quot;</span>),         <span class="co"># width of legend key</span></span>
<span id="cb1652-29"><a href="heat-plots.html#cb1652-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1652-30"><a href="heat-plots.html#cb1652-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),              <span class="co"># axis text size</span></span>
<span id="cb1652-31"><a href="heat-plots.html#cb1652-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="fl">0.2</span>),            <span class="co"># axis text alignment</span></span>
<span id="cb1652-32"><a href="heat-plots.html#cb1652-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.4</span>),               </span>
<span id="cb1652-33"><a href="heat-plots.html#cb1652-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),  <span class="co"># axis title size and bold</span></span>
<span id="cb1652-34"><a href="heat-plots.html#cb1652-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1652-35"><a href="heat-plots.html#cb1652-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">14</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),  <span class="co"># title right-aligned, large, bold</span></span>
<span id="cb1652-36"><a href="heat-plots.html#cb1652-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)  <span class="co"># caption right-aligned and italic</span></span>
<span id="cb1652-37"><a href="heat-plots.html#cb1652-37" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb1652-38"><a href="heat-plots.html#cb1652-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1652-39"><a href="heat-plots.html#cb1652-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot labels</span></span>
<span id="cb1652-40"><a href="heat-plots.html#cb1652-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>,</span>
<span id="cb1652-41"><a href="heat-plots.html#cb1652-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Facility name&quot;</span>,</span>
<span id="cb1652-42"><a href="heat-plots.html#cb1652-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Reporting</span><span class="sc">\n</span><span class="st">performance (%)&quot;</span>,           <span class="co"># legend title, because legend shows fill</span></span>
<span id="cb1652-43"><a href="heat-plots.html#cb1652-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Percent of days per week that facility reported data&quot;</span>,</span>
<span id="cb1652-44"><a href="heat-plots.html#cb1652-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;District health facilities, May-July 2020&quot;</span>,</span>
<span id="cb1652-45"><a href="heat-plots.html#cb1652-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;7-day weeks beginning on Mondays.&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1261-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="display-values" class="section level3 unnumbered">
<h3>Display values</h3>
<p>You can add a <code>geom_text()</code> layer on top of the tiles, to display the actual numbers of each tile. Be aware this may not look pretty if you have many small tiles!</p>
<p>The following code has been added: <code>geom_text(aes(label = p_days_reported))</code>. This adds text onto every tile. The text displayed is the value assigned to the argument <code>label =</code>, which in this case has been set to the same numeric column <code>p_days_reported</code> that is also used to create the color gradient.</p>
<div class="sourceCode" id="cb1653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1653-1"><a href="heat-plots.html#cb1653-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> agg_weeks)<span class="sc">+</span> </span>
<span id="cb1653-2"><a href="heat-plots.html#cb1653-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1653-3"><a href="heat-plots.html#cb1653-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show data as tiles</span></span>
<span id="cb1653-4"><a href="heat-plots.html#cb1653-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb1653-5"><a href="heat-plots.html#cb1653-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> week,</span>
<span id="cb1653-6"><a href="heat-plots.html#cb1653-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> location_name,</span>
<span id="cb1653-7"><a href="heat-plots.html#cb1653-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> p_days_reported),      </span>
<span id="cb1653-8"><a href="heat-plots.html#cb1653-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span>                 <span class="co"># white gridlines</span></span>
<span id="cb1653-9"><a href="heat-plots.html#cb1653-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1653-10"><a href="heat-plots.html#cb1653-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># text</span></span>
<span id="cb1653-11"><a href="heat-plots.html#cb1653-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb1653-12"><a href="heat-plots.html#cb1653-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb1653-13"><a href="heat-plots.html#cb1653-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> week,</span>
<span id="cb1653-14"><a href="heat-plots.html#cb1653-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> location_name,</span>
<span id="cb1653-15"><a href="heat-plots.html#cb1653-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> p_days_reported))<span class="sc">+</span>      <span class="co"># add text on top of tile</span></span>
<span id="cb1653-16"><a href="heat-plots.html#cb1653-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1653-17"><a href="heat-plots.html#cb1653-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fill scale</span></span>
<span id="cb1653-18"><a href="heat-plots.html#cb1653-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb1653-19"><a href="heat-plots.html#cb1653-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb1653-20"><a href="heat-plots.html#cb1653-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb1653-21"><a href="heat-plots.html#cb1653-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">&quot;grey80&quot;</span>)<span class="sc">+</span></span>
<span id="cb1653-22"><a href="heat-plots.html#cb1653-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1653-23"><a href="heat-plots.html#cb1653-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># date axis</span></span>
<span id="cb1653-24"><a href="heat-plots.html#cb1653-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1653-25"><a href="heat-plots.html#cb1653-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),             <span class="co"># remove extra space on sides</span></span>
<span id="cb1653-26"><a href="heat-plots.html#cb1653-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 weeks&quot;</span>,     <span class="co"># labels every 2 weeks</span></span>
<span id="cb1653-27"><a href="heat-plots.html#cb1653-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">%b&quot;</span>)<span class="sc">+</span>     <span class="co"># format is day over month (\n in newline)</span></span>
<span id="cb1653-28"><a href="heat-plots.html#cb1653-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1653-29"><a href="heat-plots.html#cb1653-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1653-30"><a href="heat-plots.html#cb1653-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                                    <span class="co"># simplify background</span></span>
<span id="cb1653-31"><a href="heat-plots.html#cb1653-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1653-32"><a href="heat-plots.html#cb1653-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1653-33"><a href="heat-plots.html#cb1653-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1653-34"><a href="heat-plots.html#cb1653-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text  =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1653-35"><a href="heat-plots.html#cb1653-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),           <span class="co"># height of legend key</span></span>
<span id="cb1653-36"><a href="heat-plots.html#cb1653-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width  =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>,<span class="st">&quot;cm&quot;</span>),         <span class="co"># width of legend key</span></span>
<span id="cb1653-37"><a href="heat-plots.html#cb1653-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1653-38"><a href="heat-plots.html#cb1653-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),              <span class="co"># axis text size</span></span>
<span id="cb1653-39"><a href="heat-plots.html#cb1653-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="fl">0.2</span>),            <span class="co"># axis text alignment</span></span>
<span id="cb1653-40"><a href="heat-plots.html#cb1653-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.4</span>),               </span>
<span id="cb1653-41"><a href="heat-plots.html#cb1653-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">&quot;bold&quot;</span>),  <span class="co"># axis title size and bold</span></span>
<span id="cb1653-42"><a href="heat-plots.html#cb1653-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1653-43"><a href="heat-plots.html#cb1653-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">14</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),  <span class="co"># title right-aligned, large, bold</span></span>
<span id="cb1653-44"><a href="heat-plots.html#cb1653-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)  <span class="co"># caption right-aligned and italic</span></span>
<span id="cb1653-45"><a href="heat-plots.html#cb1653-45" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb1653-46"><a href="heat-plots.html#cb1653-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1653-47"><a href="heat-plots.html#cb1653-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot labels</span></span>
<span id="cb1653-48"><a href="heat-plots.html#cb1653-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>,</span>
<span id="cb1653-49"><a href="heat-plots.html#cb1653-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Facility name&quot;</span>,</span>
<span id="cb1653-50"><a href="heat-plots.html#cb1653-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Reporting</span><span class="sc">\n</span><span class="st">performance (%)&quot;</span>,           <span class="co"># legend title, because legend shows fill</span></span>
<span id="cb1653-51"><a href="heat-plots.html#cb1653-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Percent of days per week that facility reported data&quot;</span>,</span>
<span id="cb1653-52"><a href="heat-plots.html#cb1653-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;District health facilities, May-July 2020&quot;</span>,</span>
<span id="cb1653-53"><a href="heat-plots.html#cb1653-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;7-day weeks beginning on Mondays.&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1262-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-27" class="section level2" number="34.4">
<h2><span class="header-section-number">34.4</span> Resources</h2>
<p><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient()</a></p>
<p><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">R graph gallery - heatmap</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-08-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
