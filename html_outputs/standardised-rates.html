<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>21 Standardised rates | The Epidemiologist R Handbook</title>

    <meta name="author" content="the handbook team" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/header-attrs-2.9/header-attrs.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.2.5.1/tabs.js"></script>
    <script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.18/datatables.js"></script>
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.9.3/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
    <link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
    <script src="libs/vis-4.20.1/vis.min.js"></script>
    <script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-1.57.1/plotly-basic-1.57.1.min.js"></script>
    <script src="libs/plotly-cartesian-1.57.1/plotly-cartesian-1.57.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-8.1.2/highcharts.js"></script>
    <script src="libs/highcharts-8.1.2/highcharts-3d.js"></script>
    <script src="libs/highcharts-8.1.2/highcharts-more.js"></script>
    <script src="libs/highcharts-8.1.2/modules/stock.js"></script>
    <script src="libs/highcharts-8.1.2/modules/map.js"></script>
    <script src="libs/highcharts-8.1.2/modules/annotations.js"></script>
    <script src="libs/highcharts-8.1.2/modules/data.js"></script>
    <script src="libs/highcharts-8.1.2/modules/drilldown.js"></script>
    <script src="libs/highcharts-8.1.2/modules/item-series.js"></script>
    <script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-8.1.2/modules/exporting.js"></script>
    <script src="libs/highcharts-8.1.2/modules/export-data.js"></script>
    <script src="libs/highcharts-8.1.2/modules/funnel.js"></script>
    <script src="libs/highcharts-8.1.2/modules/heatmap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/treemap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/sankey.js"></script>
    <script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-8.1.2/modules/organization.js"></script>
    <script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script>
    <script src="libs/highcharts-8.1.2/modules/sunburst.js"></script>
    <script src="libs/highcharts-8.1.2/modules/vector.js"></script>
    <script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script>
    <script src="libs/highcharts-8.1.2/modules/xrange.js"></script>
    <script src="libs/highcharts-8.1.2/modules/tilemap.js"></script>
    <script src="libs/highcharts-8.1.2/modules/venn.js"></script>
    <script src="libs/highcharts-8.1.2/modules/gantt.js"></script>
    <script src="libs/highcharts-8.1.2/modules/timeline.js"></script>
    <script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-8.1.2/modules/bullet.js"></script>
    <script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script>
    <script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script>
    <script src="libs/highcharts-8.1.2/modules/lollipop.js"></script>
    <script src="libs/highcharts-8.1.2/modules/series-label.js"></script>
    <script src="libs/highcharts-8.1.2/plugins/motion.js"></script>
    <script src="libs/highcharts-8.1.2/custom/reset.js"></script>
    <script src="libs/highcharts-8.1.2/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.8.2/highchart.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>

  <!-- CSS -->
    <link rel="stylesheet" href="style_bs4.css" />
    
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">The Epidemiologist R Handbook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="standardised-rates" class="section level1" number="21">
<h1><span class="header-section-number">21</span> Standardised rates</h1>
<p>This page will show you two ways to standardize an outcome, such as hospitalizations or mortality, by characteristics such as age and sex.</p>
<ul>
<li>Using <strong>dsr</strong> package</li>
<li>Using <strong>PHEindicatormethods</strong> package</li>
</ul>
<p>We begin by extensively demonstrating the processes of data preparation/cleaning/joining, as this is common when combining population data from multiple countries, standard population data, deaths, etc.</p>
<div id="overview-1" class="section level2" number="21.1">
<h2><span class="header-section-number">21.1</span> Overview</h2>
<p>There are two main ways to standardize: direct and indirect standardization.
Let’s say we would like to the standardize mortality rate by age and sex for country A and country B, and compare the standardized rates between these countries.</p>
<ul>
<li>For direct standardization, you will have to know the number of the at-risk population and the number of deaths for each stratum of age and sex, for country A and country B. One stratum in our example could be females between ages 15-44.<br />
</li>
<li>For indirect standardization, you only need to know the total number of deaths and the age- and sex structure of each country. This option is therefore feasible if age- and sex-specific mortality rates or population numbers are not available. Indirect standardization is furthermore preferable in case of small numbers per stratum, as estimates in direct standardization would be influenced by substantial sampling variation.</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="preparation-12" class="section level2" number="21.2">
<h2><span class="header-section-number">21.2</span> Preparation</h2>
<p>To show how standardization is done, we will use fictitious population counts and death counts from country A and country B, by age (in 5 year categories) and sex (female, male). To make the datasets ready for use, we will perform the following preparation steps:</p>
<ol style="list-style-type: decimal">
<li>Load packages<br />
</li>
<li>Load datasets<br />
</li>
<li>Join the population and death data from the two countries</li>
<li>Pivot longer so there is one row per age-sex stratum</li>
<li>Clean the reference population (world standard population) and join it to the country data</li>
</ol>
<p>In your scenario, your data may come in a different format. Perhaps your data are by province, city, or other catchment area. You may have one row for each death and information on age and sex for each (or a significant proportion) of these deaths. In this case, see the pages on <a href="grouping-data.html#grouping-data">Grouping data</a>, <a href="pivoting-data.html#pivoting-data">Pivoting data</a>, and <a href="descriptive-tables.html#descriptive-tables">Descriptive tables</a> to create a dataset with event and population counts per age-sex stratum.</p>
<p>We also need a reference population, the standard population. For the purposes of this exercise we will use the <code>world_standard_population_by_sex</code>. The World standard population is based on the populations of 46 countries and was developed in 1960. There are many “standard” populations - as one example, the website of <a href="https://www.opendata.nhs.scot/dataset/standard-populations">NHS Scotland</a> is quite informative on the European Standard Population, World Standard Population and Scotland Standard Population.</p>
<!-- ======================================================= -->
<div id="load-packages-14" class="section level3 unnumbered">
<h3>Load packages</h3>
<p>This code chunk shows the loading of packages required for the analyses. In this handbook we emphasize <code>p_load()</code> from <strong>pacman</strong>, which installs the package if necessary <em>and</em> loads it for use. You can also load installed packages with <code>library()</code> from <strong>base</strong> R. See the page on <a href="r-basics.html#r-basics">R basics</a> for more information on R packages.</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="standardised-rates.html#cb1079-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1079-2"><a href="standardised-rates.html#cb1079-2" aria-hidden="true" tabindex="-1"></a>     rio,                 <span class="co"># import/export data</span></span>
<span id="cb1079-3"><a href="standardised-rates.html#cb1079-3" aria-hidden="true" tabindex="-1"></a>     here,                <span class="co"># locate files</span></span>
<span id="cb1079-4"><a href="standardised-rates.html#cb1079-4" aria-hidden="true" tabindex="-1"></a>     tidyverse,           <span class="co"># data management and visualization</span></span>
<span id="cb1079-5"><a href="standardised-rates.html#cb1079-5" aria-hidden="true" tabindex="-1"></a>     stringr,             <span class="co"># cleaning characters and strings</span></span>
<span id="cb1079-6"><a href="standardised-rates.html#cb1079-6" aria-hidden="true" tabindex="-1"></a>     frailtypack,         <span class="co"># needed for dsr, for frailty models</span></span>
<span id="cb1079-7"><a href="standardised-rates.html#cb1079-7" aria-hidden="true" tabindex="-1"></a>     dsr,                 <span class="co"># standardise rates</span></span>
<span id="cb1079-8"><a href="standardised-rates.html#cb1079-8" aria-hidden="true" tabindex="-1"></a>     PHEindicatormethods) <span class="co"># alternative for rate standardisation</span></span></code></pre></div>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If you have a newer version of R, the <strong>dsr</strong> package cannot be directly downloaded from CRAN. However, it is still available from the CRAN archive. You can install and use this one. </span></p>
<p>For non-Mac users:</p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="standardised-rates.html#cb1080-1" aria-hidden="true" tabindex="-1"></a>packageurl <span class="ot">&lt;-</span> <span class="st">&quot;https://cran.r-project.org/src/contrib/Archive/dsr/dsr_0.2.2.tar.gz&quot;</span></span>
<span id="cb1080-2"><a href="standardised-rates.html#cb1080-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(packageurl, <span class="at">repos=</span><span class="cn">NULL</span>, <span class="at">type=</span><span class="st">&quot;source&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="standardised-rates.html#cb1081-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Other solution that may work</span></span>
<span id="cb1081-2"><a href="standardised-rates.html#cb1081-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(devtools)</span>
<span id="cb1081-3"><a href="standardised-rates.html#cb1081-3" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_version</span>(<span class="st">&quot;dsr&quot;</span>, <span class="at">version=</span><span class="st">&quot;0.2.2&quot;</span>, <span class="at">repos=</span><span class="st">&quot;http:/cran.us.r.project.org&quot;</span>)</span></code></pre></div>
<p>For Mac users:</p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="standardised-rates.html#cb1082-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(devtools)</span>
<span id="cb1082-2"><a href="standardised-rates.html#cb1082-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_version</span>(<span class="st">&quot;dsr&quot;</span>, <span class="at">version=</span><span class="st">&quot;0.2.2&quot;</span>, <span class="at">repos=</span><span class="st">&quot;https://mac.R-project.org&quot;</span>)</span></code></pre></div>
</div>
<div id="load-population-data" class="section level3 unnumbered">
<h3>Load population data</h3>
<p>See the <a href="download-handbook-and-data.html#download-handbook-and-data">Download handbook and data</a> page for instructions on how to download all the example data in the handbook. You can import the Standardisation page data directly into R from our Github repository by running the following <code>import()</code> commands:</p>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="standardised-rates.html#cb1083-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import demographics for country A directly from Github</span></span>
<span id="cb1083-2"><a href="standardised-rates.html#cb1083-2" aria-hidden="true" tabindex="-1"></a>A_demo <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/country_demographics.csv&quot;</span>)</span>
<span id="cb1083-3"><a href="standardised-rates.html#cb1083-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-4"><a href="standardised-rates.html#cb1083-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import deaths for country A directly from Github</span></span>
<span id="cb1083-5"><a href="standardised-rates.html#cb1083-5" aria-hidden="true" tabindex="-1"></a>A_deaths <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/deaths_countryA.csv&quot;</span>)</span>
<span id="cb1083-6"><a href="standardised-rates.html#cb1083-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-7"><a href="standardised-rates.html#cb1083-7" aria-hidden="true" tabindex="-1"></a><span class="co"># import demographics for country B directly from Github</span></span>
<span id="cb1083-8"><a href="standardised-rates.html#cb1083-8" aria-hidden="true" tabindex="-1"></a>B_demo <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/country_demographics_2.csv&quot;</span>)</span>
<span id="cb1083-9"><a href="standardised-rates.html#cb1083-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-10"><a href="standardised-rates.html#cb1083-10" aria-hidden="true" tabindex="-1"></a><span class="co"># import deaths for country B directly from Github</span></span>
<span id="cb1083-11"><a href="standardised-rates.html#cb1083-11" aria-hidden="true" tabindex="-1"></a>B_deaths <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/deaths_countryB.csv&quot;</span>)</span>
<span id="cb1083-12"><a href="standardised-rates.html#cb1083-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-13"><a href="standardised-rates.html#cb1083-13" aria-hidden="true" tabindex="-1"></a><span class="co"># import demographics for country B directly from Github</span></span>
<span id="cb1083-14"><a href="standardised-rates.html#cb1083-14" aria-hidden="true" tabindex="-1"></a>standard_pop_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/world_standard_population_by_sex.csv&quot;</span>)</span></code></pre></div>
<p>First we load the demographic data (counts of males and females by 5-year age category) for the two countries that we will be comparing, “Country A” and “Country B”.</p>
<div class="sourceCode" id="cb1084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1084-1"><a href="standardised-rates.html#cb1084-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Country A</span></span>
<span id="cb1084-2"><a href="standardised-rates.html#cb1084-2" aria-hidden="true" tabindex="-1"></a>A_demo <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;country_demographics.csv&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-c853848d74e43691be29" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c853848d74e43691be29">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[7828087,6705882,5601230,4576430,3734111,3111651,2571215,2121247,1735468,1418749,1145345,900239,685141,500248,347093,202240,94325,40402],[7674675,6592449,5522555,4533885,3726537,3118040,2592416,2150490,1771213,1459439,1193903,956070,745682,563894,416543,258538,130479,64656]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="standardised-rates.html#cb1085-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Country B</span></span>
<span id="cb1085-2"><a href="standardised-rates.html#cb1085-2" aria-hidden="true" tabindex="-1"></a>B_demo <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;country_demographics_2.csv&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-33cbc55aa8a8eccf7dc2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-33cbc55aa8a8eccf7dc2">{"x":{"filter":"none","data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[513458,508728,673522,844532,965423,1243552,1400065,1428773,1546221,1562880,2355220,2324555,2988200,2527110,1552200,1466902,876251,1073611],[503262,559249,652455,145453,965237,1238640,1392676,1505040,1671213,1459439,2218733,3528103,3204770,2500130,1683925,1683828,987362,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="load-death-counts" class="section level3 unnumbered">
<h3>Load death counts</h3>
<p>Conveniently, we also have the counts of deaths during the time period of interest, by age and sex. Each country’s counts are in a separate file, shown below.</p>
<p>Deaths in Country A</p>
<div id="htmlwidget-ba4e3a021af1fdfcc57e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ba4e3a021af1fdfcc57e">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[224,257,251,245,334,245,154,189,334,342,565,432,543,432,245,543,234,354],[194,254,232,214,316,224,163,167,354,354,463,574,493,295,175,380,177,392]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Deaths in Country B</p>
<div id="htmlwidget-92bef9c38b3ab088700b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-92bef9c38b3ab088700b">{"x":{"filter":"none","data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[34,37,51,145,434,120,100,143,307,354,463,639,706,232,275,543,234,274],[54,24,32,154,276,254,123,164,254,354,453,654,435,354,165,432,287,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="clean-populations-and-deaths" class="section level3 unnumbered">
<h3>Clean populations and deaths</h3>
<p>We need to join and transform these data in the following ways:</p>
<ul>
<li>Combine country populations into one dataset and pivot “long” so that each age-sex stratum is one row<br />
</li>
<li>Combine country death counts into one dataset and pivot “long” so each age-sex stratum is one row<br />
</li>
<li>Join the deaths to the populations</li>
</ul>
<p>First, we combine the country populations datasets, pivot longer, and do minor cleaning. See the page on <a href="pivoting-data.html#pivoting-data">Pivoting data</a> for more detail.</p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="standardised-rates.html#cb1086-1" aria-hidden="true" tabindex="-1"></a>pop_countries <span class="ot">&lt;-</span> A_demo <span class="sc">%&gt;%</span>  <span class="co"># begin with country A dataset</span></span>
<span id="cb1086-2"><a href="standardised-rates.html#cb1086-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">bind_rows</span>(B_demo) <span class="sc">%&gt;%</span>        <span class="co"># bind rows, because cols are identically named</span></span>
<span id="cb1086-3"><a href="standardised-rates.html#cb1086-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">pivot_longer</span>(                       <span class="co"># pivot longer</span></span>
<span id="cb1086-4"><a href="standardised-rates.html#cb1086-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cols =</span> <span class="fu">c</span>(m, f),                   <span class="co"># columns to combine into one</span></span>
<span id="cb1086-5"><a href="standardised-rates.html#cb1086-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_to =</span> <span class="st">&quot;Sex&quot;</span>,                 <span class="co"># name for new column containing the category (&quot;m&quot; or &quot;f&quot;) </span></span>
<span id="cb1086-6"><a href="standardised-rates.html#cb1086-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">values_to =</span> <span class="st">&quot;Population&quot;</span>) <span class="sc">%&gt;%</span>     <span class="co"># name for new column containing the numeric values pivoted</span></span>
<span id="cb1086-7"><a href="standardised-rates.html#cb1086-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">Sex =</span> <span class="fu">recode</span>(Sex,            <span class="co"># re-code values for clarity</span></span>
<span id="cb1086-8"><a href="standardised-rates.html#cb1086-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;m&quot;</span> <span class="ot">=</span> <span class="st">&quot;Male&quot;</span>,</span>
<span id="cb1086-9"><a href="standardised-rates.html#cb1086-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;f&quot;</span> <span class="ot">=</span> <span class="st">&quot;Female&quot;</span>))</span></code></pre></div>
<p>The combined population data now look like this (click through to see countries A and B):</p>
<div id="htmlwidget-25979a425bfb6287d9c7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-25979a425bfb6287d9c7">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>And now we perform similar operations on the two deaths datasets.</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="standardised-rates.html#cb1087-1" aria-hidden="true" tabindex="-1"></a>deaths_countries <span class="ot">&lt;-</span> A_deaths <span class="sc">%&gt;%</span>    <span class="co"># begin with country A deaths dataset</span></span>
<span id="cb1087-2"><a href="standardised-rates.html#cb1087-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">bind_rows</span>(B_deaths) <span class="sc">%&gt;%</span>        <span class="co"># bind rows with B dataset, because cols are identically named</span></span>
<span id="cb1087-3"><a href="standardised-rates.html#cb1087-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">pivot_longer</span>(                  <span class="co"># pivot longer</span></span>
<span id="cb1087-4"><a href="standardised-rates.html#cb1087-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cols =</span> <span class="fu">c</span>(Male, Female),        <span class="co"># column to transform into one</span></span>
<span id="cb1087-5"><a href="standardised-rates.html#cb1087-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_to =</span> <span class="st">&quot;Sex&quot;</span>,              <span class="co"># name for new column containing the category (&quot;m&quot; or &quot;f&quot;) </span></span>
<span id="cb1087-6"><a href="standardised-rates.html#cb1087-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">values_to =</span> <span class="st">&quot;Deaths&quot;</span>) <span class="sc">%&gt;%</span>      <span class="co"># name for new column containing the numeric values pivoted</span></span>
<span id="cb1087-7"><a href="standardised-rates.html#cb1087-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rename</span>(<span class="at">age_cat5 =</span> AgeCat)      <span class="co"># rename for clarity</span></span></code></pre></div>
<p>The deaths data now look like this, and contain data from both countries:</p>
<div id="htmlwidget-5fd0f5bdf321f3c98654" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5fd0f5bdf321f3c98654">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>We now join the deaths and population data based on common columns <code>Country</code>, <code>age_cat5</code>, and <code>Sex</code>. This adds the column <code>Deaths</code>.</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="standardised-rates.html#cb1088-1" aria-hidden="true" tabindex="-1"></a>country_data <span class="ot">&lt;-</span> pop_countries <span class="sc">%&gt;%</span> </span>
<span id="cb1088-2"><a href="standardised-rates.html#cb1088-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">left_join</span>(deaths_countries, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Country&quot;</span>, <span class="st">&quot;age_cat5&quot;</span>, <span class="st">&quot;Sex&quot;</span>))</span></code></pre></div>
<p>We can now classify <code>Sex</code>, <code>age_cat5</code>, and <code>Country</code> as factors and set the level order using <code>fct_relevel()</code> function from the <strong>forcats</strong> package, as described in the page on <a href="factors.html#factors">Factors</a>. Note, classifying the factor levels doesn’t visibly change the data, but the <code>arrange()</code> command does sort it by Country, age category, and sex.</p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="standardised-rates.html#cb1089-1" aria-hidden="true" tabindex="-1"></a>country_data <span class="ot">&lt;-</span> country_data <span class="sc">%&gt;%</span> </span>
<span id="cb1089-2"><a href="standardised-rates.html#cb1089-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1089-3"><a href="standardised-rates.html#cb1089-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Country =</span> <span class="fu">fct_relevel</span>(Country, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb1089-4"><a href="standardised-rates.html#cb1089-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1089-5"><a href="standardised-rates.html#cb1089-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">fct_relevel</span>(Sex, <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>),</span>
<span id="cb1089-6"><a href="standardised-rates.html#cb1089-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1089-7"><a href="standardised-rates.html#cb1089-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_cat5 =</span> <span class="fu">fct_relevel</span>(</span>
<span id="cb1089-8"><a href="standardised-rates.html#cb1089-8" aria-hidden="true" tabindex="-1"></a>      age_cat5,</span>
<span id="cb1089-9"><a href="standardised-rates.html#cb1089-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>,</span>
<span id="cb1089-10"><a href="standardised-rates.html#cb1089-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;20-24&quot;</span>, <span class="st">&quot;25-29&quot;</span>,  <span class="st">&quot;30-34&quot;</span>, <span class="st">&quot;35-39&quot;</span>,</span>
<span id="cb1089-11"><a href="standardised-rates.html#cb1089-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;40-44&quot;</span>, <span class="st">&quot;45-49&quot;</span>, <span class="st">&quot;50-54&quot;</span>, <span class="st">&quot;55-59&quot;</span>,</span>
<span id="cb1089-12"><a href="standardised-rates.html#cb1089-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;60-64&quot;</span>, <span class="st">&quot;65-69&quot;</span>, <span class="st">&quot;70-74&quot;</span>,</span>
<span id="cb1089-13"><a href="standardised-rates.html#cb1089-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;75-79&quot;</span>, <span class="st">&quot;80-84&quot;</span>, <span class="st">&quot;85&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1089-14"><a href="standardised-rates.html#cb1089-14" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb1089-15"><a href="standardised-rates.html#cb1089-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Country, age_cat5, Sex)</span></code></pre></div>
<div id="htmlwidget-609ac882d4ad03c67528" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-609ac882d4ad03c67528">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n      <th>Deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If you have few deaths per stratum, consider using 10-, or 15-year categories, instead of 5-year categories for age.</span></p>
</div>
<div id="load-reference-population" class="section level3 unnumbered">
<h3>Load reference population</h3>
<p>Lastly, for the direct standardisation, we import the reference population (world “standard population” by sex)</p>
<div class="sourceCode" id="cb1090"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1090-1"><a href="standardised-rates.html#cb1090-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reference population</span></span>
<span id="cb1090-2"><a href="standardised-rates.html#cb1090-2" aria-hidden="true" tabindex="-1"></a>standard_pop_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;world_standard_population_by_sex.csv&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-9b3a94451320872b63ca" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9b3a94451320872b63ca">{"x":{"filter":"none","data":[["0-4 years","0-4 years","5-9 years","5-9 years","10-14 years","10-14 years","15-19 years","15-19 years","20-24 years","20-24 years","25-29 years","25-29 years","30-34 years","30-34 years","35-39 years","35-39 years","40-44 years","40-44 years","45-49 years","45-49 years","50-54 years","50-54 years","55-59 years","55-59 years","60-64 years","60-64 years","65-69 years","65-69 years","70-74 years","70-74 years","75-79 years","75-79 years","80-84 years","80-84 years","85plus years","85plus years"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>WorldStandardPopulation<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
<div id="clean-reference-population" class="section level3 unnumbered">
<h3>Clean reference population</h3>
<p>The age category values in the <code>country_data</code> and <code>standard_pop_data</code> data frames will need to be aligned.</p>
<p>Currently, the values of the column <code>age_cat5</code> from the <code>standard_pop_data</code> data frame contain the word “years” and “plus”, while those of the <code>country_data</code> data frame do not. We will have to make the age category values match. We use <code>str_replace_all()</code> from the <strong>stringr</strong> package, as described in the page on <a href="characters-and-strings.html#characters-and-strings">Characters and strings</a>, to replace these patterns with no space <code>""</code>.</p>
<p>Furthermore, the package <strong>dsr</strong> expects that in the standard population, the column containing counts will be called <code>"pop"</code>. So we rename that column accordingly.</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="standardised-rates.html#cb1091-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove specific string from column values</span></span>
<span id="cb1091-2"><a href="standardised-rates.html#cb1091-2" aria-hidden="true" tabindex="-1"></a>standard_pop_clean <span class="ot">&lt;-</span> standard_pop_data <span class="sc">%&gt;%</span></span>
<span id="cb1091-3"><a href="standardised-rates.html#cb1091-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb1091-4"><a href="standardised-rates.html#cb1091-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat5 =</span> <span class="fu">str_replace_all</span>(age_cat5, <span class="st">&quot;years&quot;</span>, <span class="st">&quot;&quot;</span>),   <span class="co"># remove &quot;year&quot;</span></span>
<span id="cb1091-5"><a href="standardised-rates.html#cb1091-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat5 =</span> <span class="fu">str_replace_all</span>(age_cat5, <span class="st">&quot;plus&quot;</span>, <span class="st">&quot;&quot;</span>),    <span class="co"># remove &quot;plus&quot;</span></span>
<span id="cb1091-6"><a href="standardised-rates.html#cb1091-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">age_cat5 =</span> <span class="fu">str_replace_all</span>(age_cat5, <span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span>   <span class="co"># remove &quot; &quot; space</span></span>
<span id="cb1091-7"><a href="standardised-rates.html#cb1091-7" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb1091-8"><a href="standardised-rates.html#cb1091-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rename</span>(<span class="at">pop =</span> WorldStandardPopulation)   <span class="co"># change col name to &quot;pop&quot;, as this is expected by dsr package</span></span></code></pre></div>
<p><span style="color: orange;"><strong><em>CAUTION:</em></strong> If you try to use <code>str_replace_all()</code> to remove a plus <em>symbol</em>, it won’t work because it is a special symbol. “Escape” the specialnes by putting two back slashes in front, as in <code>str_replace_call(column, "\\+", "")</code>. </span></p>
</div>
<div id="standard_all" class="section level3 unnumbered">
<h3>Create dataset with standard population</h3>
<p>Finally, the package <strong>PHEindicatormethods</strong>, detailed <a href="standardised-rates.html#standard_phe">below</a>, expects the standard populations joined to the country event and population counts. So, we will create a dataset <code>all_data</code> for that purpose.</p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1092-1"><a href="standardised-rates.html#cb1092-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(country_data, standard_pop_clean, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;age_cat5&quot;</span>, <span class="st">&quot;Sex&quot;</span>))</span></code></pre></div>
<p>This complete dataset looks like this:</p>
<div id="htmlwidget-62c93ddc96a2ad803c4c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-62c93ddc96a2ad803c4c">{"x":{"filter":"none","data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500,12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n      <th>Deaths<\/th>\n      <th>pop<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
</div>
<div id="dsr-package" class="section level2" number="21.3">
<h2><span class="header-section-number">21.3</span> <strong>dsr</strong> package</h2>
<p>Below we demonstrate calculating and comparing directly standardized rates using the <strong>dsr</strong> package. The <strong>dsr</strong> package allows you to calculate and compare directly standardized rates (no indirectly standardized rates!).</p>
<p>In the data Preparation section, we made separate datasets for country counts and standard population:</p>
<ol style="list-style-type: decimal">
<li>the <code>country_data</code> object, which is a population table with the number of population and number of deaths per stratum per country<br />
</li>
<li>the <code>standard_pop_clean</code> object, containing the number of population per stratum for our reference population, the World Standard Population</li>
</ol>
<p>We will use these separate datasets for the <strong>dsr</strong> approach.</p>
<!-- ======================================================= -->
<div id="standardized-rates" class="section level3 unnumbered">
<h3>Standardized rates</h3>
<p>Below, we calculate rates per country directly standardized for age and sex. We use the <code>dsr()</code> function.</p>
<p>Of note - <code>dsr()</code> expects one data frame for the country populations and event counts (deaths), <em>and a <strong>separate</strong> data frame with the reference population</em>. It also expects that in this reference population dataset the unit-time column name is “pop” (we assured this in the data Preparation section).</p>
<p>There are many arguments, as annotated in the code below. Notably, <code>event =</code> is set to the column <code>Deaths</code>, and the <code>fu =</code> (“follow-up”) is set to the <code>Population</code> column. We set the subgroups of comparison as the column <code>Country</code> and we standardize based on <code>age_cat5</code> and <code>Sex</code>. These last two columns are not assigned a particular named argument. See <code>?dsr</code> for details.</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="standardised-rates.html#cb1093-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate rates per country directly standardized for age and sex</span></span>
<span id="cb1093-2"><a href="standardised-rates.html#cb1093-2" aria-hidden="true" tabindex="-1"></a>mortality_rate <span class="ot">&lt;-</span> dsr<span class="sc">::</span><span class="fu">dsr</span>(</span>
<span id="cb1093-3"><a href="standardised-rates.html#cb1093-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> country_data,  <span class="co"># specify object containing number of deaths per stratum</span></span>
<span id="cb1093-4"><a href="standardised-rates.html#cb1093-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">event =</span> Deaths,       <span class="co"># column containing number of deaths per stratum </span></span>
<span id="cb1093-5"><a href="standardised-rates.html#cb1093-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">fu =</span> Population,      <span class="co"># column containing number of population per stratum</span></span>
<span id="cb1093-6"><a href="standardised-rates.html#cb1093-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">subgroup =</span> Country,   <span class="co"># units we would like to compare</span></span>
<span id="cb1093-7"><a href="standardised-rates.html#cb1093-7" aria-hidden="true" tabindex="-1"></a>     age_cat5,             <span class="co"># other columns - rates will be standardized by these</span></span>
<span id="cb1093-8"><a href="standardised-rates.html#cb1093-8" aria-hidden="true" tabindex="-1"></a>     Sex,</span>
<span id="cb1093-9"><a href="standardised-rates.html#cb1093-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">refdata =</span> standard_pop_clean, <span class="co"># reference population data frame, with column called pop</span></span>
<span id="cb1093-10"><a href="standardised-rates.html#cb1093-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">method =</span> <span class="st">&quot;gamma&quot;</span>,      <span class="co"># method to calculate 95% CI</span></span>
<span id="cb1093-11"><a href="standardised-rates.html#cb1093-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">sig =</span> <span class="fl">0.95</span>,            <span class="co"># significance level</span></span>
<span id="cb1093-12"><a href="standardised-rates.html#cb1093-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">mp =</span> <span class="dv">100000</span>,           <span class="co"># we want rates per 100.000 population</span></span>
<span id="cb1093-13"><a href="standardised-rates.html#cb1093-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">decimals =</span> <span class="dv">2</span>)          <span class="co"># number of decimals)</span></span>
<span id="cb1093-14"><a href="standardised-rates.html#cb1093-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1093-15"><a href="standardised-rates.html#cb1093-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1093-16"><a href="standardised-rates.html#cb1093-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print output as nice-looking HTML table</span></span>
<span id="cb1093-17"><a href="standardised-rates.html#cb1093-17" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(mortality_rate) <span class="co"># show mortality rate before and after direct standardization</span></span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Subgroup
</th>
<th style="text-align:right;">
Numerator
</th>
<th style="text-align:right;">
Denominator
</th>
<th style="text-align:right;">
Crude Rate (per 100000)
</th>
<th style="text-align:right;">
95% LCL (Crude)
</th>
<th style="text-align:right;">
95% UCL (Crude)
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
95% LCL (Std)
</th>
<th style="text-align:right;">
95% UCL (Std)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
13.07
</td>
<td style="text-align:right;">
12.83
</td>
<td style="text-align:right;">
13.31
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
23.08
</td>
<td style="text-align:right;">
24.06
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
18.82
</td>
<td style="text-align:right;">
18.45
</td>
<td style="text-align:right;">
19.19
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
18.46
</td>
<td style="text-align:right;">
20.22
</td>
</tr>
</tbody>
</table>
<p>Above, we see that while country A had a lower crude mortality rate than country B, it has a higher standardized rate after direct age and sex standardization.</p>
<!-- ======================================================= -->
</div>
<div id="standardized-rate-ratios" class="section level3 unnumbered">
<h3>Standardized rate ratios</h3>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="standardised-rates.html#cb1094-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate RR</span></span>
<span id="cb1094-2"><a href="standardised-rates.html#cb1094-2" aria-hidden="true" tabindex="-1"></a>mortality_rr <span class="ot">&lt;-</span> dsr<span class="sc">::</span><span class="fu">dsrr</span>(</span>
<span id="cb1094-3"><a href="standardised-rates.html#cb1094-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> country_data, <span class="co"># specify object containing number of deaths per stratum</span></span>
<span id="cb1094-4"><a href="standardised-rates.html#cb1094-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">event =</span> Deaths,      <span class="co"># column containing number of deaths per stratum </span></span>
<span id="cb1094-5"><a href="standardised-rates.html#cb1094-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">fu =</span> Population,     <span class="co"># column containing number of population per stratum</span></span>
<span id="cb1094-6"><a href="standardised-rates.html#cb1094-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">subgroup =</span> Country,  <span class="co"># units we would like to compare</span></span>
<span id="cb1094-7"><a href="standardised-rates.html#cb1094-7" aria-hidden="true" tabindex="-1"></a>     age_cat5,</span>
<span id="cb1094-8"><a href="standardised-rates.html#cb1094-8" aria-hidden="true" tabindex="-1"></a>     Sex,                 <span class="co"># characteristics to which we would like to standardize </span></span>
<span id="cb1094-9"><a href="standardised-rates.html#cb1094-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">refdata =</span> standard_pop_clean, <span class="co"># reference population, with numbers in column called pop</span></span>
<span id="cb1094-10"><a href="standardised-rates.html#cb1094-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">refgroup =</span> <span class="st">&quot;B&quot;</span>,      <span class="co"># reference for comparison</span></span>
<span id="cb1094-11"><a href="standardised-rates.html#cb1094-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">estimate =</span> <span class="st">&quot;ratio&quot;</span>,  <span class="co"># type of estimate</span></span>
<span id="cb1094-12"><a href="standardised-rates.html#cb1094-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">sig =</span> <span class="fl">0.95</span>,          <span class="co"># significance level</span></span>
<span id="cb1094-13"><a href="standardised-rates.html#cb1094-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">mp =</span> <span class="dv">100000</span>,         <span class="co"># we want rates per 100.000 population</span></span>
<span id="cb1094-14"><a href="standardised-rates.html#cb1094-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">decimals =</span> <span class="dv">2</span>)        <span class="co"># number of decimals</span></span>
<span id="cb1094-15"><a href="standardised-rates.html#cb1094-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1094-16"><a href="standardised-rates.html#cb1094-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print table</span></span>
<span id="cb1094-17"><a href="standardised-rates.html#cb1094-17" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(mortality_rr) </span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
Rate Ratio (RR)
</th>
<th style="text-align:right;">
95% LCL (RR)
</th>
<th style="text-align:right;">
95% UCL (RR)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
1.22
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
1.27
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
1.06
</td>
</tr>
</tbody>
</table>
<p>The standardized mortality rate is 1.22 times higher in country A compared to country B (95% CI 1.17-1.27).</p>
<!-- ======================================================= -->
</div>
<div id="standardized-rate-difference" class="section level3 unnumbered">
<h3>Standardized rate difference</h3>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="standardised-rates.html#cb1095-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate RD</span></span>
<span id="cb1095-2"><a href="standardised-rates.html#cb1095-2" aria-hidden="true" tabindex="-1"></a>mortality_rd <span class="ot">&lt;-</span> dsr<span class="sc">::</span><span class="fu">dsrr</span>(</span>
<span id="cb1095-3"><a href="standardised-rates.html#cb1095-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> country_data,       <span class="co"># specify object containing number of deaths per stratum</span></span>
<span id="cb1095-4"><a href="standardised-rates.html#cb1095-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">event =</span> Deaths,            <span class="co"># column containing number of deaths per stratum </span></span>
<span id="cb1095-5"><a href="standardised-rates.html#cb1095-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">fu =</span> Population,           <span class="co"># column containing number of population per stratum</span></span>
<span id="cb1095-6"><a href="standardised-rates.html#cb1095-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">subgroup =</span> Country,        <span class="co"># units we would like to compare</span></span>
<span id="cb1095-7"><a href="standardised-rates.html#cb1095-7" aria-hidden="true" tabindex="-1"></a>     age_cat5,                  <span class="co"># characteristics to which we would like to standardize</span></span>
<span id="cb1095-8"><a href="standardised-rates.html#cb1095-8" aria-hidden="true" tabindex="-1"></a>     Sex,                        </span>
<span id="cb1095-9"><a href="standardised-rates.html#cb1095-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">refdata =</span> standard_pop_clean, <span class="co"># reference population, with numbers in column called pop</span></span>
<span id="cb1095-10"><a href="standardised-rates.html#cb1095-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">refgroup =</span> <span class="st">&quot;B&quot;</span>,            <span class="co"># reference for comparison</span></span>
<span id="cb1095-11"><a href="standardised-rates.html#cb1095-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">estimate =</span> <span class="st">&quot;difference&quot;</span>,   <span class="co"># type of estimate</span></span>
<span id="cb1095-12"><a href="standardised-rates.html#cb1095-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">sig =</span> <span class="fl">0.95</span>,                <span class="co"># significance level</span></span>
<span id="cb1095-13"><a href="standardised-rates.html#cb1095-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">mp =</span> <span class="dv">100000</span>,               <span class="co"># we want rates per 100.000 population</span></span>
<span id="cb1095-14"><a href="standardised-rates.html#cb1095-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">decimals =</span> <span class="dv">2</span>)              <span class="co"># number of decimals</span></span>
<span id="cb1095-15"><a href="standardised-rates.html#cb1095-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1095-16"><a href="standardised-rates.html#cb1095-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print table</span></span>
<span id="cb1095-17"><a href="standardised-rates.html#cb1095-17" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(mortality_rd) </span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
Rate Difference (RD)
</th>
<th style="text-align:right;">
95% LCL (RD)
</th>
<th style="text-align:right;">
95% UCL (RD)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
4.24
</td>
<td style="text-align:right;">
3.24
</td>
<td style="text-align:right;">
5.24
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-1.24
</td>
<td style="text-align:right;">
1.24
</td>
</tr>
</tbody>
</table>
<p>Country A has 4.24 additional deaths per 100.000 population (95% CI 3.24-5.24) compared to country A.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="standard_phe" class="section level2" number="21.4">
<h2><span class="header-section-number">21.4</span> <strong>PHEindicatormethods</strong> package</h2>
<p>Another way of calculating standardized rates is with the <strong>PHEindicatormethods</strong> package. This package allows you to calculate directly as well as indirectly standardized rates. We will show both.</p>
<p>This section will use the <code>all_data</code> data frame created at the end of the Preparation section. This data frame includes the country populations, death events, and the world standard reference population. You can view it <a href="standardised-rates.html#standard_all">here</a>.</p>
<!-- ======================================================= -->
<div id="directly-standardized-rates" class="section level3 unnumbered">
<h3>Directly standardized rates</h3>
<p>Below, we first group the data by Country and then pass it to the function <code>phe_dsr()</code> to get directly standardized rates per country.</p>
<p>Of note - the reference (standard) population can be provided as a <strong>column within the country-specific data frame</strong> or as a <strong>separate vector</strong>. If provided within the country-specific data frame, you have to set <code>stdpoptype = "field"</code>. If provided as a vector, set <code>stdpoptype = "vector"</code>. In the latter case, you have to make sure the ordering of rows by strata is similar in both the country-specific data frame and the reference population, as records will be matched by position. In our example below, we provided the reference population as a column within the country-specific data frame.</p>
<p>See the help with <code>?phr_dsr</code> or the links in the References section for more information.</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="standardised-rates.html#cb1096-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate rates per country directly standardized for age and sex</span></span>
<span id="cb1096-2"><a href="standardised-rates.html#cb1096-2" aria-hidden="true" tabindex="-1"></a>mortality_ds_rate_phe <span class="ot">&lt;-</span> all_data <span class="sc">%&gt;%</span></span>
<span id="cb1096-3"><a href="standardised-rates.html#cb1096-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span></span>
<span id="cb1096-4"><a href="standardised-rates.html#cb1096-4" aria-hidden="true" tabindex="-1"></a>     PHEindicatormethods<span class="sc">::</span><span class="fu">phe_dsr</span>(</span>
<span id="cb1096-5"><a href="standardised-rates.html#cb1096-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> Deaths,                 <span class="co"># column with observed number of events</span></span>
<span id="cb1096-6"><a href="standardised-rates.html#cb1096-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> Population,             <span class="co"># column with non-standard pops for each stratum</span></span>
<span id="cb1096-7"><a href="standardised-rates.html#cb1096-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">stdpop =</span> pop,               <span class="co"># standard populations for each stratum</span></span>
<span id="cb1096-8"><a href="standardised-rates.html#cb1096-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">stdpoptype =</span> <span class="st">&quot;field&quot;</span>)       <span class="co"># either &quot;vector&quot; for a standalone vector or &quot;field&quot; meaning std populations are in the data  </span></span>
<span id="cb1096-9"><a href="standardised-rates.html#cb1096-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1096-10"><a href="standardised-rates.html#cb1096-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print table</span></span>
<span id="cb1096-11"><a href="standardised-rates.html#cb1096-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(mortality_ds_rate_phe)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Country
</th>
<th style="text-align:right;">
total_count
</th>
<th style="text-align:right;">
total_pop
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
lowercl
</th>
<th style="text-align:right;">
uppercl
</th>
<th style="text-align:left;">
confidence
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
23.56686
</td>
<td style="text-align:right;">
23.08107
</td>
<td style="text-align:right;">
24.05944
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
19.32549
</td>
<td style="text-align:right;">
18.45516
</td>
<td style="text-align:right;">
20.20882
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
</tbody>
</table>
<!-- ======================================================= -->
</div>
<div id="standard_indirect" class="section level3 unnumbered">
<h3>Indirectly standardized rates</h3>
<p>For indirect standardization, you need a reference population with the number of deaths and number of population per stratum. In this example, we will be calculating rates for country A <em>using country B as the reference population</em>, as the <code>standard_pop_clean</code> reference population does not include number of deaths per stratum.</p>
<p>Below, we first create the reference population from country B. Then, we pass mortality and population data for country A, combine it with the reference population, and pass it to the function <code>phe_isr()</code>, to get indirectly standardized rates. Of course, you can do it also vice versa.</p>
<p>Of note - in our example below, the reference population is provided as a separate data frame. In this case, we make sure that <code>x =</code>, <code>n =</code>, <code>x_ref =</code> and <code>n_ref =</code> vectors are all ordered by the same standardization category (stratum) values as that in our country-specific data frame, as records will be matched by position.</p>
<p>See the help with <code>?phr_isr</code> or the links in the References section for more information.</p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="standardised-rates.html#cb1097-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create reference population</span></span>
<span id="cb1097-2"><a href="standardised-rates.html#cb1097-2" aria-hidden="true" tabindex="-1"></a>refpopCountryB <span class="ot">&lt;-</span> country_data <span class="sc">%&gt;%</span> </span>
<span id="cb1097-3"><a href="standardised-rates.html#cb1097-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">&quot;B&quot;</span>) </span>
<span id="cb1097-4"><a href="standardised-rates.html#cb1097-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1097-5"><a href="standardised-rates.html#cb1097-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate rates for country A indirectly standardized by age and sex</span></span>
<span id="cb1097-6"><a href="standardised-rates.html#cb1097-6" aria-hidden="true" tabindex="-1"></a>mortality_is_rate_phe_A <span class="ot">&lt;-</span> country_data <span class="sc">%&gt;%</span></span>
<span id="cb1097-7"><a href="standardised-rates.html#cb1097-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">&quot;A&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1097-8"><a href="standardised-rates.html#cb1097-8" aria-hidden="true" tabindex="-1"></a>     PHEindicatormethods<span class="sc">::</span><span class="fu">phe_isr</span>(</span>
<span id="cb1097-9"><a href="standardised-rates.html#cb1097-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> Deaths,                 <span class="co"># column with observed number of events</span></span>
<span id="cb1097-10"><a href="standardised-rates.html#cb1097-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> Population,             <span class="co"># column with non-standard pops for each stratum</span></span>
<span id="cb1097-11"><a href="standardised-rates.html#cb1097-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">x_ref =</span> refpopCountryB<span class="sc">$</span>Deaths,  <span class="co"># reference number of deaths for each stratum</span></span>
<span id="cb1097-12"><a href="standardised-rates.html#cb1097-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">n_ref =</span> refpopCountryB<span class="sc">$</span>Population)  <span class="co"># reference population for each stratum</span></span>
<span id="cb1097-13"><a href="standardised-rates.html#cb1097-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1097-14"><a href="standardised-rates.html#cb1097-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print table</span></span>
<span id="cb1097-15"><a href="standardised-rates.html#cb1097-15" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(mortality_is_rate_phe_A)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
observed
</th>
<th style="text-align:right;">
expected
</th>
<th style="text-align:right;">
ref_rate
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
lowercl
</th>
<th style="text-align:right;">
uppercl
</th>
<th style="text-align:left;">
confidence
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
15847.42
</td>
<td style="text-align:right;">
18.81914
</td>
<td style="text-align:right;">
13.47123
</td>
<td style="text-align:right;">
13.22446
</td>
<td style="text-align:right;">
13.72145
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
isr per 100000
</td>
<td style="text-align:left;">
Byars
</td>
</tr>
</tbody>
</table>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-14" class="section level2" number="21.5">
<h2><span class="header-section-number">21.5</span> Resources</h2>
<p>If you would like to see another reproducible example using <strong>dsr</strong> please see <a href="https://mran.microsoft.com/snapshot/2020-02-12/web/packages/dsr/vignettes/dsr.html">this vignette</a></p>
<p>For another example using <strong>PHEindicatormethods</strong>, please go to <a href="https://mran.microsoft.com/snapshot/2018-10-22/web/packages/PHEindicatormethods/vignettes/IntroductiontoPHEindicatormethods.html">this website</a></p>
<p>See the <strong>PHEindicatormethods</strong> <a href="https://cran.r-project.org/web/packages/PHEindicatormethods/PHEindicatormethods.pdf">reference pdf file</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>The Epidemiologist R Handbook</strong>" was written by the handbook team. It was last built on 2021-08-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
